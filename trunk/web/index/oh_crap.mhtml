<%flags>
#	inherit => undef
</%flags>

<html>
<head>
<title>Error</title>
</head>

<body>


<h2>Well, that's just unfortunate</h2>

<p>
	Looks like you just tripped over a bug in tabroom.com.
</p>
	
<p>
	The bug report has automatically been logged in the bug tracking database.
	However, if you know for a fact you were message around, doing something
	you shouldn't have, then send me email and let me know before I pull out my
	last few shreds of hair trying to figure it out, please. 
</p>

<p>
	If you have further questions, or just feel like giving me additional grief
	and make me regret writing this software in the first place even more, please
	feel free to contact me at <a href="mailto:help@tabroom.com">help@tabroom.com</a>.
</p>

<p>	
	Otherwise, your browser's back button will get you where you want to be.
</p>

<h4>Error text:</h4>

<pre>
	<% $error_text %>
</pre>


</body>
</html>

<%init>

	use Apache2::URI;
	use APR::URI;
	use MIME::Lite;
	use UNIVERSAL::can;

	my $error = $r->pnotes('error');

	my $error_text = "Page is " . $r->parsed_uri->unparse . "\n\n";

	$error_text .= UNIVERSAL::can( $error, 'as_text' ) ? $error->as_text : $error;

	$r->log_error($error_text);

	my $mail = MIME::Lite->new
	        ( From => 'error-handler@tabroom.com',
	          To   => 'errors@tabroom.com',
	          Subject => 'Sigh.  Another Application error',
	          Data => $error_text,
	        );

	$mail->send;
</%init>

