
<%args>
	$id1 => undef
	$id2 => undef
	$startdate => undef
	$enddate => undef
</%args>
<%init>
	my $debug = 0;
	use Time::HiRes qw( time );
	use Data::Dumper;
	my $start = time(); 
	my $student1 = Tab::Student->retrieve( $id1 );
	my $student2 = Tab::Student->retrieve( $id2 );

	$id1 = 105557 unless $id1;
	$id2 = 107590 unless $id1; 
	my ($panels_ref, $summary_ref) = $m->comp("entries_past_results.mas", id1 => $id1, id2 => $id2 );

	my %panels = %{$panels_ref};
	my %summary = %{$summary_ref};

	my $last_tourn = "XXX";
	
</%init>

	<& menu.mas &>
	
	<h2> Lifetime Team Record for <% $student1->first %> <% $student1->last %> and <% $student2->first %> <% $student2->last %> </h2>

	<div class="main">

		<table cellpadding="3" width="100%" id="results_table" class="tablesorter">
		<caption> <h3> Summary Table </h3></caption>
			<thead>
				<tr class="dkblue">
					<th class="smaller">Grouping</th>
					<th class="smaller">Prelim ballots</th>				
					<th class="smaller">Prelim Ballot Pct</th>								
					<th class="smaller">Prelim rounds</th>												
					<th class="smaller">Prelim round Pct</th>
					<th class="smaller">Elim ballots</th>				
					<th class="smaller">Elim ballot Pct</th>								
					<th class="smaller">Elim rounds</th>												
					<th class="smaller">Elim round Pct</th>												
				</tr>
			</thead>
			<tr>
				<td>As a team</td>
				<td><% $summary{"together"}{"prelim_ballots_won"} %>-<% $summary{"together"}{"prelim_ballots"} %></td>
%				if ( $summary{"together"}{"prelim_ballots"} == 0 ) { $summary{"together"}{"prelim_ballots"} = 1; }
				<td><% sprintf("%.1f\n", ($summary{"together"}{"prelim_ballots_won"} /$summary{"together"}{"prelim_ballots"})*100) %>%</td>
				<td><% $summary{"together"}{"prelim_wins"} %>-<% $summary{"together"}{"prelim_rds"} %></td>
%				if ( $summary{"together"}{"prelim_rds"} == 0 ) { $summary{"together"}{"prelim_rds"} = 1; }
				<td><% sprintf("%.1f\n", ($summary{"together"}{"prelim_wins"}/$summary{"together"}{"prelim_rds"})*100) %>%</td>
				<td><% $summary{"together"}{"elim_ballots_won"} %>-<% $summary{"together"}{"elim_ballots"} %></td>
				<td><% $summary{"together"}{"elim_ballots"} ? sprintf("%.1f\n", ($summary{"together"}{"elim_ballots_won"}/$summary{"together"}{"elim_ballots"})*100) : "" %>%</td>
				<td><% $summary{"together"}{"elim_wins"} %>-<% $summary{"together"}{"elim_rds"} %></td>
%				if ( $summary{"together"}{"elim_rds"} == 0 ) { $summary{"together"}{"elim_rds"} = 1; }
				<td><% sprintf("%.1f\n", ($summary{"together"}{"elim_wins"}/$summary{"together"}{"elim_rds"})*100) %>%</td>
			<tr>
			<tr>
				<td><% $student1->last %> with other partners</td>
				<td><% $summary{"spkr1"}{"prelim_ballots_won"} %>-<% $summary{"spkr1"}{"prelim_ballots"} %></td>
				<td><% $summary{"spkr1"}{"prelim_ballots"} ? sprintf("%.1f\n", ($summary{"spkr1"}{"prelim_ballots_won"}/$summary{"spkr1"}{"prelim_ballots"})*100) : "" %>%</td>
				<td><% $summary{"spkr1"}{"prelim_wins"} %>-<% $summary{"spkr1"}{"prelim_rds"} %></td>
				<td><% sprintf("%.1f\n", ($summary{"spkr1"}{"prelim_wins"}/$summary{"spkr1"}{"prelim_rds"})*100) %>%</td>
				<td><% $summary{"spkr1"}{"elim_ballots_won"} %>-<% $summary{"spkr1"}{"elim_ballots"} %></td>
				<td><% $summary{"spkr1"}{"elim_ballots"} ? sprintf("%.1f\n", ($summary{"spkr1"}{"elim_ballots_won"}/$summary{"spkr1"}{"elim_ballots"})*100) : "" %>%</td>
				<td><% $summary{"spkr1"}{"elim_wins"} %>-<% $summary{"spkr1"}{"elim_rds"} %></td>
				<td><% $summary{"spkr1"}{"elim_ballots"} ? sprintf("%.1f\n", ($summary{"spkr1"}{"elim_wins"}/$summary{"spkr1"}{"elim_rds"})*100) : "" %>%</td>
			<tr>
			<tr>
				<td><% $student2->last %> with other partners</td>
				<td><% $summary{"spkr2"}{"prelim_ballots_won"} %>-<% $summary{"spkr2"}{"prelim_ballots"} %></td>
				<td><% $summary{"spkr2"}{"prelim_ballots"} ? sprintf("%.1f\n", ($summary{"spkr2"}{"prelim_ballots_won"}/$summary{"spkr2"}{"prelim_ballots"})*100) : "" %>%</td>
				<td><% $summary{"spkr2"}{"prelim_wins"} %>-<% $summary{"spkr2"}{"prelim_rds"} %></td>
				<td><% $summary{"spkr2"}{"prelim_wins"} ? sprintf("%.1f\n", ($summary{"spkr2"}{"prelim_wins"}/$summary{"spkr2"}{"prelim_rds"})*100) : "" %>%</td>
				<td><% $summary{"spkr2"}{"elim_ballots_won"} %>-<% $summary{"spkr2"}{"elim_ballots"} %></td>
				<td><% $summary{"spkr2"}{"elim_ballots"} ? sprintf("%.1f\n", ($summary{"spkr2"}{"elim_ballots_won"}/$summary{"spkr2"}{"elim_ballots"})*100) : ""  %>%</td>
				<td><% $summary{"spkr2"}{"elim_wins"} %>-<% $summary{"spkr2"}{"elim_rds"} %></td>
				<td><% $summary{"spkr2"}{"elim_wins"} ? sprintf("%.1f\n", ($summary{"spkr2"}{"elim_wins"}/$summary{"spkr2"}{"elim_rds"})*100) : "" %>%</td>
			<tr>

		</table>	

		<table cellpadding="3" width="100%" id="results_table" class="tablesorter">
		<caption> <h3> Record Together as a team </h3></caption>
% 			foreach my $key (sort { $panels{$a}->{'tourn_id'} <=> $panels{$b}->{'tourn_id'} || $panels{$a}->{'round_name'} <=> $panels{$b}->{'round_name'} } keys(%panels)) {

%			if ( $panels{$key}{'spkr1_on_entry'} == 1 && $panels{$key}{'spkr2_on_entry'} == 1 ) {
%			if ( $panels{$key}{'tourn'} ne $last_tourn ) {
				<thead>
					<tr class="dkblue">
						<th colspan="5"><% $panels{$key}{'tourn'} %> -- <% $panels{$key}{'event_name'} %> <% $panels{$key}{'tourn_start'} %> </th>
					</tr>
					<tr class="dkblue">
						<th class="smaller">Rd</th>
						<th class="smaller">Judge(s)</th>				
						<th class="smaller">Decision</th>								
						<th class="smaller"><% $student1->last %></th>												
						<th class="smaller"><% $student2->last %></th>												
					</tr>
				</thead>
%			}				
				<tr>
					<td> <% $panels{$key}{'round_label'} %> </td>
					<td> <% $panels{$key}{'judge'} %></td>
					<td> <% $panels{$key}{'decision_str'} %></td>
					<td> <% $panels{$key}{'spkr1_pts'} %></td>			
					<td> <% $panels{$key}{'spkr2_pts'} %></td>
				</tr>
%			}
%			$last_tourn=$panels{$key}{'tourn'};

%		}
		</table>

		<table cellpadding="3" width="100%" id="spkr1" class="tablesorter">
		<caption> <h3> Record of <% $student1->first %> <% $student1->last %> individually </h3></caption>
		
% 			foreach my $key (sort { $panels{$a}->{'tourn_id'} <=> $panels{$b}->{'tourn_id'} || $panels{$a}->{'round_name'} <=> $panels{$b}->{'round_name'} } keys(%panels)) {

%			if ( $panels{$key}{'spkr1_on_entry'} == 1 && $panels{$key}{'spkr2_on_entry'} != 1 ) {
%			if ( $panels{$key}{'tourn'} ne $last_tourn ) {
				<thead>
					<tr class="dkblue">
						<th colspan="5"><% $panels{$key}{'tourn'} %> -- <% $panels{$key}{'event_name'} %> <% $panels{$key}{'tourn_start'} %> </th>
					</tr>
					<tr class="dkblue">
						<th class="smaller">Rd</th>
						<th class="smaller">Judge(s)</th>				
						<th class="smaller">Decision</th>								
						<th class="smaller"><% $student1->last %></th>												
					</tr>
				</thead>
%			}				
				<tr>
					<td> <% $panels{$key}{'round_label'} %> </td>
					<td> <% $panels{$key}{'judge'} %></td>
					<td> <% $panels{$key}{'decision_str'} %></td>
					<td> <% $panels{$key}{'spkr1_pts'} %></td>			
				</tr>
%			}
%			$last_tourn=$panels{$key}{'tourn'};

%		}
		</table>

		<table cellpadding="3" width="100%" id="spkr2" class="tablesorter">
		<caption> <h3> Record of <% $student2->first %> <% $student2->last %> individually </h3></caption>
		
% 			foreach my $key (sort { $panels{$a}->{'tourn_id'} <=> $panels{$b}->{'tourn_id'} || $panels{$a}->{'round_name'} <=> $panels{$b}->{'round_name'} } keys(%panels)) {

%			if ( $panels{$key}{'spkr1_on_entry'} != 1 && $panels{$key}{'spkr2_on_entry'} == 1 ) {
%			if ( $panels{$key}{'tourn'} ne $last_tourn ) {
				<thead>
					<tr class="dkblue">
						<th colspan="5"><% $panels{$key}{'tourn'} %> -- <% $panels{$key}{'event_name'} %> <% $panels{$key}{'tourn_start'} %> </th>
					</tr>
					<tr class="dkblue">
						<th class="smaller">Rd</th>
						<th class="smaller">Judge(s)</th>				
						<th class="smaller">Decision</th>								
						<th class="smaller"><% $student2->last %></th>												
					</tr>
				</thead>
%			}				
				<tr>
					<td> <% $panels{$key}{'round_label'} %> </td>
					<td> <% $panels{$key}{'judge'} %></td>
					<td> <% $panels{$key}{'decision_str'} %></td>
					<td> <% $panels{$key}{'spkr2_pts'} %></td>			
				</tr>
%			}
%			$last_tourn=$panels{$key}{'tourn'};

%		}
		</table>

	</div>
		
<%perl>
	 if ($debug) {
	 	my $end = time();
	 	print "processing time:  "; printf("%.2f\n", $end - $start);
	 }
</%perl>
