<%args>
	$tourn_id => undef
	$school_id => undef
	$judge_id => undef
	$judge_last => undef
</%args>
<%init>

	unless ($tourn_id) { 

		$m->print("You have not selected a tournament");
		$m->abort;

	}

	my $tourn = Tab::Tourn->retrieve($tourn_id);
	my $judge = Tab::Judge->retrieve($judge_id) if $judge_id;
	my $school = Tab::School->retrieve($school_id) if $school_id;

	my $switch;

</%init>

	<div class="main">

		<h4>Judge Assignments</h4>

			<center>
			<table width="95%" cellpadding="5" cellspacing="1">
				
				<tr class="evenrow">

					<td>
						Choose school:
					</td>

					<td class="centeralign">
						<form action="judge_master.mhtml" method="post">
						<input type="hidden" name="tourn_id" value="<% $tourn_id %>">
						<select name="school_id">

%							foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 
								<option value="<% $school->id %>" <% ($school->id == $school_id) ? "selected" : ""%>>
									<% substr($school->name,0,30) %>
								</option>
%							}

						</select>
					</td>

					<td class="centeralign">
						<input type="submit" value="Show Judges">
						</form>
					</td>

				</tr>

			</table>
			</center>

%		if ($school) { 

			<h3><% $school->name %>'s Judge Assignments:</h3>

			<table cellpadding="5" cellspacing="1" width="100%">

%				foreach my $judge (sort {$a->last cmp $b->last} $school->judges) { 

%        			my @panels = $judge->panels;
%					@panels = sort {$a->round->timeslot->start->epoch <=> $b->round->timeslot->start->epoch} @panels;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

						<td>
							<% $judge->first." ".$judge->last %>
						</td>

						<td>
							<% $judge->judge_group->abbr %>
						</td>

						<td class="smaller">
							
							<% ($judge->special) ? $judge->special : $judge->judge_group->special %>

%							if ($judge->judge_group->pub_assigns) { 

%								foreach my $panel (@panels) { 

%									next unless $panel->round->published;

									<a class="white">
										<% ($panel->round->label) ? $panel->round->label : "" %>
										<% $panel->event->abbr %>, 
										<% Tab::nicetime($panel->round->timeslot->start->set_time_zone($tourn->tourn->tz)) %> 
										<% ($panel->room) ? "Room: ".$panel->room->name : "" %>
									</a>

%								}

								<% ($judge->pools) ? "<h4>Additional Assignments</h4>" : "" %>

%								foreach my $pool ($judge->pools) { 

									<a class="white">
										<% ucfirst($pool->type)." ".$pool->name.": ".$pool->message %> 
									</a>

%								}
							
%							}
								
						</td>

					</tr>

%				}

			</table>

%		}


	</div>

    <& menu.mas, tourn_id => $tourn_id, judge_master => "Yippee!" &>

