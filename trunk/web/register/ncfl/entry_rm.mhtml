<%args>
	$tourn
	$remaining_entries => undef
	$account
	$entry_id	
	$circuit
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);
    my @tourn_acc = Tab::ChapterAdmin->search( account => $account->id, tournament => $tourn->id);

	if ($account->id == $entry->student->chapter->region($circuit)->director->id 
			|| $account->site_admin || @tourn_acc ) { 

		my $chapter = $entry->student->chapter;
		my $tourn = $entry->tournament;
		my $school = $entry->school;	
		my $name = $entry->student->last;
		my $student = $entry->student;
		my $event = $entry->event;
		my $partner = $entry->partner;

        my $text = $account->first." ".$account->last." dropped entry ".$entry->code;

        my $change = Tab::Change->create({
            tournament => $tourn->id,
            school => $school_id,
            type => "registration",
            text => $text
        }); 
    
        system "$Tab::eventlogger $text";

		$entry->delete;

		if ($event->team == 2) { 
			$name = $name." and ".$partner->last;
			$partner->delete if $partner && $partner->id != 0;
		}

		$student->delete;

		$remaining_entries = scalar $school->entries;
		
		if ($remaining_entries == 0) { 

			$school->delete;
		}

		my $err = "Entry $name deleted";

		$m->redirect("$Tab::url_prefix/register/entry.mhtml?id=".$chapter->region($circuit)->id."&tourn_id=".$tourn->id."&err=$err");

	}


</%init>

<p><font color="red">You are not authorized to delete that competitor</font></p>

