<%args>
	$tourn
	$event_id => undef
</%args>
<%init>


	if ($event_id) { 

		my $event = Tab::Event->retrieve($event_id);

		foreach my $entry ($event->entries) { 
		
			my $name;
			my $last_names;

			my $notfirst;

			foreach my $student ($entry->students) { 
				$name = $student->first." ".$student->last;
				$last_names .= " & " if $notfirst;
				$last_names .= $student->last;
				$notfirst++;
			}

			if ($notfirst > 1) { 
				$entry->name($last_names);
			} else { 
				$entry->name($name);
			}

			$entry->update;

		}

		my $msg = $event->name." entries all renamed";

		$m->redirect("/register/data/entry_rename.mhtml?msg=$msg");

	} else {

</%init>

	<& "menu.mas", tourn => $tourn, whoami => "entry_rename" &>

	<div class="main"> 
		
		<h2>Rename event entries</h2>

		<p>Use this to re-align the names of all the entries to the students.
		Most useful if a foreign import didn't work out that well</p>

		<form action="entry_rename.mhtml" method="post">

		<div class="evenrow visible">

			<span class="twothirds">

				<select name="event_id" class="fixed chosen">
					<option value=""></option>
%					foreach my $event ($tourn->events) { 
						<option value="<% $event->id %>">
							<% $event->name %>
						</option>
%					}
				</select>

			</span>

			<span class="third">
				<input class="thin" type="submit" value="Rename Event">
			</span>

		</div>

		</form>

	</div>

%	}

