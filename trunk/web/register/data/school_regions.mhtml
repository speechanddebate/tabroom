<%args>
	$tourn
	$session
	$limit => undef
</%args>
<%init>

	my $switch;
	my @regions = sort {$a->code cmp $b->code} $tourn->regions;

	my @schools;

	if ($limit) { 
		@schools = $m->comp("/funclib/event_schools.mas", event_id => $limit);
	} else { 
		@schools = $tourn->schools;
	}

</%init>

	<& sidebar.mas, tourn => $tourn, whoami => "school_regions" &>

	<div class="left huge">

		<div class="block">
			<span class="bigspan">
				<h2>Edit School Regions</h2>
			</span>
			<span class="halfspan rightalign nowrap">
				<form action="school_regions.mhtml">
				Limit to:
					<select name="limit" class="fixedtiny" onchange='this.form.submit()'>
						<option value="">All Events</option>
%						foreach my $event ($tourn->events) { 
							<option value="<% $event->id %>" <% $limit == $event->id ? 'selected="selected"' : "" %>><% $event->name %></option>
%						}
					</select>
				</form>
			</span>
		</div>

		<form action="school_regions_save.mhtml">
		<input type="hidden" name="limit" value="<% $limit %>">

		<& /funclib/tablesorter.mas, table => "sortable" &>

		<table cellpadding="6" cellspacing="1" width="100%" id="sortable"> 

			<thead>
		
			<tr class="yellowrow">
			
				<th class="smallish"> 
					School
				</th>

				<th class="smallish"> 
					State
				</th>

%				foreach my $region (@regions) { 
					<th class="smallish"> 
						<% $region->code %>
					</th>
%				}

			</tr>

			</thead>

			<tbody>

%			foreach my $school (sort {$a->name cmp $b->name} @schools) { 

				<tr>

					<td>
						<% $school->name %>
					</td>

					<td class="centeralign">
						<% $school->chapter->state %>
					</td>

%					foreach my $region (@regions) { 
						<td class="smallish"> 
							<input type="radio" name="<% $school->id %>" value="<% $region->id %>" 
								<% $school->region ? $school->region->id == $region->id ? 'checked="checked"' : "" : "" %> >
						</td>
%					}

				</tr>
%			}

			</tbody>

			<tr class="liblrow">

				<td colspan="19" class="rightalign">
					<input type="submit" value="Save regions">
					</form> 
				</td>

			</tr>

		</table>

	</div>

