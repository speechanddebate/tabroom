<%args>
	$circuit
	$tourn
	$session
	$group_id
	$dome => undef
	$err => undef
	$debug => 1
</%args>
<%init>

	my $count;

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @judges = $group->judges(active => 1);

	my @strikes = $group->strikes;

	my %strikes_comp = ();
	my %strikes_school = ();

	my %conflicts_comp = ();
	my %conflicts_school = ();

	foreach my $strike (@strikes) {

		if ($strike->strike) { 
			$strikes_comp{$strike->comp->id."-".$strike->judge->id}++ if $strike->type eq "comp";
			$strikes_school{$strike->school->id."-".$strike->judge->id}++ if $strike->type eq "school";
		} else { 
			$conflicts_comp{$strike->comp->id."-".$strike->judge->id}++ if $strike->type eq "comp";
			$conflicts_school{$strike->school->id."-".$strike->judge->id}++ if $strike->type eq "school";
		}
	}

	my @comps;

	open (EXPORT, ">$Tab::file_root/tmp/TRPC-Strikes-".$group->abbr.".txt");

	foreach my $event ($group->events) { 

		foreach my $comp ($event->comps) { 

			next if $comp->school->noprefs;

			print EXPORT "-------------------------------------\r";

			print EXPORT "\$".$group->abbr." \*".$comp->code."    ".$comp->school->name."   ".$comp->team_name."\r\r";

			foreach my $judge (@judges) { 

				print EXPORT "\% ".$judge->code."\ \ \ ";
				print EXPORT "[";

				if ($strikes_comp{$comp->id."-".$judge->id} || $strikes_school{$comp->school->id."-".$judge->id}) { 
					print EXPORT "6";
				} elsif ($conflicts_comp{$comp->id."-".$judge->id} || $conflicts_school{$comp->school->id."-".$judge->id}) { 
					print EXPORT "5";
				} else { 
					print EXPORT "1";
				}

				print EXPORT "]";
				print EXPORT " ".sprintf('%-30s',$judge->last.", ".$judge->first);
				print EXPORT $judge->school->name if $judge->school;
				print EXPORT "Tournament Hire" unless $judge->school;
				print EXPORT "\r";

			}

		}

	}

	close EXPORT;

	$m->redirect("$Tab::url_prefix/tmp/TRPC-Strikes-".$group->abbr.".txt");

</%init>
