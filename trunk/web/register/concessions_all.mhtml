<%args>
	$circuit
	$session
	$tourn
</%args>
<%init>

	my @schools = $tourn->schools;

    my $filename = $Tab::file_root."/tmp/concessions-ALL-".$session->id;

    my $garbage = `rm -f $filename.*`;


    open (TEXOUT, ">$filename.tex");

    print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.5}
\\begin{document}
\\begin{center}

EOF


    close TEXOUT;

	foreach my $school (@schools) { 

		next unless $school->purchases;

	    $m->comp("/funclib/concessions_print.mas",
			school_id => $school->id,
       		filename => $filename,
			circuit => $circuit);

	    open (TEXOUT, ">>$filename.tex");
	    print TEXOUT "\\newpage\n";
		close TEXOUT;
	
	}



$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

$m->redirect("$Tab::url_prefix/tmp/concessions-ALL-".$session->id.".pdf");




</%init>

