<%args>
	$session
	$event_id	
	$tourn => undef
	$tourn_id => undef
	$codes => undef
	$debug => 1
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);

	$tourn = Tab::Tournament->retrieve($tourn_id) if $tourn_id;
	$tourn_id = $tourn->id unless $tourn_id;

	my $filename = $event->abbr."-comp-cards-".$session->id;
	$filename =~ s/\s//g;

	my $filepath = $Tab::file_root."/tmp/".$filename;
	
	my $garbage = `rm -f $filepath.*`;
	
	open (TEXOUT, ">$filepath.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{times}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\usepackage[hmargin=.5in,vmargin=.75in]{geometry}
\\renewcommand{\\arraystretch}{1.4}
\\begin{document}
\\begin{center}

EOF

	close TEXOUT;

	my $switch; 

	foreach my $comp (sort{$a->code <=> $b->code} $event->comps( dropped => 0, waitlist => 0)) {
		$m->comp("/funclib/comp_info_card.mas", 
			comp_id => $comp->id, 
			filename => $filepath
		);
	}

	open (TEXOUT, ">>$filepath.tex");
	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filepath.tex; $Tab::dvipdfm_path $filepath.dvi`;
`rm -f $filepath.tex $filepath.log $filepath.dvi $filepath.aux` unless $debug;
$m->redirect("$Tab::url_prefix/tmp/".$filename.".pdf");

</%init>
