<%args>
	$tourn
	$event_id
	$show_schools => 1
	$show_titles => undef
	$show_qualifier => undef
	$league
	$sort_by => "code"
	$err => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id); 

	Tab::Comp->columns(TEMP => qw/first last stu part schname schcode/);

	my @comps = sort {$a->code <=> $b->code} Tab::Comp->search( event => $event->id );

	@comps = sort {$a->school->name cmp $b->school->name} @comps if $sort_by eq "school";
	@comps = sort {$a->school->region->name <=> $b->school->region->name} @comps if $sort_by eq "region";
	@comps = sort {$a->team_name cmp $b->team_name} @comps if $sort_by eq "name";
	@comps = sort {$a->student->last cmp $b->student->last} @comps if $sort_by eq "last";
	@comps = sort {$b->ada <=> $b->ada} @comps if $sort_by eq "ada";
	@comps = sort {$a->registered_at->epoch <=> $b->registered_at->epoch} @comps if $sort_by eq "when";

</%init>

	<table width="100%">

		<tr>	
			<td width="100%">
				<h2>Entry in <% $event->name %> (<% scalar @comps %>)</h2>
			</td>

% 			if ($tourn->method->ask_qualifying_tournament) { 

				<td> 
					<form action="event_listing.mhtml" method="post">
					<input type="hidden" name="event_id" value="<% $event_id%>">
					<input type="hidden" name="show_qualifier" value="<% ($show_qualifier) ? "" : "yes" %>">
					<input type="hidden" name="show_schools" value="<% $show_schools %>">
					<input type="hidden" name="show_titles" value="<% $show_titles %>">
					<input class="blue" type="submit" value="<% ($show_qualifier) ? "Hide Qualifiers" : "Show Qualifiers" %>">
					</form>
				</td>
% 			}

% 			if ($event->ask_for_titles) { 

				<td>
					<form action="event_listing.mhtml" method="post">
					<input type="hidden" name="event_id" value="<% $event_id%>">
					<input type="hidden" name="show_titles" value="<% ($show_titles) ? "" : "yes" %>">
					<input type="hidden" name="show_schools" value="<% $show_schools %>">
					<input type="hidden" name="show_qualifier" value="<% $show_qualifier %>">
					<input class="blue" type="submit" value="<% ($show_titles) ? "Hide Piece Titles" : "Show Piece Titles" %>">
					</form>
				</td>
% 			}

			<td>
				<form action="csv_entries.mhtml" method="post">
				<input type="hidden" name="event_id" value="<% $event_id%>">
				<input class="blue" type="submit" value="Spreadsheet">
				</form> 
			</td>

			<td>
				<form action="print_entries.mhtml" method="post">
				<input type="hidden" name="event_id" value="<% $event_id%>">
				<input class="blue" type="submit" value="Print Entry">
				</form> 
			</td>

			<td>
				<form action="events.mhtml" method="post">
				<input class="blue" type="submit" value="Return">
				</form> 
			</td>
			
		</tr>

	</table>

% 	if ($event->supp)  {
	
		<table width="100%" cellpadding="6" cellspacing="1">

			<tr class="lirdrow">

				<td>
					<form action="supp_enter.mhtml" method="post">
					<input type="hidden" name="event_id" value="<% $event->id %>">
					Register an entry to this supplemental event:
				</td>

				<td align="right">
					Speaker's current code:
				</td>

				<td align="center">
					<input type="text" name="code" size="5">
				</td>

				<td align="center">
					<input type="submit" class="red" value="   Enter in <% $event->name %>   ">
					</form>
				</td>
			</tr>

		</table>

%	}

%	my $switch;

	<table cellpadding="3" cellspacing="1" width="100%">

		<tr class="lirdrow">

			<th>
				<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=code" class="whiteblock">
				Code
				</a>
			</th>

			<th>
				<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=ada" class="whiteblock">
				ADA
				</a>
			</th>

%			if ($event->waitlist) { 

				<th>
					<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=when" class="whiteblock">
					Registered
					</a>
				</th>
%			}

			<th>
				<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=name" class="whiteblock">
				Name
				</a>
			</th>

			<th colspan="2">
				<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=school" class="whiteblock">
				School
				</a>
			</th>

%			if ($show_titles) { 

				<th>
					<a href="event_listing.mhtml?event_id=<% $event->id %>&sort_by=title" class="whiteblock">
					Title
					</a>
				</th>

%			}	

		</tr>

% 		foreach my $comp (@comps) { 

%	 		if ($comp->dropped) { 

				<tr <% ($switch++ % 2) ? "class=\"liblrow\"" : "class=\"bluerow\"" %>>

%			} else { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

%			}

				<td align="center" style="text-weight: bold;">

					<a href="comp_edit.mhtml?comp_id=<% $comp->id%>" class="whiteblock">
					<% ($comp->dropped) ? "DROP" : $comp->code %>
					</a>

				</td>

				<td align="center">
					<% ($comp->ada) ? "ADA" : ""  %>
				</td>

%				if ($event->waitlist) { 
    				<td class="smaller">
						<% ($comp && $comp->registered_at) ? Tab::niceshortdt($comp->registered_at->set_time_zone($league->timezone)): "" %>
						<% ($comp->waitlist) ? "(Waitlist)" : "" %> 
					</td>
%				}
				
				<td>
					<% $comp->team_name %>
		 			<% ($comp->dq == 1) ? "(DQed)" : "" %> 
				</td>


				<td>
					<a href="/register/registration.mhtml?school_id=<% $comp->school->id %>" class="whiteblock">
					<% $comp->school->name %>
					</a>
				</td> 

%				if ( ($league->diocese_based || $league->region_based) && $comp->school->region) {

					<td>
						<% $comp->school->region->code %>
					</td>

% 				} else { 

					<td>
						<% $comp->school->chapter->state %>
					</td>

%				}

% 				if ($show_titles) { 
					<td class="smaller">
						<% $comp->title %>
					</td> 
% 				}

% 				if ($show_qualifier) { 
					<td class="smaller">
						<% substr($comp->qualifier,0,20) %>
					</td>
% 				}

% 				if ($show_schools && $league->diocese_based) { 
					<td align="center">
						<% $comp->schcode %>
					</td> 
% 				}
	
			</tr>

% 		}

	</table>

