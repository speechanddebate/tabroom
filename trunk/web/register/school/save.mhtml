<%args>
	$tourn
	$name
	$school_id      => undef
	$paid           => undef
	$region         => undef
	$individuals    => undef
	$contact_number => undef
	$contact_name   => undef
	$contact_email  => undef
	$code           => undef
	$region_id      => undef
	$state          => undef
	$country        => undef
</%args>
<%init>

	my $err;

	my $school = Tab::School->retrieve($school_id) if $school_id;  
	$m->abort unless $school;

	if ($tourn->setting("per_person_fee")) { 

		my $bodies = $m->comp("/funclib/school_bodies.mas", school => $school);

		if ($individuals < $bodies) { 
			$err = "You have set the number of individuals below the number of people on record ($bodies).  Be sure this is what you want."
		}
	}

	$school->name($name);
	$school->individuals($individuals);
	$school->paid($paid);
	$school->region($region);
	$school->contact_number($contact_number);
	$school->contact_name($contact_name);
	$school->contact_email($contact_email);
	$school->code($code);
	$school->update;

	my $chapter = $school->chapter;

	if ($chapter) { 
		$chapter->country($country);
		$chapter->state($state);
		$chapter->update;
	}

	my $msg = "School changes saved";
	$m->redirect("edit.mhtml?school_id=$school_id&err=$err&msg=$msg");

</%init>

