<%args>
	$school
	$filename
</%args>
<%init>

	my $filepath = $Tab::file_root."/tmp/".$filename;

	use POSIX;

	my $tourn  = $school->tourn;
	my $symbol = $tourn->setting("currency");

    my $now = DateTime->now;
    $now->set_time_zone($tourn->tz);

	my ($total, $feline_ref) = $m->comp("/funclib/school_fees.mas", school_id => $school->id);

	my @felines = @{$feline_ref};

	print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
	print TEXOUT " \\\\ \n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";


	print TEXOUT <<'EOF';
\tt
\begin{tabular}{p{4.75in}p{1.75in}}
\rowcolor[rgb]{1,.95,.95} Category or Item & Fee \\
\end{tabular}
\newline
EOF

	my $warn;
	my $count = 1;

	foreach my $line (sort { $a->{"warn"} <=> $b->{"warn"} } @felines) {

		print TEXOUT "\\begin{tabular}{p{4.75in}p{1.75in}}\n";

		if ($line->{"warn"}) { 

			print TEXOUT "\\\\ \n" unless $warn;
			$warn++;
			print TEXOUT "\\rowcolor[rgb]{1,.75,.75}\[5.5pt\]\[5.5pt\]\n" if $line->{"warn"};

		} else { 
			print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($count++ % 2);
		}

		print TEXOUT &Tab::texify($line->{'name'})." & ";
		print TEXOUT Tab::texify($symbol).sprintf ("%.2f", $line->{'fee'}) if $line->{'fee'};
		print TEXOUT "\\\\ \n \\end{tabular}\n";
		print TEXOUT "\\newline\n";
	}

	if ($warn) { 
		print TEXOUT "\\bigskip\n";
		print TEXOUT "\\begin{tabular}{p{6.9in}}\n";
		print TEXOUT "{\\bf       Please clear up the warnings and problems above to get an accurate invoice total.\n }";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";
	}

close TEXOUT;

</%init>
