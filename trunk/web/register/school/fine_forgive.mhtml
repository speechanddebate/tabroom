<%args>
	$tourn
	$account
	$fine_id
</%args>
<%init>

	my $fine = Tab::SchoolFine->retrieve($fine_id) if $fine_id; 

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;
	my $now = DateTime->now->set_time_zone($tz);

	unless ($fine) { 
		$m->print("That fine does not exist.  Did you delete it already?  Hit back and try again");
		$m->abort();
	}

	my $school = $fine->school;

	$fine->deleted(1);
	$fine->deleted_by($account->id);
	$fine->deleted_at($now);
	$fine->update;

	my $msg = "Fine or payment marked as deleted";
	$m->redirect("/register/school/invoice.mhtml?school_id=".$school->id."&msg=$msg");

</%init>
