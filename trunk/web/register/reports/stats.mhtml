<%args>
	$circuit
	$tourn
	$account
	$session
</%args>
<%init>

	my @students = $m->comp("/funclib/tourn_students.mas", tourn => $tourn);
	my @judges = $m->comp("/funclib/tourn_judges.mas", tourn => $tourn);
	my @schools = $tourn->schools;
	my @regions;
#= $m->comp("/funclib/tourn_regions.mas", tourn => $tourn);

	my @pools = $m->comp("/funclib/tourn_pools.mas", tourn => $tourn);
	my $switch; 

</%init>

	<& "menu.mas", tourn => $tourn, whoami => "stats" &>

	<div class="left huge">

	<h2>Tournament statistics for <% $tourn->name %></h2>

	<div class="left half">

		<h4>Totals</h4>

		<table cellpadding="5" cellspacing="1" width="100%">
		
			<tr class="yellowrow">

				<th class="smaller">
					Category
				</th>

				<th class="smaller">
					People
				</th>

			</tr>

%		if ($tourn->setting("ncfl") || $tourn->setting("regions")) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<% ($tourn->setting("ncfl")) ? "Dioceses" : "Regions" %>
				</td> 
				
				<td class="rightalign">
					<% scalar @regions %>
				</td>

			</tr>

%		}

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				Schools
			</td> 
			
			<td class="rightalign">
				<% scalar @schools %>
			</td>
			
		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			<td>
				Students
			</td>

			<td class="rightalign">
				<% scalar @students %>
			</td>

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
			<td>
				Judges
			</td>
			
			<td class="rightalign">
				<% scalar @judges %>
			</td>

		</tr>

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
			<td>
				Total People
			</td>
			
			<td class="rightalign">
				<% scalar @judges + scalar @students %>
			</td>

		</tr>

	</table>

	<h4>Judges by Group</h4>

	<table cellpadding="5" cellspacing="1" width="100%">

%		foreach my $group (sort {$a->name cmp $b->name} $tourn->groups) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
				<td>
					<% $group->name %>
				</td>
	
				<td class="rightalign">
					<% scalar $group->judges %>
				</td>

			</tr>

%		}

	</table>

%	if (@pools) { 

		<h4>Judges by Pool</h4>

		<table cellpadding="5" cellspacing="1" width="100%">

%			foreach my $pool ($m->comp("/funclib/tourn_pools.mas", tourn => $tourn)) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<% $pool->name %>
					</td> 
				
					<td class="rightalign">
						<% scalar $pool->judges %>
					</td> 
				
				</tr>

%			}

		</table>

%	}

	</div>

	<div class="right half">

	<h4>Entries by Event</h4>

	<table cellpadding="5" cellspacing="1" width="100%">

		<tr class="yellowrow">

			<th class="smaller">
				Event
			</th>

			<th class="smaller">
				Entries
			</th>

			<th class="smaller">
				Students
			</th>

		</tr>

%		foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<% $event->name %>
				</td> 
				
				<td class="rightalign">
					<% scalar Tab::Entry->search( event => $event->id, dropped => 0, waitlist => 0 ) %>
				</td> 
				
				<td class="rightalign">
					<% scalar $m->comp("/funclib/event_students.mas", event => $event) %>
				</td> 
				
			</tr>

%		}

	</table>

	</div>

	</div>
