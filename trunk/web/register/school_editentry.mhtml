<%args>
	$tourn
	$school_id
	$err => undef
</%args>
 
<%init>
	my $school = Tab::School->retrieve($school_id);
	my @entries = Tab::Entry->search( school => $school_id, {order_by => 'code'});
	my $chapter = $school->chapter;
	my @students = Tab::Student->search( chapter => $chapter->id, {order_by => "last"});
	my @events = Tab::Event->search( tournament => $tourn->id, {order_by => "name"});
	my $chapter_id = $chapter->id;	
</%init>

<font color="red"><% $err %></font>

<h3>New entry:</h3>

<table cellpadding="3">

<form action="comp_enter.mhtml" method="post">
<input type="hidden" value="<% $school_id %>" name="school_id">
<tr>
<td>Event:</td>
<td><select name="event_id">
% foreach my $event (@events) { 
% my $caphit;
% if ($event->cap > 0 || $event->school_cap > 0) {
%	my @e_entries = Tab::Entry->search( event => $event->id ); 
%	my @s_entries = Tab::Entry->search( school => $school_id, event => $event->id ); 
%   $caphit++ if scalar @e_entries >= $event->cap;
%   $caphit++ if scalar @s_entries >= $event->school_cap;
% }


	<option value="<% $event->id %>"><% $event->name %><% ($caphit) ? '-HIT CAP' : '' %></option>
%} 
</select>
</td>
<td><input  type="submit" value="Enter Student"></td>

</tr>
</table>
</form>



<h3><% $school->chapter->name %> school information: </h3>

<p><% scalar @students %> students in the database:</p>

<form action="student_edit.mhtml" method="post">
<p><select name="student_id">

%foreach my $student (@students) { 

	<option value="<% $student->id %>"><% $student->first." ".$student->last %></option>

%}

</select>
<input  type="submit" value="Edit Student"></p>
</form>

<form action="student_save.mas" method="post">
<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
<h3>Add new student:</h3>
<table>
<tr><td>First name:</td><td colspan="3"><input type="text" name="first" size="30"></td></tr>
<tr><td>Last name:</td><td colspan="3"><input type="text" name="last" size="30"></td></tr>
<tr><td>Grad year:</td><td><input type="text" name="grad_year" size="10"></td>
<td>Novice:</td><td><input type="checkbox" value="1" name="novice"></td></tr>
<tr><td><input  type="submit" value="Save Student"></p></td><td></td></tr>
</table>
</form>



