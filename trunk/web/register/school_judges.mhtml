<%args>
	$tourn
	$league
	$chapter_id => undef
	$school_id => undef
	$account
</%args>
<%init>

	use POSIX;

	my $chapter;
	my $school;

	unless ($school_id || $chapter_id) { 
		my $err = "You have accessed the registration page incorrectly.  Please try again.";
		$m->redirect("$Tab::url_prefix/register/registration.mhtml?err=$err");
	}

	if ($chapter_id) { 
		$chapter = Tab::Chapter->retrieve($chapter_id);
	}

	if ($school_id) {
		$school = Tab::School->retrieve($school_id);
		$chapter = $school->chapter;
	}

	my $switch;

</%init>

	<& menubar.mas, school => $school, whoami => "judges", tourn => $tourn &>

	<div id="leftbignb">

		<table cellpadding="5" cellspacing="1" width="100%">

%			foreach my $group ($tourn->groups) { 

%				my @judges = $school->judges( judge_group =>  $group->id );
%				push (@judges, $school->judges( alt_group => $group->id));

%				next unless @judges;

				<tr>
					<td colspan="5">
						<h4><% $group->name %></h4>
					</td>
				</tr>

% 				foreach my $judge (@judges) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<a class="whiteblock" href="judge_edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->code %>
							</a>
						</td>

						<td>
							<a class="whiteblock" href="judge_edit.mhtml?judge_id=<% $judge->id %>">
								<% $judge->first." ".$judge->last%>
							</a>
						</td>

						<td class="center">
							<% ($judge->covers && $judge->covers->id > 0) ? "Counts as ".$judge->covers->abbr : "" %>
						</td>

%						if ($group->coach_ratings) { 

							<td class="center">
								<% $judge->print_ratings %>
							</td> 

%						} else { 
	
							<td></td>

%						}

						<td align="center">
							<a class="whiteblock" href="judge_drop.mhtml?judge_id=<% $judge->id %>&school_id=<% $school->id %>">
								Drop
							</a>
						</td>
	
					</tr>

% 				} 

%			} 

		</table>

	</div>

	<div id="rightsmall">

		<a class="whiteblock">Categories in red are below obligation:</a>

%		foreach my $group (sort {$a->name cmp $b->name} $tourn->groups) {

%			my $uncovered = $m->comp("/funclib/judgemath/uncovered_burden_by_group.mas", school => $school, group => $group); 
%			my (@useful_judges, @dontcount) = $m->comp("/funclib/judgemath/judges_useful_by_group.mas", school => $school, group => $group);
%			my $obligation = $m->comp("/funclib/judgemath/judges_needed_by_group.mas", school => $school, group => $group);

				<a href="judge_add.mhtml?school_id=<% $school->id %>&group_id=<% $group->id %>" 
					class="<% ($uncovered < 1) ? "blueblock" : "redblock" %>">
						<span style="float: left;  width: 160px;">Add judge in <% substr($group->abbr,0,15) %></span>
					<% scalar @useful_judges %>/<% $obligation %>
					<% ($uncovered < 1) ? " " : "Unmet" %> 
					<% ($uncovered < 1 && (scalar @useful_judges < $obligation) ) ? "+ Hires " : "" %> 
				</a>


%			if ($group->deadline) {
				<a href="/user/tourn/entry/judge_add.mhtml?school_id=<% $school->id %>&group_id=<% $group->id %>" class="whiteblockind">
					**<% $group->abbr %> Judges due: <% &Tab::niceshortdt($group->deadline->set_time_zone($tourn->league->timezone)) %>
				</a>

%			}

%		}

		<hr />

		<a class="blueblock" href="school_hires.mhtml?school_id=<% $school->id %>">Judge Hires</a>

	</div>

