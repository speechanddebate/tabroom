<%args>
	$tourn
</%args>

<h3>School bids report</h3>


<table cellspacing="1" cellpadding="5" width="100%" border="0">

<tr>
	<th>School</th>

%	foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)(type => "speech", circuit_event => 1) ) {
%	next if $event->team == 3;
	<th><% $event->abbr %></th>
% 	}
</tr>

%	my $switch;

% foreach my $school (sort {$a->name cmp $b->name} $tourn->schools) { 



<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<td><% $school->code %></td>

<%perl>
	foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)(type => "speech", circuit_event => 1) ) {

		next if $event->team == 3;

		my @unqualled;

		foreach my $comp ($school->entries(event => $event->id)) { 
	
			Tab::StudentResult->set_sql(bids => "
				select distinct student_result.id
				from student_result,event,comp,tournament
				where student_result.student = ".$comp->student->id."
				and   student_result.tournament = tournament.id
				and tournament.start > 2006-07-01
				and student_result.bid = 1
				and student_result.event = event.id
				and event.name =\"".$event->name."\" 
				");

			my @bid_results = Tab::StudentResult->search_bids;

			push (@unqualled, $comp) if (scalar @bid_results) < 2;
		}

		$m->print("<td>");


		foreach my $unqual (@unqualled) { 

			$m->print( "<a href=\"".$Tab::url_prefix."/register/entry/edit.mhtml?comp_id=".$unqual->id."\">".$unqual->code."</a> ");

		}
		
		$m->print("</td>");

	}
</%perl>

</tr>

% }

</table>
