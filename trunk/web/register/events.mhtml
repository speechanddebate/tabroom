<%args>
	$league
	$tourn
	$err => undef
	$sort_by => "event"
</%args>
<%init>

	my @events = $tourn->events;

	@events = sort {$a->name cmp $b->name} @events;

	@events = sort {$b->count_active_comps <=> $a->count_active_comps} @events if $sort_by eq "entries";

	@events = sort {$b->count_waitlist_comps <=> $a->count_waitlist_comps} @events if $sort_by eq "waitlist";

	my $total;
	my $totalwl;

</%init>

	<h2>Event entries in <% $tourn->name %></h2> 
	
	<table cellpadding="3" cellspacing="1" width="100%" border="0"> 
	
		<tr class="liblrow">

			<th>
				<a href="events.mhtml?sort_by=event" class="whiteblock">
				Event
				</a>
			</th>

			<th>
				<a href="events.mhtml?sort_by=entries" class="whiteblock">
				Entries
				</a>
			</th>

			<th>
				<a href="events.mhtml?sort_by=waitlist" class="whiteblock">
				Waitlist
				</a>
			</th>

			<th colspan="2">
				Print entry sorted by:
			</th>

			<th colspan="2">
			</th>
			
		</tr>

<%perl> 
		my $switch;
		
		foreach my $event (@events) { 

			my $lowest_code = $event->code;
			my $num_comps  = $event->count_active_comps;
			my $waitlisted = $event->count_waitlist_comps; 
			
			$total += $num_comps;
			$totalwl += $waitlisted;

</%perl>


			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
			
				<th> 
					<a href="<%$Tab::url_prefix%>/register/event_listing.mhtml?event_id=<% $event->id %>" class="whiteblock">
					<% $event->name %>
					</a>
				</th> 
			
				<td align="center">
					<% $num_comps %>
				</td>

				<td align="center">
%					if ($event->waitlist) {
						<a class="whiteblock" href="<% $Tab::url_prefix %>/register/waitlist.mhtml?event_id=<% $event->id %>"><% $waitlisted %> WL</a>
% 					}
				</td> 
			
				<td align="center">
					<form action="print_entries.mhtml" method="post">
					<input type="hidden" name="event_id" value="<% $event->id %>">
				
					<select name="sort_by">

						<option value="code">Code</option>

%						unless ($league->diocese_based) {
							<option value="schname">School</option>
							<option value="schcode">Sch. Code</option>
%						}

%						if ($league->diocese_based) { 
							<option value="dioname">Diocese Name</option>
							<option value="diocode">Diocese Code</option>
%						}

%						if ($league->region_based) { 
							<option value="regname">Region Name</option>
							<option value="regcode">Region Code</option>
%						}

%						if ($event->team == 1) { 
							<option value="name">Last Name</option>
%						} elsif ($event->team == 2) { 
							<option value="name">Last Name</option>
%						} elsif ($event->team == 3) { 
							<option value="team">Team Name</option>
%						}
					
					</select>
				</td> 
				
				<td align="center">
					<input class="blue" type="submit" value=" Print ">
					</form>
				</td> 
			
				<td class="smallctr">
					<a href="csv_entry.mhtml?event_id=<% $event->id %>" class="whiteblock">
						Spreadsheet
					</a>
				</td> 
			
				<td class="smallctr">
					<a href="event_comp_cards.mhtml?event_id=<% $event->id %>" class="whiteblock">
					Cards
					</a>
				</td> 
			
			</tr>
	
% 		}

		<tr class="bluerow">

			<th>
				Totals
			</th> 
			
			<td align="center">
				<% $total %>
			</td> 
			
			<td align="center">
				<% ($totalwl) ? $totalwl : "" %>
			</td> 
			
			<td align="center">
				<form action="print_entries.mhtml" method="post">

				<select name="sort_by">

					<option value="code">Code</option>

%					unless ($league->diocese_based) {
						<option value="schname">School</option>
						<option value="schcode">Sch. Code</option>
%					}

%					if ($league->diocese_based) { 
						<option value="dioname">Diocese Name</option>
						<option value="diocode">Diocese Code</option>
%					}

%					if ($league->region_based) { 
						<option value="regname">Region Name</option>
						<option value="regcode">Region Code</option>
%					}

				</select>

			</td> 
			
			<td align="center">
				<input class="blue" type="submit" value=" Print ">
				</form>
			</td> 
			
			<td class="smallctr">
				<a href="csv_entry.mhtml" class="whiteblock">
					Spreadsheet
				</a>
			</td> 
			
			<td>
			</td> 
			
		</tr> 
		
	</table>

	<br style='clear:both;'></div>
