<%args>
	$judge
	$filename
	$linebreaks => undef
</%args>
<%init>

	my $tourn = $judge->judge_group->tourn;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $filepath = $Tab::file_root."/tmp/";

	open (TEXOUT, ">>$filepath"."$filename.tex");

	my @days = $m->comp("/funclib/tourn_days.mas", tourn => $tourn);

	print TEXOUT "\\begin{flushright}\n";
	print TEXOUT "\\Huge {\\bf ".Tab::texify($judge->first." ".$judge->last)." (".$judge->code.")} \\\\ \n";
	print TEXOUT "\\medskip\n";
	print TEXOUT "\\LARGE ".$judge->judge_group->name." \\\\ \n";
	print TEXOUT "\\LARGE ".Tab::texify($judge->school->short_name)." ".Tab::texify($judge->school->code)." \\\\ \n" if $judge->school;
	print TEXOUT "\\LARGE Hired Judge \\\\ \n" unless $judge->school;
	print TEXOUT "\\large ".Tab::texify($tourn->name)." \\\\ \n";
	print TEXOUT "\\normalsize\n\n";
	print TEXOUT "\\end{flushright}\n";

	my @panels = $m->comp("/funclib/judge_panels.mas", judge => $judge);

	@panels = sort {$a->round->timeslot->start->epoch <=> $b->round->timeslot->start->epoch} @panels;

	print TEXOUT "\\begin{tabular}{p{1.25in}p{.75in}p{1.0in}p{.75in}p{2.15in}} \n";
	print TEXOUT "\\multicolumn{5}{l}{\\large Judging Assignments: } \\\\ \\hline \n" if @panels;

	my $switch;

	foreach my $panel (@panels) {
		my $start = $panel->round->timeslot->start;
		$start->set_time_zone($tz);
		print TEXOUT "\\rowcolor[rgb]{.90,.90,.90}\n" unless $switch++ % 2;
		print TEXOUT "{\\bf ".$panel->round->event->name." } & ";
		print TEXOUT "{\\bf ".$panel->round->label." }" if $panel->round->label;
		print TEXOUT "{\\bf Round ".$panel->round->name." }" unless $panel->round->label;
		print TEXOUT " & ";
		print TEXOUT $start->day_abbr." "  if scalar @days > 1;
		print TEXOUT $start->hour_12.":".$start->strftime("%M")." ";
		print TEXOUT $start->strftime("%p");
		print TEXOUT " & ";
		print TEXOUT "Section: ".$panel->letter." & ";
		print TEXOUT "Room: ".Tab::texify($panel->room->name)." " if $panel->room;
		print TEXOUT "\\\\ \n";
	}

	print TEXOUT "\\end{tabular}\n";

	print TEXOUT "\\bigskip\n";

	if ($judge->special) { 
		print TEXOUT "\\begin{tabular}{p{1.75in}p{4.50in}} \n";
		print TEXOUT "\\multicolumn{2}{c}{\\large}\\\\ \n";
		print TEXOUT "\\multicolumn{2}{l}{\\large Special Assignment: } \\\\ \\hline \n";
		print TEXOUT "\\multicolumn{2}{l}{ ".$judge->special."} \\\\ \n";
		print TEXOUT "\\end{tabular}\n";
	}

	if ($judge->pools) { 

		print TEXOUT "\\begin{tabular}{p{1.75in}p{4.50in}} \n";
		print TEXOUT "\\multicolumn{2}{c}{\\large}\\\\ \n";
		print TEXOUT "\\multicolumn{2}{l}{\\large Additional Assignments: } \\\\ \\hline \n";

		foreach my $pool ($judge->pools) { 
			print TEXOUT "{\\bf ";
			print TEXOUT ucfirst($pool->type)." Pool: "; 
			print TEXOUT $pool->name ." } & ";
			print TEXOUT $pool->message;
			print TEXOUT "\\\\ \\hline \n";
		}

		print TEXOUT "\\end{tabular}\n";
	}

	print TEXOUT "\\newpage \n" if $linebreaks; 
	close TEXOUT;

	return;


</%init>
