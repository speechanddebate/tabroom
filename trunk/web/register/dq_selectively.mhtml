<%args>
	$tourn
	$comp_id => undef
	$err => undef
	$code => undef
	$league
</%args>
<%init>

	my $comp;

	if ($comp_id) { 
		$comp = Tab::Comp->retrieve($comp_id);
	}
	
	if ($code) { 
	
		my @comps = Tab::Comp->search( code => $code, tournament => $tourn->id );

		$err = "No competitors found with speaker code $code" unless @comps;
		$m->redirect("$Tab::url_prefix/register/comp_edit.mhtml?err=$err") unless @comps;

		$m->redirect("$Tab::url_prefix/register/choose_comp.mhtml?code=$code") if scalar @comps > 1;

		$comp = $comps[0];
		$comp_id = $comp->id;	
	}
	
</%init>

% if ($comp) {

%	my $switch = 1;

%	unless ($comp->event->type eq "debate") { 

	<table width="100%" cellpadding="0" cellspacing="0">

	<tr>
		<td width="100%">
		<h3>Panel Assignments: for <% $comp->id %> </h3>	
	</td>

		<td>
			<form action="comp_edit.mhtml" method="post">
			<input type="hidden" name="comp_id" value="<% $comp->id %>">
			<input type="submit" value=" Return to Comp ">
			</form>
		</td>

%  		my @rounds = $comp->event->rounds;

%  		@rounds = sort { $a->name <=> $b->name } @rounds;
%  		my @panels = $comp->panels;

	<table cellpadding="5" width="100%" cellspacing="0"> 

% 	foreach my $round (@rounds) { 
% 		my $panel;

% 		foreach my $pan (@panels) {  
%   		my $pan_round = $pan->round;
%   		$panel = $pan if $pan_round->id == $round->id;
% 		}

%  		if ($panel) {
%  			my $room = $panel->room;
%  			my $start = $panel->round->timeslot->start;
%			$start->set_time_zone($league->timezone);
%  			my @judges = $panel->judges;
%			my @ballots = Tab::Ballot->search( comp => $comp_id, panel => $panel->id); 

			<tr <% ($switch++ % 2) ? "class=\"evenrow\"" : "class=\"oddrow\"" %>>	
				<td>Rnd <% $round->name %></td>
				<td><a href="<%$Tab::url_prefix%>/panel/panel_view.mhtml?panel_id=<% $panel->id %>"><% $panel->letter %></a></td>
				<td><% $start->hour_12.":".$start->strftime("%M")." ".$start->strftime("%p") %></td>
				<td><% ($room) ? $room->name : "" %> </td>

				<td> 

% 				foreach my $judge (@judges) { 	
					J<% $judge->code %>	
% 				}	
				</td>

		<td>


%		my $countmenot;

% 		foreach my $ballot (@ballots) { 

%			$countmenot++ if $ballot->countmenot;


%			if ($ballot->judge) { 
				<a 
					<% ($ballot->countmenot) ? "style=\"text-decoration: line-through; color: green;\"" : "" %>
					href="<% $Tab::url_prefix %>/tabbing/rank.mhtml?timeslot_id=<% $ballot->panel->round->timeslot->id %>&judge_code=<% $ballot->judge->code %>&audit=Rank"><% $ballot->real_rank %></a>
				<% ($ballot->tv) ? " TV " : "" %>
%			}

% 		}

		</td>

			<td><% $comp->speakerorder($panel) %></td>

			<td>(<a href="<% $Tab::url_prefix%>/panel/comp_edit.mhtml?comp_id=<% $comp->id %>&round_id=<% $round->id %>">Move</a>)</td>

			<td align="right">
				<form action="dq_ballots.mhtml">
					<input type="hidden" name="panel_id" value="<% $panel->id%>">
					<input type="hidden" name="comp_id" value="<% $comp->id%>">
					<input type="hidden" name="undo" value="<% $countmenot %>">
					<input type="submit" class="blue" value="  <% ($countmenot) ? "Re-qualify" : "Disqualify" %> These Ballots  ">
				</form>
			</td>

		</tr>

% 	} } } }

</table>
