<%args>
	$session
	$account
	$tourn
	$debug
</%args>
<%init>

	unless ($account) { 
		my $err = "You have no active account. $account";
		$m->redirect("$Tab::url_prefix/index/index.mhtml?err=$err");
	}

	unless ($tourn) { 
		my $err = "You have no active tournament";
		$m->redirect("$Tab::url_prefix/user/home.mhtml?err=$err");
	}

    my @tourn_acc = Tab::TournAdmin->search( account => $account->id, tourn => $tourn->id);
    push (@tourn_acc, $account->id) if $account->site_admin;

	my $circuit;

	foreach my $circ ($m->comp("/funclib/tourn_circuits.mas", tourn => $tourn)) {
	    push (@tourn_acc, Tab::CircuitAdmin->search( account => $account->id, circuit => $circ->id ));
		$circuit = $circ;
	}

    unless (@tourn_acc) {
        $m->print("<p class=\"err\">You are not authorized to do that.  Go away</p>");
        $m->abort;
    }

	unless ($tourn->settings) {
		my $err = "You must set up your tournament before you can do anything else!";
		$m->redirect("/setup/tourn/main.mhtml?err=$err");
	}

</%init>

	<div id="wrapper">

		<div id="content">

% 			$m->call_next(account => $account, tourn => $tourn, session => $session, circuit => $circuit);
			<br style="clear: both;" />

		</div>

		<div id="content-spacer"></div>

	</div>
