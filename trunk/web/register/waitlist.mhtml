<%args>
	$event_id
	$tourn
	$circuit
	$err => undef
	$by => undef
</%args> 
<%init>

	my $event = Tab::Event->retrieve($event_id);

	my $switch;

	my @waitlist = sort {$a->registered_at->epoch <=> $b->registered_at->epoch} $event->comps( waitlist => 1, dropped => 0);

	@waitlist = sort {$a->school->name cmp $b->school->name} @waitlist if $by eq "school";
	@waitlist = sort {$a->code cmp $b->code} @waitlist if $by eq "code";

	my @schools = $event->waitlist_schools;

</%init> 

	<span style="float: left; width: 480px;">
		<h2>Waitlist for <% $event->name %></h2>
	</span>

	<span style="float: left; width: 170px; padding-top: 10px;">
		<form action="one_off_waitlist.mhtml" method="post">
		<input type="hidden" name="event_id" value="<% $event->id %>">
		<input type="submit" class="red" value=" Give <% scalar @schools %> schools 1 Slot ">
		</form>
	</span>

	<span style="float: left; width: 70px; padding-top: 10px;">
		<form action="clear_waitlist.mhtml" method="post">
		<input type="hidden" name="event_id" value="<% $event->id %>">
		<input type="submit"  value=" Clear Entire Waitlist  ">
		</form>
	</span>

	<table cellspacing="1" cellpadding="5" width="100%"> 

		<tr class="liblrow">

			<td>
			</td>

			<th class="smaller">
				Registered
			</th>
			<th class="smaller">
				<a href="waitlist.mhtml?event_id=<% $event->id %>&by=code">
				Code
				</a>
			</th>
			<th class="smaller">
				Name
			</th>
			<th class="smaller">
				<a href="waitlist.mhtml?event_id=<% $event->id %>&by=school">
				School
				</a>
			</th>

			<th class="smaller" colspan="3">
			</th>



% 		foreach my $comp (@waitlist) { 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th class="center">
					<% $switch %>.
				</th>

				<td class="smaller">
					<% Tab::niceshortdt($comp->registered_at->set_time_zone($circuit->timezone)) %>
				</td>

				<td>
					<a class="whiteblock" href="/register/entry/edit.mhtml?comp_id=<% $comp->id %>">
						<% $comp->code %>
					</a> 
				</td>

				<td class="smaller">
%					foreach my $student ($comp->members) { 
						<% $student->first." ".$student->last %>
						<br />
%					}
				</td>

				<td class="smaller">
					<a class="whiteblock" href="/register/registration.mhtml?school_id=<% $comp->school->id %>">
						<% $comp->school->name %>
					</a> 
				</td>

				<td>
					<% $comp->school->chapter->state %>
				</td>

				<td>
					<% scalar $comp->school->comps( event => $event_id, waitlist => 0 ) %>
				</td>

				<td class="smaller">
					<a class="whiteblock" href="<% $Tab::url_prefix %>/register/unwaitlist.mhtml?comp_id=<% $comp->id %>">De-waitlist & notify coach</a>
				</td>

			</tr>

% 		}

	</table>

