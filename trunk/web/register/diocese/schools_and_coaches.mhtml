<%args>
	$tourn
	$league
	$session
	$sort_by => "name"
</%args>
<%init>

	my @dioceses = sort {$a->name cmp $b->name} $tourn->regions;

	if ($sort_by eq "code") { 
		@dioceses = sort {$a->code cmp $b->code} @dioceses;
		@dioceses = sort {length($a->code) <=> length($b->code)} @dioceses;
	}

</%init>

<h3>Schools (and coaches) attending <% $tourn->name %></h3>

<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="25%" align="center">
	<form action="schools_and_coaches.mhtml" method="post">
	<select name="sort_by">
		<option value="name" <% ($sort_by eq "name") ? "selected" : "" %>>Diocese Name</option>
		<option value="code" <% ($sort_by eq "code") ? "selected" : "" %>>Diocese Code</option>
	</select>
</td>
<td width="25%">
	<input class="blue" type="submit" value="Re-sort">
	</form>
</td>
<td align="right">
	<form action="schools_and_coaches_print.mhtml" method="post">
	<input type="hidden" name="sort_by" value="<% $sort_by %>">
	<input class="blue" type="submit" value="Print Schools and Coaches">
	</form>
</td>
</tr>
</table>

<hr>

<center>
<table cellpadding="5" cellspacing="1" width="100%">

%	my $switch;

%	foreach my $diocese (@dioceses) { 

%		foreach my $school ($diocese->schools(tournament => $tourn->id)) { 


		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >


		<td><% $diocese->code %></td>
		<td><% $diocese->name %></td>
		<td><% $school->name %></td>
		<td>

%		my $first;		
%			foreach my $coach ($school->chapter->credits) { 
<% ($first) ? ", " : "" %><% $coach->name %>
%				$first++;
%			}
		</td>

		<td>
			<form action="registration.mhtml" method="post">
			<input type="hidden" name="school_id" value="<% $school->id %>">
			<input class="blue" type="submit" value="Edit">
			</form>
		</td>

		</tr>

%		}

%	}	

</table>
</center>



