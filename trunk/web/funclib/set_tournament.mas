<%args>
	$account
	$session
	$league
	$tourn_id
</%args>
<%init>

	my @tourn_accesses = Tab::AccountAccess->search(
			account => $account->id,
			tournament => $tourn_id);

	if (@tourn_accesses) { 
		my $ta = shift @tourn_accesses;

		if ($ta->entry > 0) {
			$session->entry++ 
		} else { 
			$session->entry();
		}

		$session->update;
	}
		
	my $tourncookie = Apache2::Cookie->new($r,
        -name => 'Tab-TournToken',
        -value => $tourn_id,
        -expires => '+12h',
        -path => '/'
     );
	
	$tourncookie->bake($r);
	
	if ($league->diocese_based) { 
		$m->redirect("$Tab::url_prefix/register/dioceses.mhtml") ;
	} else { 
		$m->redirect("$Tab::url_prefix/register/registration.mhtml") ;
	}

</%init>



