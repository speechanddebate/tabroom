<%args>
	$tourn
	$by_region => undef
</%args>
<%perl>

	if ($by_region) { 

		Tab::Student->set_sql( region_by_tourn => "
			select distinct student.*, entry.id as entry, region.id as region
			from student, entry_student, entry, school, region
			where student.id = entry_student.student
			and entry_student.entry = entry.id
			and entry.tourn = ? 
			and entry.school = school.id
			and school.region = region.id
			order by school.name, student.last ");

		return Tab::Student->search_region_by_tourn($tourn->id);

	} else { 

		Tab::Student->set_sql( by_tourn => "
			select distinct student.*, entry.id as entry
			from student, entry_student, entry, school
			where student.id = entry_student.student
			and entry_student.entry = entry.id
			and entry.tourn = ? 
			and entry.school = school.id
			order by school.name, student.last ");

		return Tab::Student->search_by_tourn($tourn->id);

	}

</%perl>

