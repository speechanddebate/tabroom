<%args>
	$round_id
</%args>
<%init>

		#receives a round_id and returns an array of judges who fit
		#the timeslot and event
		
		my $round = Tab::Round->retrieve($round_id);
		my $event = $round->event;
		my $judge_group = $event->judge_group;

		Tab::Judge->set_sql(pull_ballots => "
			select judge.id, judge.first, judge.last
			from judge, round, timeslot
			where judge.judge_group = $judge_group
			and round.id = $round_id
			and timeslot.id = round.timeslot
			and not exists( 		
				select strike.id 
				from strike
				where strike.judge = judge.id 
				and strike.type = \"time\"
				and strike.start < timeslot.end 		
				and strike.end > timeslot.start )
			and not exists(
				select strike.id from strike
				where strike.judge = judge.id 	
				and strike.event = round.event
				and strike.type = \"event\" )
		");	

		my @judges = Tab::Judge->search_pull_ballots;
		
		return \@judges;
		
</%init>			
