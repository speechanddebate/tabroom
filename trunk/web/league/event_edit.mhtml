<%args>
	$circuit
	$event_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id; 
	my $switch;
	
</%init>


	<h2><% ($event) ? "Edit ". $event->name : "Create new event:" %></h2>
		
		<table cellpadding="5" cellspacing="1" border="0" width="100%"> 

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Name:
				</td>
				
				<td>
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" 
						name="ballot" action="event_save.mhtml" method="post">
					<input type="hidden" value="<% $event_id %>" name="event_id">
					<input type="text" name="name" value="<% ($event) ? $event->name : "" %>" size="22">
				</td>
			</tr>
			
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					Abbreviation:
				</td>
				
				<td>
					<input type="text" name="abbr" value="<% ($event) ? $event->abbr : "" %>" size="5">
				</td>
				
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Event Category:
				</td>
				
				<td>

					<select name="method">
% 						foreach my $method ($circuit->methods(is_standard => 1) ) {	 
							<option value="<% $method->id %>" <% ($event && $method->id == $event->method->id) ? "selected" : "" %>>
								<% $method->name %>
							</option>
%						}
					</select>

				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
				<td>
					Event Type:
				</td>
				
				<td>

					<select name="type">
						<option value="debate" <% ($event) ? ($event->type eq "debate") ? 'selected' : '' : "" %>>Debate</option>
						<option value="speech" <% ($event) ? ($event->type eq "speech") ? 'selected' : '' : ""%>>Speech</option>
						<option value="congress" <% ($event) ? ($event->type eq "congress") ? 'selected' : '' : "" %>>Congress</option>
						<option value="">--------------------</option>
					</select>

				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>Entry Size:</td>

				<td align="left">

					<select name="team"> 
						<option value="1" name="team" <% ($event) ? ($event->team == 1) ? 'selected' : '' : '' %>>Individual</option>
						<option value="2" name="team" <% ($event) ? ($event->team == 2) ? 'selected' : '' : '' %>>Pairs</option>
						<option value="3" name="team" <% ($event) ? ($event->team == 3) ? 'selected' : '' : '' %>>2 or more</option>
						<option value="">--------------------</option>
					</select>

				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			    <td>
			    	Ballot:
			    </td>

			    <td>
			    	<input type="file" name="ballot" size="5">
%  						if ($event && $event->ballot) {
							( <a href="/files/methods/<% $event->method->id %>/events/<% $event->id %>/<% $event->ballot %>">Ballot</a> )
%  						}
					</input>
				</td>
					
			</tr>
				
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td colspan="2">
					<h4>Event Rules/Description</h4>
				</td>

			</tr>

			<tr>
				<td valign="center" colspan="2" valign="top">
					<textarea name="text" id="text" rows=10 cols="58" wrap="virtual"><% ($event) ? $event->text : "" %></textarea>
				<td>

			</tr>

			<tr class="liblrow">

				<td colspan="8" class="right">
					<input class="blue" type="submit" value="<%($event) ? '    Save Changes    ' : 'Create Event' %>">
				</td>
					
			</tr>

		</table>

	</div>

	<div class="right small">

		<a href="event_edit.mhtml" class="red block">Add New Event</a>

% 		foreach my $method ($circuit->methods(is_standard => 1) ) {	 
		
			<h4><% $method->name %></h4>

%	 		foreach my $event (sort {$a->name cmp $b->name} $method->events) {

				<a class="blue block" href="event_edit.mhtml?event_id=<%$event->id%>">
					<% $event->name %>
				</a>

% 			}	# end of foreach event

% 		}  # end of foreach method.


