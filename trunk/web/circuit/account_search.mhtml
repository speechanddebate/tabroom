<%args>
	$circuit
	$account	
	$search_field
	$search_value => undef
	$err => undef
</%args>
<%init>

	$search_field = lcfirst($search_field);

	my @chapters;

	if ($search_field eq "all") { 
		@accounts = $circuit->accounts;
	}

	if ($search_field eq "name") { 
		$search_value = $search_value."%";
		@accounts = Tab::Account->search_circuit_and_name($circuit->id, $search_value);
	}

	if ($search_field eq "code") {
		$search_value = $search_value."%";
		@accounts = Tab::Account->search_circuit_and_code($circuit->id, $search_value);
	}

	if ($search_field eq "membership") { 

		@accounts = Tab::Account->search_circuit_and_membership($circuit->id, $search_value);
	}


    #uniq
    my %seen = ();
    @accounts = grep { ! $seen{$_->id} ++ } @accounts;


</%init>

	<h2>Search accounts in the <% $circuit->short_name %></h2>

	<table cellpadding="5" cellspacing="1" width="100%">

%		my $switch;

		<tr class="lirdrow">

			<th>
				Name:
			</th>

			<th>
				Code:
			</th>

			<th>
				State:
			</th>

			<th>
				Active:
			</th>

			<th colspan="2">
				<form action="account_multi_save.mhtml" method="post">
			</th>

		</tr>

% 		@accounts = sort {$a->name cmp $b->name} @accounts;

% 		foreach my $account (sort {$a->state cmp $b->state} @accounts) { 

%			my $mem = $chapter->circuit_membership($circuit);

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>
					<input type="text" name="name_<% $chapter->id %>" value="<% $chapter->name %>" size="20">
				</td>

				<td>
					<input type="text" name="code_<% $chapter->id %>" value="<% $mem->code %>" size="5">
				</td>

				<td>
					<input type="text" name="state_<% $chapter->id %>" value="<% $chapter->state %>" size="5">
				</td>

				<td class="centeralign">
					<input type="checkbox" value="1" name="active_<% $chapter->id %>" 
					<% ($mem->active) ? "checked" : "" %>>
				</td>

				<td class="centeralign">
					(<a href="<% $Tab::url_prefix %>/circuit/chapter_edit.mhtml?chapter_id=<% $chapter->id %>">Edit</a>)
				</td>

				<td class="centeralign">
					(<a href="<% $Tab::url_prefix %>/circuit/chapter_merge.mhtml?chapter_id=<% $chapter->id %>">Merge</a>)
				</td>

			</tr>

% 		} # end of foreach chapter. 


		<tr class="liblrow">
			<td colspan="5" class="rightalign">
				<input  type="submit" value="Save All Changes">
				</form>
			</td>
		</tr>

	</table>
