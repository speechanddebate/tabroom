<%args>
	$tourn
	$session
	$timeslot_id
	$label => undef
	$pool_id => undef
	$no_first_year => undef
	$type
	$league
	$site_id
	$sections => undef
</%args>
<%perl>

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id);

	EVENT:
	foreach my $event ($tourn->events) {

		next unless $ARGS{$event->id};

		# Create the preset round

		my $round = Tab::Round->create({
			label => $label,
			type => $type,
			preset => 1,
			pool => $pool_id,
			published => 0,
			no_first_year => $no_first_year,
			timeslot => $timeslot_id,
			event => $event->id,
			site => $site_id
		});


		next unless $sections > 0;

		my $letter = "A";

		foreach ( 1 .. $sections ) { 

			my $panel = Tab::Panel->create({

				letter => $letter,
				round => $round->id,
				type => $type,
				event => $event->id
			});

			$letter++;

		}

		# Renumber the rounds to be sane and in order.
	    $m->comp("/funclib/renumber_rounds.mas", event_id => $event->id);
	}

	$m->redirect("$Tab::url_prefix/panel/rooms_manassign.mhtml?timeslot_id=".$timeslot->id);

</%perl>

