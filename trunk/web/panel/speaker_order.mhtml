<%args>
	$comp_id => undef
	$panel_id => undef
</%args>
<%init>

	my $comp = Tab::Comp->retrieve($comp_id) if $comp_id;
	my $panel = Tab::Panel->retrieve($panel_id) if $panel_id;

	my @panels;

	push (@panels, $panel) if $panel;
	push (@panels, $comp->panels) if $comp;

</%init>

%	if ($comp_id) { 

		<div id="rightsmall">
			<a href="/register/comp_edit.mhtml?comp_id=<% $comp_id %>" class="red block">Edit Competitor <% $comp->code %></a>
		</div>

%	}

%	if ($panel) { 

		<div id="rightsmall">
			<a href="/panel/schemat_show.mhtml?round_id=<% $panel->round->id %>" class="blue block"><% $panel->round->realname %> Schematic</a>
			<a href="/panel/panel_view.mhtml?panel_id=<% $panel_id %>" class="red block">View/Edit Panel</a>
		</div>

%	}

	<div class="left huge">

		<h2>Adjust speaker order</h2>

%		foreach my $panel (sort {$a->round->name <=> $b->round->name} @panels) {

			<h4>Round <% ($panel->round->label) ? $panel->round->label : $panel->round->name %> Section <% $panel->letter %></h4>

			<form action="speaker_order_save.mhtml" method="post">
			<input type="hidden" name="panel_id" value="<% $panel->id %>">
			<input type="hidden" name="comp_id" value="<% $comp_id %>">

			<table cellpadding="5" cellspacing="1" width="100%">

				<tr class="liblrow">

					<th>
						Code
					</th>

					<th>
						Competitor
					</th>

					<th>
						Position
					</th>

					<th class="smaller" style="text-align: center;">
						Avg Prelim <br />Position
					</th>

%					if ($panel->type ne "prelim") {
						<th class="smaller" style="text-align: center;">
							Positions
							in Elims
						</th>
%					}
				</tr>

%				my $switch;

%				foreach my $o_comp ($panel->comps) { 

%					if ($o_comp->id == $comp_id) {
						<tr class="lirdrow">
%					} else {
						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
%					}

						<td>
							<% $o_comp->code %>
						</td>

						<td>
							<% $o_comp->team_name %>
						</td>

						<td align="center">
							<input type="text" size="3" name="<% $o_comp->id %>" value="<% $o_comp->speakerorder($panel) %>">
						</td>

						<td class="center">
							<% sprintf("%.2f", $o_comp->order_total) %>
						</td>

%						if ($panel->type ne "prelim") {

							<td style="text-align: center;">
%								my $notfirst;
%								foreach my $elim ($o_comp->event->rounds( type => "elim") ) {
%									next unless $elim->type eq "elim";
%									next if $elim->id == $panel->round->id;

									<% ($notfirst) ? "/ " : "" %>
						            <% $o_comp->order_by_round($elim) %>
%									$notfirst++;
%								}

							</td>

%						}

					</tr>

%				}

				<tr class="liblrow">

					<td colspan="6" align="right">
						<input type="submit" value="  Save Speaker Order  " class="blue">
						</form>
					</td>

				</tr>

			</table>


%		}

	</div>

	<br style="clear: both;">
