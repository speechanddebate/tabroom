<%args>
	$session
	$tourn
	$judge_group_id => undef
</%args>
<%init>

	my $judge_group = Tab::JudgeGroup->retrieve($judge_group_id) if $judge_group_id;
	my @judge_groups = $tourn->judge_groups unless $judge_group;
	push (@judge_groups, $judge_group) if $judge_group;

    #Set up the filename and the needed trace files
	my $filename = "Policy-labels-".$tourn->id."-".$session->id;
	my $filepath = $Tab::file_root."/tmp/";
	my $garbage = `rm -f $filepath"."$filename.*`;
	open (TEXOUT, ">$filepath"."$filename.tex");

    print TEXOUT <<'EOF';
\documentclass[10pt]{report}
\usepackage{helvet}
\usepackage{colortbl}
\usepackage{nopageno}
\usepackage{multirow}
\renewcommand{\familydefault}{\sfdefault}
\renewcommand{\arraystretch}{1.2}

\setlength{\oddsidemargin}{-.6in}     
\setlength{\textwidth}{6.0in}        

\setlength{\textheight}{10.5in}       
\setlength{\topmargin}{-.63in}      
\setlength{\headsep}{0in}         

\setlength{\parskip}{1.4ex}
\setlength{\parindent}{0mm}

\begin{document}
EOF

my $switch;

foreach my $judge_group (@judge_groups) { 

	my @group_elim_pools = $judge_group->elim_pools;

	foreach my $judge (sort {$a->code <=> $b->code} $judge_group->judges) { 

		my @quals = $judge->quals;
		my $qual = shift @quals;

		print TEXOUT "\\begin{tabular}{p{1.0in}p{2.35in}}\n";
		print TEXOUT "\\multirow{2}{*}{\\LARGE \\bf ".$judge->region->code." ".$judge->code." }\n";
		print TEXOUT " & ".&Tab::texify($judge->first." ".$judge->last);
		print TEXOUT " (".$qual->name." ) \\\\ \n";
		print TEXOUT " & \\small ".&Tab::texify(substr($judge->school->name,0,35))."\\\\ \n";

		print TEXOUT "\\footnotesize Blocks: " if $judge->strikes;

		foreach my $block ($judge->strikes) {
			print TEXOUT $block->region->code." " if $block->type eq "region" || $block->type eq "diocese";
		}

		print TEXOUT " & \\renewcommand{\\arraystretch}{.75} \\begin{tabular}{p{.2in}|p{.2in}|p{.2in}|p{.2in}|p{.2in}}\n";
		
		my $notfirst;
		foreach my $elim_pool (@group_elim_pools) {
			print TEXOUT " & " if $notfirst;
			print TEXOUT "\\footnotesize ". $elim_pool->abbr if $judge->in_pool($elim_pool);
			$notfirst++;
		}

		print TEXOUT " \\end{tabular}\n";
		print TEXOUT "\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\renewcommand{\\arraystretch}{1.2}\n";
		print TEXOUT "\\hspace{.25in}\n" unless ($switch % 2);
		print TEXOUT "\\vspace{.04in}\n" if ($switch % 2);
		print TEXOUT "\\newline\n" if ($switch++ % 2);

	}
}

	print TEXOUT "\\end{document}\n";

    close TEXOUT;

    $garbage = `cd $filepath; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
	$garbage = `cd $filepath; rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
