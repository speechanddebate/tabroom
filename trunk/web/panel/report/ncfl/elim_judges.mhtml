<%args>
	$tourn
	$session
	$event_id
	$pool_id
</%args>
<%init>

	use POSIX;

	my $now = DateTime->now;

	my $event = Tab::Event->retrieve($event_id);
	my $pool  = Tab::Pool->retrieve($pool_id);

	#Set up the filename and the needed trace files

     my $filename = $event->abbr."-elim-judges-".$tourn->id."-".$session->id;
	 my $filepath = $Tab::file_root."/tmp/";
     my $garbage = `rm -f $filepath.$filename.*`;
     open (TEXOUT, ">$filepath"."$filename.tex");

	print TEXOUT <<'EOF';
\documentclass[10pt]{letter}
\usepackage{fullpage}
\usepackage{nopageno}
\usepackage{colortbl}
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}
\renewcommand{\arraystretch}{1.4}

\setlength{\oddsidemargin}{-0.15in}     
\setlength{\textwidth}{6.5in}        

\setlength{\textheight}{9.5in}       
\setlength{\topmargin}{.2in}      
\setlength{\headsep}{0in}         

\setlength{\parskip}{1.4ex}
\setlength{\parindent}{0mm}



\begin{document}
\addtolength{\textwidth}{1in}
\addtolength{\voffset}{-.5in}
EOF

	print TEXOUT "\\begin{center}\n";
    print TEXOUT "\\medskip\n";
    print TEXOUT "\\begin{tabular}{rlrl}\n";
	print TEXOUT "\\multicolumn{4}{c}{\\Large Elim Round Judge Selection Sheet}\\\\ \n";
    print TEXOUT "\\small {\\bf Event}: & \\small ".&Tab::texify($event->name)." & ";
    print TEXOUT "\\small {\\bf Pool}: & \\small ".&Tab::texify($pool->name)." \\\\ \n ";
    print TEXOUT "\\small {\\bf Tournament}: & \\small ".&Tab::texify($tourn->name)." & ";
    print TEXOUT "\\small {\\bf Printed}: & \\small ". $now->day_abbr." ".$now->month_name." ".$now->day.", ".$now->year." ".$now->hour_12.":".$now->strftime('%M')." ".$now->strftime('%p')." \\\\ \n";
    print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";
	print TEXOUT "\\end{center}\n";

	my $switch;

	foreach my $judge (sort {$a->code cmp $b->code} $pool->judges) { 

		next if $judge->has_judged_event($event);  #Not if we've judged this event before. 
		my $qual = $judge->rating->qual if $judge && $judge->rating;

		print TEXOUT "\\begin{tabular}{p{.75in}p{1.25in}p{1.5in}p{2.25in}p{.3in}}\n";

		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

		print TEXOUT $judge->region->code." ".$judge->code." & ";
		print TEXOUT $judge->region->name." & ";
		print TEXOUT $judge->first." ".$judge->last." & ";
		print TEXOUT $judge->school->name." & ";
		print TEXOUT $qual->name if $qual;
		print TEXOUT "\\\\ \n";

		print TEXOUT "\\end{tabular}\n";

	}

    open (TEXOUT, ">>$filepath"."$filename.tex");
	print TEXOUT "\\end{document} \n";
	close TEXOUT;

	$garbage = `cd $filepath; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
	$garbage = `cd $filepath; rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
