<%args>
	$tourn
	$pool_id
	$session
	$site_id => undef
	$debug => undef
</%args>
<%init>

	my $pool = Tab::Pool->retrieve($pool_id);

	my @judges = sort {$a->code <=> $b->code} $pool->judges;

	my $file_name = "PoolJudges-".$pool->id."-".$session->id;

	my $filepath = $Tab::file_root."/tmp/$file_name";
	my $garbage = `rm -f $filepath.*`;
	open (TEXOUT, ">$filepath.tex");

    print TEXOUT <<'EOF';
\documentclass[10pt]{report}
\usepackage {helvet}
\usepackage {fullpage}
\usepackage {colortbl}
\renewcommand{\familydefault}{\sfdefault}
\renewcommand{\arraystretch}{1.4}

\setlength{\oddsidemargin}{0in}     
\setlength{\textwidth}{6.0in}        

\setlength{\textheight}{9in}       
\setlength{\topmargin}{-.25in}      
\setlength{\headsep}{0in}         

\setlength{\parskip}{1.4ex}
\setlength{\parindent}{0mm}

\begin{document}
\begin{center}
\normalsize
EOF

print TEXOUT "\\Large Judges in pool: ". $pool->name;
print TEXOUT " \\\\ \n \\normalsize\n";

my $tabular = "\\begin{tabular}{p{.3in}p{.3in}p{2in}p{1in}p{1in}p{.3in}p{.3in}}\n";

print TEXOUT $tabular;
print TEXOUT "\\rowcolor[rgb]{1.0,.95,.94}\[5.5pt\]\[5.5pt\]\n";

print TEXOUT " Code & ";
print TEXOUT " Sch & School " unless $tourn->setting("ncfl");
print TEXOUT " Dio & School " if $tourn->setting("ncfl");
print TEXOUT "& First & Last & Group & Qual  \\\\ \n \\hline \n";
print TEXOUT "\\end{tabular}\n";

my $switch;

foreach my $judge (@judges) { 

	print TEXOUT $tabular;
	print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

	print TEXOUT $judge->code ." &  ";

	if ($tourn->setting("ncfl")) { 

		print TEXOUT Tab::texify($judge->school->region->code)." & ".Tab::texify($judge->school->name)

	} else { 

		print TEXOUT Tab::texify($judge->school->code)." & ".Tab::texify($judge->school->name) if $judge->school;
		print TEXOUT "XX & Hired " unless $judge->school;

	}

	print TEXOUT " & ".Tab::texify($judge->last)." & ".Tab::texify($judge->first);

	print TEXOUT " & ".Tab::texify($judge->judge_group->abbr)." & ";

	if ($judge->judge_group->coach_ratings) { 
		$judge->ratings_print;
	}
	
	print TEXOUT " \\\\ \n";	
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";

}

print TEXOUT "\\end{center}\n";
print TEXOUT "\\end{document}\n";
close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filepath.tex; $Tab::dvipdfm_path $filepath.dvi`;
`rm -f $filepath.tex $filepath.log $filepath.dvi $filepath.aux` unless $debug;
$m->redirect("$Tab::url_prefix/tmp/$file_name.pdf");

</%init>
