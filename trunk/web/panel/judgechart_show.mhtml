<%args>
	$league
	$tourn
	$account
	$group_id
	$sort_by => "code"
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @judges = $group->judges;

	@judges = sort { $a->code cmp $b->code } @judges;
	@judges = sort { $a->last cmp $b->code} @judges if $sort_by eq "last";
	@judges = sort { $a->school->code cmp $b->school->code} @judges if $sort_by eq "school";

	my @timeslots = sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots;

</%init>

	<table width="100%">
		<tr>

			<td width="100%">
				<h3>Judges in <% $group->name %></h3>
			</td>

			<td valign="center">
				<form action="judges_unscrew_over.mas" method="post">
				<input type="hidden" name="group_id" value="<% $group_id%>">
				<input class="blue" type="submit" value="Equalize Assignments" align="right">
				</form>
			</td>

		</tr>

	</table>

	<table cellpadding="4" cellspacing="1" width="100%">

		<tr class="liblrow">

			<th>
				<a class="whiteblock" href="/panel/judgechart_show.mhtml?group_id=<% $group_id %>&sort_by=code">Code</a>
			</th>

			<th>
				<a class="whiteblock" href="/panel/judgechart_show.mhtml?group_id=<% $group_id %>&sort_by=school">SC</a>
			</th>

			<th>
				<a class="whiteblock" href="/panel/judgechart_show.mhtml?group_id=<% $group_id %>&sort_by=last">Last</a>
			</th>


%			foreach my $ts (@timeslots) { 
				<th class="smaller">
					<% $ts->name %>
				</th>
%			}

			<th class="smaller">
				Tot
			</th>

		</tr>

%  	my $switch;

%	my $filler = 8;

% 	foreach my $judge (@judges) { 

%		if ($judge->active == 1 ) { 
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %> >
%		} else {
			<tr <% ($switch++ % 2) ? "class=\"bluerow\"" : "class=\"liblrow\"" %> >
%		}

			<th>
				<a class="whiteblock" href="<% $Tab::url_prefix%>/register/judge_edit.mhtml?judge_id=<%$judge->id%>">
					<% $judge->code %>
				</a>
			</th>

%			if ($league->diocese_based) { 

				<td>
					<% $judge->region->code %>
				</td>

%			} else { 
		
				<td class="smaller" align="center">
					<% ($judge->school->id) ? $judge->school->code : "HIRE" %>
				</td>

%			}

			<td class="smaller">
				<% $judge->last %>
			</td>


% 			my @j_panels = $judge->panels;
% 			@j_panels = sort {$a->round->name <=> $b->round->name} @j_panels;
%			my $count;

%			foreach my $timeslot (@timeslots) { 

				<td class="smaller">


% 					foreach my $panel (@j_panels) {

%						next unless $panel->round->timeslot->id == $timeslot->id;

%						$count++;

% 						my $p_event = $panel->event;
%						my $p_round = $panel->round; 	

						<a href="<% $Tab::url_prefix%>/panel/panel_view.mhtml?panel_id=<% $panel->id %>">
							<% $p_event->abbr %> <% $panel->letter %></a>
% 					}

				</td>

%			}

			<td>
				<% $count %>
			</td>


		</tr>
%	} 

	</table>

