<%args>
	$circuit
	$account
	$tourn
	$panel_id
	$session
</%args>
<%perl>

	my $panel = Tab::Panel->retrieve($panel_id);
	my $round = $panel->round;
	my $event = $round->event;
	my $group = $event->judge_group;

	unless  ( $panel->entries || $panel->round->preset) { 

		$m->print("<p style=\"padding-top: 45px;\" class=\"err\"> You cannot
		pre-panel judges for a round without competitors unless it's set as a
		preset round.  Return to the schedule screen for this event to set it
		as a preset round to pre-panel judges.</p>"); 

		$m->abort;

	}

	my @judges = $panel->judges;

	my @good_judges = $m->comp("/funclib/clean_judges.mas", 
			panel_id => $panel_id, 
			session => $session );

	my $pool = $panel->round->pool;

	my %judge_comments = ();

	if ($pool) { 

		foreach my $gj (@good_judges) { 

			my $pj = $gj->in_pool($pool);
			next unless $pj;
			$judge_comments{$gj->id} = $pj->type;

		}

	}

	@good_judges = sort {$a->code cmp $b->code} @good_judges;	
	@good_judges = sort {$b->score cmp $a->score} @good_judges;	

	my %rating_by_id = ();

	foreach my $judge (@good_judges) { 

		if ($event->qual_subset)  {
			$rating_by_id{$judge->id} = $judge->rating($event->qual_subset)->qual->name;
		} else { 
			$rating_by_id{$judge->id} = $judge->rating->qual->name if $judge && $judge->rating && $judge->rating->qual;
		}
	}

	@good_judges = sort {$rating_by_id{$a->id} cmp $rating_by_id{$b->id}} @good_judges;

	my $switch;

</%perl>

	<div class="right small">

		<a class="blue block" href="schemat_show.mhtml?round_id=<% $round->id %>">Return to Schematic</a>
		<a class="blue block" href="print_schematics.mas?event_id=<% $event->id %>&round_id=<% $round->id %>">Print Schematic</a>

	</div>

	<div class="left huge">

		<h3>Judges for <% $event->name %> 
			<% ($round->label) ? $round->label : $round->name %> 
			Section <% $panel->letter %>
		</h3>

		<table cellspacing="0" cellpadding="3" width="100%">

			<tr class="liblrow">

				<th class="smaller">
				</th>
					
				<th class="smaller">
					Judge
				</th>

				<th class="smaller">
					School
				</th>

%				if ($circuit->diocese_based) { 
					<th class="smaller">
						Dio
					</th>
%				}

%				if ($circuit->region_based) { 
					<th class="smaller">
						Rgn	
					</th>
%				}

%				if ($group->coach_ratings) { 
					<th class="smaller">
						Qual
					</th>
%				}

				<th>
				</th>

			</tr>


% 			foreach my $judge (@judges) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

%					my $block = "whiteblock";

%   				if (scalar @judges > 1) {

    					<td align="center" class="smaller">
							<% $judge->is_chair($panel) 
								? "<b>Chair</b>" 
								: "<a class=\"".$block."\" href=\"make_chair.mhtml?judge_id=".$judge->id."&panel_id=".$panel->id."&from=pre\">Make Chair</a>" %>
						</td>
				
%   				}

					<td class="smaller">
						<a class="<% $block %>" href="/register/judge_edit.mhtml?judge_id=<% $judge->id %>">
							<% $judge->code %>
							<% $judge->first." ".$judge->last %>
						</a>
					</td> 
				
					<td class="smaller">

%						if ($judge->school) { 
							<a class="<% $block %>" href="/register/registration.mhtml?school_id=<% $judge->school->id %>">
							<% $judge->school->name %> 
%						} else {
							Hired
%						}

					</td> 

%					if ($circuit->diocese_based) { 

						<td class="smaller">

%							if ($judge->school) { 
								<a class="<% $block %>" href="/register/diocese/index.mhtml?diocese_id=<% $judge->region->id %>">
									<% $judge->school->region->code %>
								</a>
%							}

						</td>

%					}
					
%					if ($group->coach_ratings) { 
						<td class="smaller">
							<% $rating_by_id{$judge->id} %>
						</td> 
%					}
				
					<td class="smaller">
						<a class="red block" href="/panel/judge_rm.mas?judge_id=<%$judge->id %>&panel_id=<% $panel->id %>&from=pre">Delete</a>
					</td> 
				
				</tr>

% 			}

		</table>

		<hr>

		<h3>Add Judges:</h3>
		
		<table cellspacing="0" cellpadding="5" width="100%">
			
			<tr>
			
				<td>
					Clean judges:
					<form action="panel_judgeadd.mas" method="post">
					<input type="hidden" name="panel_id" value="<% $panel_id %>">
					<input type="hidden" name="from" value="pre">
				</td> 
				
				<td>
					<select name="judge_id"> 

%   					if ($circuit->diocese_based) {

							<option style="background-color: #444444; color: white;" value="">
								Qual Dio&nbsp;&nbsp; Kids Rounds Name
							</option>

%   					} else {

%							if ($group->coach_ratings) { 
								<option value="">
									Qual Sch&nbsp; Kids Rounds Name
								</option>

%       					} else {
							
								<option value="">
									Sch&nbsp; Kids Rounds Name
								</option>
%       					}
%   					}

% 						foreach my $judge (@good_judges) { 

%           				my $qual = $judge->qual;
%           				$qual .= "&nbsp;&nbsp;&nbsp;";

							<option value="<%$judge->id %>"> 
        						<% ($judge->qual) ? $qual : "" %>

%          						my $schcode = $judge->schcode;

%          						foreach ( length($schcode) .. 4) {
%           					    $schcode .= "&nbsp;";
%								}

						        <% $schcode %>		

%								my $score = $judge->score;

%           					foreach ( length($score) .. 4) {
%               					$score .= "&nbsp;";
%           					}

						        <% $score %>

%           					my $tmp = $judge->tmp;
%           					foreach ( length($tmp) .. 3) {
%									$tmp .= "&nbsp;";
%           					}
        						<% $tmp %>

								<% $judge->first." ".$judge->last %> 

							</option>

% 						}

					</select>
					
				</td>

			</tr>

			<tr class="liblrow">
				
				<td colspan="2" align="right">
					<input  type="submit" value="Add Judge">
					</form>
				</td>
				
			</tr>


			<tr>

				<td>
					<form action="panel_judgeadd.mas" method="post">
					<input type="hidden" name="panel_id" value="<% $panel_id %>">
					<input type="hidden" name="from" value="pre">
					Force-add judge:
				</td> 
				
				<td>
					<input type="text" name="judge_code" value="" size="5">
					(enter judge code number)
				</td> 
			</tr>
				
			<tr class="liblrow">
				<td colspan="2" align="right">
					<input  type="submit" value="Add Judge">
					</form>
				</td>
			</tr>

		</table>

	</div>




