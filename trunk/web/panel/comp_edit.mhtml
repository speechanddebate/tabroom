<%args>
	$circuit
	$tourn
	$entry_id
	$round_id => undef
	$err => undef
</%args>

<%init>

	my $entry = Tab::Entry->retrieve($entry_id);
	my @entry_panels = $entry->panels;
	my $round = Tab::Round->retrieve($round_id);
	my $this_panel;
	my $this_panel_id;

	foreach my $pan (@entry_panels)  {
		my $pan_round = $pan->round;
		$this_panel = $pan if ($pan_round->id eq $round->id);
	}

	my $school = $entry->school;
	my $region = $school->chapter->region($circuit);
	my $student = $entry->student;
	my $partner = $entry->partner;
	my $event = $entry->event;
	
	my @panels = Tab::Panel->search( event => $event->id, round => $round->id, {order_by => "letter"} );

	foreach my $panel (@panels) { $panel->update_score($entry); }

	@panels = sort{$a->score($entry) <=> $b->score($entry)} @panels;
#	@panels = sort{$a->entries <=> $b->entries} @panels;
#	@panels = sort{$b->clean_judges($entry) <=> $a->clean_judges($entry)} @panels;
	
</%init>

	<div class="right small">

		<a class="blue block" href="schemat_show.mhtml?round_id=<% $round_id %>">
			Return to Schematic
		</a>

		<a class="blue block" href="/register/entry_edit.mhtml?entry_id=<% $entry_id %>">
			View
			<% $entry->code %>
			<% $entry->team_name %>
		</a>

		<a class="blue block" href="/register/registration.mhtml?school_id=<%$school->id%>">
			View <% $school->short_name %>
		</a>

%		if ($tourn->setting("ncfl")) { 
			<a class="blue block" href="<%$Tab::url_prefix%>/register/diocese/index.mhtml?diocese_id=<%$region->id%>">
				<% $region->name %>
			</a>
%		}


		<hr>

		<a class="red block" href="entry_remove_from_round.mhtml?entry_id=<% $entry->id %>&round_id=<% $round->id %>" method="post">
			Remove Entry from Round
		</a>

		<h4>Key:</h4>	

			<a class="red block">Red: Same school</a>
			<a class="blue block">Blue: Seen before</a>

%			if ($tourn->setting("ncfl")) { 
				<a class="green block">Green: Same Diocese </a>
%			}

%			if ($tourn->setting("regions")) { 
				<a class="green block">Green: Same Region</a>
%			}

			<p class="smaller">The "Score" number is a weight given to the panel based on the
			number of mutual-hits and same-school hits that would be created by moving the kid
			into that particular room.  Smaller scores are better.
			</p>



	</div>

	<div class="left huge">

		<h2>Move Entry <% $entry->code." ".$entry->team_name %></h2>

		<table cellpadding="2" width="100%" cellspacing="1">
	
			<tr class="liblrow"> 
		
				<th>
					Room
				</th>

				<th>
					Judges
				</th>
			
				<th>
					Entrys
				</th>

				<th class="smaller" colspan="2">
					Score
				</th>
			
			</tr>
	
% 			my $switch;

% 			foreach my $panel (@panels) { 

%				next if $this_panel && $this_panel->id == $panel->id;

%				my $judge_block;

%           	my $block = "white block" if $switch % 2;
%           	$block = "grey block" unless $switch % 2;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td class="smaller">
						<a class="<% $block %>" href="<% $Tab::url_prefix %>/panel/panel_view.mhtml?panel_id=<% $panel->id %>">
							<% $panel->letter %><% ($panel->room && $panel->room->name) ? "/".$panel->room->name : "" %>
						</a>
					</td>

					<td class="smaller" align="center">

% 						foreach my $judge ($panel->judges) { 

%							if ($judge->cannot_judge($entry)) {
%								$judge_block++;
								<% "<font color=\"brown\">".$judge->code."</font>" %>
%							} else { 
								<% $judge->code %>
%							}
%						} 

					</td>

					<td class="smaller" align="left">

% 					foreach my $o_entry ($panel->entries) { 

% 						if ($tourn->setting("regions") || $tourn->setting("ncfl")) {
							<% ( $o_entry->regionid == $region->id ) ? '<font color="#D6F2D0">':'' %>
%						} 
						<% ( $o_entry->schoolid == $school->id)  ? '<font color="#ffdcdc">' : '' %>
							<% $o_entry->code %>
						</font>

% 					}

					</td>

					<td align="center" class="smaller">
						<% $panel->score($entry) %>
					</td>

					<td class="smaller" align="center">
%						unless ($judge_block) { 
							<a href="entry_move.mas?entry_id=<% $entry->id %>&panel_id=<% $panel->id %>&back=entry_edit" class="blue block">
								Move
							</a>
%						} else {
							Judge<br />
							Block
%						}

					</td>
				
				</tr>

% 			}

		</table>

	</div>

	<br style="clear: both;">
