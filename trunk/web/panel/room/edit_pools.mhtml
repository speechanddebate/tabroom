<%args>
	$account
	$tourn
	$rg_name => undef
</%args>
<%init>

	my $msg;
	my $switch;

	if ($rg_name) { 
		my $pool = Tab::RoomGroup->create({
			tourn => $tourn->id,
			name  => $rg_name,
		});
		$msg = "Pool $rg_name created";
	}

	my @pools = sort {$a->name cmp $b->name} $tourn->room_groups;

</%init>

	<& menu.mas, tourn => $tourn, whoami => "edit_pools" &>

	<div class="main">

		<% $msg ? '<p class="explain">'.$msg.'</p>' : "" %>

		<h2>Room Pools</h2>
	
		<& tabbar.mas, tourn => $tourn, whoami => "edit_pools" &>

		<span class="quarter nospace top" style="width: 23%;">

			<table cellpadding="3" cellspacing="1">

				<tr class="yellowrow smallish">
					<th>
						<form action="edit_pools_save.mhtml" method="post">
						Pool Name
					</th>
				</tr>

%				foreach my $pool (@pools) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

						<td>
							<a id="<% $pool->id %>"></a>
							<span class="hidden"><% $pool->name %></span>
							<span class="optionblock">
								<input type="text" name="<% $pool->id %>" value="<% $pool->name %>" size="12">
							</span>
						</td>

					</tr>

%				}

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<td>
						<div class="optionblock">
						<input type="text" name="new" placeholder="New Pool name" size="12">
						</div>
					</td>
				</tr>

				<tr class="liblrow">
					<td>
						<div class="optionblock">
						<input type="submit" value="Save Pools">
						</form>
						</div>
					</td>
				</tr>

			</table>

		</span>

%		undef $switch;

		<span class="threequarter top nospace" style="width: 76%; border-left: 0px solid white;">
		
			<table cellpadding="3" cellspacing="1">

				<tr class="yellowrow smallish">

					<th>
						Rounds (Click to remove)
					</th>

					<th>
						#Rms
					</th>

					<th class="nosort">
						Add Rounds
					</th>
					
					<th class="nosort">
						Add All From
					</th>

					<th class="nosort">
					</th>

				</tr>

%				foreach my $pool (@pools) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

						<td>
							<div class="optionblock">
%							my %used_round;
%							foreach my $round ($pool->rounds) {
%								$used_round{$round->id}++;
%								next unless $round->event;
								<span class="nospace half nowrap smallish">
									<a class="white hover" href="pool_round_rm.mhtml?pool_id=<% $pool->id %>&round_id=<% $round->id %>">
									<% $round->event ? $round->event->abbr : "" %>
									<% $round->realname %>
									</a>
								</span>
%							}
							</div>
						</td>

						<td class="rightalign smallish">
							<% scalar $pool->rooms %>
						</td>

					<td>
						<form action="pool_round_add.mhtml" method="post">
						<input type="hidden" name="pool_id" value="<% $pool->id %>">

						<select name="round_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
							<option value=""></option>
%							my @rounds = $m->comp("/funclib/tourn_rounds.mas", tourn => $tourn);
%	                       	foreach my $round (@rounds) {
%								next if $used_round{$round->id};
								<option value="<% $round->id %>"><% $round->event->name %> <% $round->realname %></option>
%	                       	}
						</select>

						</form>
					</td>

					<td>
						<form action="pool_event_add.mhtml" method="post">
						<input type="hidden" name="pool_id" value="<% $pool->id %>">

						<select name="event_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
							<option value=""></option>
%	                       	foreach my $event ($tourn->events) {
								<option value="<% $event->id %>"><% $event->name %></option>
%	                       	}
						</select>

						</form>
					</td>


					<td class="centeralign" style="padding-left: 2px;">

%						my $warn = "You are about to delete this room pool and cast any rounds in it to pull from the main list.  Are you sure?";
						<a class="dkred marno block" <& "/funclib/confirm.mas", warn => $warn &>  href="pool_delete.mhtml?pool_id=<% $pool->id %>">
							X
						</a>
					</td>
				
				</tr>
%			}

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
				<td colspan="5">
					<Div class="optionblock"> &nbsp;</div>
				</td>
			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
				<td colspan="5">
					<Div class="optionblock">&nbsp;</div>
				</td>
			</tr>

			</tbody>

		</table>

		</span>

	</div>
