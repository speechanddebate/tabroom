<%args>
	$tourn
	$account
	$event_id => undef
	$group_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);
	my $group = Tab::JudgeGroup->retrieve($group_id);

	unless ($event || $group) { 
		$m->abort;
	}

	if ($event) { 
		$m->abort unless $event->tourn->id == $tourn->id;
	}

	$group = $event->$group if $event && not defined $group;

	unless ($event) { 
		$m->abort unless $group;
		my @g_events = $group->events;
		$event = shift @g_events if @g_events;
	}

</%init>

%	unless ($event) { 

		<& menu.mas, tourn => $tourn, group => $group,  whoami => "event" &>

		<& tabbar.mas, tourn => $tourn, group => $group,  whoami => "event" &>

%	} else { 

		<& menu.mas, tourn => $tourn, group => $group, event => $event, whoami => "event" &>

		<& /funclib/tablesorter.mas, table => "sortme" &>

		<div class="main">

			<h2><% $group->name %></h2>
		
			<& tabbar.mas, tourn => $tourn, group => $group,  whoami => "event" &>

			<h4><% $event->name %> Judge Settings</h4>

			<table cellpadding="4" cellspacing="1" id="sortme">

				<thead>
				<tr class="yellowrow">

					<th class="smaller">
						<form action="event_save.mhtml" method="post">
						<input type="hidden" name="event_id" value="<% $event->id %>">
						Round
					</th>

					<th class="smaller">
						Flights
					</th>

					<th class="smaller">
						# Judges per panel
					</th>

					<th class="smaller">
						Judge pool
					</th>

				</tr>
				</thead>

				<tbody>

%					foreach my $round (sort {$a->name <=> $b->name} $event->rounds) { 

						<tr>

							<td class="smallish">
								<% $round->realname %>
							</td>

							<td class="centeralign">
								<input name="flighted_<% $round->id %>" class="smaller" type="number" min="1" max="99" size="3" value="<% $round->flighted ? $round->flighted : 1 %>">
							</td>

							<td class="centeralign">
								<input name="judges_<% $round->id %>" class="smaller" type="number" min="1" max="99" size="3" value="<% $round->judges ? $round->judges : 1 %>">
							</td>

							<td>
								<select name="pool_<% $round->id %>" class="fixed chosen">
									<option value="0">None (draw from all <% $event->judge_group->abbr %> judges)</option>

%									foreach my $pool ($m->comp('/funclib/tourn_pools.mas', tourn => $tourn)) { 
										<option value="<% $pool->id %>" <% $round->pool && $round->pool->id == $pool->id ? "selected" : "" %>>
											<% $pool->name %>
										</option>
%									}

								</select>
							</td>

						</tr>

%					}

				</tbody>

				<tr class="liblrow">

					<td colspan="4" class="rightalign">
						<input type="submit" value="Save <% $event->abbr %> Judge Settings">
						</form>
					</td>


				</tr>

			</table>

		</div>
%	}
