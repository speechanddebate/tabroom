<%args>
	$tourn
	$account
	$pool_id       => undef
	$group_id      => undef
	$pull_group_id => undef
</%args>
<%init>

	my $pool = Tab::Pool->retrieve($pool_id);
	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @sites = $m->comp('/funclib/tourn_sites.mas', tourn => $tourn);
	my @timeslots = sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots;

	my $switch;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	unless ($pool) { 

		my @pools = $group->pools;
		$pool = shift @pools if @pools;

	}

</%init>

    <script type="text/javascript"> 
        function showMe (it, box) { 
            var vis = (box.checked) ? "inline-block" : "none"; 
            document.getElementById(it).style.display = vis;
        } 
    </script>

	<& menu.mas, tourn => $tourn, group => $group, whoami => "edit_pools", pool => $pool &>

	<div class="left huge">

%		unless ($group) { 

			<h2>Choose a judge group at right</h2>
	
%		} else {

			<h2><% $group->name %></h2>
			
			<& tabbar.mas, group => $group, whoami => "edit_pools" &>

			<form action="edit_pools_save.mhtml" method="post">
			<input type="hidden" value="<% $group->id %>" name="group_id">

%			foreach my $pool ($group->pools) { 

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %> visible">
					
					<span class="quarter">
						<input type="text" size="10" value="<% $pool->name %>" name="name_<% $pool->id %>">
					</span>

					<span class="half">

						<label for="publish_<% $pool->id %>">
							<span class="third smallish hover">
								Publish:
								<input type="checkbox" value="1" id="publish_<% $pool->id %>" 
									name="publish_<% $pool->id %>" <% $pool->publish ? 'checked="checked"' : "" %> >
							</span>
						</label>

%						my $standby_click = "showMe('standby_ts_".$pool->id."', this)";

						<label for="standby_<% $pool->id %>">
							<span class="third smallish hover">
								Standby:
								<input type="checkbox" value="1" id="standby_<% $pool->id %>" onclick="<% $standby_click %>"
									name="standby_<% $pool->id %>" <% $pool->standby ? 'checked="checked"' : "" %> >
							</span>
						</label>

						<span <% $pool->standby ? "display: inline-block;" : 'style="display: none;"' %> 
							class="third smallish hover" id="standby_ts_<% $pool->id %>">

							<select name="standby_timeslot_<% $pool->id %>" class="fixedtiny chosen"> 
								<option value="">Choose When:</option>

%								foreach my $timeslot ($tourn->timeslots) { 
									<option value="<% $timeslot->id %>" 
										<% $pool->standby_timeslot && $timeslot->id == $pool->standby_timeslot->id ? 'selected="selected"' : "" %> > 
										<% $timeslot->name %>
									</option>
%	                      		}
							</select>
						</span>
					</span>

%					if (scalar @sites > 1) { 

						<span class="quarter padno">

							<span class="fivesixth nospace">
								<select name="site_<% $pool->id %>" class="fixedtiny chosen">
%									foreach my $site (@sites) { 
										<option value="<% $site->id %>" 
											<% $site->id == $pool->site->id ? 'selected="selected"' : "" %>><% $site->name %></option>
%									}
								</select>
							</span>
							<span class="sixth nospace rightalign">
%								my $warn = "Really delete the pool ".$pool->name." and all round and judge assignments?";

								<a class="dkred smaller" href="pool_rm.mhtml?pool_id=<% $pool->id %>&group_id=<% $group_id %>"
									<& "/funclib/confirm.mas", warn => $warn &>  >
									X
								</a>
							</span>
						</span>

%					}  else { 

						<span class="quarter rightalign">

%							my $warn = "Really delete the pool ".$pool->name." and all round and judge assignments?";

							<a class="dkred smaller" href="pool_rm.mhtml?pool_id=<% $pool->id %>&group_id=<% $group_id %>"
								<& "/funclib/confirm.mas", warn => $warn &>  >
								Delete
							</a>
						</span>

%					}  

				</div>

%			}
			

			<div class="liblrow rightalign">
				<input type="submit" value=" Save Pools">
			</div>

%		}

	</div>

