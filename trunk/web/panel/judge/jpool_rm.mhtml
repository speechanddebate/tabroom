<%args>
	$jpool_id
</%args>
<%init>

	my $jpool = Tab::JPool->retrieve($jpool_id);

	Tab::Round->set_sql( delete_jpool => " update round set jpool = NULL where jpool = ? ");
	Tab::JPoolJudge->set_sql( delete_jpool => " delete from jpool_judge where jpool = ? ");

	my $msg;
	my $group_id;

	if ($jpool) { 

		Tab::JPoolJudge->sql_delete_jpool->execute($jpool->id);
		Tab::Round->sql_delete_jpool->execute($jpool->id);
		$msg = $jpool->name." has been deleted";
		$group_id = $jpool->judge_group->id;
		$jpool->delete;

	}

	$m->redirect("edit_jpools.mhtml?group_id=$group_id&msg=$msg");


</%init>
