<%args>
	$tourn
	$pool   => undef
	$group  => undef
	$event  => undef
	$whoami => "index"
</%args>
<%init>

	my $switch;

	$whoami = "index" unless $whoami;
	
</%init>

	<div class="right small">

		<div class="sidenote">

			<h4>Judge Group</h4>

			<form action="<% $whoami %>.mhtml" method="post">

			<div class="even visible centeralign full">
				<select name="group_id" class="chosen fixedmed" onchange='this.form.submit()' data-placeholder="Choose group..">
					<option value=""></option>
%					foreach my $ogroup ($tourn->groups) { 
						<option <% $group && $ogroup->id == $group->id ? "selected" : "" %> value="<% $ogroup->id %>"><% $ogroup->name %></option>
%					}
				</select>
			</div>

			</form>

%		if ($whoami eq "event") { 

			</div>
			<div class="sidenote">

				<h4>Choose an Event:</h4>

%				my @events = sort {$a->name cmp $b->name} $group->events;
%				@events = sort {$a->type cmp $b->type} @events;
				<form action="<% $whoami %>.mhtml" method="post">
				<input type="hidden" name="group_id" value="<% $group->id %>">

				<div class="even visible centeralign full">
					<select name="event_id" class="chosen fixedmed" onchange='this.form.submit()' data-placeholder="Choose event..">
						<option value=""></option>
%						foreach my $oevent ($group->events) { 
							<option <% $event && $oevent->id == $event->id ? "selected" : "" %> value="<% $oevent->id %>"><% $oevent->name %></option>
%						}
					</select>
				</div>

				</form>

			</div>

%		} elsif ($whoami eq "pool") { 

				<h4> Pools</h4>

%				my @pools = $group->pools;

%				foreach my $opool (@pools) { 
					<a class="<% $pool && $opool->id == $pool->id? "dk" : ""%>yellow nowrap full" href="pool.mhtml?pool_id=<% $opool->id %>&group_id=<% $group->id %>">
						<span class="huntwofive padno">
							<% $opool->name %>
						</span>
						<% $opool->standby ? "Standby" : "" %>
					</a>
%				}

			</div>

%			if ($pool) { 

				<div class="sidenote">

%					my @rounds = $pool->rounds;
%					my %used_round;

%					if (@rounds) { 
					
						<h4>Rounds Using Pool</h4>

%						foreach my $round ($pool->rounds) { 
%							$used_round{$round->id}++;
							<a class="yellow full" href="pool_round_rm.mhtml?round_id=<% $round->id %>&pool_id=<% $pool->id %>">
								<% $round->realname %>
							</a>
%						}

%					}

					<h4>Use for round</h4>

					<form action="pool_round_add.mhtml" method="post">
					<input type="hidden" name="pool_id" value="<% $pool->id %>">

					<div class="even full visible centeralign">

						<select name="round_id" class="chosen fixedmed" onchange='this.form.submit()'>
							<option value=""></option>
%							foreach my $round ($m->comp("/funclib/group_rounds.mas", group => $group)) { 
%								next if $used_round{$round->id};
								<option value="<% $round->id %>"><% $round->event->name %> <% $round->realname %></option> 
%							}
						</select>

					</div>

					</form>

					<h4>Auto-populate</h4>

					<form action="pool_autopopulate.mhtml" method="post">
					<input type="hidden" name="pool_id" value="<% $pool->id %>">

					<p class="exwhite nospace">Add all judges with debaters in:</p>

					<div class="even full visible centeralign">

						<select name="round_id" class="chosen fixedmed" onchange='this.form.submit()'>
							<option value=""></option>
%							foreach my $round ($m->comp("/funclib/group_rounds.mas", group => $group)) { 
								<option value="<% $round->id %>"><% $round->event->name %> <% $round->realname %></option> 
%							}
						</select>

					</div>

					</form>

%					my $warn = "This will dump all judges from this pool.  Are you sure?";

					<a href="pool_dump_judges.mhtml?pool_id=<% $pool->id %>" class="martop full yellow" <& "/funclib/confirm.mas", warn => $warn &> >
						Dump all judges from pool
					</a>
					
				</div>
%			}

%		} elsif ($whoami eq "edit_pools") { 

			</div>

			<div class="sidenote">

			<h4>Create new pool</h4>

			<form action="pool_create.mhtml">
			<input type="hidden" name="group_id" value="<% $group->id %>">

				<div class="<% ($switch++ % 2) ? "odd" : "even" %>">

					<span class="quarter smallish pado padleft">
						Name:
					</span>

					<span class="threequarter">
						<input type="text" name="name" size="20" class="thin" placeholder="Name the pool...">
					</span>

				</div>

				<div class="<% ($switch++ % 2) ? "odd" : "even" %>">

					<label for="publish">
					<span class="threequarter smallish hover padno padleft">
						Publish judges on web:
					</span>

					<span class="quarter padno">
						<input type="checkbox" id="publish" name="publish" value="1">
					</span>
					</label>

				</div>

				<div class="<% ($switch++ % 2) ? "odd" : "even" %>">

					<label for="standby">
					<span class="threequarter smallish hover padno padleft">
						Use as standby:
					</span>

					<span class="quarter padno">
						<input id="standby" type="checkbox" name="standby" value="1">
					</span>
					</label>
				</div>
			
				<div class="<% ($switch++ % 2) ? "odd" : "even" %> padmore">

					<span class="half smallish">
						Standby during:
					</span>

					<span class="half">
						<select name="standby_timeslot" class="fixedtiny">
							<option value="">Choose...</option>
%							foreach my $timeslot ($tourn->timeslots) { 
								<option value="<% $timeslot->id %>"> <% $timeslot->name %> </option>
%							}
						</select>
					</span>
				</div>

%				if (scalar $tourn->sites > 1) { 

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">

						<span class="half smallish padno padleft">
							Site:
						</span>

						<span class="half">
							<select name="site" class="fixedtiny">
%								foreach my $site ($tourn->sites) { 
									<option value="<% $site->id %>"> <% $site->name %> </option>
%								}
							</select>
						</span>
					</div>
%				}

				<div class="liblrow rightalign">
					<input type="submit" class="thin" value="Save Pool">
					</form>
				</div>
				
			</div>
			

%		} else { 

			</div>

%		}

	</div>


