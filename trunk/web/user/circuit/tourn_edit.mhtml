<%args>
	$account
	$tourn_id   => undef
	$circuit_id => undef
</%args>
<%init>

	$m->abort unless $tourn_id;
	$m->abort unless $circuit_id;

	my $tourn = Tab::Tourn->retrieve($tourn_id);
	my $circuit = Tab::Circuit->retrieve($circuit_id);

	my @admins = $m->comp("/funclib/tourn_admins.mas", tourn => $tourn);

	my @tourn_admins = Tab::TournAdmin->search( tourn => $tourn->id );

	my %admin_joins = ();

	foreach my $ta (@tourn_admins) { 
		$admin_joins{$ta->account->id} = $ta;
	}

	@admins = sort { $admin_joins{$a->id}->id <=> $admin_joins{$b->id}->id }  @admins;

</%init>

	<div class="main">
	
		<h2><% $tourn->name %> Tournament Access</h2>

		<table cellpadding="5" width="100%" cellspacing="1"> 

%			if (@admins) { 

				<tr class="liblrow">
				
					<th>	
						Name
					</th>

					<th class="smaller">
						List as Contact
					</th> 

					<th class="smaller">
						Setup Access
					</th>

					<th class="smaller">
						Data Entry Only
					</th> 

				
					<th>
					</th> 

				</tr>

%				my $switch;

% 				foreach my $account (@admins) { 

%					my $staff = $admin_joins{$account->id};

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
						<td align="left">
							<% $account->first." ".$account->last %>
						</td>

						<td align="center">
							<a href="contact_switch.mhtml?staff_id=<% $staff->id %>&circuit_id=<% $circuit_id %>&tourn_id=<% $tourn_id %>" class="<% ($staff->contact) ? "dkblue" : "dkred" %> block" >
								<% ($staff->contact) ? "Yes" : "No" %>
							</a>
						</td>

						<td align="center">
							<a href="settings_switch.mhtml?staff_id=<% $staff->id %>&circuit_id=<% $circuit_id %>&tourn_id=<% $tourn_id %> " class="<% ($staff->no_setup) ? "dkred" : "dkblue" %> block" >
								<% ($staff->no_setup) ? "No" : "Yes" %>
							</a>
						</td>

						<td align="center">
							<a href="limited_switch.mhtml?staff_id=<% $staff->id %>&circuit_id=<% $circuit_id %>&tourn_id=<% $tourn_id %>" class="<% ($staff->entry_only) ? "dkred" : "dkblue" %> block" >
								<% ($staff->entry_only) ? "Yes" : "No" %>
							</a>
						</td>

						<td align="center">
							<a class="dkred block" href="staff_rm.mhtml?staff_id=<% $staff->id %>&circuit_id=<% $circuit_id %>&tourn_id=<% $tourn_id %>">
								Revoke
							</a>
						</td>

					</tr>
%				}

%			}

		</table>

	</div>

	<div class="menu">

		<div class="sidenote">

		<h4>Add New Staff:</h4>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="evenrow">

				<td>
					<form action="staff_add.mhtml" method="post">
					<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
					<input type="hidden" name="circuit_id" value="<% $circuit->id %>">
					<input type="text" name="email" size="20" placeholder="Email address">
				</td>

			</tr>

			<tr class="liblrow">

				<td class="rightalign">
					<input  type="submit" value="  Grant Access  ">
					</form>
				</td>
			</tr>

		</table>

		</div>

		<& menu.mas, whoami => "tourn_edit", circuit => $circuit, nodiv => "1", year => $tourn->start->year  &>
	
	</div>

