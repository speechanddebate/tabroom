<%args>
	$entry_id
	$school_id
	$from => undef
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);

	$m->abort unless $entry;

	my $event = $entry->event;
	my $tourn = $event->tourn;
	my $school = Tab::School->retrieve($school_id);

	my $max = $event->setting("max_entry");
	my $min = $event->setting("min_entry");

	my $code_style = $event->setting("code_style");

	my $switch;

</%init>

	<div class="main">

		<h2><% $tourn->name %></h2>
		
		<& menu.mas, school => $school, whoami => "students" &>

		<h4>Entry Details</h4>

		<form action="details_save.mhtml" method="post">
		<input type="hidden" name="entry_id" value="<% $entry->id %>">
		<input type="hidden" name="school_id" value="<% $school->id %>">
		<input type="hidden" name="from" value="<% $from %>">

		<table cellpadding="5" cellspacing="1" width="100%">

%			my @students = $entry->students;

%			foreach my $count (1 .. $max) { 

%				my $student = shift @students if @students;

%				my $hybrid = Tab::School->search( chapter => $student->chapter->id, tourn => $tourn->id )->first
%					if $student && $student->chapter &&  $student->chapter->id != $school->chapter->id;


				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td class="<% $count > $min ? "" : "required" %>">
						Student <% $max > 1 ? $count : "" %>
						<% $hybrid ? "(".$hybrid->name.")" : "" %>
					</td>

					<td class="bigger leftalign">

						<select name="student_<% $count %>" class="fixedmed">

%							if ($student) { 
								<option value="<% $student->id %>">
									<% $student->first." ".$student->last %>
								</option>
%							}

							<option value="">NONE</option>

%							if ($hybrid) { 
%								foreach my $student ($m->comp("/funclib/students_evententer.mas", event => $event, school => $hybrid )) {
									<option value="<% $student->id %>">
										<% $student->first." ".$student->last %>
									</option>
%								}
%							} else { 
%								foreach my $student ($m->comp("/funclib/students_evententer.mas", event => $event, school => $school )) {
									<option value="<% $student->id %>">
										<% $student->first." ".$student->last %>
									</option>
%								}
%							}

						</select>

					</td>

				</tr>

%				$count++;

%			}

			<tr class="<% ($switch++ % 2) ? "odd" : "even" %>">

				<td class="<% ($code_style eq "registrant" || $code_style eq "initials") ? "required" : "" %>">
					Entry Code
				</td>

				<td class="leftalign">
%					if ($code_style eq "initials" || $code_style eq "register" || $code_style eq "full_initials") {
						<input type="text" size="30" name="code" value="<% $entry->code %>">
%					} else { 
						<span class="padmore">
							<% $entry->code %>
						</span>
%					}
				</td>

			</tr>

%			if ($event->setting("apda")) { 

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						<label for="seed">
							Prelim Seeding
						</label>
					</td>

					<td class="leftalign" style="padding-top: 9px; padding-bottom: 9px;">
						<select name="seed" class="fixedsmall">
							<option value="">None</option>
							<option value="half" <% $entry->seed eq "half" ? "selected" : "" %>>Half</option>
							<option value="full" <% $entry->seed eq "full" ? "selected" : "" %>>Full</option>
							<option value="free" <% $entry->seed eq "free" ? "selected" : "" %>>Free</option>
						</select>
					</td>

				</tr>

%			}

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

				<td>
					<label for="ada">
						ADA/Accessible Rooms Needed
					</label>
				</td>

				<td class="leftalign">
					<input type="checkbox" class="largecheck" id="ada" name="ada" value="1" <% $entry->ada ? "checked" : "" %>>
				</td>

			</tr>

%			if ($event->setting("ask_for_titles")) {
			
				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td class="required">
						Piece title (or ISBN):
					</td>

					<td>
						<input type="text" name="title" value="<% $entry->title %>" size="40">
					</td>

				</tr>

%			}

		</table>

%		my $quals = $event->setting('ask_quals'); 
%		my $required = $quals;
%		$quals = 15 if $event->setting("more_quals");

%		if ($quals) { 

			<span class="half inline padno">
				<h4 style="margin-bottom: 1px;">Qualifiers</h4>
			</span>

			<span class="half inline rightalign padno">
				<h5 style="margin-bottom: -5px;"><% $required %> Required</h5>
			</span>

		<table cellpadding="4" cellspacing="1">

%			if ($event->setting("at_larges")) { 

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						<label for="atlarge">
						At-large applicant? 
						</label>
					</td>

					<td colspan="2" class="leftalign">
						<input id="atlarge" type="checkbox" class="largecheck" name="atlarge" value="1" <% $entry && $entry->seed eq "atlarge" ? 'checked="checked"' : "" %>>
					</td>

				</tr>
				
%			}

			<tr class="yellowrow bordertop">

				<th class="smallish">
					Number
				</th>

				<th class="smallish">
					Tournament
				</th>

				<th class="smallish">
					Finish/Points
				</th>

			</tr>

%			my @qualifiers = $entry->qualifiers;

%			foreach my $tick (1 .. $quals) { 

%				my $qual = shift @qualifiers if @qualifiers;

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td class="<% $tick > $required ? "" : "required" %>">
						Qualifier <% $tick %>
					</td>

					<td>
						<input type="text" name="qual_<% $tick %>" value="<% $qual ? $qual->name : "" %>" size="25">
					</td>

					<td>
						<input type="text" name="qualpts_<% $tick %>" value="<% $qual ? $qual->result : "" %>" size="25">
					</td>

				</tr>

%			}

			</table>

%		}


		<table cellpadding="5" cellspacing="1" width="100%">
			
			<tr class="liblrow">

				<td align="right">
					<input type="submit" value=" Save Entry Details ">
					</form>
				</td>

			</tr>

		</table>

		<p class="required">
			 = Required field
		</p>

	</div>

	<div class="menu">
	
		<div class="sidenote">

			<h4>Entry</h4>

			<p class="evenrow block">
				<% $entry->name %>
			</p>

			<p class="evenrow block">
				<% $entry->code %>
			</p>

			<p class="evenrow block">
				<% $event->name %>
			</p>

%			if ($entry->waitlist) { 
				<p class="yellow block">
					On Waitlist
				</p>
%			}

			<h4><% $event->abbr %></h4>

			<a class="blue block" href="students.mhtml?school_id=<% $school_id %>&event_id=<% $event->id %>">
				Return to <% $event->abbr %> Entry
			</a>
		</div>

	</div>

