<%args>
	$chapter_id
	$name => undef
	$switch => undef
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	$m->abort unless $chapter;

	unless ($name || not defined $chapter) { 
		$name = $chapter->name;
		$name =~ s/High School//g;
		$name =~ s/HS//g;
		$name =~ s/Academy//g;
		$name =~ s/School//g;
		$name =~ s/Prep//g;
	}

	$name = "\%".$name."\%";

	my @others = Tab::Chapter->search_like( name => $name );

</%init>

	<& menu.mas, whoami => "chapters"  &>

	<div class="main">

		<h2>Merge <% $chapter->id %> <% $chapter->name %> into:</h2>

		<table cellpadding="5" cellspacing="1" width="100%">

% 		foreach my $other (@others) { 

%			next if $other->id == $chapter_id;

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>


				<td>
					<% $other->name %>
				</td>

				<td>
					<% $other->id %>
				</td>

				<td>
					<% $other->state %>
				</td>

				<td>
					<% scalar ($other->students) %>
				</td>

				<td class="explain">
%					foreach my $circuit ($other->circuits) {
						<% $circuit->abbr %>
%					}
				</td>

				<td class="centeralign">
					<form action="chapter_merge_save.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
					<input type="hidden" name="other_id" value="<% $other->id %>">
					<input type="submit" class="red" value=" Merge Into ">
					</form>
				</td>

			</tr>

% 		} # end of foreach other. 


		<tr>
			<td style="padding-top: 15px;">
			</td>
		</tr>

		<tr class="yellowrow">

			<td>
				Merge search:
			</td>

			<td colspan="4">
				<form action="chapter_merge.mhtml" method="post">
				<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
				<input type="text" name="name" size="20">
			</td>

			<td class="centeralign">
				<input type="submit" value=" Search ">
				</form>
			</td>

		</tr>

	</table>

	</div>
