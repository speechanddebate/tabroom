<%args>
	$account
	$region_id
	$tourn_id => undef
</%args>
<%init>

	my $region = Tab::Region->retrieve($region_id);

	unless ($region->director->id == $account->id) { 

		$m->print("Stop messing around.  You are not authorized to view that region");
		$m->abort;

	}

	my $tourn = Tab::Tourn->retrieve($tourn_id) if $tourn_id;
	my $circuit = $region->circuit;

    my @all_tourns = sort {$b->start->epoch <=> $a->start->epoch} Tab::Tourn->search( circuit => $circuit->id );

	my $switch;
	
</%init>

	<h2>Region <% $region->name %> of <% $circuit->short_name %> </h2>

	<div class="main"> 

%	if ($tourn) { 

		<h4>Entry for <% $tourn->name %> <% $tourn->start->year %></h4>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="lirdrow">

				<th>
					School
				</th>

				<th>
					Entries
				</th>

				<th>
				</th>

			</tr>

%			foreach my $school ($tourn->schools(region => $region_id)) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<% $school->name %>
					</td>

					<td>
						<% scalar ($school->entries) %>
					</td>

					<td class="centeralign">
						<a class="white" href="school_entry.mhtml?school_id=<% $school->id %>">
							Check Qualifiers
						</a>
					</td>

				</tr>
%			}

		</table>


%	}


	</div>

	<div class="menu">

		<h3>Tournaments</h3>

%		foreach my $tourn (@all_tourns) { 

			<a class="blue block" href="region.mhtml?region_id=<% $region_id %>&tourn_id=<% $tourn->id %>">
				<% $tourn->name %> <% $tourn->start->year %>
			</a>

%		}

	</div>
