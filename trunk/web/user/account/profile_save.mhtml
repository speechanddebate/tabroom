<%args>
	$first
	$last
	$email
	$phone => undef
	$is_cell => undef
	$street => undef
	$city	=> undef
	$state	=> undef
	$noemail	=> undef
	$zip	=> undef
	$account
</%args>

<%init>

	unless ($email eq $account->email) { 

		my @existing_emails = Tab::Account->search( email => $email);

		if (@existing_emails) { 

			my $err = "Email address $email already has an account: ".$existing_emails[0]->first." ".$existing_emails[0]->last;
			$m->redirect("$Tab::url_prefix/user/account/profile.mhtml?err=$err");			

		}

	}
	
	$account->first($first);
	$account->last($last);
	$account->street($street);
	$account->city($city);
	$account->email($email);
	$account->state($state);
	$account->noemail($noemail);
	$account->zip($zip);
	$account->phone($phone);
	$account->is_cell($is_cell);
	$account->update;
	
	my $msg = "Changes saved";
	
	$m->redirect("$Tab::url_prefix/user/account/profile.mhtml?msg=$msg");

</%init>
