<%args>
	$account
	$judge_id => undef
	$past     => undef
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	if ($judge > 0 && $judge->account && $judge->account->id != $account->id) { 
		my $name = $account->last;
		$m->print("That judge is not you.  Stop messing around, $name");
		$m->abort;
	}

	my @judges = $account->judges unless $judge;
	push (@judges, $judge) if $judge;

	my $switch;
	my $now = DateTime->now;

</%init>

	<& /user/menu.mas, account => $account &>

	<div class="main">

		<h2>Judging record</h2>

%		foreach my $judge (@judges) { 

%			my $switch;

%			my $group = $judge->judge_group;
%			next unless $group;

%			my $tourn = $group->tourn;
%			next unless $tourn;

%			my $tz = $tourn->tz;  
%			$tz = "UTC" unless $tz;

%			my $start = $tourn->start->set_time_zone($tz);
%			my $end = $tourn->end->set_time_zone($tz);

%			next unless $past || $end > $now;

			<div class="full">
				<span class="half nospace">
					<h4><% $tourn->name %> </h4>
				</span>
				<span class="half nospace rightalign">
					<h5>
					<% Tab::niceshortdate($start) %><% $start->day != $end->day ? " - ".Tab::niceshortdate($end) : "" %>/<% $start->year %>
					</h5>
				</span>
			</div>

			<div class="half padtop padbottom">

				<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
					<span class="half padtop padbottom ">
						School
					</span>
					<span class="half padtop padbottom">
						<% $judge->school ? $judge->school->short_name : "Hired" %>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
					<span class="half padtop padbottom ">
						Judge Group
					</span>
					<span class="half padtop padbottom">
						<% $group->name %>
					</span>
				</div>

%				if ($end > $now && $group->setting("diversity_selfie")) { 

					<form action="diverse_switch.mhtml" method="post">
					<input type="hidden" name="judge_id" value="<% $judge->id %>">

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
						<span class="twothirds ">
							Diversity Enhancing?
						</span>
						<span class="third">
							<input type="checkbox" name="diverse" value="1" <% $judge->diverse ? 'checked="checked"' : "" %> onchange='this.form.submit()'>
							<% $judge->diverse ? "YES" : "NO" %>
						</span>
					</div>

					</form>

%					if ($group->setting("diversity_notice")) { 
						<p class="explain">
							<% $group->setting("diversity_notice") %>
						</p>
%					}

%				}
	
%				unless ($group->setting("no_codes")) { 

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
						<span class="half padtop padbottom ">
							Judge Code
						</span>
						<span class="half padtop padbottom">
							<% $judge->code %>
						</span>
					</div>

%				}

			</div>

			<div class="half padtop padbottom">

%				undef $switch;

%				if ($end < $now) { 

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
						<span class="half padtop padbottom">
							Rounds judged
						</span>
						<span class="half padtop padbottom">
							<% scalar $m->comp("/funclib/judge_panels.mas", judge => $judge) %>
						</span>
					</div>

%				} elsif ($group->setting("rounds_per")) { 

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
						<span class="half padtop padbottom">
							Obligation for School
						</span>
						<span class="half padtop padbottom">
							<% $judge->obligation %>
						</span>
					</div>

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">
						<span class="half padtop padbottom">
							Hired Rounds
						</span>
						<span class="half padtop padbottom">
							<% $judge->hired %>
						</span>
					</div>
%				}


%				if ($m->comp("/funclib/account_panels.mas", account => $account, judge => $judge)) {

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> top">

						<span class="half padtop padbottom">
							Enter Ballots Online:
						</span>

						<span class="half padtop padbottom">
							<a class="dkblue inline" href="panels.mhtml">
								ENTER
							</a>
						</span>
					</div>

%				} elsif ($m->comp("/funclib/account_published.mas", account => $account, judge => $judge)) {

					<div class="<% ($switch++ % 2) ? "odd" : "even" %> full">

						<span class="half padtop padbottom">
							Online Pairings:
						</span>

						<span class="half nospace">
							<a class="nospace dkblue padmore" href="panels.mhtml">Your Assignments</a>
						</span>
					</div>
%				}

			</div>

%		}

	</div>

