<%args>
	$tourn
	$school_id
</%args>
<%init>

	my $school = Tab::School->retrieve($school_id);
	$tourn = $school->tourn unless $tourn && $tourn->id;
	my ($total, $feline_ref) = $m->comp("/funclib/school_fees.mas", school_id => $school_id);
	my @felines = @{$feline_ref};
	my $switch; 

</%init>

	<& "menu.mas", school => $school, whoami => "invoice" &>

	<div class="main">
		
		<h2><% $school->chapter->name %>: Results</h2>

		<& /user/chapter/tabbar.mas, chapter => $school->chapter, whoami => "results" &>

		<h4>Invoice for <% $school->name %></h4>

		<table cellpadding="6" cellspacing="1" width="100%">
	
%			foreach my $line (@felines) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

%					if ($line->{'fee'}) { 

						<td class="smallish">
							<%$line->{'name'} %>
						</td>
			
						<td class="rightalign smallish">
							$<% sprintf ("%.2f", $line->{'fee'}) %>
						</td>

%					} else { 
						
						<td colspan="2" class="rightalign smallish">
							<%$line->{'name'} %>
						</td>
%					}

				</tr>

%			} 


			<tr>
				<td colspan="3">
					<hr />
				</td>
			</tr>

			<tr class="liblrow">
				
				<th class="smallish">
					Entry Fee Total
				</th>
				
				<th class="rightalign">
					$<% sprintf ("%.2f", $total) %>
				</th>
				
			</tr> 

%			if ($tourn->concessions) { 

%				my $concession_total = $m->comp("/funclib/school_concessions.mas", school => $school, charge => 1);
%				$total += $concession_total;

				<tr class="yellowrow">
				
					<th class="smallish">
						Concessions Total
					</th>
				
					<th class="rightalign">
						$<% sprintf ("%.2f", $concession_total) %>
					</th>
				
				</tr> 

				<tr class="liblrow">
				
					<th class="smallish">
						Overall Total
					</th>
				
					<th class="rightalign">
						$<% sprintf ("%.2f", $total) %>
					</th>
				
				</tr> 

%			}

			<tr class="yellowrow">
			
				<th class="smallish">
					Paid
				</th>
			
				<th class="rightalign">
					$<% sprintf ("%.2f", $school->paid) %>
				</th>
			
			</tr> 

%			if ($school->paid != $total) { 

				<tr class="lirdrow">
				
					<th class="smallish">
						Due:
					</th>
				
					<th class="rightalign">
						$<% sprintf ("%.2f", $total - $school->paid) %>
					</th>
				
				</tr> 

%			} else { 

				<tr class="ligrnrow">
				
					<th class="smallish centeralign" colspan="2">
						Paid in Full.  Thank you!
					</th>

				</tr> 
%			}
			
		</table>

	</div>

	<br style="clear: both;">

