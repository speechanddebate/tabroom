<%args>
	$chapter_id
	$account
	$session
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my $switch;

	$m->comp("/user/chapter/auth.mas", chapter => $chapter, account => $account, session => $session);

</%init>

	<& /user/menu.mas, chapter => $chapter, account => $account &>

	<div class="main">

		<h2><% $chapter->name %>: Settings</h2>

		<& tabbar.mas, chapter => $chapter, whoami => "settings" &>

		<div class="half">

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
	
				<span class="third">
					Name
				</span>

				<span class="twothird padtop">
					<form action="save.mhtml" method="post"> 
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
					<input type="text" name="name" size="27" value="<% $chapter->name %>">
				</span>

			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<span class="third">
					Level
				</span>

				<span class="twothird padtop">
					<select name="level" class="fixedmed chosen">
						<option value=""></option>
						<option <% $chapter->level eq "university" ? "selected" : "" %> value="university">College/University</option>
						<option <% $chapter->level eq "highschool" ? "selected" : "" %> value="highschool">High School/Secondary</option>
						<option <% $chapter->level eq "middle" ? "selected" : "" %> value="middle">Middle/Junior High</option>
						<option <% $chapter->level eq "elementary" ? "selected" : "" %> value="elementary">Elementary</option>
						<option <% $chapter->level eq "homeschool" ? "selected" : "" %> value="homeschool">Home School</option>
						<option <% $chapter->level eq "independent" ? "selected" : "" %> value="independent">Independent</option>
						<option <% $chapter->level eq "private" ? "selected" : "" %> value="private">Private Organization</option>
					</select>
				</span>

			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<span class="third">
					Country
				</span>

				<span class="twothird padtop">
					<select name="country" class="fixedmed chosen">
						<& /funclib/country_select.mas, country => $chapter->country &>
					</select>
				</span>

			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<span class="third">
					State/Province
				</span>

				<span class="twothird padtop">
					<select name="state" class="fixedmed chosen">
						<& /funclib/state_select.mas, state => $chapter->state &>
					</select>
				</span>

			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<span class="third">
					Coach names
				</span>

				<span class="twothird padtop padtop">
					<input type="text" name="coaches" size="27" value="<% $chapter->coaches %>">
				</span>

			</div>

		</div>

%		undef $switch;

		<div class="half">

			<label for="self_prefs">

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%> hover optionblock" >

					<span class="seveneighth">
						Entries may enter their own prefs
					</span>

					<span class="eighth centeralign">
						<input type="checkbox" id="self_prefs" name="self_prefs" class="padmore" value="1" <% $chapter->self_prefs ? 'checked="checked"' : "" %>>
					</span>

				</div>

			</label>

			<label for="naudl">
				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%> hover optionblock" >

					<span class="seveneighth">
						National Urban Debate League (NAUDL) reports?
					</span>

					<span class="eighth centeralign">
						<input type="checkbox" id="naudl" name="naudl" class="padmore" 
							value="1" <% $chapter->naudl ? 'checked="checked"' : "" %>>
					</span>

				</div>
			</label>

			<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%> optionblock" >

				<span class="fourfifth">
					National Speech and Debate Association ID
				</span>

				<span class="fifth">
					<input type="text" size="7" class="thin" name="nsda"  value="<% $chapter->nsda %>">
				</span>

			</div>

			<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%> optionblock" >

				<span class="fourfifths">
					National Center for Education Statistics ID
				</span>

				<span class="fifth centeralign">
					<input type="text" name="nces" size="7" class="thin" value="<% $chapter->nces %>">
				</span>

			</div>

			<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%> optionblock" >

				<span class="fourfifth smallish">
					Integrated Postsecondary Education Data System ID:
				</span>

				<span class="fifth">
					<input type="text" size="7" class="thin" name="ipeds"  value="<% $chapter->ipeds %>">
				</span>

			</div>

		</div>

		<div class="full libl rightalign">
			<input type="submit" value=" Save Chapter Details ">
			</form>
		</div>

		<h4>Accounts with access to this tabroom.com chapter</h4>

%		foreach my $coach ($m->comp("/funclib/chapter_admins.mas", chapter => $chapter, prefs => "yep")) { 

			<div class="<% ($switch++ % 2) ? "odd" : "even" %>">	

				<span class="third">
      	    	    <% $coach->first." ".$coach->last %>
				</span>

				<span class="third">
					<a class="white" href="mailto:<% $coach->email %>">
              			<% $coach->email %>
					</a>
				</span>

				<span class="sixth">
					<a class="dk<% $coach->prefs ? "red" : "blue" %> block" href="/user/chapter/prefs_switch.mhtml?coach_id=<% $coach->id%>&chapter_id=<% $chapter->id%>">
						<% $coach->prefs ? "Prefs Only" : "Full Access" %>
					</a>
				</span>

				<span class="sixth">
					<a class="dkred block" href="/user/chapter/admin_rm.mhtml?coach_id=<% $coach->id%>&chapter_id=<% $chapter->id%>">
						Remove
					</a>
				</span>

			</div>

%		}

		<form action="/user/chapter/admin_add.mhtml" method="post">
		<input type="hidden" name="chapter_id" value="<% $chapter->id%>">

		<div class="liblrow nospace">

			<span class="quarter">
				Add:
			</span>
	
			<span class="half">
				<input type="text" name="email" size="27" value="Enter coach's email address" onfocus="value=''">
			</span>

   			<span class="rightalign quarter">
				<input type="submit"  value="   Grant    ">
				</form>
			</span>

		</div>

	</div>



