<%args>
	$session
	$chapter_id
	$league_id
	$account
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id );
	my $league = Tab::League->retrieve($league_id );

	$m->comp("/user/chapter/auth.mas", chapter => $chapter, session => $session, account => $account);

	my @cls = Tab::ChapterLeague->search( chapter => $chapter_id, league => $league_id );

	my $cl = shift @cls if @cls;

	foreach (@cls) {  $_->delete; }  #Wormtail, kill the spare!

	my $switch;

</%init>


	<div id="leftbig">

		<table cellpadding="0" width="100%">
	
			<tr>
				<td width="100%">
					<h2><% $chapter->name %>'s <% $league->short_name %> membership </h2>
				</td>

				<td>
				</td>

			</tr>

		</table>

		<table width="100%" cellpadding="5" cellspacing="1">

%			if ( $cl && $cl->membership && $cl->membership->dues ) { 

				<tr>
					<td colspan="3">
						<h4>Dues:</h4>
					</td>
				<tr>

				<tr class="lirdrow">

					<td colspan="2">
						<% $cl->paid ? "Your dues are paid in full" : "Dues owed for ".$cl->membership->name.": \$".$cl->membership->dues %>
					</td>

					<td class="right">
						<form action="/user/league/dues_invoice.mhtml" method="post">
						<input type="hidden" name="cl_id" value="<% $cl->id %>">
						<input type="submit" class="grey" value=" Dues Invoice ">
						</form>	
					</td>
				</tr>


%			}

			<tr>
				<td colspan="3">
					<form action="league_save.mhtml" method="post">
					<input type="hidden" name="cl_id" value="<% $cl->id %>">
					<h4>League Settings:</h4>
				</td>
			<tr>


%			if ($league->region_based) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th>
						Region
					</th>

					<td colspan="2" class="right">
						<select name="region_id">
%							foreach my $region ($league->regions) { 
								<option value="<% $region->id %>"><% "(".$region->code.") ". $region->name %></option>
%							}

					</td>

				</tr>

%			}

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Active?
				</th>

				<td colspan="2" class="right">
					<input type="radio" value="1" name="active" <% ($cl) ? $cl->active ? "checked" :  "" : "checked" %>>Yes
					<input type="radio" value="" name="active" <% ($cl) ? $cl->active ? "" :  "checked" : "" %>>No
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="explain" colspan="3">

					Choose "No" to remove this league's tournaments from your
					list, and to not receive this league's emails and
					announcements.

				</td>
			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<th>
					Member?
				</th>

				<td colspan="2" class="right">
					<input type="radio" value="1" name="full_member" <% ($cl) ? $cl->full_member ? "checked" :  "" : "checked" %>>Yes
					<input type="radio" value="" name="full_member" <% ($cl) ? $cl->full_member ? "" :  "checked" : "" %>>No
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td class="explain" colspan="3">

					Choose "No" if you are only registering for a single
					tournament hosted by this League and do not intend to join
					the league altogether.  This removes you from League emails
					and announcements, limiting communication to only the
					tournaments you register for.

				</td>

			</tr>

%			if ($cl && $cl->full_member && $league->memberships) { 

				<tr>
					<td colspan="3">
						<h4>Membership Types:</h4>
					</td>
				<tr>

%				foreach my $membership ($league->memberships) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<th>
							<% $membership->name %>
						</th>

						<td class="center">
							Annual dues: $<% $membership->dues %>
						</td>

						<td class="center">
							<input type="radio" name="membership" value="<% $membership->id %>" 
								<% ($cl && $cl->membership) ? ($membership->id == $cl->membership->id) ? "checked" : "" : "" %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td class="explain" colspan="3">
							<% $membership->text %>
						</td>

					</tr>

%				}

%			}

			<tr class="liblrow">

				<td colspan="3" class="right">
	
					<input type="submit" value="   Save Membership   ">	
					</form>

				</td>

			</tr>

		</table>

	</div>

	<div id="rightsmall">
		
		<a class="blueblock" href="/user/home.mhtml">Return Home</a>

		<h4><% $league->short_name %> member tools:</h4>

%		if ($league->public_email) {
			<a class="redblock" href="/user/league/emails.mhtml">League Emails</a>
%		}

%		if ($league->track_bids) {
			<a class="redblock" href="/user/league/bids_list.mhtml">Bids Listing</a>
%		}


	</div>

	
