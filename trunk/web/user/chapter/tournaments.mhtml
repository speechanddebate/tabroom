<%args>
	$account
	$chapter_id
	$tourn
	$all => undef
	$tz
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my $switch; 

</%init>

	<div id="leftbignb">

		<& /user/tabbar.mas, chapter => $chapter, whoami => "tourn" &>

%			if ($chapter->entered_tourns) { 

				<h2>Existing tournament registrations</h2>

				<table cellpadding="3" cellspacing="1" width="100%">

%					foreach my $et (sort {$a->start->epoch <=> $b->start->epoch} $chapter->entered_tourns) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td class="smaller">
								<% $et->name %> 
							</td>

							<td width="10%" class="center">
								<% Tab::niceshortdate($et->start->set_time_zone($tz)) %>
							</td>

							<td width="10%" class="center">
								<% $et->league->short_name %>
							</td>

							<td width="20%" class="center">
								<a class="whiteblock" href="/user/tourn/enter.mhtml?chapter_id=<% $chapter->id %>&tourn_id=<% $et->id %>">
									View Entry
								</a>
							</td>

						</tr>

%					}

				</table>

%			}

%			if ($chapter->open_tourns) { 

				<h2>Tournaments open for registration</h2>

				<table cellpadding="3" cellspacing="1" width="100%">

%					my $hidden;

%					foreach my $ot (sort {$a->start->epoch <=> $b->end->epoch} $chapter->open_tourns) { 

%						$hidden++ if $account->account_ignore($ot) && not defined $all;
%						next if $account->account_ignore($ot) && not defined $all;

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td class="center">
								[<a href="no_interest.mhtml?tourn_id=<% $ot->id %>&chapter_id=<% $chapter_id %>">X</a>]
							</td>

							<td>
								<a class="whiteblock" href="/index/tourn/index.mhtml?tourn_id=<% $ot->id %>">
								<% $ot->name %> 
								</a>
							</td>

							<td width="10%" class="center">
								<% Tab::niceshortdate($ot->start) %>
							</td>

							<td width="10%" class="center">
								<% $ot->league->short_name %>
							</td>

							<td width="20%" class="center">
								<a class="whiteblock" href="/user/tourn/enter.mhtml?chapter_id=<% $chapter->id %>&tourn_id=<% $ot->id %>">
									Register
								</a>
							</td>

						</tr>
%					}

%					if ($hidden) { 
					
						<tr class="oddrow">
							<td colspan="4" class="smaller">
								[<a href="tournaments.mhtml?chapter_id=<% $chapter_id %>&all=yessireebob">Show all</a>]
							</td>
						</tr>


%					}

				</table>

%			} 

%			unless ($chapter->open_tourns || $chapter->entered_tourns) {

				<h2>You must join a league or two</h2>

				<p>There are currently no tournaments open for registration in
				your league(s).</p>

				<p>Double-check your <a href="leagues.mhtml?chapter_id=<%
				$chapter->id%>">League Memberships</a> by clicking the tab
				above if there are tournaments you believe you should be able
				to register for.</p>

				<p>If you are looking for open high school invitationals, you
				have to join the "league" Invitationals: High School before you
				can register for the tournaments.  No dues/fees apply for
				joining this league</p>

%			}

%			if ($chapter->results_tourns) { 


				<h3>Past Tournament Results</h3>

				<table cellpadding="3" cellspacing="1" width="100%">

					<tr class="liblrow">

						<td>
							<form action="/user/tourn/results/index.mhtml" method="post">
							<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
							<select name="tourn_id">

%								foreach my $rt ($chapter->results_tourns) { 
									<option value="<% $rt->id %>">
										<% $rt->league->short_name %>: <% substr($rt->name,0,30) %> (<% $rt->start->year %>)
									</option>
%								}

							</select>
						</td>
			
						<td class="center"> 
							<input type="submit" class="blue" value="   View Results  "> 
							</form>
						</td>

					</tr>

				</table>

%			}

		<p>Remember to add your students and judges to your roster (tabs above) before
		registering them for tournaments!</p>

	</div>


	<div id="rightsmall">

		<& /user/menu.mas, chapter => $chapter, account => $account, tourn => $tourn &>

	</div>
	
