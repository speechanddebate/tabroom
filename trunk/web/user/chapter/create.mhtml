<%args> 
	$err => undef
	$session
	$account
	$name => undef
	$country => undef
	$state => undef
	$search => undef
</%args>
<%init> 
	
	my $switch;

	my @chapters;

	if ($search) { 
		@chapters = Tab::Chapter->search( name => $name, country => $country, state => $state );
	}

</%init> 

	<div class="left huge">


%		if (@chapters) { 

			<h2>That school/team already exists!</h2>

			<p>
				School/team(s) already exist with that name & locale.  If you are
				a new coach for an existing program, you should instead request
				access to that program's account, so you can gain access to the
				existing team history & records.  The request will go to the 
				existing administrators and the Tabroom help staff. 
			</p>
		
			<table cellpadding="10" cellspacing="1">

				<tr class="yellowrow">

					<th>
						Name
					</th>

					<th>
						Accounts w/access
					</th>

					<th>
						Request
					</th>
				</tr>

%				foreach my $chapter (@chapters) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
						
						<td>
							<% $chapter->name %>
						</td>

						<td>
							<& /funclib/chapter_admins.mas, chapter => $chapter, print => 1 &>
						</td>

						<td class="centeralign">
							<a class="dkgreen block" href="request.mhtml?chapter_id=<% $chapter->id %>">
								Request Access
							</a>
						</td>

					</tr>
% 				}

			</table>

			<br />

			<h4>
				Or, change names or confirm that this is a new school:
			</h4>

% 		} else {  

			<h2>Create a new school/team</h2>
% 		} 

		<table cellpadding="20" cellspacing="1">

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >
	
				<th class="rightalign">
					School/Team Name
				</th>

				<td>
					<form action="save.mhtml" method="post"> 
					<input type="hidden" name="new" value="yessireebob">
					<input type="text" name="name" size="47" value="<% $name %>">
				</td>

			</tr>


			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<th class="rightalign">
					Country
				</th>

				<td>
					<select name="country" class="fixed">
						<& /funclib/country_select.mas, country => $country &>
					</select>
				</td>

			</tr>

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

				<th class="rightalign">
					State/Province (if applicable)
				</th>

				<td>
					<select name="state" class="fixed">
						<& /funclib/state_select.mas, state => $state &>
					</select>
				</td>

			</tr>

%			if (@chapters) { 
				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"%>" >

					<th class="rightalign">
						<label for="dupe">
							It's OK this is a duplicate:
						</label>
					</th>

					<td>
						<input type="checkbox" name="duplicate" value="1">
					</td>
	
				</tr>
%			}

			<tr class="liblrow">
	
				<td colspan="2" class="rightalign">
					<input type="submit" value="   Save School Info   ">
					</form>
				</td>
	
			</tr>
	
		</table>

	</div>

	<div class="right small">
		
		<& /user/menu.mas, account => $account &>

	</div>

