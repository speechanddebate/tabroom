<%args>
	$tourn
</%args>
<%init>

	my @events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn)( type => "speech" );

	push (@events, $tourn->resultfiles);

	my $filepath = "results/".$tourn->circuit->id."/".$tourn->id;
	my $dirpath  = $Tab::file_root."/public_site/".$filepath;
	my $garbage = `rm -f $dirpath`;
    $garbage = `mkdir -p $dirpath`;

	my $indexfile = $dirpath."/index.mhtml";
	my $tourn_name = $tourn->name;

	open (INDEX, ">$indexfile ");
	print INDEX "<h2>Tournament results for $tourn_name </h2>\n";
	print INDEX '<div class="left huge">';
	print INDEX "<center>\n";
	print INDEX '<table cellpadding="2" cellspacing="1" width="100%">'."\n";

	my $switch;

	foreach my $event (sort {$a->name cmp $b->name} @events) { 
		print INDEX "<tr ";
		print INDEX ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"";
		print INDEX ">\n\t<td>\n\t\t";
		print INDEX "<a class=\"whiteblock\" href=\"".$Tab::url_prefix."/public_site/".$filepath."/".$event->id.".mhtml\">" if $event->table eq "event";
		print INDEX "<a class=\"whiteblock\" href=\"".$Tab::url_prefix."/public_site/".$filepath."/files/".$event->id."/".$event->filename."\">" if $event->table eq "resultfile";
		print INDEX $event->name." </a></td>\n\t</tr>\n";
	}

	print INDEX "</table>\n";
	print INDEX "</div>\n";

	print INDEX '<br style=" clear: both; ">';
	close INDEX;

	return;

</%init>

