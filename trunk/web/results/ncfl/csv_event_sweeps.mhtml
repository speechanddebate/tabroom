<%args>
	$event
	$filepath
</%args>
<%init>

	my @comps = $event->comps( dropped => 0, waitlist => 0); 

	my %sweeps_points = ();
	my %ballot_string = ();

	open (CSV, ">>$filepath.csv");

	if ($event->type eq "speech") { 

		my ($sweeps_points_ref, $ballot_string_ref) = $m->comp("/results/ncfl/speech_sweep_kids.mas", event => $event);
		%sweeps_points = %$sweeps_points_ref;
		%ballot_string = %$ballot_string_ref;

		foreach my $comp (@comps) { 
			my $ballots = $ballot_string{$comp->id};
			chop $ballots;

			print CSV "\"";
			print CSV $comp->code."\",\"";
			print CSV $comp->student->first." ".$comp->student->last;
			print CSV " & ".$comp->partner->first." ".$comp->partner->last if $event->team == 2;
			print CSV "\",\"";
			print CSV $comp->school->name."\",\"";
			print CSV $comp->school->region->code."\",\"";
			print CSV $ballots."\",\"";
			print CSV "\",\"";
			print CSV "\",\"";
			print CSV $sweeps_points{$comp->id}."\"\r\n";
		}
	
	} else { 

		foreach my $comp (@comps) { 
			print CSV "\"";
			print CSV $comp->code."\",\"";
			print CSV $comp->student->first." ".$comp->student->last;
			print CSV " & ".$comp->partner->first." ".$comp->partner->last if $event->team == 2;
			print CSV "\",\"";
			print CSV $comp->school->name."\",\"";
			print CSV $comp->school->region->code."\",\"";
			print CSV "\",\"";
			print CSV $comp->wins."\",\"";
			print CSV $comp->losses."\",\"";
			print CSV $comp->sweeps_points."\"\r\n";
		}
	}

	close CSV;

</%init> 

