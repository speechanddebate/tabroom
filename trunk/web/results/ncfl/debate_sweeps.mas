<%args>
	$tourn
	$debug => undef
</%args>
<%perl>

	my @schools = $tourn->debate_and_congress_schools;
	system "$Tab::logger I have ".scalar @schools." schools" if $debug;

	my @entries = $tourn->debate_and_congress_entries;
	system "$Tab::logger I have ".scalar @entries." kiddies" if $debug;

	my %entries_by_school;
	my %sweeps_by_school;

	foreach my $entry (@entries) {
		push (@{$entries_by_school{$entry->school->id}}, $entry);
	}

	foreach my $school (@schools) { 

		next unless $entries_by_school{$school->id};
		
		my @entries = @{$entries_by_school{$school->id}};

		@entries = sort {$b->sweeps_points <=> $a->sweeps_points} @entries;

		foreach (1 .. 3) { 
			my $counted_entry = shift @entries;
			next unless $counted_entry;
			$sweeps_by_school{$school->id} += $counted_entry->sweeps_points;
		}

		$school->sweeps_points($sweeps_by_school{$school->id});

	}

	@schools = sort {$sweeps_by_school{$b->id} <=> $sweeps_by_school{$a->id}} @schools;

	return\%sweeps_by_school, @schools;

</%perl>
