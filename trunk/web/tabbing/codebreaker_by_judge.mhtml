<%args>
	$judge_code => undef;
	$timeslot_id => undef
	$tourn
	$session
	$circuit
</%args>
<%init>

	my @timeslots = sort {$a->start->epoch <=> $b->start->epoch} $tourn->timeslots;

	my @judges;
	my $judge;

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id);
	$timeslot = $timeslots[0] unless $timeslot;

	my $points++ if $tourn->method && $tourn->method->tiebreaks(tiebreaker => "points");

	my @ballots;
	my $panel;

	if ($judge_code) { 
	
		@judges = Tab::Judge->search( 
			code => $judge_code, 
			tournament => $tourn->id ) unless $judge;

		if (@judges || $judge) { 

			$judge = shift @judges unless $judge;

			@ballots = Tab::Ballot->search_judge_timeslot( $judge->id, $timeslot->id );
 			$panel = $ballots[0]->panel if @ballots;

		}	
	}

</%init>


	<div id="rightsmall">

		<h3>Choose judge:</h3>

		<table cellpadding="4" width="100%" cellspacing="1">

			<tr class="oddrow">
				<td>
					<form action="codebreaker_by_judge.mhtml" method="post">
					Code:
				</td>
				
				<td>
					<input type="text" name="judge_code" size="5">
				</td>

			</tr>

			<tr class="evenrow">
				<td>
					Timeslot: 
				</td>
				
				<td>
					<select name="timeslot_id"> 
%						foreach my $ts (@timeslots) { 
							<option value="<% $ts->id %>" <% ($ts->id == $timeslot_id) ? "selected" : "" %>>
								<% $ts->name %>
							</option> 
%						}
					</select>
				</td>
			</tr>
		
			<tr class="liblrow">
				<td colspan="2" align="right">
					<input type="submit" value="    Search    "> 
				</td>
			</tr>

		</table>

		<hr>

		<a class="blue block" href="/results/codes_and_schools.mhtml">
			View complete codebreaker
		</a>

		<a class="blue block" href="/results/print_codebreaker.mhtml">
			Print complete codebreaker
		</a>

	</div>

	<div id="leftbig">

%		if ($judge && $panel) { 

			<h3>Judge <% $judge->code." ".$judge->first." ".$judge->last %></h3>
	
			<p><% $panel->event->name." Section ".$panel->letter." ".$panel->round->realname %></p>

			<table cellpadding="4" width="100%" border="0" cellspacing="1">

%				my $switch; 
	
%				foreach my $ballot (@ballots) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %> style="height: 40px;">
	
						<td style="padding-left: 40px;">
							<% $ballot->comp->code %>
						</td>
	
						<td align="center">
							<% $ballot->comp->school->code %>
							<% ($ballot->comp->school->region) ? $ballot->comp->school->region->code : "" %>
						</td>

						<td style="padding-left: 50px;">
							<% $ballot->comp->team_name %>
						</td>
					
					</tr>
%				}

			</table>

%		} elsif ($judge) { 

			<h3>No ballot found with that judge & timeslot </h3>

%		} else {
		
			<h2>Codebreaker by Panel</h2>

%		}

	</div>

	<br style="clear: both;" />
