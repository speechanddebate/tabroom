<%args>
	$circuit
	$tourn
	$session
</%args>
<%init>

	use POSIX;

	my $filename =  "schedule-".$tourn->id."-".$session->id;

    my $now = DateTime->now;
    $now->set_time_zone($circuit->timezone);

	open (TEXOUT, ">>$Tab::file_root/tmp/$filename.tex");

    print TEXOUT <<"EOF";
\\documentclass[12pt]{report}
\\usepackage{fullpage}
\\usepackage{colortbl}
\\usepackage{times}
\\renewcommand{\\arraystretch}{1.5}

\\setlength{\\oddsidemargin}{-.25in}     
\\setlength{\\textwidth}{6.5in}        

\\setlength{\\textheight}{9in}       
\\setlength{\\topmargin}{-.25in}      
\\setlength{\\headsep}{0in}         

\\setlength{\\parskip}{1.4ex}
\\setlength{\\parindent}{0mm}

\\begin{document}
\\normalsize

EOF


	print TEXOUT "\\begin{center} \n";
	print TEXOUT "\\bigskip \n";
	print TEXOUT "{\\Large\\bf ".$tourn->name." Schedule }\\\\ \n";
	print TEXOUT "\\bigskip\n";
	print TEXOUT "{\\large\\bf Times in ".$now->time_zone_short_name." }\\\\ \n";

	print TEXOUT <<'EOF';
\end{center}
\medskip

\large 
\begin{center}
\begin{tabular}{p{1.0in}p{1.0in}p{4.5in}}
EOF

my $switch;

foreach my $timeslot (sort {$a->start->epoch <=> $b->start->epoch}  $tourn->timeslots) {

	my $start = $timeslot->start->set_time_zone($circuit->timezone);

	print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);

	print TEXOUT $timeslot->name." & ";
	print TEXOUT $start->hour_12.":".$start->strftime('%M')." ".$start->strftime("%p")." & ";

	foreach my $round (sort {$a->event->abbr cmp $b->event->abbr} $timeslot->rounds) {

		print TEXOUT $round->event->abbr." ";

	}

	print TEXOUT " \\\\ \n";

}

print TEXOUT "\\end{tabular} \n";
print TEXOUT "\\end{center} \n";
print TEXOUT "\\end{document} \n";
close TEXOUT;

my $garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

#$garbage = `cd $Tab::file_root/tmp; rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

$m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
