<%args>
	$tourn
	$group_id          => 0
	$name              => 0
	$abbr              => 0
	$no_codes          => 0
	$code_start        => 0
	$field_report      => 0
	$judge_contacts    => 0
	$first_year_outs   => 0
	$neutrals          => 0
	$double_entry      => 0
	$ask_alts          => 0
	$judge_per         => 0
	$rounds_per        => 0
	$tab_room          => 0
	$dio_min           => 0
	$missing_judge_fee => 0
	$max_rounds        => 0
	$free              => 0
	$min_burden        => 0
	$max_burden        => 0
	$alt_max           => 0
</%args>
<%init>

	my $msg;

	my $group;

	if ($rounds_per > 0 && $judge_per > 0) { 
		my $err = "You must EITHER use number of entries per judge, OR number of rounds owed.  Both methods don\'t work together";
		$m->redirect("edit.mhtml?group_id=$group_id&err=$err");
	}

	if ($group_id) { 

		$group = Tab::JudgeGroup->retrieve($group_id);
		$group->name($name);
		$group->abbr($abbr);
		$group->update();

		$msg = "$name judge group changes saved";

	} else { 

        $group = Tab::JudgeGroup->create({
            tourn => $tourn->id,
            name => $name,
            abbr => $abbr,
        });

		$msg = "$name judge group created";

	}

	$max_rounds = 8 if $max_rounds < 1;

	$group->setting("no_codes", $no_codes);
	$group->setting("code_start", $code_start);
	$group->setting("field_report", $field_report);
	$group->setting("judge_contacts", $judge_contacts);
	$group->setting("first_year_outs", $first_year_outs);
	$group->setting("neutrals", $neutrals);
	$group->setting("double_entry", $double_entry);
	$group->setting("ask_alts", $ask_alts);
	$group->setting("judge_per", $judge_per);
	$group->setting("rounds_per", $rounds_per);
	$group->setting("tab_room", $tab_room);
	$group->setting("dio_min", $dio_min);
	$group->setting("missing_judge_fee", $missing_judge_fee);
	$group->setting("max_rounds", $max_rounds);
	$group->setting("free", $free);
	$group->setting("min_burden", $min_burden);
	$group->setting("max_burden", $max_burden);
	$group->setting("alt_max", $alt_max);

	$m->redirect("edit.mhtml?group_id=".$group->id."&msg=$msg");

</%init>
