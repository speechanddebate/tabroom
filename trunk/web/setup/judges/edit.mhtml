<%args>
	$account
	$group_id => undef
	$tourn
	$new => undef
	$page => undef
</%args>
<%perl>

	my $group = Tab::JudgeGroup->retrieve($group_id) if $group_id; 
	my $switch;

	$group = $tourn->groups->first if scalar $tourn->groups == 1 && not defined $new;
	$group_id = $group->id if $group && not defined $new;

	if ($page) { 

		$m->redirect("edit.mhtml?group_id=".$group->id) if $page eq "edit";
		$m->redirect("hires.mhtml?group_id=".$group->id) if $page eq "hires";
		$m->redirect("ratings.mhtml?group_id=".$group->id) if $page eq "ratings";
		$m->redirect("scale.mhtml?group_id=".$group->id) if $page eq "scale";
		$m->redirect("partials.mhtml?group_id=".$group->id) if $page eq "partials";
		$m->redirect("pools.mhtml?group_id=".$group->id) if $page eq "pools";
		
	}

</%perl>

	<& menubar.mas, group_id => $group_id, tourn => $tourn, page => "edit" &>

	<div class="left huge">

%	if ($group || $new) { 

		<h2>
			<% ($group) ? "Edit group ".$group->name : "Add Group"%> 
			<% ($group && $account->site_admin) ? " (".$group->id.")" : ""%>
		</h2>

		<table cellpadding="5" cellspacing="1" width="100%">
		
			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Judge Group Name:
				</th>

				<td class="rightalign">
					<form action="edit_save.mhtml" method="post">
					<input type="hidden" value="<% $group_id %>" name="group_id">
					<input type="text" name="name" value="<% ($group) ? $group->name : "" %>" size="25">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Abbreviation:
					(max letters: 3)
				</th>

				<td class="rightalign">
					<input type="text" maxlength="3" name="abbr" value="<% ($group) ? $group->abbr : "" %>" size="7">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					<label for="code_start">
						Start judge codes with
					</label>
				</th>

				<td class="rightalign">
					<input type="number" name="code_start" size="5" min="1" max="99999" value="<% ($group) ? $group->setting("code_start") : "" %>">
				</td>

			</tr>

% 			if ($tourn->setting("ncfl")) { 
			
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Note on NCFL elim assignment cards:
					</th>
		
					<td class="rightalign smallish">
						<input type="text" value="<% $group ? $group->setting("elim_special") : "" %>" size="40" name="elim_special">
					</td>

				</tr>
% 			}

		</table>

		<h4>Registration options</h4>

		<div class="halfcolumn">
		
			<table cellpadding="3" cellspacing="1" width="100%">
	
				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 

					<td>
						<label for="no_codes">
							Suppress judge codes (use names only)
						</label>
					</th>

					<td class="rightalign">
						<input type="checkbox" name="no_codes" id="no_codes" value="1" <% ($group) ? ($group->setting("no_codes")) ? "checked" : "" : "" %>>
					</td>

				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 

					<td>
						<label for="field_report">
							Publish list of judges online
						</label>
					</th>

					<td class="rightalign">
						<input type="checkbox" name="field_report" id="field_report" value="1" <% ($group) ? ($group->setting("field_report")) ? "checked" : "" : "" %>>
					</td>

				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 

					<td>
						<label for="judge_contacts">
							Ask registrants for judge phone numbers
						</label>
					</th>

					<td class="rightalign">
						<input type="checkbox" name="judge_contacts" id="judge_contacts" value="1" <% ($group) ? ($group->setting("judge_contacts")) ? "checked" : "" : "" %>>
					</td>

				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 

					<td>
						<label for="first_year_outs">
							Ask registrants to mark first year out judges
						</label>
					</th>

					<td class="rightalign">
						<input type="checkbox" name="first_year_outs" id="first_year_outs" value="1" <% ($group) ? ($group->setting("first_year_outs")) ? "checked" : "" : "" %>>
					</td>

				</tr>

			</table>

		</div>

		<div class="halfcolumn">

			<table cellpadding="3" cellspacing="1" width="100%">
	
				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 
		
					<td>
						<label for="neutrals">
							Registrants allowed to mark neutral judges 
						</label>

						<br />

						<span class="smaller">
							Allowed to judge their own school's entries
						</span>
					</td>
			
					<td class="rightalign" colspan="2">
						<input type="checkbox" id="neutrals" name="neutrals" value="1" 
						<% $group && $group->setting("neutrals") ? "checked" : "" %>>
					</td>
		
				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 

					<td>
						<label for="double_entry">
							Judges may double-register in other groups
						</label>
					</th>

					<td class="rightalign">
						<input type="checkbox" name="double_entry" id="double_entry" value="1" <% ($group && $group->setting("double_entry")) ? "checked" : "" %>>
					</td>

				</tr>

				<tr class="fixed <% ($switch++ % 2) ? "oddrow" : "evenrow" %>"> 
			
					<td>
						<label for="ask_alts">
							Judges may specify an alternate group
						</label>
					</td>

					<td class="rightalign">
						<input type="checkbox" id="ask_alts" name="ask_alts" value="1" <%  ($group && $group->setting("ask_alts")) ? "checked" : "" %>>
					</td>

				</tr>

			</table>

		</div>

		<h4 style="margin-top: 10px;">
			Burden method (use only one)
		</h4>

		<table cellpadding="5" width="100%" cellspacing="1">   

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Number of entries per judge owed
				</td>

				<td class="rightalign">
					<input type="number" step=".01" min=0 max=99 name="judge_per" value="<% ($group) ? $group->setting("judge_per") : "" %>" size="4">
				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

				<td>
					Number of rounds owed per entry 
				</td>

				<td class="rightalign">
					<input type="number" min=0 max=99999 name="rounds_per" value="<% ($group) ? $group->setting("rounds_per") : "" %>" size="4">
				</td>

			</tr>

% 			if ($tourn->setting("ncfl")) { 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						<label="tab_room">
							Flat obligation (even without entries; tab room)
						</label>
					</td>

					<td class="rightalign">
						<input type="checkbox" id="tab_room" name="tab_room" class="largecheck"
							value="1" <% ($group) ? ($group->setting("tab_room")) ? "checked" : "" : "" %>>
					</td>
				</tr>
	
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >	

					<td>
						Minimum required per diocese 
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99999 name="dio_min" value="<% ($group) ? $group->setting("dio_min") : "" %>" size="4">
					</td>

				</tr>

% 			} 


		</table>

%		if ($group && $group->setting("rounds_per")) { 

			<h4 style="margin-top: 10px;">
				Alter burden
			</h4>

			<table cellpadding="5" width="100%" cellspacing="1">   

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td>
						Maximum number of rounds per judge:
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=99 name="max_rounds" value="<% ($group) ? $group->setting("max_rounds") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
	
					<td>
						Free rounds: reduce round burden by
					</td>

					<td class="rightalign">
						<input type="number" min=-99 max=99 name="free" value="<% ($group) ? $group->setting("free") : "" %>" size="4">
					</td>

				</tr>

%			} elsif ($group && $group->setting("judge_per")) { 
			
				<h4 style="margin-top: 10px;">
					Alter burden
				</h4>

				<table cellpadding="5" width="100%" cellspacing="1">   

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Minimum judges owed if a school has entries
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=999 name="min_burden" value="<% ($group) ? $group->setting("min_burden") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Maximum judges that a school can owe
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=999 name="max_burden" value="<% ($group) ? $group->setting("max_burden") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Free judges: reduce judge burdens by
					</td>

					<td class="rightalign">
						<input type="number" min=-99 max=99 name="free" value="<% ($group) ? $group->setting("free") : "" %>" size="4">
					</td>

				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

					<td>
						Maximum number of judges that can count for the alternate group
					</td>

					<td class="rightalign">
						<input type="number" min=0 max=999 name="alt_max" value="<% ($group) ? $group->setting("alt_max") : "" %>" size="4">
					</td>

				</tr>

%			} else { 

				<table cellpadding="5" width="100%" cellspacing="1">   

%			} 

			<tr class="liblrow">

				<td  colspan="2" class="rightalign">
					<input type="submit" value="Save group" style="width: 150px;">
					</form>
				</td>
			</tr>

		</table>

%	} else { 

		<h2>Judge Groups</h2>

		<p>
			Add judge groups or edit judge group information.
		</p>

%	}

	</div>
