<%args>
	$tourn
</%args>

	<& "/funclib/editor.mas" &>

	<div class="main"> 

		<h2><% $tourn->name %></h2>

		<& tabbar.mas, tourn => $tourn, whoami => "housing" &>

		<h4>Tournament provided housing</h4>

%		if ($tourn->setting("housing")) { 

			<table width="100%" cellpadding="4" cellspacing="1" >

				<tr>

					<th>
						Night of
					</th>
					
					<th class="rightalign">
						Number of Housing Slots Available
						<form action="housing_save.mhtml" method="post">
						<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
					</th>
				</tr>

%				my $switch;
%				my @days = $m->comp("/funclib/tourn_days.mas", tourn => $tourn);
%				my $day_before = $days[0]->clone;
%				$day_before->subtract( days => 1);
%   			push (@days, $day_before);

%				foreach my $day (sort {$a->epoch <=> $b->epoch} @days) { 

%					my @housings = Tab::HousingSlots->search( 
%						tourn => $tourn->id, 
%						night => $day); # teehee!

%					my $housing = shift @housings if @housings;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $day->day_name.", ".$day->month_name." ".$day->day %>
						</td>

						<td class="rightalign">
							<input type="text" name="slots_<% $day->ymd %>" size="10" value=<% ($housing) ? $housing->slots : "" %> >
						</td> 

					</tr>

%				} 

				<tr>
					<td colspan="2" style="padding-top: 20px;">
						<h4>Housing policies/message to registrants</h4>
					</td>
				</tr> 
				
				<tr>
					<td colspan="2" align="center">
						<textarea rows="8" cols="55" name="housing_message"><% $tourn->setting("housing_message") %></textarea>
					</td>
				</tr> 
				
				<tr class="liblrow">
					<td colspan="2" align="right">
						<input type="submit" value="   Save Housing Settings    ">
						</form>
					</td>
				</tr> 
				
			</table>

%		}

	</div>

	<div class="menu">

		<div class="sidenote">

			<h4>Housing is <% ($tourn->setting("housing")) ? " ON " : " OFF " %></h4>

			<br />

			<a class="<% ($tourn->setting("housing")) ? "dkred block" : "dkgreen block" %>" href="housing_switch.mhtml">
				Turn housing <% ($tourn->setting("housing")) ? " off " : " on " %>
			</a>

			<br />
			<br />

		</div>

	</div>

