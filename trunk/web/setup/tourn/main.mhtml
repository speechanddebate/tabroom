<%args>
	$tourn
	$account
</%args>
<%init>

	my $switch;
	my $tz = $tourn->tz;
	$tz = "America/New_York" unless $tz;

</%init>

	<div class="left huge">

		<h2><% $tourn->name %></h2>

		<& tabbar.mas, tourn => $tourn, whoami => "main" &>

		<h4>Name & Location</h4>

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Tournament Full Name 
				</span>

				<span class="twothird">
					<form action="main_save.mhtml" method="post">
					<input type="text" name="name" size="35" value="<% $tourn->name %>">
				</span>

			</div>

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Tournament Web name
				</span>

				<span class="twothird">
					http://<input type="text" name="webname" size="16" value="<%  $tourn->webname  %>">.tabroom.com
				</span>

			</div>

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Time Zone
				</span>

				<span class="twothird">
					<select name="timezone" 
					class="chosen fixed">
					<& "/funclib/timezones.mas", tz => $tz &>
					</select>
				</span>

			</div>

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Location Country
				</span>

				<span class="twothird">
					<select name="country" class="chosen fixed">
					<& /funclib/country_select.mas, country => $tourn->country &>
					</select>
				</span>

			</div>

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Location State (if applicable)
				</span>

				<span class="twothird">
					<select name="state" class="chosen fixed">
					<& /funclib/state_select.mas, state => $tourn->state &>
					</select>
				</span>

			</div>

%			my $currency = $tourn->setting('currency');

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Currency Symbol
				</span>

				<span class="twothird">
					<input type="text" name="currency" size="5" value="<% $currency ? $currency : '$' %>">
				</span>

			</div>

%			my $papersize = $tourn->setting('papersize');

			<div class="<% ($switch++% 2) ? "oddrow" : "evenrow" %>">

				<span class="third">
					Paper Size
				</span>

				<span class="twothird">
					<select name="papersize" class="fixedmed chosen">
						<option value="letter" <% $papersize eq "letter" ? 'selected' : "" %>>
							Letter (US)
						</option>
						<option value="a4" <% $papersize eq "a4" ? 'selected' : "" %>>
							A4
						</option>
					</select>
				</span>

			</div>

			<div class="liblrow rightalign"> 
				<input  type="submit" value=" Save Tournament Info">
				</form>
			</div>

		</table>

		<span class="half inline">

			<h4>Circuits</h4>

%			my @approved = $m->comp("/funclib/tourn_circuits.mas", tourn => $tourn);
%			my @pending = $m->comp("/funclib/tourn_circuits.mas", tourn => $tourn, unapproved => 1);

%			if (@approved) { 
				<p class="padmore">Approved for the following circuit calendars:</p>
%			}

%			undef $switch;
%			my %circuit_used;

%			foreach my $circuit (@approved) { 

%				next if $circuit_used{$circuit->id}++;

				<form action="circuit_add.mhtml" method="post">
				<input type="hidden" name="tourn_id" value="<% $tourn->id %>">

				<div class="padmore <% ($switch++% 2) ? "oddrow" : "evenrow" %>">

					<span class="twothird">
						<% $circuit->name %>
					</span>

					<span class="third rightalign">
						<a class="centeralign dkred" href="circuit_rm.mhtml?circuit_id=<% $circuit->id %>">
							Remove
						</a>
					</span>

				</div>
						
%			}

%			if (@pending) { 
				<p class="padmore">Approval still pending:</p>
%			}

%			undef $switch;

%			foreach my $circuit (@pending) { 

%				next if $circuit_used{$circuit->id}++;

				<div class="padmore <% ($switch++% 2) ? "oddrow" : "evenrow" %>">

					<span class="twothird">
						<% $circuit->name %>
					</span>

					<span class="third centeralign">
						<a class="dkred full block" href="circuit_rm.mhtml?circuit_id=<% $circuit->id %>">
							Remove
						</a>
					</span>

				</div>

%			}

			<div class="block liblrow">
			
				<span class="twothird">
					<select name="circuit_id" class="fixedmed chosen">
%						foreach my $circuit (sort {$a->name cmp $b->name} Tab::Circuit->search( active => 1)) { 
%							next if $circuit_used{$circuit->id};
							<option value="<% $circuit->id %>"> <% $circuit->name %> </option>
%						}
					</select>
				</span>

				<span class="third centeralign">
					<input type="submit" value=" Add " class="thin">
					</form>
				</span>
			</div>

		</span>

		<span class="half rightfloat">
		
			<h4>Invitation</h4>

			<div class="evenrow block"> 

				<div class="uploader">
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="invite" action="invite_upload.mhtml" method="post">
					<input type="file" name="invite" style="opacity: 0;" onchange="uploaderName()" id="upload">
					<span id="filename" class="filename" style="-webkit-user-select: none;">No file selected</span>
					<span class="action" style="-webkit-user-select: none;">Choose File</span>
				</div>

				<span class="third rightalign">
					<input  type="submit" class="thin" value="  Upload  ">
					</form>
				</span>
			</div>

			<h4>Congress Packet</h4>

			<div class="evenrow block"> 

				<div class="uploader">
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="bills" action="bills_upload.mhtml" method="post">
					<input type="file" name="bills" style="opacity: 0;" onchange="uploaderName()" id="upload">
					<span id="filename" class="filename" style="-webkit-user-select: none;">No file selected</span>
					<span class="action" style="-webkit-user-select: none;">Choose File</span>
				</div>

				<span class="third rightalign">
					<input  type="submit" class="thin" value="  Upload  ">
					</form>
				</span>
			</div>

			<h4>Tournament Logo</h4>

			<div class="evenrow block"> 

				<div class="uploader">
					<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="logo" action="logo_upload.mhtml" method="post">
					<input type="file" name="logo"/ style="opacity: 0;" onchange="uploaderName()" id="upload">
					<span id="filename" class="filename" style="-webkit-user-select: none;">No file selected</span>
					<span class="action" style="-webkit-user-select: none;">Choose File</span>
				</div>

				<span class="third rightalign">
					<input  type="submit" class="thin" value="  Upload  ">
					</form>
				</span>
			</div>

		</div>

	</span>

	<div class="right small">

% 		if ($tourn->setting("invite") || $tourn->setting("bills") || $tourn->setting("logo")) { 
			<div class="sidenote"> 

				<h4>Files posted:</h4>

%				if ($tourn->setting("logo") && -e "/files/tourns/".$tourn->id."/".$tourn->setting("logo")) { 
					<div class="block">
						<img src="/files/tourns/<% $tourn->id."/".$tourn->setting("logo") %>" alt="Logo" style="max-width: 220px;"/>
					</div>
%				}

%	 			if ($tourn->setting("invite")) {
    	    		<a class="blue half" href="/files/tourns/<% $tourn->id %>/<% $tourn->setting("invite") %>">
						Posted Invite
					</a><a class="yellow half" href="delete_invite.mhtml">
						Delete
					</a>
%				}

%  				if ($tourn->setting("bills")) {
    	    	 	<a class="blue half" href="/files/tourns/<% $tourn->id."/bills/".$tourn->setting("bills") %>">
						Posted Bills
					</a><a class="yellow half" href="delete_bills.mhtml">
						Delete
					</a>
%   			} 



			</div>
% 		} 

		<div class="sidenote"> 

			<h4>Notes</h4>

			<p>
				Your webname must be unique to your tournament, and in all
				lowercase letters or numbers, no punctuation.  Don't include
				the year; web names can be re-used by the same tournament
				each year.
			</p>

			<p>
				Don't make your tournament name too long; long names will be
				truncated on many online listings.  Also, don't include
				the year of the tournament; archives and results pages will
				include the year automatically.
			</p>

			<p>
				Your tournament invitations and the bill packets will
				immediately appear on your public website as download
				links.  Please make sure the files are in a common format, such
				as DOC or PDF, and it's best if the file names did not include
				characters besides numbers and letters
			</p>

	
		</div>

	</div>
