<%args>
	$err => undef
	$msg => undef
	$fullmsg => undef
</%args>
<%init>

	my ($account, $session) = $m->comp( "/user/login/authenticate.mas");

	my $league = $session->league if $session;

	my $tourn = $session->tournament if $session && ($r->uri !~ /index/);

	my $debug;

	my $tz = $league->timezone if $league;
	$tz = "America/New_York" unless $tz;

</%init>

	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

	<html>

		<head>

			<link rel="stylesheet" type="text/css" media=screen href="/lib/css/tabroom.css">

%			unless ($r->uri =~ /user/ || $r->uri =~ /admin/ || $r->uri =~ /league/ || $r->uri =~ /index/ || $r->uri =~ /liveupdates\// || $r->uri =~ /donate/) { 
				<link rel="stylesheet" type="text/css" media=screen href="/lib/css/headerless.css">
%			}

			<script type="text/javascript" src="/lib/javascript/tabroom.js"></script>

			<title>
				Tabroom.com
				<% ($tourn) ? ": ".$tourn->name : ($league) ? ": ".$league->name : "" %>
				<% ($account && $tourn && $account->site_admin) ? $tourn->id : "" %>
			</title>


%			if ($err) { 
				<script type="text/javascript" language="javascript">
					$(document).ready(function() {
						$.jGrowl("<% $err %>", { header: 'Warning', life: 10000, theme: 'warning', position: 'top-left', sticky: true });
					});
				</script>
%			}

%			if ($msg) { 
				<script type="text/javascript" language="javascript">
					$(document).ready(function() {
						$.jGrowl("<% $msg %>", { header: 'Result', life: 4000  });
					});
				</script>
%			}

%			if ($fullmsg) { 
				<script type="text/javascript" language="javascript">
					$(document).ready(function() {
						$.jGrowl("<% $fullmsg %>", { header: 'Notice', theme: 'full', position: 'center', sticky: true  });
					});
				</script>
%			}

	</head>

<%perl>

 	my $bodystyle;

	if ($r->hostname =~ /tabdev/ || $r->hostname =~ /tabpro/ || $r->hostname =~ /zain/) { 
		$bodystyle = "style=\"background-image: none; background-color: #660000;\"";
	}

	if ($r->hostname =~ /tab.tabroom.com/) { 
		$bodystyle = "style=\"background-image: none; background-color: #444444;\"";
	}

	if ($r->hostname =~ /sandbox.tabroom.com/) { 
		$bodystyle = "style=\"background-image: none; background-color: #666666;\"";
	}

</%perl>

% 	if ($r->uri =~ /tabbing\/rank/ || $r->uri =~ /user\/login/ || $r->uri =~ /tabbing\/congress_sweeps/ ) { 

		<body OnLoad="placeFocus()" <% $bodystyle %>>

% 	} else { 

		<body <% $bodystyle %>>

% 	}

	<div id="<% ($session) ? "header" : "indexheader" %>">

		<div id="headerlinks">

			<a href="http://www.summitdebate.com">
				<img src="<% $Tab::url_prefix %>/lib/images/transparent-summit.gif"></a>

			<br>

			<a href="<% $Tab::url_prefix %>">
				<img src="<% $Tab::url_prefix %>/lib/images/transparent-tabroom.gif">
			</a>

		</div>

		<div id="login">
			<& "/user/login/login_block.mas", session => $session, account => $account &>
		</div>

	</div>

%		$m->call_next( 	debug => $debug, 
%						account => $account, 
%						tz => $tz, 
%						league => $league, 
%						tourn => $tourn, 
%						session => $session );

	</body>

</html>

