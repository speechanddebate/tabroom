<%args>
	$tourn
</%args>
<%init>

	unless ($tourn->method) { 
		$m->redirect("/rules/registration.mhtml");
	}

</%init>


	<h2>Tournament provided housing</h2>


	<div id="leftbignb"> 

%		if ($tourn->method->housing) { 

			<table width="100%" cellpadding="4" cellspacing="1" >

				<tr>

					<th>
						Night of
					</th>
					
					<th>
						# of Slots Available
						<form action="housing_save.mhtml" method="post">
						<input type="hidden" name="tourn_id" value="<% $tourn->id %>">
					</th>
				</tr>

%				my $switch;
%				my @days = $tourn->days;
%				my $day_before = $days[0]->clone;
%				$day_before->subtract( days => 1);
%   			push (@days, $day_before);

%				foreach my $day (sort {$a->epoch <=> $b->epoch} @days) { 

%					my @housings = Tab::HousingSlots->search( 
%						tournament => $tourn->id, 
%						night => $day); # teehee!

%					my $housing = shift @housings if @housings;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $day->day_name.", ".$day->month_name." ".$day->day %>
						</td>

						<td align="center">
							<input type="text" name="slots_<% $day->ymd %>" size="10" value=<% ($housing) ? $housing->slots : "" %> >
						</td> 

					</tr>

%				} 

				<tr>
					<td colspan="2" style="padding-top: 20px;">
						<h4>Housing policies/message to registrants</h4>
					</td>
				</tr> 
				
				<tr>
					<td colspan="2" align="center">
						<textarea rows="8" cols="55" name="housing_message"><% $tourn->method->housing_message %></textarea>
					</td>
				</tr> 
				
				<tr>
					<td colspan="2" align="right">
						<input type="submit" value="   Save Housing Settings    ">
						</form>
					</td>
				</tr> 
				
			</table>

%		}

	</div>

	<div id="rightsmall">

			<h4>Housing management is <% ($tourn->method->housing) ? " ON " : " OFF " %></h4>

			<br />

			<a class="<% ($tourn->method->housing) ? "red block" : "blue block" %>" href="housing_switch.mhtml">
				Turn Housing Management <% ($tourn->method->housing) ? " off " : " on " %>
			</a>

	</div>

