<%args>
	$tourn
	$account
	$err => undef
</%args>
<%init>

	my $switch;

	my @tiebreakers = 	("ranks","winloss","reciprocals","points",
						"judgepref","roundrank", "panelletter",
						"rankinround","competition", "coinflip");

	my @counts = 		("all","prelim","elim","last elim","final");

	my @sets = sort {$a->name cmp $b->name} Tab::TiebreakSet->search(tourn => $tourn->id);

</%init> 

	<& sidebar.mas, tourn => $tourn, chosen => "tiebreaks" &>

	<div class="left huge">
			
		<h2>Tiebreaker sets</h2>

%		foreach my $set (@sets) { 

%			my $prime = 1;
	
			<h4 style="margin-top: 10px;"><% ucfirst($set->name) %></h4>

			<table width="100%" cellpadding="5" cellspacing="1">

%   			foreach my $tiebreak (sort {$a->priority <=> $b->priority} Tab::Tiebreak->search(tb_set => $set->id)) {

%					$prime++;

%					my $highlow = " dropping best & worst, " if $tiebreak->highlow == 1;
%					$highlow = " dropping best scores, " if $tiebreak->highlow == 2;
%					$highlow = " dropping worst scores, " if $tiebreak->highlow == 3;
%					$highlow = " dropping the 2 best & worst, " if $tiebreak->highlow == 4;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			            <td colspan="7" style="padding-top: 10px; padding-left: 10px;">

							 <% $tiebreak->priority %>. <% ucfirst($tiebreak->name) %> score
							 from <% $tiebreak->count %> rounds, <% $highlow %> multiplied by <% $tiebreak->multiplier %>

							<span style="float: right; width: 100px; text-align: center; margin: 0; padding: 0;">
            			    	<a class="dkred block" href="tiebreak_rm.mhtml?tiebreak_id=<% $tiebreak->id %>">Delete</a>
							</span>

						</td>
					</tr>
%				}

				<tr>
					<td>
					</td>
				</tr>

				<tr class="liblrow"> 
				
					<td>
						Add
						<form action="tiebreak_save.mhtml" method="post">
						<input type="hidden" name="tb_set_id" value="<% $set->id %>">
					</td> 
					
					<td class="centeralign">
						<select name="name">
%               			foreach my $tb (@tiebreakers) {
                    			<option value="<% $tb %>"><% ucfirst($tb) %></option>
%               			}
           	 			</select>
        			</td> 
					
					<td class="centeralign">
						<input type="number" min="1" max="99" size="4" name="priority" value="<% $prime %>" placeholder="Priority"> 
					</td> 
					
					<td>
						<select name="count">
%           				foreach my $ct (@counts) {
                				<option value="<% $ct %>"><% ucfirst($ct) %></option>
%           				}
            			</select>
        			</td>

					<td class="centeralign">
						<input type="number" min="1" max="99" size="10" name="multiplier" placeholder="Multiplier">
					</td> 

					<td class="smaller centeralign">
						Drop
						<select name="highlow"> 
                   			<option value="0">None</option>
                   			<option value="1">H/L</option>
                   			<option value="2">High</option>
                   			<option value="3">Low</option>
                   			<option value="4">2H/2L</option>
						</select>
					</td> 
					
					
					<td class="centeralign">
						<input class="skinny" type="submit" value="Save">
						</form>
					</td>

				</tr>

			</table>

%		}

		<br />

	</div>

