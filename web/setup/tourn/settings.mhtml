<%args>
	$tourn
	$person
	$person_settings
	$tourn_settings
	$perms
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;
	my $district = $tourn_settings->{"nsda_district"};

</%init>

	<div class="menu">

%	if ($person->id < 4) {
		<div class="sidenote">
			<h4>Paypal Payments</h4>

			<form action="paypal_save.mhtml" method="post">
				<div class="row flexrow">
					<span class="fourfifths semibold">
						Enable PayPal Payments
					</span>
					<span class="fifth centeralign nospace">
						<input
							type    = "checkbox"
							class   = "notfirst"
							name    = "paypal_enable"
							id      = "paypal_enable"
							value   = 1
							onClick = 'enablePayments();'
							<% $tourn_settings->{"paypal_enable"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow paypal">
					<span class="twothirds semibold">
						Your PayPal Merchant ID
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "paypal_merchant_id"
							class = "notfirst"
							value = "<% $tourn_settings->{"paypal_merchant_id"} %>"
						>
					</span>
				</div>
				<div class="row flexrow paypal">
					<span class="twothirds semibold">
						Your PayPal Client ID
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "paypal_client_id"
							class = "notfirst"
							value = "<% $tourn_settings->{"paypal_client_id"} %>"
						>
					</span>
				</div>
				<div class="row flexrow paypal">
					<span class="twothirds semibold">
						Your PayPal Payment Email
					</span>
					<span class="third centeralign">
						<input
							type  = "email"
							name  = "paypal_email"
							class = "notfirst"
							value = "<% $tourn_settings->{"paypal_email"} %>"
						>
					</span>
				</div>
				<div class="row flexrow paypal">
					<span class="twothirds semibold">
						Your PayPal.me URL
					</span>
					<span class="third centeralign">
						<input
							type  = "url"
							name  = "paypal_url"
							class = "notfirst"
							value = "<% $tourn_settings->{"paypal_url"} %>"
						>
					</span>
				</div>

				<div class="libl rightalign">
					<span class="half centeralign">
						<input
							class = "notfirst"
							type  = "submit"
							value = "Save"
						>
					</span>
				</div>
			</form>
		</div>

		<div class="sidenote">
			<h4>Authorize.Net Payments</h4>
			<span class="explain centeralign full">
				Authorize.Net settings are auto-deleted post tournament
			</span>

			<form action="authorizenet_save.mhtml" method="post">
				<div class="row flexrow">
					<span class="fourfifths semibold">
						Enable Authorize.Net Payments
					</span>
					<span class="fifth centeralign nospace">
						<input
							type    = "checkbox"
							class   = "notfirst"
							name    = "authorizenet_enable"
							value   = 1
							id      = "authorizenet_enable"
							onClick = 'enablePayments();'
							<% $tourn_settings->{"authorizenet_enable"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="twothirds semibold">
						Authorize.Net API Login ID
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "authorizenet_api_login"
							class = "notfirst"
							value = "<% $tourn_settings->{"authorizenet_api_login"} %>"
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="twothirds semibold">
						Authorize.Net Transaction Key
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "authorizenet_transaction_key"
							class = "notfirst"
							value = "<% $tourn_settings->{"authorizenet_transaction_key"} %>"
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="twothirds semibold">
						Authorize.Net Client Key
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "authorizenet_client_key"
							class = "notfirst"
							value = "<% $tourn_settings->{"authorizenet_client_key"} %>"
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="fourfifths semibold wrap noflex nospace">
						<div class="nospace full">
							Enable ACH Payments
						</div>
						<div class="nospace padtopless full explain">
							(must be supported in your Authorize.Net account)
						</div>
					</span>

					<span class="fifth centeralign">
						<input
							type  = "checkbox"
							class = "notfirst"
							name  = "authorizenet_ach_enable"
							value = 1
							<% $tourn_settings->{"authorizenet_ach_enable"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="twothirds semibold wrap noflex nospace">
						<div class="nospace full">
							CC Processing Fee
						</div>
						<div class="nospace padtopless full explain">
							as a decimal, e.g. 0.04 = 4%
						</div>
					</span>
					<span class="third centeralign">
						<input
							id    = "authorizenet_cc_fee"
							name  = "authorizenet_cc_fee"
							class = "notfirst"
							type  = "number"
							step  = ".01"
							min   = "0.0"
							max   = "0.1"
							value = "<% $tourn_settings->{"authorizenet_cc_fee"} %>"
						>
					</span>
				</div>
				<div class="row flexrow authorizenet">
					<span class="twothirds semibold wrap noflex nospace">
						<div class="nospace full">
							ACH Processing Fee
						</div>
						<div class="nospace padtopless full explain">
							as a decimal, e.g. 0.01 = 1%
						</div>
					</span>
					<span class="third centeralign">
						<input
							id    = "authorizenet_ach_fee"
							name  = "authorizenet_ach_fee"
							class = "notfirst"
							type  = "number"
							step  = ".01"
							min   = "0.0"
							max   = "0.1"
							value = "<% $tourn_settings->{"authorizenet_ach_fee"} %>"
						>
					</span>
				</div>

				<div class="libl rightalign">
					<span class="half centeralign">
						<input
							class = "notfirst"
							type  = "submit"
							value = "Save"
						>
					</span>
				</div>
			</form>
		</div>
%	}

%	if ($person->id < 4 || $person->id == 4642) {
		<div class="sidenote">
			<h4>Boltizar Payments</h4>

			<form action="boltizar_save.mhtml" method="post">
				<div class="row flexrow">
					<span class="fourfifths semibold">
						Enable Boltizar Payments
					</span>
					<span class="fifth centeralign nospace">
						<input
							type    = "checkbox"
							class   = "notfirst"
							name    = "boltizar_enable"
							id      = "boltizar_enable"
							value   = 1
							onClick = 'enablePayments();'
							<% $tourn_settings->{"boltizar_enable"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow boltizar">
					<span class="twothirds semibold">
						Your Boltizar Host System Code
					</span>
					<span class="third centeralign">
						<input
							type  = "text"
							name  = "boltizar_host_system_code"
							class = "notfirst"
							value = "<% $tourn_settings->{"boltizar_host_system_code"} %>"
						>
					</span>
				</div>
				<div class="row flexrow boltizar">
					<span class="fourfifths semibold wrap noflex nospace">
						<div class="nospace full">
							Require e-payments?
						</div>
					</span>

					<span class="fifth centeralign">
						<input
							type  = "checkbox"
							class = "notfirst"
							name  = "boltizar_require_epayments"
							value = 1
							<% $tourn_settings->{"boltizar_require_epayments"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow boltizar">
					<span class="fourfifths semibold wrap noflex nospace">
						<div class="nospace full">
							Credit Card Surcharge?
						</div>
					</span>

					<span class="fifth centeralign">
						<input
							type  = "checkbox"
							class = "notfirst"
							name  = "boltizar_cc_surcharge"
							value = 1
							<% $tourn_settings->{"boltizar_cc_surcharge"} ? "checked" : "" %>
						>
					</span>
				</div>
				<div class="row flexrow boltizar">
					<a href="https://boltizarpayments.com/host/tabroom/<% $tourn->id %>" target="_blank" noopener noreferrer>
						Boltizar Platform Setup
					</a>
				</div>

				<div class="libl rightalign">
					<span class="half centeralign">
						<input
							class = "notfirst"
							type  = "submit"
							value = "Save"
						>
					</span>
				</div>
			</form>
		</div>
%	}

	</div>

	<div class="main">

		<h3><% $tourn->name %></h3>

		<& tabbar.mas,
			tourn		 => $tourn,
			tourn_settings => $tourn_settings,
			whoami		 => "settings"
		&>

		<h4>Tournament-Wide Registration Settings</h4>

		<form
			enctype = "multipart/form-data"
			name    = "regpack"
			action  = "settings_save.mhtml"
			method  = "post"
		>

		<input
			type  = "hidden"
			name  = "tourn_id"
			value = "<% $tourn->id %>"
		>

		<span class="pagehalf">
			<label for="hidden">
				<div class="hover row">
					<span class="fivesixths">
						Test tournament (hidden from public)
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							value    => $tourn->hidden,
							target   => $tourn,
							property => "hidden",
							smaller  => 1,
						&>
					</span>
				</div>
			</label>

			<label for="require_adult_contact">
				<div class="hover row">
					<span class="fivesixths">
						Require adult contact info to register
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "require_adult_contact",
							value  => $tourn_settings->{"require_adult_contact"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="account_contacts">
				<div class="hover row"
					title="This option allows schools to designate official contacts via Tabroom accounts instead of freeform text boxes. Only their designated contacts get emails. All contacts must have a Tabroom account. This behavior will become the default soon."
				>
					<span class="fivesixths">
						Tabroom account based coach/contacts
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag     => "account_contacts",
							value   => $tourn_settings->{"account_contacts"},
							target  => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="second_adult_contact">
				<div class="hover row">
					<span class="fivesixths">
						Require second/backup adult contact/coach
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "second_adult_contact",
							value  => $tourn_settings->{"second_adult_contact"},
							target => $tourn,
							smaller => 1
						&>
					</span>
				</div>
			</label>

%			unless ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) {
				<label for="category_adult_contact">
					<div class="nospace mocktrial">
					<div class="hover row plaincontacts">
						<span class="fivesixths">
							Ask for adult contacts by category
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "category_adult_contact",
								value  => $tourn_settings->{"category_adult_contact"},
								target => $tourn,
								smaller => 1
							&>
						</span>
					</div>
					</div>
				</label>
%			}


%			unless ($district || $tourn_settings->{"nsda_nats"}) {
				<label for="overall_cap">
					<div class="row">
						<span class="threequarters">
							Tournament-wide cap on entries
						</span>

						<span class="quarter centeralign">
							<input
								type = "number"
								id	= "overall_cap"
								name = "overall_cap"
								size = "5"
								class = "smaller"
								value = "<% $tourn_settings->{"overall_cap"} %>"
							>
						</span>
					</div>
				</label>
%			}

			<label for="track_reg_changes">
				<div class="hover row">
					<span class="fivesixths">
						Log registration changes
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "track_reg_changes",
							value  => $tourn_settings->{"track_reg_changes"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>


%			unless ($district || $tourn_settings->{"nsda_nats"}) {
				<label for="closed_entry">
					<div class="hover row">
						<span class="fivesixths">
							Closed tournament: admin staff registers
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "closed_entry",
								value  => $tourn_settings->{"closed_entry"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			}

			<label for="no_waitlist_double_entry">
				<div class="hover row mocktrial">
					<span class="fivesixths">
						Waitlisted still count for double entry
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "no_waitlist_double_entry",
							value  => $tourn_settings->{"no_waitlist_double_entry"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

%			if ($tourn_settings->{"ncfl"}) {
				<label for="ncfl_codes">
					<div class="hover row">
						<span class="fivesixths">
							Post Entry Codes by Diocese
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "ncfl_codes",
								value  => $tourn_settings->{"ncfl_codes"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			}

			<script>

				function enablePayments() {
					const methods = ['authorizenet', 'paypal', 'boltizar'];
					for (const method of methods) {
						if ($(`#${method}_enable`).prop('checked')) {
							$(`.${method}`).removeClass('hidden');
						} else {
							$(`.${method}`).addClass('hidden');
						}
					}
					fixVisual();
				}

				function checkRegions() {
					$(".regions").addClass('hidden');
					if ($("#regions").prop("checked")) {
						$(".regions").removeClass('hidden');
					}

					fixVisual();
				}

				function checkContactOptions() {
					console.log(`account based checked`);
					console.log($(`#account_contacts`).prop('checked'));

					if ($(`#account_contacts`).prop('checked')) {
						$('.plaincontacts').addClass('hidden');
					} else {
						$('.plaincontacts').removeClass('hidden');
					}
					fixVisual();
				}

				function checkMT() {
					$(".mocktrial").removeClass('hidden');
					if ($("#mock_trial_registration").prop("checked")) {
						$(".mocktrial").addClass('hidden');
					}

					fixVisual();
				}

				function schoolCode() {
					$(".school_codes").addClass('hidden');
					if ($("#school_codes").val() == 'incremental') {
						$(".school_codes").removeClass('hidden');
					}
					fixVisual();
				}

				$(document).ready(function() {
					checkContactOptions();
					checkRegions();
					checkMT();
					schoolCode();
					enablePayments();
				});
			</script>

%			unless ($district) {
				<label for="regions">
					<div class="hover row">
						<span class="fivesixths">
							Use school regions
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag   => "regions",
								value  => $tourn_settings->{"regions"},
								target  => $tourn,
								smaller => 1,
								function => "checkRegions();"
							&>
						</span>
					</div>
				</label>

				<div class="hover row regions flexrow">
					<span class="half padleft">
						Use circuit standard regions
					</span>

					<span class="half padright">
						<select
							name = "region_circuit"
							class = "notfirst"
						>
							<option value=""></option>
%							foreach my $circuit ($tourn->circuits) {
								<option
									value="<% $circuit->id %>`"
									<% $tourn_settings->{"region_circuit"} == $circuit ? "selected" : "" %>
								><% $circuit->name %></option>
%							}
							<span class='quarterspacer'></span>
						</select>
					</span>
				</div>

				<div class="hover row regions flexrow">
					<span class="half padleft">
						Region label for registrations
					</span>

					<span class="half padright">
						<input
							type        = "text"
							name        = "region_label"
							class       = "notfirst"
							value       = "<% $tourn_settings->{"region_label"} %>"
							placeholder = "State, county, etc"
						>
					</span>
				</div>

				<label for="ask_regions">
					<div class="hover row regions">
						<span class="fivesixths">
							Require registrants to select a region
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag   => "ask_regions",
								value  => $tourn_settings->{"ask_regions"},
								target  => $tourn,
								smaller => 1
							&>
						</span>
					</div>
				</label>

				<label for="region_areas" title="Primarily for CHSSA. Because Angel needs to be just that much more extra.">
					<div class="hover row regions">
						<span class="fivesixths">
							Use region areas
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag   => "region_areas",
								value  => $tourn_settings->{"region_areas"},
								target  => $tourn,
								smaller => 1
							&>
						</span>
					</div>
				</label>
%			}

			<label for="require_disaster_check">
				<div class="hover row">
					<span class="fivesixths">
						Require disaster check before publishing
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag   => "require_disaster_check",
							value  => $tourn_settings->{"require_disaster_check"},
							target  => $tourn,
							smaller => 1
						&>
					</span>
				</div>
			</label>
		</span>

		<span class="pagehalf">
%			unless ($district) {
%				unless ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) {
					<label for="mock_trial_registration">
						<div class="hover row">
							<span class="fivesixths">
								Mock Trial Registration
							</span>

							<span class="sixth centeralign">
								<& "/funclib/bool_switch.mas",
									tag   => "mock_trial_registration",
									value  => $tourn_settings->{"mock_trial_registration"},
									target  => $tourn,
									smaller => 1,
									function => "checkMT();"
								&>
							</span>
						</div>
					</label>
%				}

				<label for="refund_information">
					<div class="hover row">
						<span class="fivesixths">
							Ask for refund information
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "refund_information",
								value  => $tourn_settings->{"refund_information"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%				if ($tourn_settings->{"refund_information"}) {
					<label
						for = "enable_credit"
						id = "enable_credit_box"
					>
						<div class="hover row">
							<span class="fivesixths">
								Offer credit for next year?
							</span>

							<span class="sixth centeralign">
								<& "/funclib/bool_switch.mas",
									tag	 => "enable_credit",
									value  => $tourn_settings->{"enable_credit"},
									target => $tourn,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
%				}

%				unless ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"} || $tourn_settings->{"ncfl"}) {
					<div class="hover row mocktrial">
						<label for="nsda_members_only">
							<span class="fivesixths">
								NSDA Paid Members only
							</span>
							<span class="sixth centeralign">
								<& "/funclib/bool_switch.mas",
									tag	 => "nsda_members_only",
									value  => $tourn_settings->{"nsda_members_only"},
									target => $tourn,
									smaller => 1,
								&>
							</span>
						</label>
					</div>
%				}
%			}

			<label for="publish_schools">
				<div class="hover row">
					<span class="fivesixths">
						Publish list of registered schools
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "publish_schools",
							value  => $tourn_settings->{"publish_schools"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<div class = "hover row"
				title  = "Removes deadline listings from the public tournament page, and the registration entry page.  Does not remove event/judge specific deadlines."
			>
				<label for="hide_deadlines">
					<span class="fivesixths">
						Hide Tabroom deadlines from registration
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag     => "hide_deadlines",
							value   => $tourn_settings->{"hide_deadlines"},
							target  => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
			</div>

			<label for="hide_codes">
				<div class="hover row">
					<span class="fivesixths">
						Hide Speaker Codes from Registrants
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "hide_codes",
							value  => $tourn_settings->{"hide_codes"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<div class="row flexrow">
				<span class="half padleft">
					School code style
				</span>

				<span class="half padright">
					<select
						name   = "school_codes"
						id    = "school_codes"
						class  = "fixedmost"
						onChange = "schoolCode();"
					>
						<option
							value="incremental"
							<% $tourn_settings->{'school_codes'} eq "incremental" ? "selected" : "" %> >
								Incremental (AA, AB, AC...)
						</option>

						<option
							value="circuit"
							<% $tourn_settings->{'school_codes'} eq "circuit" ? "selected" : "" %> >
							Circuit codes
						</option>

						<option
							value="shortname"
							<% $tourn_settings->{'school_codes'} eq "shortname" ? "selected" : "" %> >
							Shorten school name
						</option>

						<option
							value="registrant"
							<% $tourn_settings->{'school_codes'} eq "registrant" ? "selected" : "" %> >
							Registrant choice
						</option>

						<option
							value="none"
							<% $tourn_settings->{'school_codes'} eq "none" ? "selected" : "" %> >
							None
						</option>

					</select>
				</span>
			</div>

			<div class="row school_codes">
				<span class="threequarters">
					First school code
				</span>

				<span class="quarter centeralign">
					<input
						type = "text"
						size = "4"
						name = "first_school_code"
						value = "<% $tourn_settings->{"first_school_code"} %>"
					>
				</span>
			</div>

%			unless ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) {
				<label for="nonunique_entry_codes">
					<div class="row hover mocktrial">
						<span class="fivesixths">
							Allow duplicate codes in different events
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "nonunique_entry_codes",
								value  => $tourn_settings->{"nonunique_entry_codes"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

				<label for="avoid_others_rooms">
					<div class="row hover mocktrial">
						<span class="fivesixths">
							Do not avoid using ADA/other pools' rooms
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "avoid_others_rooms",
								value  => $tourn_settings->{"avoid_others_rooms"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

				<label for="no_school_judges">
					<div class="row hover mocktrial">
						<span class="fivesixths">
							Do not give schools the option to bring judges
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "no_school_judges",
								value  => $tourn_settings->{"no_school_judges"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			}

			<label for="no_registration_fees">
				<div class="hover row">
					<span class="fivesixths">
						No money/fees screen for schools
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag   => "no_registration_fees",
							value  => $tourn_settings->{"no_registration_fees"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="allow_dashboard_drops">
				<div class="hover row mocktrial" title="Allows self-drops during tournament">
					<span class="fivesixths">
						Allow entry drops on school dashboard
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas",
							tag	 => "allow_dashboard_drops",
							value  => $tourn_settings->{"allow_dashboard_drops"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<div class="row flexrow">
				<span class="twofifths padleft">
					Printout Paper Size
				</span>

				<span class="threefifths flexrow">
					<label
						for  = "letter"
						class = "half hover centeralign"
						title = "US 8.5x11"
					>
						Letter
						<input
							type         = "radio"
							id           = "letter"
							name         = "papersize"
							value        = "0"
							setting_name = "papersize"
							onChange     = "postSwitch(this, 'setting_switch.mhtml');"
							<% $tourn_settings->{'papersize'} eq "a4" ? "" : "checked" %>
						>
					</label>

					<label
						for  = "a4"
						class = "half hover centeralign"
						title = "Metric standard paper"
					>
						A4
						<input
							type         = "radio"
							id           = "a4"
							name         = "papersize"
							value        = "a4"
							setting_name = "papersize"
							onChange     = "postSwitch(this, 'setting_switch.mhtml');"
							<% $tourn_settings->{'papersize'} eq "a4" ? "checked" : "" %>
						>
					</label>
				</span>
			</div>
		</span>

%		if ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) {

			<div class="bluebordertop martop">
				<h5>Nationals Options</h5>
			</div>

			<span class="pagehalf">
				<label for="show_book">
					<div class="hover row">
						<span class="fivesixths">
							Show Tournament Book Online
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "show_book",
								value  => $tourn_settings->{"show_book"},
								target => $tourn,
								smaller => 1
							&>
						</span>
					</div>
				</label>

				<label for="refund_judge_bond">
					<div class="hover row">
						<span class="fivesixths">
							Option to apply refund to judge bond
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "refund_judge_bond",
								value  => $tourn_settings->{"refund_judge_bond"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%				if ($tourn_settings->{"nsda_nats"}) {
					<label for="no_autopromotion">
						<div class="hover row" title="For Nationals only">
							<span class="fivesixths">
								Suspend all alternate auto-promotion
							</span>

							<span class="sixth centeralign">
								<& "/funclib/bool_switch.mas",
									tag   => "no_autopromotion",
									value  => $tourn_settings->{"no_autopromotion"},
									target  => $tourn,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
%				}
			</span>

			<span class="pagehalf marleft">
				<label for="require_hotel_form">
					<div class="hover row">
						<span class="fivesixths">
							Require hotel information to register
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "require_hotel_form",
								value  => $tourn_settings->{"require_hotel_form"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

				<label for="require_hotel_confirmation">
					<div class="hover row">
						<span class="fivesixths">
							Require hotel confirmation number
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "require_hotel_confirmation",
								value  => $tourn_settings->{"require_hotel_confirmation"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%			if ($tourn_settings->{"nsda_nats"}) {

				<label for="show_jpools">
					<div class="hover row" title="Not just registration/signup pools">
						<span class="fivesixths">
							Show All Pools on Judge Cards
						</span>

						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas",
								tag	 => "show_jpools",
								value  => $tourn_settings->{"show_jpools"},
								target => $tourn,
								smaller => 1
							&>
						</span>
					</div>
				</label>
%			}
			</span>
%		}

		<div class="libl pagefull rightalign">
			<span class="centeralign third">
				<input
					type  = "submit"
					value = "Save Settings"
				>
			</span>
		</div>

		<h4>Online day-of registration</h4>

		<p>
			On-site registration allows schools to confirm
			online. Schools will be marked as "in" as they register.
		</p>

<%perl>

		my $onsite_starts = $tourn_settings->{"onsite_starts"};
		$onsite_starts->set_time_zone($tz) if $onsite_starts;

		my $onsite_ends = $tourn_settings->{"onsite_ends"};
		$onsite_ends->set_time_zone($tz) if $onsite_ends;

</%perl>

		<span class="pagehalf">

			<label for="onsite_registration">
				<div class="hover row">
					<span class="threequarters">
						Enable online registration system
					</span>

					<span class="quarter">
						<& "/funclib/bool_switch.mas",
							tag	 => "onsite_registration",
							value  => $tourn_settings->{"onsite_registration"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="onsite_only_paid">
				<div class="hover row">
					<span class="threequarters">
						Only paid schools may register
					</span>

					<span class="quarter">
						<& "/funclib/bool_switch.mas",
							tag	 => "onsite_only_paid",
							value  => $tourn_settings->{"onsite_only_paid"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

		</span>

		<span class="pagehalf">
			<div class="row">
				<& /funclib/datepicker.mas, id => "onsite_starts" &>

				<span class="half">
					Online registration starts
				</span>

				<span class="twotenths">
					<input
						type  = "text"
						name  = "onsite_starts"
						id    = "onsite_starts"
						size  = "8"
						value = "<% $onsite_starts ? Tab::pickerdate($onsite_starts) : "" %>">
				</span>
				<span class="twenty centeralign">
					@
				</span>
				<span class="twotenths">
					<&
						/funclib/timepicker.mas,
						name => "onsite_starts_time",
						time => $onsite_starts,
						size => "6"
					&>
				</span>
			</div>

			<& /funclib/datepicker.mas, id => "onsite_ends" &>

			<div class="row">

				<span class="half">
					Online registration ends
				</span>

				<span class="twotenths">
					<input
						type  = "text"
						name  = "onsite_ends"
						id    = "onsite_ends"
						size  = "8"
						value = "<% $onsite_ends ? Tab::pickerdate($onsite_ends) : "" %>"
					>
				</span>
				<span class="twenty centeralign">
					@
				</span>
				<span class="twotenths">
					<& /funclib/timepicker.mas,
						name => "onsite_ends_time",
						time => $onsite_ends,
						size => "6"
					&>
				</span>
			</div>
		</span>

		<& "/funclib/editor.mas", height => 192, web => 1 &>
			<h5 class="martop">
				Notes on onsite registration page
			</h5>

			<div class="row">
				<textarea
					rows = "5"
					cols = "60"
					name = "onsite_notes"
				><% $tourn_settings->{"onsite_notes"} %></textarea>
			</div>

			<h5 class="martop">
				Upload info packet to onsite registration
			</h5>

			<div class="flexrow row">
				<span class="half flexrow">
					<span class="twofifths padleft">
						Existing Packet
					</span>

					<span class="twofifths rightalign">
%					if ($tourn_settings->{"registration_packet"}) {
						<a
							class="plain full semibold bluetext"
							href="<% $Tab::s3_url %>/<% $tourn->id %>/<% $tourn_settings->{"registration_packet"} %>">
							<% $tourn_settings->{"registration_packet"} %>
						</a>
%					} else {
						<span class="inline semibold bluetext">
							None Uploaded
						</span>
%					}
					</span>
					<span class="centeralign fifth">
%					if ($tourn_settings->{"registration_packet"}) {
						<a href="packet_rm.mhtml"
							class="fa fa-sm fa-trash buttonwhite redtext"
						></a>
%					}
					</span>
				</span>

				<span class="half">
					<span class="third">
						Upload Packet
					</span>
					<span class="twothirds centeralign">
						<div class="uploader dynamic">

							<input
								type     = "file"
								name     = "regpack"
								style    = "opacity: 0;"
								onchange = "uploaderName()"
								id       = "upload"
							>

							<span
								id    = "filename"
								class = "filename"
								style = "-webkit-user-select:none;"
							>No file selected</span>

							<span
								class = "action"
								style = "-webkit-user-select: none;"
							>Choose File</span>
						</div>
					</span>
				</span>
			</div>

			<div class="libl flexrow rightalign">
				<span class="third centeralign">
					<input
						type = "submit"
						value = "Save Settings & Upload"
					>
				</span>
			</div>
		</form>
<%perl>

		unless ($district && ($person->id > 10)) {

			my @tourns = $m->comp(
				"/funclib/person_tourns.mas",
				person    => $person,
				all     => 1,
				no_districts => 1
			);

			if (@tourns) {
</%perl>
				<h4>Clone settings</h4>

				<p>
					Copies setup, events, judge categories, etc from a previous
					tournament. Do this only to a new tournament; it will
					duplicate any existing events or judge categories you may
					already have set up
				</p>

				<form
					action = "import.mhtml"
					method = "post"
				>

				<div class="even full">

					<span class="third">
						<select
							name = "clone"
							class = "fixedmost"
						>
							<option value=""></option>

%						  	foreach my $otourn (@tourns) {
%								next if $otourn->id == $tourn->id;
								<option
									value="<% $otourn->id %>"
									> <%
										$otourn->start->year
											%> <%
										substr($otourn->name,0,40)
									%> </option>
%							}

						</select>
					</span>

%					my $warn = "This option will erase all schools, options, events, judge categories, etc";
%					$warn .= " and replace them with the cloned tournament. Are you sure?";

					<label for="erase">
						<span class="fifth centeralign hover smallish">
							Erase current
							<input
								type  = "checkbox"
								name  = "erase"
								id    = "erase"
								value = "1"
								<& "/funclib/warn.mas", warn => $warn &>
							>
						</span>
					</label>

%					$warn = "This option will import entries, judges and schools from the previous tournament. Are you sure?";

					<label for="entries">
						<span class="fifth centeralign hover smallish">
							Include Entries
							<input
								type  = "checkbox"
								name  = "entries"
								id    = "entries"
								value = "1"
								<& "/funclib/warn.mas", warn => $warn &>
							>
						</span>
					</label>

					<span class="fifth rightalign">
						<input
							type  = "submit"
							value = " Clone "
							class = "thin"
						>
					</span>
				</div>
				</form>
%			}
%		}

%		if ($person->site_admin) {

			<div class='martopmore'>
				<span class="half">
					<h4 class="nospace">
						Site Admin Only Options
					</h4>
				</span>
				<span class="half explain purpletext rightalign semibold true">
					Do not cite the Deep Magic to me, Witch;
					I was there when it was written!
				</span>
			</div>

			<p>
				The options below are reserved for site admins to activate
				particular custom tournaments. Please do not enable them for
				normal tournaments, or Really Weird Shit&trade; will start happening
				to your tournament. You've been warned.
			</p>

			<div class="row flexrow">

				<span class="half hover">
					<label for="nsda_nats">
						<span class="fourfifths">
							NSDA Nationals
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "nsda_nats",
								value  => $tourn_settings->{"nsda_nats"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>

				<span class="half hover">
					<label for="nsda_ms_nats">
						<span class="fourfifths">
							NSDA Middle School Nationals
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "nsda_ms_nats",
								value  => $tourn_settings->{"nsda_ms_nats"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>
			</div>

			<div class="row flexrow">
				<span class="half hover">
					<label for="ncfl">
						<span class="fourfifths">
							NCFL Grand Nationals
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "ncfl",
								value  => $tourn_settings->{"ncfl"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>

				<span class="half hover">
					<label for="ceda_nationals">
						<span class="fourfifths">
							CEDA Nationals
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "ceda_nationals",
								value  => $tourn_settings->{"ceda_nationals"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>
			</div>

			<div class="row flexrow">
				<span class="half hover">
					<label for="wsdc">
						<span class="fourfifths">
							Worlds Schools Debate Championships
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "wsdc",
								value  => $tourn_settings->{"wsdc"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>

				<span class="half hover">
					<label for="legion">
						<span class="fourfifths">
							American Legion Oratorical Contest
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag	 => "legion",
								value  => $tourn_settings->{"legion"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>
			</div>

			<div class="row flexrow">

				<span class="half hover">
				<label for="mailing_address">
					<span class="fourfifths">
						Ask for Mailing Address
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag	 => "mailing_address",
							value  => $tourn_settings->{"mailing_address"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>

				<span class="half hover">
				<label for="nsda_billing">
					<span class="fourfifths">
						Non-nationals using NSDA Billing System
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag	 => "nsda_billing",
							value  => $tourn_settings->{"nsda_billing"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>
			</div>

			<div class="row flexrow">
				<span class="twofifths">
					NSDA District Qualifier district ID
				</span>
				<span class="tenth">
					<input
						type         = "number"
						id           = "nsda_district"
						target_id    = <% $tourn->id %>,
						name         = "nsda_district"
						setting_name = "nsda_district"
						size         = "4"
						value        = "<% $district %>"
						onChange     = "postSwitch(this, 'setting_switch.mhtml');"
					>
				</span>

				<span class="twofifths">
					NSDA District Level Override
				</span>
				<span class="tenth">
					<input
						type         = "number"
						id           = "nsda_district_level_force"
						name         = "nsda_district_level_force"
						setting_name = "nsda_district_level_force"
						target_id    = <% $tourn->id %>,
						value        = "<% $tourn_settings->{"nsda_district_level_force"} %>"
						onChange     = "postSwitch(this, 'setting_switch.mhtml');"
					>
				</span>
			</div>

			<div class="row flexrow">
				<span class="half hover">
				<label for="district_eligible">
					<span class="fourfifths">
						Entries must be NSDA Districts eligible
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag   => "district_eligible",
							value  => $tourn_settings->{"district_eligible"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>

				<span class="half hover">
				<label for="district_required">
					<span class="fourfifths">
						Entries must have attended Districts
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag   => "district_required",
							value  => $tourn_settings->{"district_required"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>
			</div>

			<div class="row flexrow">
				<span class="half hover">
					<label for="school_districts_required">
						<span class="fourfifths">
							Schools must have attended districts
						</span>
						<span class="fifth centeralign nospace">
							<& "/funclib/bool_switch.mas",
								tag   => "school_districts_required",
								value  => $tourn_settings->{"school_districts_required"},
								target => $tourn,
								smaller => 1,
							&>
						</span>
					</label>
				</span>

				<span class="half hover flexrow">
					<span class="fourfifths">
						Non-qualled supp-only freebies
					</span>
					<span class="fifth centeralign nospace">
						<input
							type         = "number"
							id           = "nsda_nonquals"
							name         = "nsda_nonquals"
							setting_name = "nsda_nonquals"
							target_id    = <% $tourn->id %>,
							size         = "5"
							value        = "<% $tourn_settings->{"nsda_nonquals"} %>"
							onChange     = "postSwitch(this, 'setting_switch.mhtml');"
						>
					</span>
				</span>
			</div>

			<div class="row hidden">
				<span class="half hover">
				<label for="nsda_online_nats">
					<span class="fourfifths">
						NSDA Online Supp Tournament
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag   => "nsda_online_nats",
							value  => $tourn_settings->{"nsda_online_nats"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>

				<span class="half hover">
				<label for="vaccines">
					<span class="fourfifths">
						Vaccines Required
					</span>
					<span class="fifth centeralign nospace">
						<& "/funclib/bool_switch.mas",
							tag   => "vaccines",
							value  => $tourn_settings->{"vaccines"},
							target => $tourn,
							smaller => 1,
						&>
					</span>
				</label>
				</span>
			</div>

%			if ($person->id == 1) {
				<div class="row flexrow">
					<span class="half hover">
						<label for="backtab">
							<span class="fourfifths">
								Backtab Tournament
							</span>
							<span class="fifth centeralign nospace">
								<& "/funclib/bool_switch.mas",
									tag     => "backtab",
									value   => $tourn_settings->{"backtab"},
									target  => $tourn,
									smaller => 1,
								&>
							</span>
						</label>
					</span>

					<span class="half hover">
						<label for="nein">
						</label>
					</span>
				</div>
%			}

			<p class='smaller italic rightalign bluetext'>
				*Really Weird Shit&trade; isn't a registered trademark of
				Tabroom.com, but it might as well be, so just roll with it.
			</p>
%		}

	</div>

