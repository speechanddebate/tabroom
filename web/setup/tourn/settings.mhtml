<%args>
	$tourn
	$person
	$tourn_settings
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $district = $tourn_settings->{"nsda_district"};

</%init>

	<div class="main">
	
		<h2><% $tourn->name %></h2>

		<& tabbar.mas, 
			tourn          => $tourn,
			tourn_settings => $tourn_settings,
			whoami         => "settings"
		&>

		<h4>General Settings</h4>
		
		<form 
			enctype  = "multipart/form-data"
			name     = "regpack"
			action   = "settings_save.mhtml"
			method   = "post">

		<input 
			type  = "hidden"
			name  = "tourn_id"
			value = "<% $tourn->id %>">

		<span class="pagehalf">

			<div class="hover row">

				<label for="require_adult_contact">

					<span class="fivesixth">
						Require adult contact info to register
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "require_adult_contact"
							name  = "require_adult_contact"
							value = "1"
							<% $tourn_settings->{"require_adult_contact"} ? "checked" : "" %> >
					</span>

				</label>

			</div>

%			if ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) { 

				<div class="hover row">

					<label for="require_hotel_form">

						<span class="fivesixth">
							Require hotel information to register
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "require_hotel_form"
								name  = "require_hotel_form"
								value = "1"
								<% $tourn_settings->{"require_hotel_form"} ? "checked" : "" %> >
						</span>

					</label>

				</div>

%			}

			<div class="hover row">

				<label for="track_reg_changes">

					<span class="fivesixth">
						Log registration changes
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "track_reg_changes"
							name  = "track_reg_changes"
							value = "1"
							<% $tourn_settings->{"track_reg_changes"} ? "checked" : "" %>
						>
					</span>
				</label>
			</div>
			
			<div class="hover row">

				<label for="hide_codes">

					<span class="fivesixth">
						Hide Speaker Codes from Registrants
					</span>

					<span class="sixth centeralign">
						<input 
							id    = "hide_codes"
							type  = "checkbox"
							name  = "hide_codes"
							value = "1"
							<% $tourn_settings->{"hide_codes"} ? 'checked="checked"' : "" %> 
						>
					</span>

				</label>

			</div>

%			unless ($district) { 

				<div class="hover row">

					<label for="closed_entry">

						<span class="fivesixth">
							Closed tournament: admin staff registers
						</span>

						<span class="sixth centeralign">
							<input 
								id    = "closed_entry"
								type  = "checkbox"
								name  = "closed_entry"
								value = "1"
								<% $tourn_settings->{"closed_entry"} ? "checked" : "" %>
							>
						</span>
					</label>
				</div>
%			}
			

			<div class="hover row">

				<label for="hidden">

					<span class="fivesixth">
						Test tournament, not public.
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "hidden"
							name  = "hidden"
							value = "1"
							<% $tourn->hidden ? "checked" : "" %>
						>
					</span>

				</label>

			</div>

			<div class="hover row">

				<label for="no_waitlist_double_entry">
					<span class="fivesixths smallish">
						Waitlist entries still trigger double entry limits
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "no_waitlist_double_entry"
							name  = "no_waitlist_double_entry"
							value = "1"
							<% $tourn_settings->{"no_waitlist_double_entry"} ? "checked" : "" %>
						>
					</span>
				</label>
			</div>

%			if ($tourn_settings->{"ncfl"}) { 
				<div class="hover row">

					<label for="ncfl_codes">
						<span class="fivesixth">
							Post Entry Codes by Diocese
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "ncfl_codes"
								name  = "ncfl_codes"
								value = "1"
								<% $tourn_settings->{"ncfl_codes"} ? "checked" : "" %>
							>
						</span>
					</label>
				</div>
%			}

%			unless ($district) { 

				<div class="hover row">

					<label for="googleplus">
						<span class="fivesixth">
							Require Google Hangout Accounts
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "googleplus"
								name  = "googleplus"
								value = "1"
								<% $tourn_settings->{"googleplus"} ? "checked" : "" %>
							>
						</span>
					</label>
				</div>
%			}
		
		</span>	

		<span class="pagehalf">

%			unless ($district) { 

				<div class="hover row">
					<label for="refund_information">
						<span class="fivesixth">
							Ask for refund information
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "refund_information"
								name  = "refund_information"
								value = "1"
								<% $tourn_settings->{"refund_information"} ? "checked" : "" %> 
							>
						</span>
					</label>

					<label for="enable_credit" 
						id="enable_credit_box"
						class=<% $tourn_settings->{"refund_information"} ? "smallish" : "hidden smallish" %>
						>
						<span class="padleftmore padrightmore twothird">
							Offer credit for next year?
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "enable_credit"
								name  = "enable_credit"
								value = "1"
								<% $tourn_settings->{"enable_credit"} ? "checked" : "" %> 
							>
						</span>
					</label>
				</div>


%				if ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_ms_nats"}) { 

					<div class="hover row">

						<label for="refund_judge_bond">
							<span class="fivesixth">
								Option to apply refund to judge bond
							</span>

							<span class="sixth centeralign">
								<input 
									type  = "checkbox"
									id    = "refund_judge_bond"
									name  = "refund_judge_bond"
									value = "1"
									<% $tourn_settings->{"refund_judge_bond"} ? "checked" : "" %> 
								>
							</span>
						</label>
					</div>

					<div class="hover row">

						<label for="nsda_members_only">

							<span class="fivesixth">
								NSDA Paid Members only
							</span>

							<span class="sixth centeralign">
								<input 
									type  = "checkbox"
									id    = "nsda_members_only"
									name  = "nsda_members_only"
									value = "1"
									<% $tourn_settings->{"nsda_members_only"} ? "checked" : "" %> 
								>
							</span>
						</label>
					</div>

%				}

%			}

			<div class="hover row">
				<label for="publish_schools">
					<span class="fivesixth">
						Publish list of registered schools
					</span>

					<span class="sixth centeralign">
						<input 
							type  = "checkbox"
							id    = "publish_schools"
							name  = "publish_schools"
							value = "1"
							<% $tourn_settings->{"publish_schools"} ? "checked" : "" %>
						>
					</span>
				</label>
			</div>

%			unless ($district) { 

				<div class="hover row">
					<label for="regions">
						<span class="fivesixth">
							Use school regions
						</span>

						<span class="sixth centeralign">
							<input 
								type  = "checkbox"
								id    = "regions"
								name  = "regions"
								value = "1"
								<% $tourn_settings->{"regions"} ? "checked" : "" %>
							>
						</span>
					</label>
				</div>
			
				<div class="row">

					<label for="overall_cap">
						<span class="threequarter">
							Tournament-wide cap on entries
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "number"
								id    = "overall_cap"
								name  = "overall_cap"
								size  = "5"
								class = "smaller"
								value = "<% $tourn_settings->{"overall_cap"} %>"
							>
						</span>
					</label>
				</div>

%			}

			<div class="row">
				<span class="twofifth">
					School code style
				</span>

				<span class="threefifth rightalign">

					<select name="school_codes" class="fixedmed"> 

						<option 
							value="incremental" 
							<% $tourn_settings->{'school_codes'} eq "incremental" ? "selected" : "" %> >
								Incremental (AA, AB, AC...)
						</option>

						<option 
							value="circuit" 
							<% $tourn_settings->{'school_codes'} eq "circuit" ? "selected" : "" %> >
							Circuit codes
						</option>

						<option 
							value="shortname" 
							<% $tourn_settings->{'school_codes'} eq "shortname" ? "selected" : "" %> >
							Shorten school name
						</option>

						<option 
							value="registrant" 
							<% $tourn_settings->{'school_codes'} eq "registrant" ? "selected" : "" %> >
							Registrant choice
						</option>

						<option 
							value="none" 
							<% $tourn_settings->{'school_codes'} eq "none" ? "selected" : "" %> >
							None
						</option>

					</select>
				</span>
			</div>

			<div class="row">
				<span class="threequarter">
					First school code:
				</span>

				<span class="quarter centeralign">
					<input 
						type  = "text"
						size  = "4"
						name  = "first_school_code"
						value = "<% $tourn_settings->{"first_school_code"} %>"
					>
				</span>
			</div>

			<div class="row">
				<span class="padsetting third">
					&nbsp;
				</span>
			</div>

<%doc>
	DO NOT ENABLE THE BELOW -- it will change methods but not the tiebreakers and other required settings. .
</%doc>

%			if (1 == 2 && $tourn_settings->{"nsda_district"}) { 

				<div class="row">

					<span class="half">
						NSDA Speech Method:
					</span>

					<span class="half">

						<select name="nsda_speech_method" class="fixedsmall">

							<option 
								value="doubledown"
								<% $tourn_settings->{"nsda_speech_method"} eq "doubledown"
									? 'selected="selected"' : "" %>
							>Up/Downs</option>

							<option 
								value="california_3"
								<% $tourn_settings->{"nsda_speech_method"} eq "california_3"
									? 'selected="selected"' : "" %>
							>California Plan</option>

							<option 
								value="california_2"
								<% $tourn_settings->{"nsda_speech_method"} eq "california_2"
									? 'selected="selected"' : "" %>
							>California Plan (2 Judges)</option>
						</select>

					</span>

				</div>

%			}

		</span>

		<div class="libl full marvertno rightalign">
			<input 
				type  = "submit"
				value = "Save Settings"
			>
		</div>

		<h4>Online on-site registration</h4>

		<p>
			On-site registration allows schools to check their registration
			online and confirm they are on site.  Schools will be marked as
			"in" as they register.
		</p>

<%perl>

		my $onsite_starts = $tourn_settings->{"onsite_starts"};
		$onsite_starts->set_time_zone($tz) if $onsite_starts;

		my $onsite_ends = $tourn_settings->{"onsite_ends"};
		$onsite_ends->set_time_zone($tz) if $onsite_ends;

</%perl>

		<span class="pagehalf">

			<div class="hover row">

				<label for="onsite_registration">

					<span class="threequarter">
						Enable online registration system
					</span>

					<span class="quarter">
						<input 
							type  = "checkbox"
							name  = "onsite_registration"
							id    = "onsite_registration"
							value = "1"
							<% $tourn_settings->{"onsite_registration"} ? 'checked="checked"' : "" %>>
					</span>
				</label>
			</div>

			<div class="hover row">
				<label for="onsite_only_paid">
					<span class="threequarter">
						Only paid schools may register
					</span>

					<span class="quarter">
						<input 
							type  = "checkbox"
							name  = "onsite_only_paid"
							id    = "onsite_only_paid"
							value = "1" 
							<% $tourn_settings->{"onsite_only_paid"} ? 'checked = "checked"' : "" %>
						>
					</span>
				</label>
			</div>

			<div class="row">
				
				<span class="twofifths padsetting">
					Registration Packet:
				</span>

				<span class="threefifths rightalign"> 
%				if ($tourn_settings->{"registration_packet"}) { 
					<a 
						class="plain full semibold bluetext" 
						href="<% $Tab::s3_url %>/<% $tourn->id %>/<% $tourn_settings->{"registration_packet"} %>">
						<% $tourn_settings->{"registration_packet"} %>
					</a>
%				} else { 
					<span class="inline semibold bluetext">
						None
					</span>
%				}
				</span>
			</div>

		</span>

		<span class="pagehalf">

			<div class="row">

				<& /funclib/datepicker.mas, id => "onsite_starts" &>

				<span class="half">
					Online registration starts
				</span>

				<span class="half centeralign">
					<input 
						type  = "text"
						name  = "onsite_starts"
						id    = "onsite_starts"
						size  = "8"
						value = "<% $onsite_starts ? Tab::pickerdate($onsite_starts) : "" %>">
						@ 

					<& 
						/funclib/timepicker.mas, 
						name => "onsite_starts_time", 
						time => $onsite_starts, 
						size => "6" 
					&>
				</span>

			</div>

			<& /funclib/datepicker.mas, id => "onsite_ends" &>

			<div class="row">

				<span class="half">
					Online registration ends
				</span>

				<span class="half centeralign">

					<input 
						type  = "text"
						name  = "onsite_ends"
						id    = "onsite_ends"
						size  = "8"
						value = "<% $onsite_ends ? Tab::pickerdate($onsite_ends) : "" %>">
						@	

					<& /funclib/timepicker.mas, 
						name => "onsite_ends_time",
						time => $onsite_ends,
						size => "6"
					&>
				</span>

			</div>

			<div class="row">

				<span class="twofifths padsetting">
					Upload Packet
				</span>

				<span class="threefifths rightalign nospace">
					<div class="uploader thinner">

						<input 
							type  = "file"
							name  = "regpack"
							style = "opacity: 0;" onchange = "uploaderName()"
							id    = "upload">

						<span 
							id="filename" 
							class="filename" 
							style="-webkit-user-select: none;"
						>No file selected</span>

						<span 
							class="action" 
							style="-webkit-user-select: none;"
						>Choose File</span>

					</div>
				</span>
			</div>

		</span>

		<div class="libl full marvertno rightalign">
			<input type="submit" value="Save Settings & Upload">
			</form>
		</div>

<%perl>

		unless ($district) { 

			my @tourns = $m->comp(
				"/funclib/person_tourns.mas", 
				person => $person,
				all    => 1
			);

			if (@tourns) { 

</%perl>

				<h4>Copy settings</h4>

				<p>
					Copies setup, events, judge categories, etc from a previous
					tournament.  Do this only to a new tournament; it will
					duplicate any existing events or judge categories you may
					already have set up
				</p>

				<form action="import.mhtml" method="post">
				
				<div class="even full nospace">

					<span class="third">

						<select name="clone" class="fixedmed chosen">

							<option value="">None: Create tournament from scratch</option>

%						   	foreach my $otourn (@tourns) { 

%								next if $otourn->id == $tourn->id;
								<option 
									value="<% $otourn->id %>"
									> <% 
										$otourn->start->year 
											%> <% 
										substr($otourn->name,0,40) 
									%> </option>
%							}   

						</select>
					</span>

%					my $warn = "This option will erase all schools, options, events, judge categories, etc and replace them with the cloned tournament.  Are you sure?";

					<label for="erase">

						<span class="fifth centeralign hover smallish marno">

							Erase current

							<input 
								type="checkbox" 
								name="erase" 
								id="erase" 
								value="1" 
								<& "/funclib/confirm.mas", warn => $warn &> 
							> 

						</span>
					</label>

%					$warn = "This option will import the previous tournament's	entries, judges and schools.  Are you sure?";

					<label for="entries">

						<span class="fifth centeralign hover smallish marno">

							Include Entries

							<input 
								type  = "checkbox"
								name  = "entries"
								id    = "entries"
								value = "1"
								<& "/funclib/confirm.mas", warn => $warn &> 
							> 
						</span>
					</label>

					<span class="fifth rightalign">
						<input 
							type  = "submit"
							value = " Clone "
							class = "thin"
						>
					</span>

				</div>
				</form>
%			}   

%		}

%		if ($person->site_admin) { 
		
			<br />

			<h4>Rarely Used Options</h4>

			<p>
				The options below are reserved for site admins to activate
				particular custom tournaments. Please do not enable them or
				Really Weird Things will start happening to your tournament.
				You've been warned.
			</p>

			<form action="rare_settings_save.mhtml" method="post">

			<input 
				type  = "hidden"
				name  = "tourn_id"
				value = "<% $tourn->id %>"
			>

				<div class="row">

					<label for="ncfl">

						<span class="twofifths">
							NCFL Grand Nationals
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "ncfl"
								name  = "ncfl"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"ncfl"} ? 'checked="checked"' : "" %>>
						</span>
					</label>

					<label 
						for   = "nsda_nats"
					>
				
						<span class="twofifths">
							NSDA Nationals
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "nsda_nats"
								name  = "nsda_nats"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"nsda_nats"} ? 'checked="checked"' : "" %>
							>
						</span>
					</label>

				</div>

				<div class="row">

					<label for="nsda_ms_nats">
				
						<span class="twofifths">
							NSDA Middle School Nationals
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "nsda_ms_nats"
								name  = "nsda_ms_nats"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"nsda_ms_nats"} ? 'checked="checked"' : "" %>
							>
						</span>
						
					</label>

					<label for="pkd">
				
						<span class="twofifths">
							Pi Kappa Delta Nationals
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "pkd"
								name  = "pkd"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"pkd"} ? 'checked="checked"' : "" %>>
						</span>
						
					</label>
				</div>

				<div class="row">

					<label for="wsdc">
				
						<span class="twofifths">
							Worlds Schools Debate Championships
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "wsdc"
								name  = "wsdc"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"wsdc"} ? 'checked="checked"' : "" %>>
						</span>
						
					</label>

					<label for="legion">
				
						<span class="twofifths">
							American Legion Oratorical Contest
						</span>
				
						<span class="tenth">
							<input 
								type  = "checkbox"
								id    = "legion"
								name  = "legion"
								size  = "5"
								value = "1"
								<% $tourn_settings->{"legion"} ? 'checked="checked"' : "" %>>
						</span>
						
					</label>
				</div>

				<div class="row">

					<span class="twofifths">
						NSDA District Qualifier for:
					</span>
			
					<span class="tenth">
						<input 
							type  = "number"
							id    = "nsda_district"
							name  = "nsda_district"
							size  = "5"
							value = "<% $district %>"
						>
					</span>

					<span class="twofifths">
						NSDA District Level Override:
					</span>
			
					<span class="tenth">
						<input 
							type  = "number"
							id    = "nsda_district_level_force"
							name  = "nsda_district_level_force"
							size  = "5"
							value = "<% $tourn_settings->{"nsda_district_level_force"} %>"
						>
					</span>
							
				</div>

				<div class="libl full marvertno rightalign">
					<input 
						class = "thin"
						type  = "submit"
						value = "I have read the above warning.  Save these weird settings anyway."
					>
					</form>
				</div>

%		}

	</div>
		
