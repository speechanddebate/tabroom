<%args>
	$dbh
	$tourn
	$person
	$circuit_id   => undef
	$circuit_name => undef
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	my $logmsg = "Removed tournament from circuit $circuit_name";

	my $circuit_rm = $dbh->prepare("
		delete tc.*
		from tourn_circuit tc
		where tc.tourn = ?
		and tc.circuit = ?
	");

	$circuit_rm->execute($tourn->id, $circuit_id);

    $m->comp("/funclib/log.mas",
		type        => "tabbing",
		tourn       => $tourn->id,
		person      => $person->id,
		destroy     => $circuit_id,
		description => $logmsg
	);

	my $response = {
		message => $logmsg,
		destroy => $circuit_id,
		error => \0,
	};

    $m->print(JSON::encode_json($response));
	$m->abort();

</%init>
