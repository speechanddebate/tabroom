<%args>
	$tourn
	$ncfl          => 0
	$usa_wsdc      => 0
	$wsdc          => 0
	$nsda_nats     => 0
	$nsda_ms_nats  => 0
	$nsda_district => 0
	$student_claim => 0
</%args>
<%init> 

	$tourn->setting("ncfl", $ncfl);
	$tourn->setting("usa_wsdc", $usa_wsdc);
	$tourn->setting("wsdc", $wsdc);
	$tourn->setting("nsda_nats", $nsda_nats);
	$tourn->setting("nsda_ms_nats", $nsda_ms_nats);
	$tourn->setting("nsda_district", $nsda_district);
	$tourn->setting("student_claim", $student_claim);

	if ($ncfl) { 
		unless (Tab::TournCircuit->search( tourn => $tourn, circuit => 3)) { 
			Tab::TournCircuit->create({
				tourn    => $tourn,
				circuit  => 3,
				approved => 1
			});
		}

	} else { 
		foreach my $tc (Tab::TournCircuit->search( tourn => $tourn, circuit => 3)) { 
			$tc->delete;
		}
	}

	if ($usa_wsdc || $wsdc) { 

		unless (Tab::TournCircuit->search( tourn => $tourn, circuit => 120)) { 
			Tab::TournCircuit->create({
				tourn    => $tourn,
				circuit  => 120,
				approved => 1
			});
		}

	} else { 
		foreach my $tc (Tab::TournCircuit->search( tourn => $tourn, circuit => 120)) { 
			$tc->delete;
		}
	}

	if ($nsda_nats || $usa_wsdc)  {

		unless (Tab::TournCircuit->search( tourn => $tourn, circuit => 83)) { 
			Tab::TournCircuit->create({
				tourn    => $tourn,
				circuit  => 83,
				approved => 1
			});
		}
	} else { 

		foreach my $tc (Tab::TournCircuit->search( tourn => $tourn, circuit => 83)) { 
			$tc->delete;
		}

	}

	if ($nsda_ms_nats) { 

		unless (Tab::TournCircuit->search( tourn => $tourn, circuit => 25)) { 
			Tab::TournCircuit->create({
				tourn    => $tourn,
				circuit  => 25,
				approved => 1
			});
		}
	} else { 

		foreach my $tc (Tab::TournCircuit->search( tourn => $tourn, circuit => 25)) { 
			$tc->delete;
		}

	}

	my $msg = "Excessively Rare Tournament settings saved";

	$m->redirect("settings.mhtml?msg=$msg");

</%init> 

