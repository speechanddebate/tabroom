<%args>
	$tourn
</%args>
<%init>

	my @settings = (
		"ncfl",
		"wsdc",
		"pkd",
		"legion",
		"nsda_nats",
		"nsda_ms_nats",
		"nsda_billing",
		"mailing_address",
		"nsda_district",
		"nsda_tourn_id",
		"nsda_district_level_force"
	);

	foreach my $setting (@settings) {

		if ($ARGS{$setting}) {
			$tourn->setting($setting, $ARGS{$setting});
		} else {
			$tourn->setting($setting, 0);
		}
	}

	# Put the rare tournaments into the rare circuits

	circuit_me(\%ARGS, $tourn, "ncfl", 3);
	circuit_me(\%ARGS, $tourn, "wsdc", 120);
	circuit_me(\%ARGS, $tourn, "nsda_nats", 83, "nsda_district");
	circuit_me(\%ARGS, $tourn, "pkd", 126);
	circuit_me(\%ARGS, $tourn, "nsda_ms_nats", 25);

	sub circuit_me {

		my ($args, $tourn, $tag, $circuit_id, $tag2)  = @_;

		my @exists = Tab::TournCircuit->search(
			tourn   => $tourn->id,
			circuit => $circuit_id
		);

		if ($args->{$tag} || $args->{$tag2} )  {

			unless (@exists) {

				Tab::TournCircuit->create({
					tourn    => $tourn->id,
					circuit  => $circuit_id,
					approved => 1
				});
			}

		} else {

			foreach my $exist (@exists) {
				$exist->delete;
			}
		}
	}


	my $msg = "Excessively Rare Tournament settings saved";

	$m->redirect("settings.mhtml?msg=$msg");

</%init>

