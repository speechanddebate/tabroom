<%args>
	$tourn
	$tourn_settings
	$person
	$person_settings
	$perms
	$event_id => undef
	$add      => undef
	$err      => undef
	$tz       => undef
</%args>
<%init>

	$tz = $tourn->tz unless $tz;

 	my @categories = sort{$a->name cmp $b->name} $tourn->categories;
	my $event = Tab::Event->retrieve($event_id) if $event_id;

	if (scalar $tourn->events == 1 && not defined $add) {
		$event = $tourn->events->first;
	}

	$m->abort unless $event;
	my %event_settings = $event->all_settings;

	if ($event) {
		unless ($event->category) {
			my $err = "You must select a judge category before continuing";
			$m->redirect("edit.mhtml?event_id=".$event->id."&err=$err");
		}
	}

	my $districts = $tourn_settings->{"nsda_district"};

</%init>

	<div class="main">

		<h2><% $event->name %></h2>

		<&
			"tabbar.mas",
			districts       => $districts,
			event           => $event,
			tourn           => $tourn,
			person          => $person,
			person_settings => $person_settings,
			tourn_settings  => $tourn_settings,
			whoami          => "register"
		&>

			<form
				action   = "register_save.mhtml"
				method   = "post"
				enctype  = "multipart/form-data"
			>

			<input
				type  = "hidden"
				name  = "event_id"
				value = "<% $event->id %>"
			>

<%perl>
			if (
				( (not defined $districts) || $person->site_admin)
				&& (not defined $tourn_settings->{"nsda_nats"})
			) {
</%perl>

				<span class="twofifths nospace">
					<h5 class="button">
						Event Specific Deadlines
					</h5>
				</span>

				<span class="threefifths rightalign semibold redtext nospace">
					These only work if they're EARLIER than the tournament-wide deadlines
				</span>

				<div class="odd full marno padless">

					<span class="pagehalf">
						<span class="twofifths">
							New Entries Due
						</span>

						<span class="third">

%							my $deadline = $event_settings{"deadline"} unless $add;
%							$deadline->set_time_zone($tz) if $deadline;

							<&
								"/funclib/datepicker.mas",
								id  => "deadline",
								max => $tourn->end
							&>

							<input
								type        = "text"
								name        = "deadline"
								id          = "deadline"
								placeholder = "Date.."
								size        = "12"
								value       = "<% ($deadline) ?  $deadline->mdy('/') : "" %>"
							>
						</span>

						<span class="quarter true">
							@
							<&
								"/funclib/timepicker.mas",
								name        => "deadlinetime",
								time        => $deadline,
								size        => 8,
								placeholder => "Time..."
							&>
						</span>

					</span>

					<span class="pagehalf padleft">

						<span class="third">
							Fee/Judge Freeze
						</span>

						<span class="third">

%							my $freeze_deadline = $event_settings{"freeze_deadline"} unless $add;
%							$freeze_deadline->set_time_zone($tz) if $freeze_deadline;

							<&
								"/funclib/datepicker.mas",
								id  => "freeze_deadline",
								max => $tourn->end
							&>

							<input
								type        = "text"
								name        = "freeze_deadline"
								id          = "freeze_deadline"
								placeholder = "Date.."
								size        = "12"
								value       = "<% ($freeze_deadline) ?  $freeze_deadline->mdy('/') : "" %>"
							>
						</span>

						<span class="threetenths padleftless">
							@
							<&
								"/funclib/timepicker.mas",
								name        => "freeze_deadlinetime",
								time        => $freeze_deadline,
								size        => 8,
								placeholder => "Time..."
							&>
						</span>

					</span>

				</div>

				<div class="even padless full marno">

					<span class="pagehalf">

						<span class="twofifths">
							Fine on Drops After
						</span>

						<span class="third">
%							my $fine_deadline = $event_settings{"fine_deadline"} unless $add;
%							$fine_deadline->set_time_zone($tz) if $fine_deadline;

							<&
								"/funclib/datepicker.mas",
								id  => "fine_deadline",
								max => $tourn->end
							&>

							<input
								type        = "text"
								name        = "fine_deadline"
								id          = "fine_deadline"
								placeholder = "Date.."
								size        = "12"
								value       = "<% ($fine_deadline) ?  $fine_deadline->mdy('/') : "" %>"
							>
						</span>

						<span class="quarter true">
							@
							<&
								"/funclib/timepicker.mas",
								name        => "fine_deadlinetime",
								time        => $fine_deadline,
								size        => 8,
								placeholder => "Time..."
							&>
						</span>

					</span>

					<span class="pagehalf padleft">
						<span class="seventenths true nospace">
							Event Specific Nuisance Fine for Drops
						</span>
						<span class="quarter nospace padvertless">
							<% $tourn_settings->{"currency"} %>
							<input
								type  = "text"
								class = "thin"
								name  = "drop_fine"
								size  = "8"
								value = "<% $event_settings{"drop_fine"} %>"
							>
						</span>
					</span>

				</div>
%			}

			<div class="truefull nospace martop">

			<span class="pagehalf">

				<h5 class="button">
					Registration Settings
				</h5>

%				my $code_style = $event_settings{'code_style'};

%				if ($code_style eq "numbers" || $code_style eq "school_number") {
					<div class=" row fixedflex">
						<span class="threequarters">
							Start Speaker Codes With
						</span>

						<span class="quarter centeralign">
							<input
								type  = "text"
								class = "thin"
								name  = "code_start"
								value = "<% $event_settings{"code_start"} %>"
								size  = "5"
							>
						</span>
					</div>
%				}

%				if ($tourn_settings->{"nsda_nats"}) {

					<label for="reveal_codes">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Reveal Codes to Coaches
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "reveal_codes",
									value   => $event_settings{"reveal_codes"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="supp">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Supplemental Event
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "supp",
									value   => $event_settings{"supp"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="conn">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Consolation Event
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "conn",
									value   => $event_settings{"conn"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="stefan">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Supplemental without pre-registration
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "stefan",
									value   => $event_settings{"stefan"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="no_autopromotion">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Suspend auto-promotion of alternates
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "no_autopromotion",
									value   => $event_settings{"no_autopromotion"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

%					if ($event->type eq "wsdc") {

						<div class=" row fixedflex">
							<span class="threequarters">
								Per District Cap
							</span>

							<span class="quarter centeralign">
								<input
									id    = 'district_cap'
									type  = "text"
									class = "thin"
									name  = "district_cap"
									size  = "5"
									value = "<% $event_settings{"district_cap"} %>"
								>
							</span>
						</div>
%					}

					<h5 class="button">
						NSDA Judge Burdens
					</h5>

					<label for="nats_judge_burden">
						<div class="hover  row fixedflex">
							<span class="threequarter">
								Days per entry
							</span>

							<span class="quarter centeralign">
								<input
									type  = "number"
									id    = "nats_judge_burden"
									name  = "nats_judge_burden"
									min   = 0
									step  = .01
									max   = 99
									value = "<% $event_settings{"nats_judge_burden"} %>"
								>
							</span>
						</div>
					</label>

					<div class="hover  row fixedflex">
						<span class="half">
							Judge registration pool
						</span>

						<span class="half rightalign">
							<select name="nats_jpool">
								<option value=""></option>
<%perl>
								foreach my $pool (
									$m->comp("/funclib/category_jpools.mas",
										category => $event->category,
										limit    => "registrant"
									)
								) {
</%perl>
									<option
										value="<% $pool->id %>"
										<% $pool->id == $event_settings{"nats_jpool"}
											?  "selected='selected'"
											: ""
									%>><% $pool->name %></option>
%								}

							</select>
						</span>
					</div>

<%doc>
					# No longer a thing after the great conversion to Days judging -- CLP 2/2020
					<label for="nats_screwy_burden">
						<div class="hover  row fixedflex">
							<span class="threequarter">
								Screwy PF style judge burden
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "nats_screwy_burden",
									value   => $event_settings{"nats_screwy_burden"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
</%doc>
%				}

%				unless ($tourn_settings->{"nsda_nats"}) {
%					if ( (not defined $districts) || $person->site_admin) {
%						if ($event_settings{'max_entry'} > 1) {
							<label for="hybrids">
								<div class="hover  row fixedflex">
									<span class="threequarters">
										Allow hybrid entries (2+ schools)
									</span>
									<span class="quarter centeralign">
										<& "/funclib/bool_switch.mas",
											tag     => "hybrids",
											value   => $event_settings{"hybrids"},
											target  => $event,
											smaller => 1,
										&>
									</span>
								</div>
							</label>
%						}

%						if ($event->type eq "speech") {
							<label for="enter_me_twice">
								<div class="hover  row fixedflex">
									<span class="threequarters">
										Allow double entry within event
									</span>
									<span class="quarter centeralign">
										<& "/funclib/bool_switch.mas",
											tag     => "enter_me_twice",
											value   => $event_settings{"enter_me_twice"},
											target  => $event,
											smaller => 1,
										&>
									</span>
								</div>
							</label>
<%perl>
						}
					}
				}
</%perl>

				<label for="field_report">
					<div class="hover  row fixedflex">
						<span class="threequarter">
							Publish field report/entry list on web
						</span>
						<span class="quarter centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "field_report",
								value   => $event_settings{"field_report"},
								target  => $event,
								smaller => 1,
							&>
						</span>
					</div>
				</label>


				<script>

					function waitlistExists() {

						var exists;

						if (
							$("#school_cap").val() > 0
							|| $("#total_cap").val() > 0
						) {
							$(".nocap_options").addClass('hidden');
						} else {
							$(".nocap_options").removeClass('hidden');
						}

						if (
							$("#school_cap").val() > 0
							|| $("#total_cap").val() > 0
							|| $("#waitlist").prop("checked")
						) {
							$(".waitlist_options").removeClass('hidden');
						} else {
							$(".waitlist_options").addClass('hidden');
						}

						zebraRows();
					}

					$(document).ready(function() {
						waitlistExists();
					});
				</script>

<%perl>
				unless ($tourn_settings->{"nsda_nats"}) {

					if (
						(not defined $districts)
						|| $event_settings{"nsda_event_category"} == 108
						|| $person->site_admin
					) {
</%perl>

						<h5 class="button">
							Caps &amp; Waitlists
						</h5>

						<div class=" row fixedflex">
							<span class="threequarters">
								Event-Wide Cap
							</span>

							<span class="quarter centeralign">
								<input
									id       = "total_cap"
									type     = "text"
									class    = "thin"
									name     = "cap"
									onChange = "waitlistExists();"
									size     = "5"
									value    = "<% $event_settings{"cap"} %>"
								>
							</span>
						</div>

						<div class=" row fixedflex">
							<span class="threequarters">
								Per-School Cap
							</span>
							<span class="quarter centeralign">
								<input
									id       = "school_cap"
									type     = "text"
									class    = "thin"
									name     = "school_cap"
									onChange = "waitlistExists();"
									size     = "5"
									value    = "<% $event_settings{"school_cap"} %>"
								>
							</span>
						</div>
<%perl>
					}
				}

				unless ($tourn_settings->{"nsda_nats"}) {

					if ( (not defined $districts) || $person->site_admin) {
</%perl>
						<label for="waitlist">
							<div class="hover  row fixedflex">
								<span class="threequarters">
									Maintain a waitlist even without caps
								</span>

								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "waitlist",
										value   => $event_settings{"waitlist"},
										target  => $event,
										function => "waitlistExists();",
										smaller => 1,
									&>
								</span>
							</div>
						</label>

						<label for="waitlist_all">
							<div class="hover  row fixedflex waitlist_options">
								<span class="threequarters">
									Waitlist all entries
								</span>

								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag      => "waitlist_all",
										value    => $event_settings{"waitlist_all"},
										target   => $event,
										function => "waitlistExists();",
										smaller  => 1,
									&>
								</span>
							</div>
						</label>
%					}

					<label for="no_waitlist">
						<div class="hover  row fixedflex waitlist_options">
							<span class="threequarter">
								Disable waitlist for entries beyond caps
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "no_waitlist",
									value   => $event_settings{"no_waitlist"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

%					if ( (not defined $districts) || $person->site_admin) {
						<label for="waitlist_rank">
							<div class="hover  row fixedflex waitlist_options">
								<span class="threequarters">
									Ask registrants to rank waitlist priorities
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "waitlist_rank",
										value   => $event_settings{"waitlist_rank"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>

						<label for="field_waitlist">
							<div class="hover  row fixedflex waitlist_options">
								<span class="threequarters">
									Include waitlist on field reports
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "field_waitlist",
										value   => $event_settings{"field_waitlist"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>

						<label for="always_tba">
							<div class="hover  row fixedflex nocap_options">
								<span class="threequarters">
									Accept TBA entries even without caps
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "always_tba",
										value   => $event_settings{"always_tba"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>
%					}
%				}

				</span>
				<span class="pagehalf right">

%				unless ($tourn_settings->{"nsda_nats"}) {

					<h5 class="button">Entry Details</h5>

					<label for="code_hide">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Hide entry codes at registration
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "code_hide",
									value   => $event_settings{"code_hide"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
%				}

%				if ($districts && $event->abbr eq "HSE") {

					<div class=" row fixedflex">
						<span class="threequarter">
							Number of House chambers:
							<br />
							<span class="explain">
								Specify at Districts to enable House chamber assignments
							</span>
						</span>

						<span class="quarter centeralign">
							<input
								type  = "number"
								name  = "house_chambers"
								min   = "1"
								max   = "99"
								value = "<%
									$event_settings{"house_chambers"}
									?  $event_settings{"house_chambers"}
									: 1
								%>"
							>
						</span>
					</div>
%				}

%				if ($event->type eq "speech") {

					<h5 class="button">Piece Information</h5>

					<label for="ask_for_titles">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Ask for piece titles
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_titles",
									value   => $event_settings{"ask_for_titles"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="ask_for_authors">
						<div class="hover  row fixedflex">
							<span class="threequarter">
								Ask for piece authors
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_authors",
									value   => $event_settings{"ask_for_authors"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="ask_for_publication">
						<div class="hover  row fixedflex">
							<span class="threequarter">
								Ask for publication information
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_publication",
									value   => $event_settings{"ask_for_publication"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="ask_for_bibliography">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Ask for piece bibliography
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_bibliography",
									value   => $event_settings{"ask_for_bibliography"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="ask_for_topic">
						<div class="hover  row fixedflex">
							<span class="threequarter">
								Ask for speech topics
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_topic",
									value   => $event_settings{"ask_for_topic"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="ask_for_videos">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Ask for video links (async/backup)
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_videos",
									value   => $event_settings{"ask_for_videos"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

					<label for="disable_video_link">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Turn off video link submissions
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "disable_video_link",
									value   => $event_settings{"disable_video_link"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>

%					if ($tourn_settings->{"nsda_nats"}) {

						<label for="video_link_optional">
							<div class="hover  row fixedflex">
								<span class="threequarters">
									Do not require video links
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "video_link_optional",
										value   => $event_settings{"video_link_optional"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>

						<label for="ask_for_manuscript">
							<div class="hover  row fixedflex">
								<span class="threequarter">
									Require piece manuscript
								</span>

								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "ask_for_manuscript",
										value   => $event_settings{"ask_for_manuscript"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>
%					}
%				} elsif ($event->type eq "congress") {

					<h5 class="button">
						Registration Options
					</h5>

					<label for="ask_for_po">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Ask for PO self-nominations
							</span>
							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "ask_for_po",
									value   => $event_settings{"ask_for_po"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
<%perl>
				}

				if ($tourn_settings->{"nsda_nats"}) {

					if ($event_settings{"supp"} || $event_settings{"conn"}) {
</%perl>
						<h5 class="button">
							Re-registration
						</h5>

						<label for="no_rereg">
							<div class="hover  row fixedflex">
								<span class="threequarters">
									Disable re-registration
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "no_rereg",
										value   => $event_settings{"no_rereg"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>

%						my $rereg_start = $event_settings{"rereg_start"};
%						$rereg_start->set_time_zone($tz) if $rereg_start;

						<div class=" row fixedflex">
							<span class="fifth">
								Opens
							</span>

							<span class="half centeralign">
								<&
									"/funclib/datepicker.mas",
									id  => "rereg_start",
									max => $tourn->end
								&>
								<input
									type        = "text"
									name        = "rereg_start"
									id          = "rereg_start"
									placeholder = "Date.."
									size        = "16"
									value       = "<% ($rereg_start) ?  $rereg_start->mdy('/') : "" %>"
								>
							</span>

							<span class="threetenths centeralign">
								<&
									"/funclib/timepicker.mas",
									name        => "rereg_starttime",
									time        => $rereg_start,
									size        => 10,
									placeholder => "Time..."
								&>
							</span>
						</div>

%						my $rereg_end = $event_settings{"rereg_end"};
%						$rereg_end->set_time_zone($tz) if $rereg_end;

						<div class=" row fixedflex">
							<span class="fifth">
								Closes
							</span>
							<span class="half centeralign">
								<&
									"/funclib/datepicker.mas",
									id  => "rereg_end",
									max => $tourn->end
								&>

								<input
									type        = "text"
									name        = "rereg_end"
									id          = "rereg_end"
									placeholder = "Date.."
									size        = "16"
									value       = "<% ($rereg_end) ?  $rereg_end->mdy('/') : "" %>"
								>
							</span>

							<span class="threetenths centeralign">
								<&
									"/funclib/timepicker.mas",
									name        => "rereg_endtime",
									time        => $rereg_end,
									size        => 10,
									placeholder => "Time..."
								&>
							</span>
						</div>
%					}

%				} else {

					<script>

						function checkSuppBox() {
							if ($("#supp").prop("checked") ) {
								$(".supp").removeClass('hidden');
							} else {
								$(".supp").addClass('hidden');
							}
							zebraRows();
						}

						$(document).ready(function(){
							console.log("Fun times");
							checkSuppBox();
						});

					</script>

					<label for="supp">
						<div class="hover  row fixedflex">
							<span class="threequarters">
								Supplemental Event
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag      => "supp",
									function => "checkSuppBox();",
									value    => $event_settings{"supp"},
									target   => $event,
									smaller  => 1,
								&>
							</span>
						</div>
					</label>

					<label for="open_supp">
						<div class="hover  row fixedflex supp">
							<span class="threequarters">
								Non-entrants can register for supplemental
							</span>

							<span class="quarter centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => "open_supp",
									value   => $event_settings{"open_supp"},
									target  => $event,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
%				}

%			unless ($tourn_settings->{"nsda_nats"}) {

				<h5 class="button">
					Judging adjustments
				</h5>

				<label for="no_judge_burden">
					<div class="hover  row fixedflex">
						<span class="threequarter">
							No judge obligations
						</span>

						<span class="quarter centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "no_judge_burden",
								value   => $event_settings{"no_judge_burden"},
								target  => $event,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%				if ($event
%					&& $event->category->setting("rounds_per")
%				) {

					<div class=" row fixedflex">
						<span class="threequarter">
							Adjust judge rounds owed per entry
						</span>

						<span class="quarter centeralign">
							<input
								type  = "number"
								class = "smaller"
								name  = "adjust_judge_rounds_owed"
								min   = "0"
								max   = "999"
								step  = "1"
								value = <% $event_settings{"adjust_judge_rounds_owed"} %>
							>%
						</span>
					</div>

%				} else {

					<div
						title = "The number of judges owed for this event will be multiplied by the figure in the box"
						class = " row fixedflex"
					>
						<span class="threequarter">
							Adjust judges owed per entry by
						</span>

						<span class="quarter centeralign">
							<input
								type  = "number"
								class = "smaller"
								name  = "adjust_judges_owed"
								min   = "0"
								max   = "999"
								step  = "1"
								value = <% $event_settings{"adjust_judges_owed"} %>
							>%
						</span>
					</div>
%				}

				<div class=" row fixedflex">
					<span
						title = "The judge fees for this event will be multiplied by the figure in the box"
						class = "threequarter"
					>
						Adjust judges hiring fees by
					</span>

					<span class="quarter centeralign">
						<input
							type  = "number"
							class = "smaller"
							name  = "adjust_judges_fees"
							min   = "-999"
							max   = "999"
							step  = ".01"
							value = <% $event_settings{"adjust_judges_fees"} %>
							>%
					</span>
				</div>

				<label for="self_strike">
					<div class="hover  row fixedflex">
						<span class="threequarters">
							Judges can strike self from event
						</span>
						<span class="quarter centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "self_strike",
								value   => $event_settings{"self_strike"},
								target  => $event,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%				if ($event && $event->category && $event->category->setting("entry_strikes")) {

					<div class=" row fixedflex">
						<span class="threequarter">
							Adjust strikes per entry by
						</span>

						<span class="quarter centeralign">
							<input
								type  = "number"
								class = "smaller"
								name  = "adjust_strikes"
								min   = "-999"
								max   = "999"
								step  = "1"
								value = <% $event_settings{"adjust_strikes"} %>
							>
						</span>
					</div>
%				}

				<label for="no_prefs">
					<div class="hover  row fixedflex">
						<span class="threequarters">
							No Judge Prefs
						</span>
						<span class="quarter centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "no_prefs",
								value   => $event_settings{"no_prefs"},
								target  => $event,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			}

			</span>
		</div>

%		unless ($event->type eq "attendee") {
			<div class="truefull nospace martop">

				<span class="pagehalf">

<%perl>
					if (not defined ($tourn_settings->{"nsda_nats"})
						&& not defined ($districts)
					) {

						if ($event->type eq "parli") {
</%perl>
							<label for="apda">
								<div class="hover  row fixedflex">
									<span class="threequarters">
										Use APDA Seeds (Full, Half, Free)
									</span>
									<span class="quarter centeralign">
										<& "/funclib/bool_switch.mas",
											tag     => "apda",
											value   => $event_settings{"apda"},
											target  => $event,
											smaller => 1,
										&>
									</span>
								</div>
							</label>
%						}

						<h5 class="button">
							Breakout/Flags
						</h5>

%						foreach my $breakout (1 .. $event_settings{"breakouts"}) {

%							next if $event_settings{"breakout_".$breakout."_delete"};

							<div class="hover  row fixedflex">
								<span class="threefifths">
									Breakout/Flag <% $breakout %> Label
								</span>

								<span class="twofifths">
									<input
										type      = "text"
										maxlength = "24"
										size      = "16"
										name      = "breakout_<% $breakout %>_label"
										value     = "<% $event_settings{"breakout_".$breakout."_label"} %>"
									>
								</span>
							</div>

							<label for="breakout_<% $breakout %>_selfreg">
								<div
									class = "hover  row fixedflex"
									title = "This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so"
								>

									<span class="threequarter">
										Breakout <% $breakout %> marked at registration by coach?
									</span>

									<span class="quarter centeralign">
										<& "/funclib/bool_switch.mas",
											tag     => "breakout_".$breakout."_selfreg",
											value   => $event_settings{"breakout_".$breakout."_selfreg"},
											target  => $event,
											smaller => 1,
										&>
									</span>
								</div>
							</label>

							<label for="breakout_<% $breakout %>_exclude_elims">

								<div
									class="hover  row fixedflex"
									title="This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so"
								>

									<span class="threequarter">
										Exclude entries already in another elim?
									</span>

									<span class="quarter centeralign">
										<& "/funclib/bool_switch.mas",
											tag     => "breakout_".$breakout."_exclude_elims",
											value   => $event_settings{"breakout_".$breakout."_exclude_elims"},
											target  => $event,
											smaller => 1,
										&>
									</span>
								</div>
							</label>

							<label for="breakout_<% $breakout %>_delete">
								<div
									class="hover  row fixedflex"
									title="This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so"
								>

									<span class="threequarter">
										Delete Breakout <% $breakout %>
									</span>
									<span class="quarter centeralign">
										<input
											type  = "checkbox"
											name  = "breakout_<% $breakout %>_delete"
											id    = "breakout_<% $breakout %>_delete"
											value = 1
										>
									</span>
								</div>
							</label>
%						}

						<div
							class = " row fixedflex"
							title = "Breakout rounds allow you to advance only a subset of entries, such as ESL/EFL teams or first-years only.  Flags let you collect custom data about entries for registration purposes."
						>
							<span class="threefifths">
								Add a breakout/flag labeled
							</span>

							<span class="twofifths">
								<input
									type      = "text"
									maxlength = "24"
									size      = "16"
									name      = "breakout_new"
								>
							</span>
						</div>
%					}

				</span>

%				unless ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"nsda_district"}) {

					<span class="pagehalf right">
						<h5 class="button">
							Qualifiers
						</h5>

						<label for="ask_quals">
							<div class="hover  row fixedflex">
								<span class="threequarter">
									Required number of qualifiers/bids
								</span>

								<span class="quarter centeralign">
									<input
										type  = "text"
										class = "thin"
										name  = "ask_quals"
										value = "<% $event_settings{"ask_quals"} %>"
										size  = "5"
									>
								</span>
							</div>
						</label>

						<label for="more_quals">
							<div class="hover  row fixedflex">
								<span class="threequarter">
									Allow entry of quals above minimum
								</span>

								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "more_quals",
										value   => $event_settings{"more_quals"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>

						<label for="at_larges">
							<div class="hover  row fixedflex">
								<span class="threequarter">
									Allow at-large (non-qualified) entries
								</span>
								<span class="quarter centeralign">
									<& "/funclib/bool_switch.mas",
										tag     => "at_larges",
										value   => $event_settings{"at_larges"},
										target  => $event,
										smaller => 1,
									&>
								</span>
							</div>
						</label>
					</span>
%				}
			</div>
%		}

		<div class="liblrow rightalign full marvertno">
			<span class='third centeralign'>
				<input
					type  = "submit"
					value = "Save Registration Settings"
				>
			</span>
		</div>

%		if ($event->type eq "congress") {

			<& "/funclib/editor.mas" &>

			<h4>Text for Contestant Assignment Cards</h4>

			<div class="centeralign">
				<textarea
					class = "full"
					name  = "congress_entry_cards"
					 row fixedflexs  = "16"
					cols  = "59"
					wrap  = "virtual"
					><% $event_settings{"congress_entry_cards"} %></textarea>
			</div>

			<div class="libl row fixedflex full rightalign">
				<input
					type  = "submit"
					value = "Save"
				>
			</div>
%		}

		</form>
	</div>

	<div class="menu">
		<& "menu.mas",
			person          => $person,
			person_settings => $person_settings,
			tourn           => $tourn,
			perms           => $perms,
			tourn_settings  => $tourn_settings,
			whoami          => "register",
			event_id        => $event->id
		&>
	</div>

