<%args>
	$tourn
	$tourn_settings
	$person
	$person_settings
	$perms
	$event_id => undef
	$add      => undef
	$err      => undef
	$tz       => undef
</%args>
<%init>

	$tz = $tourn->tz unless $tz;

 	my @categories = sort{$a->name cmp $b->name} $tourn->categories;

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	if (scalar $tourn->events == 1 && not defined $add) {
		$event = $tourn->events->first;
	}

	$m->abort unless $event;

	my %event_settings = $event->all_settings;

	if ($event) {

		unless ($event->category) { 
			my $err = "You must select a judge category before continuing";
			$m->redirect("edit.mhtml?event_id=$event_id&err=$err");
		}

	}

	my $districts = $tourn_settings->{"nsda_district"};
	undef $districts if $event->setting("nsda_event_category") == "108";

</%init>

	<div class="main">

		<h2><% $event->name %></h2>

		<& 
			"tabbar.mas", 
			districts       => $districts,
			event           => $event,
			person          => $person,
			person_settings => $person_settings,
			whoami          => "register"
		&>

		<h4>Registration Settings</h4>
			
			<form 
				action   = "register_save.mhtml"
				method   = "post"
				enctype  = "multipart/form-data"
				onsubmit = "return uploadThis();"
			>

			<input 
				type  = "hidden"
				name  = "event_id"
				value = "<% $event->id %>"
			>

<%perl>
			if ( 
				(
					(not defined $districts) 
					|| $person->site_admin
				) && (not defined $tourn_settings->{"nsda_nats"})
			) { 
</%perl>

				<div class="row marleft marright marbottom padtopmore padbottom">

					<span class="pagehalf">

						Event-Specific Entry Registration Deadline 

						<p class="explain marno ">
							only set if it's earlier than 

							<% Tab::pickerdate($tourn->reg_end->set_time_zone($tz)) %>
								 at 
							<% Tab::nicetime($tourn->reg_end->set_time_zone($tz)) %>
						</p>

					</span>

					<span class="pagehalf centeralign">

%						my $deadline = $event_settings{"deadline"} unless $add;
%						$deadline->set_time_zone($tz) if $deadline;

						<& 
							"/funclib/datepicker.mas", 
							id  => "deadline",
							max => $tourn->end
						&>

						<input 
							type        = "text"
							name        = "deadline"
							id          = "deadline"
							placeholder = "Date.."
							size        = "16"
							value       = "<% ($deadline) ?  $deadline->mdy('/') : "" %>"
						>
							@
						<& 
							"/funclib/timepicker.mas",
							name        => "deadlinetime",
							time        => $deadline,
							size        => 16,
							placeholder => "Time..."
						&>
					</span>

				</div>

%			}

			<span class="pagehalf">

%				my $code_style = $event_settings{'code_style'};

%				if ($code_style eq "numbers" || $code_style eq "school_number") { 

					<div class=" row">

						<span class="threequarter ">
							Start Speaker Codes With
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "text"
								class = "thin"
								name  = "code_start"
								value = "<% $event_settings{"code_start"} %>"
								size  = "5"
							>
						</span>

					</div>

%				}

%				if ($tourn_settings->{"nsda_nats"}) { 

					<label for="supp">

						<div class="hover row">

							<span class="threequarter ">
								Supplemental Event
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "supp"
									name  = "supp"
									value = "1"
									<% $event_settings{"supp"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="conn">

						<div class="hover row">

							<span class="threequarter ">
								Consolation Event
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "conn"
									name  = "conn"
									value = "1"
									<% $event_settings{"conn"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="stefan">

						<div class="hover row">

							<span class="threequarter ">
								Supplemental without pre-registration
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "stefan"
									name  = "stefan"
									value = "1"
									<% $event_settings{"stefan"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

%					if ($event->type eq "wsdc") { 

						<div class="row">

							<span class="threequarter ">
								Per District Cap 
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "text"
									class = "thin"
									name  = "district_cap"
									size  = "5"
									value = "<% $event_settings{"district_cap"} %>"
								>
							</span>
						</div>
%					}

					<h6 class="button">
						NSDA Judge Burdens
					</h6>

					<label for="nats_judge_burden">

						<div class="hover row">

							<span class="threequarter">
								Rounds per entry
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "number"
									id    = "nats_judge_burden"
									name  = "nats_judge_burden"
									min   = 0
									max   = 99
									value = "<% $event_settings{"nats_judge_burden"} %>"
								>
							</span>

						</div>

					</label>

					<div class="hover row">

						<span class="half">
							Judge registration pool
						</span>

						<span class="half rightalign">

							<select name="nats_jpool">

								<option value=""></option>
<%perl>
								foreach my $pool (
									$m->comp("/funclib/category_jpools.mas", 
										category => $event->category,
										limit    => "registrant"
									)
								) { 
								
</%perl>
									<option 
										value="<% $pool->id %>"
										<% $pool->id == $event_settings{"nats_jpool"} 
											?  "selected='selected'"
											: ""
									%>><% $pool->name %></option>
%								}

							</select>

						</span>

					</div>

					<label for="nats_screwy_burden">

						<div class="hover row">

							<span class="threequarter">
								Screwy PF style judge burden
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "nats_screwy_burden"
									name  = "nats_screwy_burden"
									value = "1"
									<% $event_settings{"nats_screwy_burden"} ? 'checked=true' : '' %>
								>
							</span>
						</div>
					</label>


%				} else { 

%				if ( (not defined $districts) || $person->site_admin) { 

					<div class="row">

						<span class="threequarter ">
							Total Field Cap 
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "text"
								class = "thin"
								name  = "cap"
								size  = "5"
								value = "<% $event_settings{"cap"} %>"
							>
						</span>

					</div>

					<div class="row">

						<span class="threequarter ">
							Per-School Cap 
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "text"
								class = "thin"
								name  = "school_cap"
								size  = "5"
								value = "<% $event_settings{"school_cap"} %>"
							>
						</span>
					</div>

					<label for="waitlist">

						<div class="hover row">

							<span class="threequarter ">
								Waitlist entries over caps
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "waitlist"
									name  = "waitlist"
									value = "1"
									<% $event_settings{"waitlist"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="waitlist_all">

						<div class="hover row">

							<span class="threequarter ">
								Waitlist all entries
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "waitlist_all"
									name  = "waitlist_all"
									value = "1"
									<% $event_settings{"waitlist_all"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="no_waitlist">

						<div class="hover row">

							<span class="threequarter ">
								No waitlist beyond cap
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "no_waitlist"
									name  = "no_waitlist"
									value = "1"
									<% $event_settings{"no_waitlist"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="waitlist_rank">

						<div class="hover row">

							<span class="threequarter ">
								Ask registrants to rank waitlist priorities
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "waitlist_rank"
									name  = "waitlist_rank"
									value = "1"
									<% $event_settings{"waitlist_rank"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

					<label for="always_tba">

						<div class="hover row">

							<span class="threequarter ">
								Take TBA Entries w/o caps
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "always_tba"
									name  = "always_tba"
									value = "1"
									<% $event_settings{"always_tba"} ? 'checked=true' : '' %>
								>
							</span>

						</div>

					</label>

%					if ($event->type eq "congress") { 
					
						<h6 class="button">
							Congress Legislation
						</h6>

						<label for="upload_legislation">

							<div class="hover row">

								<span class="threequarter">
									Upload legislation on Tabroom
								</span>

								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "upload_legislation"
										name  = "upload_legislation"
										value = "1"
										<% $event_settings{"upload_legislation"} ? 'checked=true' : '' %>
									>
								</span>

							</div>

						</label>

						<div class="row">

							<span class="threequarter">
								Per-School limit on submissions
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "text"
									class = "thin"
									name  = "legislation_cap"
									size  = "5"
									value = "<% $event_settings{"legislation_cap"} %>"
								>
							</span>

						</div>

						<div class="row">

							<span class="third">
								Bill Template
							</span>

%							if ($event_settings{"bill_template"}) { 

								<span class="half">
									<a 
										class  = "bluetext white centeralign"
										href   = "<% 
											$Tab::s3_url 
											."/". $tourn->id
											."/". $event->id 
											."/bill_template/". $event_settings{"bill_template"} 
										%>" 
										target = "_blank"
									>
										View Template
									</a>

								</span>

								<span class="sixth">
									<a 
										class = "redtext buttonwhite fa fa-trash"
										href  = "delete_template.mhtml?event_id=<% $event->id %>&target=bill"
									>
									</a>
								</span>
	
%							} else { 

								<span class="twothirds rightalign">

									<div class="uploader leftalign">

										<input 
											type     = "file"
											name     = "bill"
											style    = "opacity: 0;"
											onchange = "uploaderName('bill', 'bill_file')"
											id       = "bill"
										>

										<span 
											id  = "bill_file"
											class = "filename"
											style = "-webkit-user-select: none;"
										>No file selected</span>

										<span 
											class = "action"
											style = "-webkit-user-select: none;"
										>Choose File</span>

									</div>


								</span>

%							} 

						</div>

						<div class="row">

							<span class="third">
								Resolution Template
							</span>

%							if ($event_settings{"resolution_template"}) { 

								<span class="half">
									<a 
										class  = "bluetext white centeralign"
										href   = "<% 
											$Tab::s3_url 
											."/". $tourn->id
											."/". $event->id 
											."/resolution_template/". $event_settings{"resolution_template"} 
										%>" 
										target = "_blank"
									>
										View Template
									</a>

								</span>

								<span class="sixth">
									<a 
										class = "redtext buttonwhite fa fa-lg fa-trash"
										href  = "delete_template.mhtml?event_id=<% $event->id %>&target=resolution"
									>
									</a>
								</span>
	
%							} else { 

								<span class="twothirds rightalign">
									<div class="uploader leftalign">

										<input 
											type     = "file"
											name     = "resolution"
											style    = "opacity: 0;"
											onchange = "uploaderName('resolution', 'resolution_file')"
											id       = "resolution"
										>

										<span 
											id  = "resolution_file"
											class = "filename"
											style = "-webkit-user-select: none;"
										>No file selected</span>

										<span 
											class = "action"
											style = "-webkit-user-select: none;"
										>Choose File</span>

									</div>

								</span>
						

%							} 

						</div>

						<div class="row">

							<span class="third">
								Con. Amendment Template
							</span>

%							if ($event_settings{"amendment_template"}) { 

								<span class="half">
									<a 
										class  = "bluetext white centeralign"
										href   = "<% 
											$Tab::s3_url 
											."/". $tourn->id
											."/". $event->id 
											."/amendment_template/". $event_settings{"amendment_template"} 
										%>" 
										target = "_blank"
									>
										View Template
									</a>

								</span>

								<span class="sixth">
									<a 
										class = "redtext buttonwhite fa fa-lg fa-trash"
										href  = "delete_template.mhtml?event_id=<% $event->id %>&target=amendment"
									>
									</a>
								</span>
	
%							} else { 

								<span class="twothirds rightalign">
									<div class="uploader leftalign">

										<input 
											type     = "file"
											name     = "amendment"
											style    = "opacity: 0;"
											onchange = "uploaderName('amendment', 'amendment_file')"
											id       = "amendment"
										>

										<span 
											id  = "amendment_file"
											class = "filename"
											style = "-webkit-user-select: none;"
										>No file selected</span>

										<span 
											class = "action"
											style = "-webkit-user-select: none;"
										>Choose File</span>

									</div>

								</span>
						

%							} 

						</div>

%					}

					<div class="row">
						<h6 class="button">
							Qualifications
						</h6>
					</div>

					<label for="ask_quals">

						<div class="hover row">

							<span class="threequarter">
								Required number of qualifiers/bids
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "text"
									class = "thin"
									name  = "ask_quals"
									value = "<% $event_settings{"ask_quals"} %>"
									size  = "5"
								>
							</span>

						</div>

					</label>

					<label for="more_quals">

						<div class="hover row">

							<span class="threequarter">
								Allow entry of quals above minimum
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "more_quals"
									name  = "more_quals"
									value = "1"
									<% $event_settings{"more_quals"} ? "checked=true" : '' %>
								>
							</span>

						</div>
					</label>

					<label for="at_larges">
						<div class="hover row">
							<span class="threequarter">
								Allow at-large (non-qualified) entries
							</span>
							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "at_larges"
									name  = "at_larges"
									value = "1"
									<% $event_settings{"at_larges"} ? 'checked=true' : '' %>
								>
							</span>
						</div>
					</label>

%				}
%			}

			</span>

			<span class="pagehalf">

%			if ($tourn_settings->{"nsda_nats"}) { 

				<label for="ask_for_titles">

					<div class="hover row">

						<span class="threequarter">
							Ask for piece titles &amp; manuscripts
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "ask_for_titles"
								name  = "ask_for_titles"
								value = "1"
								<% $event_settings{"ask_for_titles"} ? 'checked=true' : '' %>
							>
						</span>
					</div>
				</label>

				<label for="ask_for_authors">
					<div class="hover row">
						<span class="threequarter">
							Ask for piece authors &amp; publication
						</span>
						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "ask_for_authors"
								name  = "ask_for_authors"
								value = "1"
								<% $event_settings{"ask_for_authors"} ? 'checked=true' : '' %>
							>
						</span>
					</div>
				</label>

				<label for="ask_for_bibliography">

					<div class="hover row">

						<span class="threequarter">
							Ask for piece bibliography
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "ask_for_bibliography"
								name  = "ask_for_bibliography"
								value = "1"
								<% $event_settings{"ask_for_bibliography"} ? 'checked=true' : '' %>
							>
						</span>
					</div>
				</label>

%				if ($event_settings{"supp"} || $event_settings{"conn"} ) { 

					<h6 class="button">
						Re-registration
					</h6>

%					my $rereg_start = $event_settings{"rereg_start"};
%					$rereg_start->set_time_zone($tz) if $rereg_start;

					<div class="row">

						<span class="fifth">
							Opens
						</span>

						<span class="half centeralign">
							<& 
								"/funclib/datepicker.mas", 
								id  => "rereg_start",
								max => $tourn->end
							&>

							<input 
								type        = "text"
								name        = "rereg_start"
								id          = "rereg_start"
								placeholder = "Date.."
								size        = "16"
								value       = "<% ($rereg_start) ?  $rereg_start->mdy('/') : "" %>"
							>
						</span>

						<span class="threetenths centeralign">
							<& 
								"/funclib/timepicker.mas",
								name        => "rereg_starttime",
								time        => $rereg_start,
								size        => 10,
								placeholder => "Time..."
							&>
						</span>

					</div>

%					my $rereg_end = $event_settings{"rereg_end"};
%					$rereg_end->set_time_zone($tz) if $rereg_end;

					<div class="row">

						<span class="fifth">
							Closes
						</span>

						<span class="half centeralign">
							<& 
								"/funclib/datepicker.mas", 
								id  => "rereg_end",
								max => $tourn->end
							&>

							<input 
								type        = "text"
								name        = "rereg_end"
								id          = "rereg_end"
								placeholder = "Date.."
								size        = "16"
								value       = "<% ($rereg_end) ?  $rereg_end->mdy('/') : "" %>"
							>
						</span>

						<span class="threetenths centeralign">
							<& 
								"/funclib/timepicker.mas",
								name        => "rereg_endtime",
								time        => $rereg_end,
								size        => 10,
								placeholder => "Time..."
							&>
						</span>

					</div>
%				}

%			} else { 

%				if ($event->type eq "parli") { 

					<label for="apda">

						<div class="hover row">
							<span class="threequarter ">
								Use APDA Seeds (Full, Half, Free)
							</span>
							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									name  = "apda"
									id    = "apda"
									value = "1"
									<% $event_settings{"apda"} ? 'checked' : '' %>
								>
							</span>
						</div>

					</label>

%				}

				<label for="field_report">
					<div class="hover row">

						<span class="threequarter ">
							Publish web field report
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "field_report"
								name  = "field_report"
								value = "1"
								<% $event_settings{"field_report"} ? 'checked' : '' %>
							>
						</span>
					</div>
				</label>

%				unless ($districts) { 

					<label for="field_waitlist">

						<div class="hover  hover row">

							<span class="threequarter ">
								Include waitlist on field report
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "field_waitlist"
									name  = "field_waitlist"
									value = "1"
									<% $event_settings{"field_waitlist"} ? 'checked=true' : '' %>
								>
							</span>
						</div>
					</label>
%				}

				<label for="code_hide">

					<div class="hover row">

						<span class="threequarter ">
							Hide entry codes at registration
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "code_hide"
								name  = "code_hide"
								value = "1"
								<% $event_settings{"code_hide"} ? 'checked=true' : '' %>
							>
						</span>

					</div>

				</label>

%				if ($districts && $event->abbr eq "HOU" && (not defined $tourn_settings{"pilot_congress"})) { 

					<div class="row">

						<span class="threequarter">
							Number of House chambers: 
							<br />
							<span class="explain">
								Specify at Districts to enable House chamber assignments
							</span>
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "number"
								name  = "house_chambers"
								min   = "1"
								max   = "99"
								value = "<% 
									$event_settings{"house_chambers"} 
									?  $event_settings{"house_chambers"} 
									: 1
								%>"
							>
						</span>

					</div>
%				}

%				unless ($districts &! $person->site_admin) { 

%					if ($event_settings{'max_entry'} > 1) { 

						<label for="hybrids">

							<div class="hover row">

								<span class="threequarter ">
									Allow hybrid entries (2+ schools)
								</span>

								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "hybrids"
										name  = "hybrids"
										value = "1"
										<% $event_settings{"hybrids"} ? 'checked=true' : '' %>
									>
								</span>
							</div>
						</label>

%					}

%					if ($event->type eq "speech") {

						<label for="ask_for_titles">

							<div class="hover row">

								<span class="threequarter ">
									Ask for piece titles
								</span>

								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "ask_for_titles"
										name  = "ask_for_titles"
										value = "1"
										<% $event_settings{"ask_for_titles"} ? 'checked=true' : '' %>
									>
								</span>
							</div>
						</label>

						<label for="ask_for_authors">
							<div class="hover row">
								<span class="threequarter ">
									Ask for piece authors
								</span>
								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "ask_for_authors"
										name  = "ask_for_authors"
										value = "1"
										<% $event_settings{"ask_for_authors"} ? 'checked=true' : '' %>
									>
								</span>
							</div>
						</label>

						<label for="ask_for_bibliography">
							<div class="hover row">
								<span class="threequarter ">
									Ask for piece bibliography
								</span>
								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "ask_for_bibliography"
										name  = "ask_for_bibliography"
										value = "1"
										<% $event_settings{"ask_for_bibliography"} ? 'checked=true' : '' %>
									>
								</span>
							</div>
						</label>

						<label for="enter_me_twice">

							<div class="hover row">

								<span class="threequarter ">
									Allow double entry within event
								</span>

								<span class="quarter centeralign">
									<input 
										type  = "checkbox"
										id    = "enter_me_twice"
										name  = "enter_me_twice"
										value = "1"
										<% $event_settings{"enter_me_twice"} ? 'checked=true' : '' %>
									>
								</span>

							</div>

						</label>

%					}

				<label for="supp">

					<div class="hover row">

						<span class="threequarter ">
							Supplemental Event
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "supp"
								name  = "supp"
								value = "1"
								<% $event_settings{"supp"} ? 'checked=true' : '' %>
							>
						</span>

					</div>

				</label>

				<label for="open_supp">

					<div class="hover row">

						<span class="threequarter ">
							Non-entrants can register in supps:
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "open_supp"
								name  = "open_supp"
								value = "1"
								<% $event_settings{"open_supp"} ? 'checked=true' : '' %>
							>
						</span>

					</div>

				</label>

				<label for="no_judge_burden">

					<div class="hover row">

						<span class="threequarter">
							No judge obligations
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "no_judge_burden"
								name  = "no_judge_burden"
								value = "1"
								<% $event_settings{"no_judge_burden"} ? 'checked=true' : '' %>
							>
						</span>

					</div>

				</label>

%				if ($event 
%					&& $event->category->setting("rounds_per")
%				) { 

					<div class="hover row">

						<span class="threequarter">
							Adjust judge rounds owed per entry by
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "number"
								class = "smaller"
								name  = "adjust_judge_rounds_owed"
								min   = "-99"
								max   = "99"
								step  = ".01"
								value = <% $event_settings{"adjust_judge_rounds_owed"} %>
							>
						</span>
					</div>

%				} else { 

					<div class="hover row">

						<span class="threequarter">
							Adjust judges owed per entry by
						</span>

						<span class="quarter centeralign">
							<input 
								type  = "number"
								class = "smaller"
								name  = "adjust_judges_owed"
								min   = "-99"
								max   = "99"
								step  = ".01"
								value = <% $event_settings{"adjust_judges_owed"} %>
							>
						</span>
					</div>
%				}

				<div class="hover row">

					<span class="threequarter">
						Adjust judges hiring fees by
					</span>

					<span class="quarter centeralign">
						<input 
							type  = "number"
							class = "smaller"
							name  = "adjust_judges_fees"
							min   = "-999"
							max   = "999"
							step  = "1"
							value = <% $event_settings{"adjust_judges_fees"} %>
							>%
					</span>
				</div>

				<label for="self_strike">

					<div class="hover row">

						<span class="threequarter ">
							Judges can strike self from event
						</span>
						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "self_strike"
								name  = "self_strike"
								value = "1"
								<% $event_settings{"self_strike"} ? 'checked=true' : '' %>
							>
						</span>
					</div>
				</label>

				<label for="no_prefs">
					<div class="hover row">
						<span class="threequarter ">
							No Judge Prefs
						</span>
						<span class="quarter centeralign">
							<input 
								type  = "checkbox"
								id    = "no_prefs"
								name  = "no_prefs"
								value = "1"
								<% $event_settings{"no_prefs"} ? 'checked=true' : '' %>
							>
						</span>
					</div>
				</label>

				<div class="row">
					<h6 class="button">Breakout/Flags</h6>
				</div>

%				foreach my $breakout (1 .. $event_settings{"breakouts"}) { 

%					next if $event_settings{"breakout_".$breakout."_delete"};

					<div class="hover row">

						<span class="half">
							Breakout/Flag <% $breakout %> Label:
						</span>

						<span class="half centeralign">
							<input 
								type      = "text"
								maxlength = "24"
								size      = "16"
								name      = "breakout_<% $breakout %>_label"
								value     = "<% $event_settings{"breakout_".$breakout."_label"} %>"
							>
						</span>
					</div>

					<label for="breakout_<% $breakout %>_selfreg">

						<div 
							class="hover row" 

							title="This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so" >

							<span class="threequarter">
								Breakout <% $breakout %> marked at registration by coach? 
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "breakout_<% $breakout %>_selfreg"
									name  = "breakout_<% $breakout %>_selfreg"
									value = "1" 
									<% $event_settings{"breakout_".$breakout."_selfreg"} ? 'checked="true"' : '' %>
								>

							</span>
						</div>
					</label>
				
					<label for="breakout_<% $breakout %>_exclude_elims">

						<div 
							class="hover row" 
							
							title="This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so"
							
						>

							<span class="threequarter">
								Exclude entries already in another elim?
							</span>

							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "breakout_<% $breakout %>_exclude_elims"
									name  = "breakout_<% $breakout %>_exclude_elims"
									value = "1"
									<% $event_settings{"breakout_".$breakout."_exclude_elims"} ? 'checked="checked"' : '' %>
								>
							</span>
						</div>
					</label>
				
					<label for="breakout_<% $breakout %>_delete">

						<div 
							class="hover row" 
							
							title="This option when selected will allow coaches to register entries as eligible for this breakout on registration.  Without it, tournament admins must do so"
						>

							<span class="threequarter">
								Delete Breakout <% $breakout %> 
							</span>
							<span class="quarter centeralign">
								<input 
									type  = "checkbox"
									id    = "breakout_<% $breakout %>_delete"
									name  = "breakout_<% $breakout %>_delete"
									value = "1"

									<% $event_settings{"breakout_".$breakout."_delete"} ? 'checked="checked"' : '' %>
								>
							</span>
						</div>
					</label>
				
%				}

				<div class="row" 
					title="Breakout rounds allow you to advance only a subset of entries, such as ESL/EFL teams or first-years only.  Flags let you collect custom data about entries for registration purposes." 
					>

					<span class="threefifths">
						Add a breakout/flag labeled:
					</span>

					<span class="twofifths centeralign">
						<input 
							type      = "text"
							maxlength = "24"
							size      = "12"
							name      = "breakout_new"
						>
					</span>

				</div>

%			}
%		}

		</span>

		<div class="libl full rightalign martopno">

			<input 
				type="submit" 
				value="Save Registration Settings"
			>
		</div>

%		if ($event->type eq "congress") { 

			<& "/funclib/editor.mas" &>

			<h4>Text for Contestant Assignment Cards</h4>

			<div class="centeralign">
				<textarea 
					class = "full"
					name  = "congress_entry_cards"
					rows  = "16"
					cols  = "59"
					wrap  = "virtual"
					><% $event_settings{"congress_entry_cards"} %></textarea>
			</div>

			<div class="liblrow full rightalign">
				<input 
					type  = "submit"
					value = "Save"
				>
			</div>

%		} 

		</form>

	</div>
		
	<div class="menu">
		<& "menu.mas", 
			person          => $person,
			person_settings => $person_settings,
			tourn           => $tourn,
			perms           => $perms,
			tourn_settings  => $tourn_settings,
			whoami          => "register",
			event_id        => $event->id
		&>
	</div>
		
