<%args>
	$tourn
	$event_id => undef
	$add      => undef
	$err      => undef
	$tz       => undef
</%args>
<%init>

	$tz = $tourn->tz unless $tz;
 	my @groups = sort{$a->name cmp $b->name} $tourn->judge_groups;

	my $event = Tab::Event->retrieve($event_id) if $event_id;

	if (scalar $tourn->events == 1 && not defined $add) {
		$event = $tourn->events->first;
	}

	$m->abort unless $event;

	my $switch;

</%init>

	<div class="left huge">

		<h2><% $event->name %></h2>

		<& tabnav.mas, event => $event, whoami => "register" &>

		<h4>Registration Settings</h4>
			
			<form action="register_save.mhtml" method="post">
			<input type="hidden" name="event_id" value="<% $event->id %>">

			<div class="evenrow full">

				<span class="half">
					Event-Specific Entry Registration Deadline 
					<div class="smaller block martop-half">
						(only set if it's earlier than <% Tab::pickerdate($tourn->reg_end->set_time_zone($tz))." at ".Tab::nicetime($tourn->reg_end->set_time_zone($tz)) %>)
					</div>
				</span>

				<span class="half centeralign">

%					my $deadline = $event->setting("deadline") unless $add;
%					$deadline->set_time_zone($tz) if $deadline;

					<& /funclib/datepicker.mas, id =>"deadline" , max => $tourn->end &>

					<input type="text" name="deadline" id="deadline" size="9" value="<% ($deadline) ?  $deadline->mdy('/') : "" %>">
							@
					<& /funclib/timepicker.mas, name => "deadlinetime", time => $deadline &>
				</span>

			</div>


%			undef($switch);

			<div class="half">

%				my $code_style = $event->setting('code_style');

%				if ($code_style eq "numbers" || $code_style eq "school_number") { 

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
						<span class="threequarter">
							Start Speaker Codes With
						</span>
						<span class="quarter centeralign">
							<input type="text" class="thin" name="code_start" value="<% ($event) ? $event->setting("code_start") : ""%>" size="5">
						</span>
					</div>

%				}

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						Total Field Cap 
					</span>
					<span class="quarter centeralign">
						<input type="text" class="thin" name="cap" value="<% ($event) ? $event->setting("cap") : ""%>" size="5">
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						Per-School Cap 
					</span>
					<span class="quarter centeralign">
						<input type="text" class="thin" name="school_cap" value="<% ($event) ? $event->setting("school_cap") : "" %>" size="5">
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="waitlist">
							Waitlist entries over caps
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="waitlist" name="waitlist" value="1" <% ($event) ? ($event->setting("waitlist")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="waitlist_all">
							Waitlist all entries
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="waitlist_all" name="waitlist_all" value="1" <% ($event) ? ($event->setting("waitlist_all")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="ask_quals">
							Required number of qualifiers/bids
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="text" class="thin" name="ask_quals" value="<% ($event) ? $event->setting("ask_quals") : "" %>" size="5">
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter smallish">
						<label for="more_quals">
							Allow entry of quals above minimum
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="more_quals" name="more_quals" value="1" <% ($event) ? ($event->setting("more_quals")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter smallish">
						<label for="at_larges">
							Allow at-large (non-qualified) entries
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="at_larges" name="at_larges" value="1" <% ($event) ? ($event->setting("at_larges")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="no_judge_burden">
							No judge obligations
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="no_judge_burden" name="no_judge_burden" value="1" <% ($event) ? ($event->setting("no_judge_burden")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="self_strike">
							Judges can strike self from event
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="self_strike" name="self_strike" value="1" <% ($event) ? ($event->setting("self_strike")) ? 'checked' : '' : '' %>>
					</span>
				</div>

			</div>

%			undef($switch);

			<div class="half">

%				if ($event->type eq "parli") { 

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
						<span class="threequarter">
							<label for="apda">
								Use APDA Seeds (Full, Half, Free)
							</label>
						</span>
						<span class="quarter centeralign">
							<input type="checkbox" name="apda" id="apda" value="1" <% ($event) ? ($event->setting("apda")) ? 'checked' : '' : '' %>>
						</span>
					</div>

%				}

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="field_report">
							Publish web field report
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="field_report" name="field_report" value="1" <% ($event) ? ($event->setting("field_report")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="field_waitlist">
							Include waitlist on field report
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="field_waitlist" name="field_waitlist" value="1" <% ($event) ? ($event->setting("field_waitlist")) ? 'checked' : '' : '' %>>
					</span>
				</div>

                <div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
                    <span class="threequarter">
						<label for="code_hide">
							Hide entry codes at registration
						</label>
                    </span>
                    <span class="quarter centeralign">
						<input type="checkbox" id="code_hide" name="code_hide" value="1" <% ($event) ? ($event->setting("code_hide")) ? 'checked' : '' : '' %>>
                    </span>
                </div>

%				if ($event->setting('max_entry') > 1) { 

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
						<span class="threequarter">
							<label for="hybrids">
								Allow hybrid entries (2+ schools)
							</label>
						</span>
						<span class="quarter centeralign">
							<input type="checkbox" id="hybrids" name="hybrids" value="1" <% ($event) ? ($event->setting("hybrids")) ? 'checked' : '' : '' %>>
						</span>
					</div>

%				}

%				if ($event->type eq "speech") {

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
						<span class="threequarter">
							<label for="ask_for_titles">
								Ask for piece titles
							</label>
						</span>
						<span class="quarter centeralign">
							<input type="checkbox" id="ask_for_titles" name="ask_for_titles" value="1" <% ($event) ? ($event->setting("ask_for_titles")) ? 'checked' : '' : '' %>>
						</span>
					</div>

					<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
						<span class="threequarter">
							<label for="enter_me_twice">
								Allow double entry within event
							</label>
						</span>
						<span class="quarter centeralign">
							<input type="checkbox" id="enter_me_twice" name="enter_me_twice" value="1" <% ($event) ? ($event->setting("enter_me_twice")) ? 'checked' : '' : '' %>>
						</span>
					</div>

%				}

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="supp">
							Supplemental Event
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="supp" name="supp" value="1" <% ($event) ? ($event->setting("supp")) ? 'checked' : '' : '' %>>
					</span>
				</div>

				<div class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<span class="threequarter">
						<label for="no_prefs">
							No Judge Prefs
						</label>
					</span>
					<span class="quarter centeralign">
						<input type="checkbox" id="no_prefs" name="no_prefs" value="1" <% ($event) ? ($event->setting("no_prefs")) ? 'checked' : '' : '' %>>
					</span>
				</div>

			</div>

		<div class="liblrow block rightalign">
			<input type="submit" value="Save Registration Settings">
			</form>
		</div>
		
	</div>
			
	<div class="right small">
		<& menu.mas, tourn => $tourn, whoami => "register", event_id => ($event) ? $event->id : "" &>		
	</div>
