<%args>
	$tourn
	$event_id => undef
	$add => undef
	$err => undef
	$tz => undef
</%args>
<%init>

	$tz = $tourn->tz unless $tz;
 	my @groups = sort{$a->name cmp $b->name} $tourn->judge_groups;

	my $event = Tab::Event->retrieve($event_id) if $event_id;
	my $switch;

</%init>
	
	<& "/funclib/editor.mas" &>

	<div class="right small">
		<& menu.mas, tourn => $tourn, event_id => $event_id  &>		
	</div>

	<div class="left huge">

%		if ($event) { 

			<h2><% $event->name %> settings</h2>

%		} else { 

			<h2>Add and edit events</h2>
%		}

%		unless (@groups) {
		
			<p>
				Events, or divisions, are organized into judge groups.  Events
				in the same group will share judges, same judge obligations,
				and judge rating systems.
			</p>

			<p>
				You must create judge group(s) under 
				<a href="/setup/judges/edit.mhtml">Setup -> Judge Groups</a>
				before creating events here.
			</p>

%		}

%		if ($event || $add ) { 

			<table cellpadding="5" cellspacing="1" border="0" width="100%"> 

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<form enctype="multipart/form-data" onsubmit="return uploadThis()" name="ballot" action="event_save.mhtml" method="post">
						<input type="hidden" value="<% $event_id %>" name="event_id">
						Event Name
					</td>
				
					<td align="right">
						<input type="text" name="name" value="<% ($event) ? $event->name : "" %>" size="50">
					</td>
					
				</tr>

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						Judge Group
					</td>
				
					<td align="right">
						<select name="judge_group_id">
							<option></option>

%							foreach my $group (sort {$a->name cmp $b->name} $tourn->judge_groups) { 
								<option value="<% $group->id %>" <% ($event && $event->judge_group && $group->id == $event->judge_group->id) ? "selected" : "" %>>
									<% $group->name %>
								</option>
%							}

						</select>
					</td>
					
				</tr>

			</table>

			<hr />

%			undef($switch);

			<div class="half" style="width: 49%; float: left;">

				<table cellpadding="5" cellspacing="1" border="0" width="100%"> 
				
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
					
						<td>
							Abbreviation
						</td> 
						
						<td>
							<input type="text" name="abbr" value="<% ($event) ? $event->abbr : "" %>" size="5">
						</td> 

					</tr> 
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Entry Fee
						</td>

						<td>
							<input type="text" name="fee" value="<% ($event) ? $event->fee : "" %>" size="5">
						</td>

					</tr>


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Field Cap 
						</td>

						<td>
							<input type="text" name="cap" value="<% ($event) ? $event->setting("cap") : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
						<td >
							School Cap 
						</td>

						<td>
							<input type="text" name="school_cap" value="<% ($event) ? $event->setting("school_cap") : "" %>" size="5">
						</td> 
						
					</tr> 
	
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Min students per entry
						</td> 

						<td>
							<input type="text" name="min_entry" value="<% ($event) ? $event->setting("min_entry") : "" %>" size="5">
						</td> 

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Max students per entry
						</td> 

						<td>
							<input type="text" name="max_entry" value="<% ($event) ? $event->setting("max_entry") : "" %>" size="5">
						</td> 

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							1st Numeric Speaker Code
						</td>

						<td>
							<input type="text" name="code_start" value="<% ($event) ? $event->setting("code_start") : ""%>" size="5">
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<label for="code_hide">
								Hide codes at registration
							</label>
						</td>

						<td>
							<input type="checkbox" id="code_hide" name="code_hide" value="1" <% ($event) ? ($event->setting("code_hide")) ? 'checked' : '' : '' %>>
						</td>

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<label for="ask_for_titles">
							Ask for Piece Titles
							</label>
						</td>

						<td>
							<input type="checkbox" id="ask_for_titles" name="ask_for_titles" value="1" <% ($event) ? ($event->setting("ask_for_titles")) ? 'checked' : '' : '' %>>
						</td>
				
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<label for="alumni">
								Allow judges to enter
							</label>
						</td>

						<td>
							<input type="checkbox" id="alumni" name="alumni" value="1" <% ($event) ? ($event->setting("alumni")) ? 'checked' : '' : '' %>>
						</td>

					</tr>


				</table>

			</div>

%			undef($switch);

			<div class="half" style="width: 49%; float: right;">

				<table cellpadding="5" cellspacing="1" border="0" width="100%"> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							<label for="waitlist">
								Waitlist entries over cap
							</label>
						</td> 
						
						<td align="left">
							<input type="checkbox" id="waitlist" name="waitlist" value="1" <% ($event) ? ($event->setting("waitlist")) ? 'checked' : '' : '' %>>
						</td> 

					</tr> 


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>		
					
						<td>
							<label for="waitlist_all">
								Waitlist all entries
							</label>
						</td> 
						
						<td align="left">
							<input type="checkbox" id="waitlist" name="waitlist_all" value="1" <% ($event) ? ($event->setting("waitlist_all")) ? 'checked' : '' : '' %>>
						</td> 

					</tr>
					
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>			
					
						<td>
							<label for="omit_sweeps">
								No sweepstakes credit
							</label>
						</td> 
						
						<td>
							<input type="checkbox" id="omit_sweeps" name="omit_sweeps" value="1" <% ($event) ? ($event->setting("omit_sweeps")) ? 'checked' : '' : '' %>> 
						</td> 
						
					</tr> 
					
% 					unless ($tourn->setting("allow_judge_own")) { 

						<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

							<td>
								<label for="allow_judge_own">
									Allow same-school judges
								</label>
							</td>

							<td>
								<input type="checkbox" id="allow_judge_own" name="allow_judge_own" value="1" <% ($event) ? ($event->setting("allow_judge_own")) ? 'checked' : '' : '' %>>
							</td>

						</tr>

%					}


					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<label for="no_judge_burden">
								No judge obligations
							</label>
						</td>

						<td>
							<input type="checkbox" id="no_judge_burden" name="no_judge_burden" value="1" <% ($event) ? ($event->setting("no_judge_burden")) ? 'checked' : '' : '' %>>
						</td>
			
					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<label for="bids">
								Award Bids/Quals
							</label>
						</td>

						<td>
							<input type="checkbox" id="bids" name="bids" value="1" <% ($event) ? ($event->setting("bids")) ? 'checked' : '' : '' %>>
						</td>
				
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
						<td>
							<label for="supp">
								Supplemental Event
							</label>
						</td>

						<td>
							<input type="checkbox" name="supp" id="supp" value="1" <% ($event) ? ($event->setting("supp")) ? 'checked' : '' : '' %>>
						</td>

					</tr>
		
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							<label for="field_report">
								Publish web field report
							</label>
						</td>

						<td>
							<input type="checkbox" id="field_report" name="field_report" value="1" <% ($event) ? ($event->setting("field_report")) ? 'checked' : '' : '' %>>
						</td>

					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		
						<td>
							<label for="live_updates">
								Enable Live Updates
							</label>
						</td>

						<td>
							<input type="checkbox" id="live_updates" name="live_updates" value="1" 
								<% ($event) ? ($event->setting("live_updates")) ? 'checked' : '' : '' %>>
						</td>
					</tr>

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td >
							Event Type
						</td> 

						<td class="smaller">
							<select name="type">

								<option value="speech" <% ($event && $event->type eq "speech") ? "selected" : "" %>>
									Speech
								</option>

								<option value="debate" <% ($event && $event->type eq "debate") ? "selected" : "" %>>
									Debate	
								</option>

								<option value="congress" <% ($event && $event->type eq "congress") ? "selected" : "" %>>
									Congress
								</option>

							</select>
						</td> 

					</tr> 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
						
						<td >
							Master Ballot
						</td> 
						
						<td>
							<select name="ballot_type">
								<option value="normal" <% ($event && $event->setting("ballot_type") eq "normal") ? "selected" : "" %>>
									Plain
								</option>

								<option value="cfl" <% ($event && $event->setting("ballot_type") eq "cfl") ? "selected" : "" %>>
									Rules
								</option>
							</select>
						</td>

					</tr> 

				</table>
		

			</div>

		<br style="clear: both;">
		
		<hr />
	
		<table cellpadding="5" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td>Schematic competitor display style:</th>

				<td class="smaller rightalign">

					<select name="code_style">

						<option value="numbers" <% ($event && $event->setting("code_style") eq "numbers") ? "selected" : "" %>>
							Numeric codes
						</option>

						<option value="school_number" <% ($event && $event->setting("code_style") eq "school_number") ? "selected" : "" %>>
							School code + numeric code
						</option>

						<option value="initials" <% ($event && $event->setting("code_style") eq "initials") ? "selected" : "" %>>
							School name & entry initials	
						</option>

						<option value="register" <% ($event && $event->setting("code_style") eq "register") ? "selected" : "" %>>
							Ask registrants to supply code
						</option>

						<option value="names" <% ($event && $event->setting("code_style") eq "names") ? "selected" : "" %>>
							Full names
						</option>

					</select>

				</td>

			</tr>

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

			    <td >
					Early Deadline
				</td>

%				my $deadline = $event->setting("deadline") unless $add;
%				$deadline->set_time_zone($tz) if $deadline;

				<& /funclib/datepicker.mas, id =>"deadline" , max => $tourn->end &>

				<td class="rightalign">
   		            <input type="text" name="deadline" id="deadline" size="15" value="<% ($deadline) ?  $deadline->mdy('/') : "" %>">
						@
					<& /funclib/timepicker.mas, name => "deadlinetime", time => $deadline &>
				</td>

			</tr>

		</table>

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

				<td valign="top">
					<h4>Event Rules</h4>
				</td>

				<td>
					<textarea name="text" id="text" rows=5 cols="58" wrap="virtual"><% ($event) ? $event->setting("text") : "" %></textarea>
				</td>

			</tr>

			<tr class="liblrow">
				<td colspan="2" class="rightalign">
					<input type="submit"  value="  Save Event  ">
					</form>
				</td>
			</tr>

		</table>

%	} 

	</div>
			
