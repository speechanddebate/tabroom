<%args>
	$circuit
	$tourn
	$name
	$date
	$new_start => undef
	$new_end => undef
	$tz
</%args>
<%init>

	my $start = Tab::dtme($date, $new_start);
	my $end = Tab::dtme($date, $new_end);

	$start->set_time_zone($tz);
	$end->set_time_zone($tz);

	unless ($start) { 
		my $err = "You did not enter a valid start time for your new timeslot.  Try again";
		$m->redirect("$Tab::url_prefix/setup/schedule/sked.mhtml?date=<% $date %>&err=$err");
	}

	unless ($end) { 
		my $err = "You did not enter a valid end time for your new timeslot.  Try again";
		$m->redirect("$Tab::url_prefix/setup/schedule/sked.mhtml?date=<% $date %>&err=$err");
	}

	my $timeslot = Tab::Timeslot->create( { 
		tournament => $tourn->id,
		start => $start, 
		end => $end, 
		name => $name, 
	});
		
	my $msg = "Timeslot $name saved";
	$m->redirect("/setup/schedule/sked.mhtml?date=$date&msg=$msg");

</%init>
