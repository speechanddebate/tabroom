<%args>
	$err => undef
	$tourn
	$circuit
	$account
</%args>

	<& sidebar.mas, tourn => $tourn, whoami => "site_edit" &>

%	my $switch; 

	<& "/funclib/editor.mas" &>	

	<div class="left huge">

		<h2>Change Tournament Sites</h2>

			<table cellpadding="5" width="100%" cellspacing="1">

				<tr class="yellowrow">

					<th class="smaller">
						Site name
					</th>

					<th class="smaller">
						Room Count
					</th>

					<th>
					</th>

					<th>
					</th>
				</tr>

%				my %site_used = ();

% 				foreach my $site (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_sites.mas", tourn => $tourn)) {

%					$site_used{$site->id}++;

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >

						<td>
							<% $site->name %>
						</td>

						<td class="centeralign"> 
							<% scalar ($site->rooms) %> 
						</td>

						<td class="centeralign">
							<a class="dkgreen block" href="site_edit.mhtml?site_id=<% $site->id %>">
								Edit Site
							</a>
						</td>

						<td class="centeralign"> 
							<a class="dkred block" href="site_rm.mhtml?site_id=<% $site->id %>">
								Remove 
							</a>
						</td>

					</tr>
%				}

			</table>

			<br />
		
			<h4>Add an existing site</h4>

			<table cellpadding="5" width="100%" cellspacing="1">

				<tr class="liblrow">

					<td colspan="2">
					
						<form action="site_add.mhtml" method="post">

						<select name="site_id">

%							foreach my $circuit (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_circuits.mas", tourn => $tourn)) { 
%								foreach my $site (sort {$a->name cmp $b->name} $circuit->sites ) { 
%									next if $site_used{$site->id};
									<option value="<% $site->id %>">
										<% substr($site->name,0,40) %>
										(<% scalar $site->rooms %> Rooms) 
									</option>
%								}
%							}
	
						</select>

					</td>

					<td class="rightalign"> 
						<input type="submit" value=" Add Site ">
						</form>
					</td>

				</tr>

			</table>

			<br />

			<h4>Add a new site to your tournament</h4>

			<table cellpadding="5" width="100%" cellspacing="1">

				<tr class="evenrow" align="left"> 

					<td>
						<form action="site_new.mhtml" method="post">
						<input type="text" name="name" size="65" placeholder="Name of site">
					</td>

				</tr>

				<tr class="oddrow">

					<td>
						<textarea name="directions" rows="5" placeholder="Directions & Location" cols="65">Directions to Location</textarea>
					</td>

				</tr>

				<tr class="liblrow">

					<td class="rightalign"> 
						<input type="submit" value="  Save New Site  ">
						</form>
					</td>

				</tr>

			</table>

	</div>

