<%args>
	$tourn
	$perms
	$person
	$session
	$tourn_settings
	$person_settings
	$event_id    => undef
	$category_id => undef
</%args>

<%init>

	unless ($person) { 
		my $err = "You are not logged in.  Log in to continue";
		$m->redirect("/index/index.mhtml?err=$err");
	}

	unless ($tourn) {
		my $err = "You are no longer logged into a tournament" unless $tourn;
		$m->redirect("/user/home.mhtml?err=$err");
	}

	unless (
		${$perms}{"owner"} 
		|| ${$perms}{"contact"} 
		|| ${$perms}{"full_admin"} 
		|| ${$perms}{"setup"}
		|| $person->site_admin
		|| (${$tourn_settings}{"nsda_district"} && ${$person_settings}{"nsda_admin"})
	) { 
		my $err = "You do not have access to adjust settings for this tournament";
		$m->redirect("/register/index.mhtml?err=$err");
	}

	if ($event_id) {
		my $event = Tab::Event->retrieve($event_id);
		unless ($event->tourn->id == $tourn->id) { 
			$m->print('<div class="main">');
			$m->print("That event is not part of your tournament");
			$m->print('</div>');
		}

	}

	if ($category_id) {
		my $category = Tab::Event->retrieve($category_id);
		unless ($category->tourn->id == $tourn->id) { 
			$m->print('<div class="main">');
			$m->print("That judge category is not part of your tournament");
			$m->print('</div>');
		}

	}

</%init>

	<div id="wrapper">

		<div id="content">

<%perl>

 		$m->call_next(  
			person          => $person,
			tourn           => $tourn,
			perms           => $perms,
			tourn_settings  => $tourn_settings,
			person_settings => $person_settings
		);

</%perl>

		<br style="clear: both;" />

		<div id="content-spacer"></div>

		</div>

	</div>

