<%args>	
	$session
	$circuit
	$tourn
	$group_id
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);
	my $switch;

</%init>

    <& menubar.mas, group_id => $group_id, tourn => $tourn, page => "partials" &>

	<div class="left huge">

		<h2>Judge time-based blocks</h2>

		<p>
			These timeblocks allow registering coaches to mark judges as unavailble
			during the blocks you specify.  The fees will be charged if a school is
			under their burden during that timeblock; so if a school owes 2 judges
			and only 1 judge is free on Friday night, the Friday night fine will be charged.
			However, if the school brings 3 judges, of which 2 are always available,
			the fine will not be charged.
		</p>
		
		<form action="partials_save.mhtml" method="post">
		<input type="hidden" name="group_id" value="<% $group->id %>">

		<table cellpadding="5" width="100%" cellspacing="1">

			<tr class="lirdrow">

				<th class="smaller">
				</th>

				<th class="smaller">
					Name
				</th>

				<th class="smaller">
					Fee
				</th>

%				if (scalar $tourn->days > 1) { 
					<th class="smaller">
						Day
					</th>
%				}

				<th class="smaller">
					Start Time
				</th>

				<th class="smaller">
					End Time
				</th>

			</tr>

%			foreach my $bin (sort {$a->start->epoch <=> $b->start->epoch} $group->bins) {

%				my $bin_start = $bin->start->set_time_zone($circuit->timezone);
%				my $bin_end = $bin->end->set_time_zone($circuit->timezone);
	
				 <tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td align="center">
						<a class="whiteblock" href="partial_rm.mhtml?partial_id=<% $bin->id %>">
						[X]
						</a>
					</td>

					<th>
						<input type="text" name="<% $bin->id %>_name" value="<% $bin->name %>" size="10">
					</th>

					<td>
						<input type="text" name="<% $bin->id %>_fine" value="<% $bin->fine %>" size="4">
					</td>

%					if (scalar $tourn->days > 1) { 
				
						<td class="smaller">
%							foreach my $day ($tourn->days) { 
								<span style="padding-right: 3px;">
									<input type="radio" id="<% $bin->id."-".$day->epoch %>" name="<% $bin->id %>_day" value="<% Tab::pickerdate($day) %>" <% ($bin->start->day == $day->day) ? "checked" : "" %>>
										<label for="<% $bin->id."-".$day->epoch %>">
											<% $day->day_abbr %>
										</label>
								</span>
%							}

						</td>
%					} else { 
						<input type="hidden" name="<% $bin->id %>_day" value="<% Tab::pickerdate($tourn->start) %>">
%					}

					</td>

					<td>
						<& /funclib/timepicker.mas, name => $bin->id."_start", time => $bin->start, size => "6" &> 
					</td>

					<td>
						<& /funclib/timepicker.mas, name => $bin->id."_end", time => $bin->end, size => "6" &> 
					</td> 


				</tr>
% 			}

			<tr class="liblrow">

				<th class="smaller">
					New
				</th>

				<td>
					<input type="text" name="new_name" size="10" placeholder="Add new...">
				</td>

				<td>
					<input type="text" name="new_fine" size="4">
				</td>

%				if (scalar $tourn->days > 1) { 

					<td class="smaller">
%						foreach my $day ($tourn->days) { 
							<span style="padding-right: 3px;">
								<input type="radio" id="<% $day->epoch %>" name="new_day" value="<% Tab::pickerdate($day) %>">
									<label for="<% $day->epoch %>">
										<% $day->day_abbr %>
									</label>
							</span>
%						}

					</td>
%				} else { 

					<input type="hidden" name="new_day" value="<% Tab::pickerdate($tourn->start) %>">
%				}

				<td>
					<& /funclib/timepicker.mas, name => "new_start", size => "6" &> 
				</td>

				<td>
					<& /funclib/timepicker.mas, name => "new_end", size => "6" &> 
				</td>

			</tr>


			<tr class="liblrow">

				<td colspan="6" align="right">
					<input type="submit" value=" Save Timeblocks"> 
					</form>
				</td>

			</tr>

		</table>

	</div>
