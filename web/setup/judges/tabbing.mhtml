<%args>
	$tourn
	$account
	$group_id
	$new => undef
</%args>
<%perl>

	my $group = Tab::JudgeGroup->retrieve($group_id);
	my $switch;

</%perl>

	<& menubar.mas, group_id => $group_id, tourn => $tourn, page => "tabbing" &>

	<div class="left huge">

		<h2>
			<% $group->name %>
		</h2> 
	
%		if ($group) { 
			<& "tabbar.mas", whoami => "tabbing", group => $group &>
%		}

		
		<form action="tabbing_save.mhtml" method="post">
		<input type="hidden" value="<% $group_id %>" name="group_id">

		<div class="half inline">
		
			<h4 class="padno">Pairing settings</h4>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty">
					<label for="no_back_to_back">
						Prevent back to back rounds
					</label>
				</span>
				<span class="smallishspan centeralign">
					<input type="checkbox" name="no_back_to_back" id="no_back_to_back" value="1" <% ($group) ? ($group->setting("no_back_to_back")) ? "checked" : "" : "" %>>
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty">
					<label for="judge_event_twice">
						Judges can get the same event twice
					</label>
				</span>
				<span class="smallishspan centeralign">
					<input type="checkbox" name="judge_event_twice" id="judge_event_twice" value="1" <% ($group) ? ($group->setting("judge_event_twice")) ? "checked" : "" : "" %>>
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap">
					<label for="allow_school_panels">
						Allow panels w/same school judges
					</label>
				</span>
				<span class="smallishspan centeralign">
					<input type="checkbox" name="allow_school_panels" id="allow_school_panels" value="1" <% ($group) ? ($group->setting("allow_school_panels")) ? "checked" : "" : "" %>>
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty">
					<label for="judge_randomize">
						Randomize judge assignments*
					</label>
				</span>
				<span class="smallishspan centeralign">
					<input type="checkbox" name="judge_randomize" id="judge_randomize" value="1" <% ($group) ? ($group->setting("judge_randomize")) ? "checked" : "" : "" %>>
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty">
					<label for="track_diversity">
						Diversity-enhanced judge placement
					</label>
				</span>
				<span class="smallishspan centeralign">
					<input type="checkbox" name="track_diversity" id="track_diversity" value="1" <% ($group) ? ($group->setting("track_diversity")) ? "checked" : "" : "" %>>
				</span>
			</div>

		</div>

%		undef $switch;

		<div class="half inline rightfloat">

			<h4 class="padno">MPJ placement weights</h4>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap smallish">
					Penalize non-mutual matches
				</span>
				<span class="smallishspan centeralign">
%					my $mutuality = $group->setting("mutuality") if $group;
%					$mutuality = 25 unless $mutuality;
%					$mutuality = 0 if $mutuality == -1;
					<input type="number" min=0 max=999 size=4 name="mutuality" value="<% $mutuality %>">
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap smallish">
					Penalize low-preferred matches
				</span>
				<span class="smallishspan centeralign">
%					my $preference = $group->setting("preference") if $group;
%					$preference = 25 unless $preference;
%					$preference = 0 if $preference == -1;
					<input type="number" min=0 max=999 size=4  name="preference" value="<% $preference %>">
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

			    <span class="twofifty wrap smallish">
					Avoid burning committments early
				</span>

				<span class="smallishspan centeralign">
%					my $round_burn_avoid = $group->setting("round_burn_avoid") if $group;
%					$round_burn_avoid = 25 unless $round_burn_avoid;
%					$round_burn_avoid = 0 if $round_burn_avoid == -1;
					<input type="number" min=0 max=999 size=4 name="round_burn_avoid" value="<% $round_burn_avoid %>">
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap smallish">
					Prefer hard-to-place judges
				</span>

				<span class="smallishspan centeralign">
%					my $sucktastic_judge_weight = $group->setting("sucktastic_judge_weight") if $group;
%					$sucktastic_judge_weight = 5 unless $sucktastic_judge_weight;
%					$sucktastic_judge_weight = 0 if $sucktastic_judge_weight == -1;
					<input type="number" min=0 max=999 size=4 name="sucktastic_judge_weight" value="<% $sucktastic_judge_weight %>">
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap smallish">
					Promote use of diverse judging
				</span>

				<span class="smallishspan centeralign">
%					my $diverse_judge_weight = $group->setting("diverse_judge_weight") if $group;
%					$diverse_judge_weight = 5 unless $diverse_judge_weight;
%					$diverse_judge_weight = 0 if $diverse_judge_weight == -1;
					<input type="number" min=0 max=999 size=4 name="diverse_judge_weight" value="<% $diverse_judge_weight %>">
				</span>
			</div>

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
			    <span class="twofifty wrap smallish">
					Stand-in rating for non-preffed judges:
				</span>
				<span class="smallishspan centeralign">
					<input type="number" min=1 max=99 size=4  name="default_mjp" value="<% ($group && $group->setting("default_mjp")) ? $group->setting("default_mjp") : "1" %>">
				</span>
			</div>

		</div>

		<br class="clear">

		<h4>Tabulation settings</h4>

%		my $audit_method = $group->setting("audit_method");
%		undef $switch;

		<div class="half inline">

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

                <span class="medspan">
					Ballot Entry Method
				</span>

                <span class="onesixty rightalign">

                    <select name="audit_method" class="fixedtiny" style="font-size: 100%;">

						<option value="twice" <% ($audit_method eq "twice") ? "selected" : "" %>> 
							Enter twice; 2nd must match
						</option>

						<option value="visual" <% ($audit_method eq "visual") ? "selected" : "" %>> 
							Visual scan with confirmation
						</option>

						<option value="none" <% ($audit_method eq "none") ? "selected" : "" %>> 
							Live dangerously; no required double-check
						</option>

					</select>

				</span>

			</div>

		</div>

%		undef $switch;

		<div class="half inline rightfloat">

%			my $master_ballot = $group->setting("master_ballot");

            <div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

                <span class="medspan">
					Master Ballot style
                </span>

                <span class="onesixty rightalign">

                    <select name="master_ballot" class="fixedtiny" style="font-size: 100%;">

						<option value=""></option>

						<option value="titles" <% ($master_ballot eq "titles") ? "selected" : "" %>> 
							Titles
						</option>

						<option value="names" <% ($master_ballot eq "names") ? "selected" : "" %>> 
							Names
						</option>

						<option value="both" <% ($master_ballot eq "both") ? "selected" : "" %>> 
							Names & Titles
						</option>

						<option value="name_schcode" <% ($master_ballot eq "name_schcode") ? "selected" : "" %>> 
							School Code & Entry Code & Entry Name
						</option>

						<option value="title_schcode" <% ($master_ballot eq "title_schcode") ? "selected" : "" %>> 
							School Code & Title
						</option>

						<option value="first" <% ($master_ballot eq "first") ? "selected" : "" %>> 
							First Names
						</option>

					</select>
				</span>

			</div>

		</div>

		<div class="half inline marno">

			<div class="optionblock <% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

			    <span class="twofifty wrap">
					<label for="ballot_entry_school_codes">
					Show school codes on ballot entry
					</label>
				</span>

				<span class="smallishspan centeralign">
					<input type="checkbox" name="ballot_entry_school_codes" id="ballot_entry_school_codes" value="1" <% ($group) ? ($group->setting("ballot_entry_school_codes")) ? "checked" : "" : "" %>>
				</span>

			</div>

		</div>


		<& "/funclib/editor.mas" &>

		<h4>Message for judge assignment sheets:</h4>

		<span class="block leftalign">
			<textarea name="judge_sheet_notice" rows=5 cols="58" wrap="virtual"><% ($group) ? $group->setting("judge_sheet_notice") : "" %></textarea>
		</span>

		<h4>Message about diversity policy</h4>

		<span class="block leftalign">
			<textarea name="diversity_notice" rows=5 cols="58" wrap="virtual"><% ($group) ? $group->setting("diversity_notice") : "" %></textarea>
		</span>


		<div class="liblrow rightalign">
			<input type="submit" value=" Save Pairing/Tabbing Settings">
			</form>
		</div>

		<p>*By default, in multi-event judge groups, Tabroom will prefer judges
		whose schools have more entries in that category.  Check this to
		disable this preference</p>

	</div>
