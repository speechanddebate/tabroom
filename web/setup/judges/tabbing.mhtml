<%args>
	$tourn
	$tourn_settings
	$person
	$category_id
	$new => undef
</%args>
<%perl>

	my $category = Tab::Category->retrieve($category_id);

	my %category_settings = $category->all_settings if $category;

</%perl>

	<& 
		"menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		page           => "tabbing",
		category_id    => $category_id,
	&>

	<div class="main">

		<h2>
			<% $category->name %>
		</h2> 
	
%		if ($category) { 
			<& 
				"tabbar.mas", 
				tourn          => $tourn,
				tourn_settings => $tourn_settings,
				whoami         => "tabbing",
				category       => $category
			&>
%		}

		
		<form action="tabbing_save.mhtml" method="post">

		<input 
			type  = "hidden"
			value = "<% $category_id %>"
			name  = "category_id"
		>

		<span class="pagehalf">
		
			<h5 class="padno">
				Pairing settings
			</h5>

			<label for="no_back_to_back">
				<div class="hover row">
					<span class="fivesixth">
						Prevent back to back rounds
					</span>
					<span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "no_back_to_back",
                            value   => $category_settings{"no_back_to_back"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

			<label for="judge_event_twice">
				<div class="hover row">
					<span class="fivesixth">
							Judges can get the same event twice
					</span>
					<span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "judge_event_twice",
                            value   => $category_settings{"judge_event_twice"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

			<label for="override_jpools">

				<div class="hover row">

					<span class="fivesixth">
						Do not let judge pools override categories
					</span>

					<span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "override_jpools",
                            value   => $category_settings{"override_jpools"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

%			if ($tourn_settings->{"ncfl"}) { 

				<label for="allow_school_panels">
					<div class="hover row">
						<span class="fivesixth">
							Allow panels w/same diocese judges
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas", 
								tag     => "allow_school_panels",
								value   => $category_settings{"allow_school_panels"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

				<label for="allow_region_panels">
					<div class="hover row">
						<span class="fivesixth">
							Allow panels w/same diocese region judges
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas", 
								tag     => "allow_region_panels",
								value   => $category_settings{"allow_region_panels"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

				<label for="conflict_region_judges">
					<div class="hover row">
						<span class="fivesixth">
							Conflict judges from same region
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas", 
								tag     => "conflict_region_judges",
								value   => $category_settings{"conflict_region_judges"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%			} else { 

				<label for="allow_school_panels">
					<div class="hover row">
						<span class="fivesixth">
							Allow panels w/same school judges
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas", 
								tag     => "allow_school_panels",
								value   => $category_settings{"allow_school_panels"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>

%				if ($tourn_settings->{"nsda_nats"} || $tourn_settings->{"regions"}) { 

					<label for="allow_region_panels">
						<div class="hover row">
							<span class="fivesixth">
								Allow panels w/same region judges
							</span>
							<span class="sixth centeralign">
								<& "/funclib/bool_switch.mas", 
									tag     => "allow_region_panels",
									value   => $category_settings{"allow_region_panels"},
									target  => $category,
									smaller => 1,
								&>
							</span>
						</div>
					</label>
%				} 
%			} 

%			unless ($tourn_settings->{"nsda_district"}) { 

				<label for="judge_randomize">
					<div class="hover row"
						title="By default, in multi-event judge categories, Tabroom will prefer
							judges whose schools have more entries in that category. Check this
							to disable that preference."
					>
						<span class="fivesixth">
							Randomize judge assignments*
						</span>
						<span class="sixth centeralign">
							<& "/funclib/bool_switch.mas", 
								tag     => "judge_randomize",
								value   => $category_settings{"judge_randomize"},
								target  => $category,
								smaller => 1,
							&>
						</span>
					</div>
				</label>
%			} 

			<label for="track_diversity">
				<div class="hover row">
					<span class="fivesixth">
						Use diversity tracking
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "track_diversity",
							value   => $category_settings{"track_diversity"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

%		unless ($tourn_settings->{"nsda_district"}) { 

			<label for="show_diversity">
				<div class="hover row">
					<span class="fivesixth">
						Show diversity opt-ins on prefs
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "show_diversity",
							value   => $category_settings{"show_diversity"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>
%		} 

		</span>

%		if ($category_settings{"prefs"} && $category_settings{"prefs"} ne "none") { 

			<span class="pagehalf">
				<h5 class="padno">
					MPJ placement weights
				</h5>
				<div class="row">
				  <span class="threequarter">
						Penalize non-mutual judges
					</span>
					<span class="quarter centeralign">

%						my $mutuality = $category_settings{"mutuality"} if $category;
%						$mutuality = 40 unless $mutuality;
%						$mutuality = 0 if $mutuality == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "mutuality"
							value = "<% $mutuality %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Penalize non-mutual panels
					</span>
					<span class="quarter centeralign">
%						my $panel_mutuality = $category_settings{"panel_mutuality"} if $category;
%						$panel_mutuality = 40 unless $panel_mutuality;
%						$panel_mutuality = 0 if $panel_mutuality == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "panel_mutuality"
							value = "<% $panel_mutuality %>">
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Penalize less preferred judges
					</span>
					<span class="quarter centeralign">
%						my $preference = $category_settings{"preference"} if $category;
%						$preference = 20 unless $preference;
%						$preference = 0 if $preference == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "preference"
							value = "<% $preference %>"
						>
					</span>
				</div>

				<div class="row">

				  <span class="threequarter">
						Avoid burning committments early
					</span>

					<span class="quarter centeralign">
%						my $round_burn_avoid = $category_settings{"round_burn_avoid"} if $category;
%						$round_burn_avoid = 5 unless $round_burn_avoid;
%						$round_burn_avoid = 0 if $round_burn_avoid == -1;
						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "round_burn_avoid"
							value = "<% $round_burn_avoid %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Prefer hard-to-place judges
					</span>

					<span class="quarter centeralign">
%						my $sucktastic_judge_weight = $category_settings{"sucktastic_judge_weight"} if $category;
%						$sucktastic_judge_weight = 10 unless $sucktastic_judge_weight;
%						$sucktastic_judge_weight = 0 if $sucktastic_judge_weight == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "sucktastic_judge_weight"
							value = "<% $sucktastic_judge_weight %>"
						>
					</span>
				</div>

				<div class="row">
				  <span class="threequarter">
						Promote use of diverse judging
					</span>

					<span class="quarter centeralign">

%						my $diverse_judge_weight = $category_settings{"diverse_judge_weight"} if $category;
%						$diverse_judge_weight = 5 unless $diverse_judge_weight;
%						$diverse_judge_weight = 0 if $diverse_judge_weight == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999999
							size  = 4
							name  = "diverse_judge_weight"
							value = "<% $diverse_judge_weight %>"
						>
					</span>
				</div>

				<div class="row">

					<span class="threequarter">
						Prefer hired judges over obligated
					</span>

					<span class="quarter centeralign">

%						my $mjp_prefer_hireds = $category_settings{"mjp_prefer_hireds"} if $category;
%						$mjp_prefer_hireds = 10 unless $mjp_prefer_hireds;
%						$mjp_prefer_hireds = 0 if $mjp_prefer_hireds == -1;

						<input 
							type  = "number"
							class = "smaller"
							min   = 0
							max   = 999
							size  = 4
							name  = "mjp_prefer_hireds"
							value = "<% $mjp_prefer_hireds %>">
					</span>
				</div>


				<div class="row">
				  <span class="threequarter">
						Stand-in rating for non-preffed judges:
					</span>
					<span class="quarter centeralign">
						<input 
							type  = "number"
							class = "smaller"
							min   = 1
							max   = 99
							size  = 4
							name  = "default_mjp"
							value = "<% $category_settings{"default_mjp"} %>"
						>
					</span>
				</div>


			</span>

			<br style="clear: both;">

%		}

%		my $audit_method = $category_settings{"audit_method"};

		<span class="pagehalf">
		
			<h5>
				Tabulation settings
			</h5>

			<div class="row">

				<span class="twofifth">
					Ballot Entry
				</span>

				<span class="rightalign threefifth">

				  <select name="audit_method" class="fixedmed nochosen">

						<option 
							value="twice" 
							<% ($audit_method eq "twice") ? "selected" : "" %>
						> Enter twice; 2nd must match
						</option>

						<option 
							value="visual" 
							<% ($audit_method eq "visual") ? "selected" : "" %>
						> Visual scan with confirmation
						</option>

						<option 
							value="none" <% ($audit_method eq "none") ? "selected" : "" %>
						> Live dangerously; no required double-check
						</option>

					</select>

				</span>

			</div>

            <label for="show_names">
                <div class="hover row">
                    <span class="fivesixths smallish">
						Show entry names not codes on ballot manual entry
                    </span>
                    <span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "show_names",
                            value   => $category_settings{"show_names"},
                            target  => $category,
                            smaller => 1,
                        &>
                    </span>
                </div>
            </label>

            <label for="show_affs">
                <div class="hover row">
                    <span class="fivesixths smallish">
						Show ballot entry index by entry code not by judge
                    </span>
                    <span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "show_affs",
                            value   => $category_settings{"show_affs"},
                            target  => $category,
                            smaller => 1,
                        &>
                    </span>
                </div>
            </label>


			<label for="ballot_entry_school_codes">
				<div class="hover row">
					<span class="fivesixth">
						Show <% $tourn_settings->{"ncfl"} 
							? "diocese" : "school"
						%> codes on ballot entry
					</span>
					<span class="sixth centeralign">
                        <& "/funclib/bool_switch.mas", 
                            tag     => "ballot_entry_school_codes",
                            value   => $category_settings{"ballot_entry_school_codes"},
                            target  => $category,
                            smaller => 1,
                        &>
					</span>
				</div>
			</label>

%		if ($category_settings{"prefs"} && $category_settings{"prefs"} ne "none") { 
			</span>
			<span class="pagehalf">
%		}

			<h5>Ballot Formats</h5>

			<label for="ballot_entry_names">
				<div class="hover row">
					<span class="fivesixth">
						List Entry Names
					</span>

					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_entry_names",
							value   => $category_settings{"ballot_entry_names"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_entry_first_names">
				<div class="hover row">
					<span class="fivesixth">
						List Entry First Names
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_entry_first_names",
							value   => $category_settings{"ballot_entry_first_names"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_entry_titles">
				<div class="hover row">
					<span class="fivesixth">
						Space for piece titles/question
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_entry_titles",
							value   => $category_settings{"ballot_entry_titles"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_times">
				<div class="hover row">
					<span class="fivesixth">
						Space for times
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_times",
							value   => $category_settings{"ballot_times"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_school_codes">
				<div class="hover row">
					<span class="fivesixth">
						School codes
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_school_codes",
							value   => $category_settings{"ballot_school_codes"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_school_names">
				<div class="hover row">
					<span class="fivesixth">
						School names
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_school_names",
							value   => $category_settings{"ballot_school_names"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>

			<label for="ballot_judge_phones">
				<div class="hover row">
					<span class="fivesixth">
						Ask judges for their cell # on ballots
					</span>
					<span class="sixth centeralign">
						<& "/funclib/bool_switch.mas", 
							tag     => "ballot_school_phones",
							value   => $category_settings{"ballot_school_phones"},
							target  => $category,
							smaller => 1,
						&>
					</span>
				</div>
			</label>
		</span>
		<div class="libl full rightalign marvertno">
			<input 
				type  = "submit"
				value = "Save Pairing/Tabbing Settings"
			>
			</form>
		</div>
	</div>
