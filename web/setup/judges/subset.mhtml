<%args>
	$tourn
	$group_id
</%args>

<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id) if $group_id; 
	my $switch;

</%init>

	<& menubar.mas, group_id => $group_id, tourn => $tourn, page => "subset" &>

	<div class="left huge">

		<h2>Coach Rating Subsets</h2>

		<p>
			Use these if you want judges to be rated by their coaches
			separately for sets of events; ie you want judges to be rated
			in Extemp differently than they'd be rated in Interp events.
			This only works for coach ratings, not for MPJ/Community Prefs.
		</p>

		<table cellpadding="6" cellspacing="1" width="100%">

%			foreach my $rating_subset ($group->rating_subsets) { 
			
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						<% $switch %>
					</td>

					<td>
						<% $rating_subset->name %>
					</td>

					<td class="smaller">

%						foreach my $event ($rating_subset->events) { 
							<span style="display: inline-block; width: 40px; padding-left: 1px; padding-right: 2px;">
								<% $event->abbr %>
							</span>
%						}

					</td>
		
					<td align="center">
						<a class="dkred block" href="subset_rm.mhtml?rating_subset_id=<% $rating_subset->id %>">
							Delete
						</a>
					</td>

				</tr>

%			}

			<tr class="liblrow">

					<th class="smaller">
						New:
						<form action="subset_add.mhtml" method="post">
						<input type="hidden" name="group_id" value="<% $group->id %>">
					</th>

					<td colspan="2">
						<input type="text" name="name" size="35" value="">
					</td>

					<td align="center">
						<input type="submit" class="thin" value=" Add New ">
						</form>
					</td>

				</tr>

			</table>

			<br />


%		if (scalar $group->rating_subsets > 0) { 

			<h3>Event Group Assignments</h3>
			
			<form action="subset_events.mhtml" method="post">
			<input type="hidden" name="group_id" value="<% $group->id %>">
		
			<table cellpadding="6" cellspacing="1" width="100%">

%				foreach my $event ($group->events) { 
			
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% $event->name %>
						</td>
		
						<td class="rightalign">

							<select name="<% $event->id %>" class="small">

								<option value=""> ----- </option>

%								foreach my $rating_subset ($group->rating_subsets) { 

									<option value="<% $rating_subset->id %>" 
										<% ( ($event->rating_subset && $event->rating_subset->id) && ($event->rating_subset->id == $rating_subset->id)) ? "selected" : "" %>>
										<% $rating_subset->name %>
									</option>
%								}

							<select>

						</td>

					</tr>

%				}


				<tr class="liblrow">
					<td colspan="2" align="right">
						<input type="submit" class="smaller" value="Save Changes" style="width: 150px;">
						</form>
					</td>
				</tr>

			</table>

%		}

	</div>


