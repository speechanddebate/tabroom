<%args>
	$entry
	$type => undef
	$published => undef
	$post_results => undef
</%args>
<%init>

	if ($published) { 

		Tab::Panel->set_sql( published_by_entry => "
			select distinct panel.*	
				from panel, ballot, round
				where ballot.entry = ?
				and ballot.panel = panel.id
				and round.id = panel.round
				and round.published = 1
				and round.post_results != 1");

		return Tab::Panel->search_published_by_entry($entry->id);

	} elsif ($post_results) {  

		Tab::Panel->set_sql( posted_by_entry => "
			select distinct panel.*	
				from panel, ballot, round
				where ballot.entry = ?
				and ballot.panel = panel.id
				and round.id = panel.round
				and round.published != 1
				and round.post_results = 1");

		return Tab::Panel->search_posted_by_entry($entry->id);

	} elsif ($type) { 

		Tab::Panel->set_sql( by_entry => "
			select distinct panel.*	
				from panel, ballot
				where ballot.entry = ?
				and ballot.panel = panel.id");

		return Tab::Panel->search_posted_by_entry($entry->id);

	} else { 

		Tab::Panel->set_sql( by_entry => "
			select distinct panel.*	
				from panel, ballot
				where ballot.entry = ?
				and ballot.panel = panel.id");

		return Tab::Panel->search_posted_by_entry($entry->id);

	}
	
</%init>

