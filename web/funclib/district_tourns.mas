<%args>
	$district
	$year   => undef
	$hidden => 1
</%args>
<%init>

	$year = &Tab::school_year() unless $year;

	my $year_end = $year->clone();

	$year_end->add(years => 1);

	my $hidden_limit = "and tourn.hidden != 1";
	undef $hidden_limit if $hidden < 1;

	Tab::Tourn->set_sql( districts => "
		select tourn.*
		from tourn, tourn_setting
		where tourn.id = tourn_setting.tourn
		and tourn_setting.tag = 'nsda_district'
		and tourn_setting.value = ?
		and tourn.start > ?
		and tourn.start < ?
		$hidden_limit
		order by tourn.start
	");


	return Tab::Tourn->search_districts(
		$district->id, 
		DateTime::Format::MySQL->format_datetime($year),
		DateTime::Format::MySQL->format_datetime($year_end)
	);

</%init>
