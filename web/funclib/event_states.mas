<%args>
	$event
</%args>
<%init>

	my $dbh = Tab::DBI->db_Main();

	my $sth = $dbh->prepare('
        select chapter.state, chapter.country
        	from chapter, school, entry
        where entry.event = ?
			and entry.school = school.id
			and school.chapter = chapter.id
			and exists (
				select ballot.id
				from ballot
				where ballot.entry = entry.id
			)
	');

	$sth->execute($event->id);
	my $chapters = $sth->fetchall_hash();

	my %uniq;

	foreach my $chapter (@{$chapters}) {
		if ($chapter->{state}) {
			$uniq{$chapter->{state}}++;
		} elsif ($chapter->{country}) {
			$uniq{$chapter->{country}}++;
		}
	}

	my $count = scalar(keys %uniq);
    return $count;

</%init>
