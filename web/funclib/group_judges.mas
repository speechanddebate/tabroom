<%args>
	$group
</%args>
<%init>

	return unless $group;

	my $prefs = $group->setting("prefs");

	if ($prefs && $prefs ne "none" && $prefs ne "ordinals") { 
		
		Tab::debuglog($prefs);

		Tab::Judge->set_sql( by_group => "
			select distinct judge.*, group_concat(distinct rating.id, rating_tier.name) as avg
			from judge, rating, rating_tier
			where judge.judge_group = ?
			and judge.active = 1
			and judge.id = rating.judge
			and rating.rating_tier = rating_tier.id
			group by judge.id
			order by judge.code, judge.last");

		return Tab::Judge->search_by_group($group->id);

	} elsif ($prefs eq "ordinals") { 

		Tab::debuglog("WT1F");

		Tab::Judge->set_sql( by_group => "
			select distinct judge.*, group_concat(distinct rating.id, rating.percentile) as avg
			from judge, rating
			where judge.judge_group = ?
			and judge.active = 1
			and judge.id = rating.judge
			group by judge.id
			order by judge.code, judge.last");

		return Tab::Judge->search_by_group($group->id);

	} else { 

		Tab::debuglog("WTF");

		return $group->judges(active => 1);

	}


</%init>
