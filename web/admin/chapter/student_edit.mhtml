<%args>
	$circuit
	$account
	$student_id => undef
	$err => undef;
	$chapter_id => undef;
	$from => undef;
</%args>

<%init>

	my $student = Tab::Student->retrieve($student_id) if $student_id;
	$chapter_id = $student->chapter->id if $student;

	my @results = $student->results if $student;

	@results = sort {$b->tournament->start->epoch <=> $a->tournament->start->epoch} @results;

</%init>

	<div id="leftsmall">

		<table width="100%">

			<tr>
				<td width="100%">

%					if ($student) {

						<h3>Edit <%$student->first." ".$student->last %></h3>

% 					} else { 

						<h3>Create new student</h3>

% 					}

				</td>
			</tr>

		</table>

<table cellpadding="3" width="100%" >

<form action="student_save.mhtml" method="post">
<input type="hidden" name="student_id" value="<% ($student) ? $student->id : "" %>">
<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
<input type="hidden" name="from" value="<% $from %>">

%	my $switch;

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>First:</td>
<td><input type="text" name="first" size="15" value="<% ($student) ? $student->first : "" %>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Last:</td>
<td><input type="text" name="last" size="15" value="<% ($student) ? $student->last : ""%>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Phonetic Pronunciation:</td>
<td><input type="text" name="phonetic" size="15" value="<% ($student) ? $student->phonetic : ""%>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Grad Year:</td>
<td><input type="text" name="grad_year" size="6" value="<% ($student) ?   $student->grad_year : ""%>"></td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Novice:</td>
<td><input type="checkbox" name="novice" value="1" <% ($student) ?  ($student->novice) ? 'checked' : '': "" %> ></td> 
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Gender:</td>
<td>
<input type="radio" name="gender" value="M" <% ($student) ? ($student->gender eq "M") ? "checked" : "" : "" %>> M
<input type="radio" name="gender" value="F" <% ($student) ? ($student->gender eq "F" ) ? "checked" : "" : "" %>> F
</td>
</tr>


<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td>Gender:</td>
<td></td>
</tr>


<tr>
<td colspan="2" align="right">
	<input  type="submit" value="  Save Student  ">
</td>
</tr>

</form>

</table>


</div>

<div id="rightbig">

<form action="student_roster.mhtml" method="post">
<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
<td valign="top" width="60%">
<table>
<tr>
<td width="100%">
<h3>Tournament Record</h3>
</td>
<td align="right">
<input  type="submit" value="Return to Roster">
</td>
</tr>
</table>
</form>

<table cellpadding="4" cellspacing="1" width="100%">

%	undef $switch;

% 	foreach my $result (@results) { 

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\""%> >
		<td><%substr($result->tournament->name,0,25)." ".$result->tournament->start->year%></td>
		<td><%$result->event->abbr%></td>
		<td>Place: <%$result->rank%></td>
		<td><%$result->results_bar%></td>
		<td><% ($result->bid) ? "Bid" : "" %></td>
	</tr>	

% }
</table>
</td>
</tr>
</table>

