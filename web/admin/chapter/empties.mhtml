<%args>
	$account	
</%args>
<%init>

	Tab::Chapter->set_sql(by_no_schools => "select chapter.id	
								from chapter left join school
                                on chapter.id = school.chapter
                                where school.chapter is null");

	Tab::Chapter->set_sql(by_no_students => "select chapter.id
								from chapter left join student
                                on chapter.id = student.chapter
                                where student.chapter is null");

	my @school_chapters = Tab::Chapter->search_by_no_schools;
	my @student_chapters = Tab::Chapter->search_by_no_students;

	my %original = ();

	map { $original{$_} = 1 } @school_chapters;
	my @chapters = grep { $original{$_} } @student_chapters;

    #uniq
    my %seen = ();
    @chapters = grep { ! $seen{$_->id} ++ } @chapters;

	@chapters = sort {$a->name cmp $b->name} @chapters;

	my $switch;

</%init>

	<div class="left huge">

		<h2><% scalar @chapters %> Empty Chapters found</h2>

%		if (@chapters) { 

		<table cellpadding="5" cellspacing="1" width="100%">

			<tr class="lirdrow">

				<th>
					Name:
				</th>

				<th>
					ID
				</th>

				<th>
					ST
				</th>
	
				<th width="25%">
					Circuits
				</th>
	
				<th>
					<form action="empties_delete.mhtml" method="post">
					Del:
				</th>
	
			</tr>
	
% 			foreach my $chapter (sort {$a->name cmp $b->name} @chapters) { 
	
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	
					<td>
	
						<a href="chapter_edit.mhtml?chapter_id=<% $chapter->id%>">
							<% $chapter->name %>
						</a>
	
					</td>
	
					<td>
						<% $chapter->id %>
					</td>
	
					<td>
						<% $chapter->state %>
					</td>
	
					<td class="explain">
%						foreach my $circuit ($chapter->circuits) {
							<% $circuit->short_name %>
%						}
					</td>
	
					<td align="center">
						<input type="checkbox" name="<% $chapter->id %>" value="1" checked>
					</td>
	
				</tr>
	
% 			} # end of foreach chapter. 
	
			<tr class="liblrow">
	
				<td colspan="2">
					Type "I am certain" in the box to delete these chapters:
				</td>
	
				<td colspan="3" class="right">
					<input type="text" name="certain" size="25">
				</td>
	
			</tr>
	
			<tr class="lirdrow">
	
				<td colspan="5" class="right">
					<input type="submit" class="red" value=" Delete all checked chapters ">
					</form>
				</td>
	
			</tr>
	
		</table>

%		}
	
	</div>
	
	<& chapter_menu.mas &>
	
