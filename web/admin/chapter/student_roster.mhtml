<%args>
	$account
	$chapter_id
	$show_graduated => undef
	$err => undef
	$sort_by => "last"
	$from => undef
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);
	my @students;
 
	if ($show_graduated) { 

		@students = $chapter->students;

	} else {

		@students = $chapter->nongrads;

	}

	@students = sort {$a->last cmp $b->last} @students;

	@students = sort {$a->grad_year <=> $b->grad_year} @students if $sort_by eq "grad_year";

	@students = sort {$b->novice <=> $a->novice } @students if $sort_by eq "novice";

	@students = sort {$b->retired <=> $a->retired } @students if $sort_by eq "retired";

	my $message;

</%init>

	<div class="left huge">

		<table cellpadding="0" width="100%">
	
			<tr>
				<td width="100%">
					<h2><% $chapter->name %> Student Roster</h2>
				</td>

				<td>
					<form action="/admin/chapter/chapter_edit.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
					<input type="submit" value=" Back ">
					</form>
				</td>

			</tr>

		</table>

		<table width="100%" cellpadding="4" cellspacing="1">

			<tr class="liblrow">
				<th>
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_graduated=<% $show_graduated %>&sort_by=last"> 
						Name
					</a>
				</th>

				<th>
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_graduated=<% $show_graduated %>&sort_by=grad_year">
						Graduates
					</a>
				</th>

				<th>
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_graduated=<% $show_graduated %>&sort_by=novice">
						Nov
					</a>
				</th>

%				if ($show_graduated) { 
					<th>
						<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_graduated=<% $show_graduated %>&sort_by=retired">
							Ret.
						</a>
					</th>
%				}

				<th class="right" colspan="2">

					<form action="student_roster.mhtml" method="post">
					<input type="hidden" name="chapter_id" value="<% $chapter_id %>">

%  					if ($show_graduated) {
						<input class="grey" type="submit" value="Hide Inactives" align="right">
%					} else {
						<input type="hidden" name="show_graduated" value="boomshika">
						<input class="grey" type="submit" value="Show Inactives" align="right">
% 					}

					</form>
						
						
				</th>

			</tr>

% 			my $switch; 

% 			foreach my $student (@students) { 

%				next if $student->retired &! $show_graduated;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a id="<% $student->id %>"></a>
						<% $student->last.", ".$student->first %>
					</td>

					<td class="center">
						<% $student->grad_year %>
					</td>

					<td class="center">
						<% ($student->novice) ? "*" : "" %>
					</td>

%					if ($show_graduated) { 
						<td class="center">
							<% ($student->retired) ? "Y" : "" %>
						</td>
%					}
							
					<td class="center">
						<a class="white block" href="student_edit.mhtml?student_id=<% $student->id %>">
							Edit
						</a>
					</td>

					<td class="center">
						<a class="white block" href="student_retire.mhtml?student_id=<% $student->id %>">
							<% ($student->retired) ? "Unretire" : "  Retire  " %>
						</a>
					</td>

				</tr>

% 			}

		</table>

	</div>

	<div class="right small">

		<table width="100%" cellpadding="3">

			<tr>

				<td colspan="4">
					<h3>Add new student</h3>
					<form action="student_save.mhtml" method="post"> 
					<input type="hidden" name="chapter_id" value="<% $chapter_id %>">
				</td>

			</tr>

			<tr>
				<td>
					First:
				</td>

				<td colspan="3">
					<input type="text" name="first" size="15">
				</td>

			</tr>
	
			<tr class="evenrow">

				<td>
					Last:
				</td>

				<td colspan="3">
					<input type="text" name="last" size="15">
				</td>

			</tr>

			<tr>
				<td>
					Phonetic Guide:
				</td>

				<td colspan="3">
					<input type="text" name="phonetic" size="15">
				</td>
			</tr>

			<tr class="evenrow">

				<td>
					Grad Year:
				</td>

				<td colspan="2">
					<input type="text" name="grad_year" size="5">
				</td>

			</tr>

			<tr>
				<td>
					Novice:
				</td>

				<td>
					<input type="checkbox" name="novice" value="1">
				</td>
			</tr>

			<tr class="evenrow">	
				<td>
					Gender:
				</td>

				<td>
					<input type="radio" name="gender" value="F">F
				</td>

				<td>
					<input type="radio" name="gender" value="M">M
				</td>
			</tr>

			<tr>
				<td align="right" colspan="4">
				<input  type="submit" value="   Save Student   ">
				</form>
				</td>
			</tr>

		</table>

	</div>

	
