<%args>
	$chapter_id
	$email
	$account
</%args>
<%init>

	$email =~tr/[A-Z]/[a-z]/;
	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my @accs = Tab::Account->search( email => $email);

	my $err;

	unless (@accs) { 

		$err = "The email $email has no account on this system.  ";
		$err .= "The coach must sign up for an account first before access to this chapter can be granted.";
		$m->redirect("$Tab::url_prefix/admin/chapter/chapter_edit.mhtml?err=$err&chapter_id=$chapter_id");

	}

	my $coach = Tab::ChapterAccess->create({

		chapter => $chapter_id,
		account => $accs[0]->id

	});

	my $msg = "Coach ".$accs[0]->first." ".$accs[0]->last." has been given access to ". $chapter->name;	

	$m->redirect("$Tab::url_prefix/admin/chapter/chapter_edit.mhtml?msg=$msg&chapter_id=$chapter_id");

</%init>
