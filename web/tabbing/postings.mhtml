<%args>
	$timeslot_id => undef
	$tourn
</%args>
<%init>

	my $tourn_id = $tourn->id;

	if ($timeslot_id) {

		my $timeslot = Tab::Timeslot->retrieve($timeslot_id);

		my @panels = $timeslot->panels;

	    my $filename = $Tab::file_root."/tmp/postings-".$tourn->id."-".$timeslot_id;
		my $garbage = `rm -f $filename.*`;
		open (TEXOUT, ">$filename.tex");

		print TEXOUT <<'EOF';

\documentclass[12pt]{article}
\usepackage{fullpage}
\usepackage{times}


% Overrule the maximum in font-size in ot1cmr.fd:
\DeclareFontShape{OT1}{cmr}{m}{n}
     {%
        <5><6><7><8><9>gen*cmbx%
        <10><10.95>cmbx10%
        <12><14.4><17.28><20.74><24.88->cmbx12%
        }{}
  
\begin{document}
\begin{center}

EOF
		foreach my $panel (@panels) {

			my @comps = $panel->comps;
			my @judges = $panel->judges;

		print TEXOUT "\\fontsize{50pt}{50pt}\\selectfont ".$panel->event->name." \\\\ - \\\\ \n";
		print TEXOUT "\\begin{tabular*}{.6\\textwidth}\n";
		print TEXOUT "{\@{\\extracolsep{\\fill}}cc}\n";

		my $count = 1;
		foreach my $comp (@comps) { 

			print TEXOUT $comp->code;

			if ($count == 1) { 

				print TEXOUT " & ";
				$count++;	


			} else { 
				print TEXOUT " \\\\ \n";
				$count--;

			}

		}

		print TEXOUT  "\\end{tabular*}\n";
		print TEXOUT  "\\newline\n";
		print TEXOUT  "\\fontsize{45pt}{45pt}\\selectfont\n";

		print TEXOUT  "Room: ".$panel->room->name." \\\\ \n";
		print TEXOUT  "Judges: \\\\ \n";

		foreach my $judge (@judges) { 

			print TEXOUT "J".$judge->code." ";
	
		}
		
			print TEXOUT "\\\\ \n \\newpage \n";
	
		}

		print TEXOUT "\\end{center}\n";
		print TEXOUT "\\end{document}\n";


    $garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
#    $garbage = `rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect("$Tab::url_prefix/tmp/postings-$tourn_id-$timeslot_id.pdf");


	}

	my @timeslots = $tourn->timeslots;
	@timeslots = sort {$b->start <=> $a->start} @timeslots;

</%init>

<h3>Print postings for round:</h3>

<center>
<form action="postings.mhtml" method="post"> 
<p>
	<select name="timeslot_id">
% foreach my $ts (@timeslots) {
		<option value="<% $ts->id %>"><% $ts->name %></option>
% }
	</select>
</p>
<p><input  type="submit" value="Print"></p>
</form>
</center>
