<%args>
	$judge_id
	$panel_id
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	my $panel = Tab::Panel->retrieve($panel_id);

	my $audit = 1 if $ARGS{"audit_".$judge_id};

	foreach my $comp ($panel->comps) { 
	
		my @ballots = Tab::Ballot->search( judge => $judge->id, panel => $panel->id, comp => $comp->id );

		next unless @ballots;

		my $ballot = shift @ballots;

		foreach my $spare (@ballots) { $spare->delete; }

		$ballot->real_rank($ARGS{"rank_".$ballot->id});

		$ballot->real_points($ARGS{"points_".$ballot->id});

		$ballot->tv($ARGS{"tv_".$ballot->id});

		$ballot->noshow($ARGS{"noshow_".$ballot->id});

		$ballot->audit($audit);

		$ballot->update;

	}


	$m->redirect("panel_card.mhtml?panel_id=".$panel_id);


</%init>


