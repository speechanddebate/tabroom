<%args>
	$tourn
	$tourn_settings
	$perms
	$person
	$person_settings
	$what         => undef
	$sweep_set_id => undef
</%args>
<%init>

	if ($what eq "Print") { 	
		$m->redirect("sweep_students_print.mhtml?sweep_set_id=$sweep_set_id");
	}   

	my @sweep_sets;

	my $master_set = Tab::SweepSet->retrieve($sweep_set_id);

	unless ($master_set) { 
		my $err = "You must select a set of sweepstakes rules to run this report";
		$m->redirect("index.mhtml?err=$err");
	}

	my @results = $m->comp(
		"/tabbing/results/sweep_tourn.mas",
		sweep_set => $master_set,
		tourn     => $tourn
	);

	my $entries_ref = pop @results;

	my %event_by_id = map {$_->id => $_} $tourn->events;

</%init>

	<div class="menu">

		<div class="sidenote">

			<h4>Nav</h4>

			<div class="full row centeralign">
				<form action="sweep_entries.mhtml" method="post">

				<select 
					name     = "sweep_set_id"
					class    = "fixedmed"
					onchange = "this.form.submit();";
				>
%					foreach my $set (sort {$a->name cmp $b->name} $tourn->sweep_sets) {
						<option
							value    = "<% $set->id %>"
							<% $set->id == $sweep_set_id ? 'selected="selected"' : "" %>
						> <% $set->name %> </option>
%					}
				</select>
				</form>
			</div>

			<a class = "blue full"
				href = "/tabbing/report/index.mhtml"
			>
				Return to Reports
			</a>

%			if ($person->site_admin || $person_settings->{"nsda_admin"}) { 
				<a class = "blue full"
					href = "/tabbing/report/sweep_post.mhtml?sweep_set_id=<% $sweep_set_id %>"
				>Post to NSDA Database</a>
%			}

		</div>

	</div>

	<div class="main">

		<span class="twothirds nospace">
			<h4><% $master_set->name %> by Entries</h4>
		</span>
		<span 
			id    = "entrysweeps_buttonarea"
			class = "third rightalign nospace"
		>
		</span>

		<& "/funclib/tablesorter.mas", table => "entrysweeps" &>

		<table id="entrysweeps">

			<thead>

				<tr class="yellowrow smallish">
					<th>
						Event
					</th>

					<th>
						Entry Code
					</th>

					<th>
						Entry Name
					</th>

					<th>
						School
					</th>

%					if ($tourn_settings->{"nsda_nats"}) { 
						<th>
							State
						</th>
%					}

%					foreach my $rule_id (@{$entries_ref->{"rules"}}) { 
						<th>
							<% $entries_ref->{"tag"}{$rule_id} %>
						</th>
%					}

					<th>
						Total
					</th>

				</tr>

			</thead>

			<tbody>

%				foreach my $entry_id (@{$entries_ref->{"entries"}}) { 

					<tr>
					
						<td>
							<% $event_by_id{$entries_ref->{$entry_id}{"event"}}->abbr %>
						</td>

						<td>
							<% $entries_ref->{$entry_id}{"code"} %>
						</td>

						<td>
							<% $entries_ref->{$entry_id}{"name"} %>
						</td>

						<td>
							<% $entries_ref->{$entry_id}{"schoolname"} %>
						</td>

%						if ($tourn_settings->{"nsda_nats"}) { 
							<td>
								<% $entries_ref->{$entry_id}{"state"} %>
							</td>
%						}

%						foreach my $rule_id (@{$entries_ref->{"rules"}}) { 
							<td>
								<% $entries_ref->{$entry_id}{$rule_id} %>
							</td>
%						}

						<td>
							<% $entries_ref->{$entry_id}{"points"} %>
						</td>


					</tr>

% 				}

			</tbody>

		</table>

	</div>

