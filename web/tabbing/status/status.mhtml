<%args>
	$tourn
	$tourn_settings
	$perms
	$person
	$session
	$defaults    => undef
	$checker     => undef
	$round_id    => undef
	$timeslot_id => undef
</%args>
<%init>

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	my $round = Tab::Round->retrieve($round_id) if $round_id;

	if ($round) {
		$ARGS{"event_id"} = $round->event->id;
	}

	my %events = $m->comp("/funclib/perms/events.mas",
		tourn   => $tourn,
		perms   => $perms,
		checker => 1,
		limited => 1,
		by_both => 1
	);

	my @categories = $m->comp("/funclib/perms/categories.mas",
		tourn   => $tourn,
		perms   => $perms,
		checker => 1
	);

	my %categories = map {$_->id => $_} @categories;

	my %timeslots = $m->comp("/funclib/perms/timeslots.mas",
		tourn => $tourn,
		perms => $perms,
		by_both => 1
	);

	my @timeslot_ids = sort {
		$timeslots{$a}{"start"}{'epoch'} <=> $timeslots{$b}{"start"}{'epoch'}
		|| $timeslots{$a}{"end"}{'epoch'} <=> $timeslots{$b}{"end"}{'epoch'}
		|| $timeslots{$a}{"name"} cmp $timeslots{$b}{'name'}
	} keys %timeslots;

	my $timeslot;
	if ($timeslot_id) {
		$timeslot = Tab::Timeslot->retrieve($timeslot_id);
	}

	my $dbh = Tab::DBI->db_Main();
	my $longest_code;

	my $campus_sth = $dbh->prepare("
		select event.id
			from event
		where event.tourn = ?
			and not exists (
				select es.id
					from event_setting es
				where es.event = event.id
				and es.tag = 'online_mode'
				and es.value = 'async'
			)
	");

	my %ok;
	$campus_sth->execute($tourn->id);

	while (
		my ($event_id) = $campus_sth->fetchrow_array()
	) {
		$ok{$event_id}++;
	}

	foreach my $key (keys %events) {
		next if $ok{$key};
		delete $events{$key};
	}

	my $event;

	if ($ARGS{timeslot_id}) {

	} elsif ($ARGS{event_id} && $events{$ARGS{"event_id"}}) {
		$event = $events{$ARGS{"event_id"}};
	} elsif ($defaults->{tourns}{$tourn}{event} && $events{$defaults->{tourns}{$tourn}{event}}) {
		$event = $events{$defaults->{tourns}{$tourn}{event}};
	} elsif (scalar (keys %events) == 1) {
		my @events = keys %events;
		$event = $events{$events[0]};
	}

	if ($event) {
		$defaults->{tourns}{$tourn}{event} = $event->{id};
		$session->default($defaults);
	}

	my %rounds;
	my %judges;
	my $limit;

	if ($timeslot_id) {
		$timeslot_id = int($timeslot_id);
		$limit = " where round.timeslot = ".$timeslot_id;
	} elsif ($event) {
		$limit = "where round.event = ".$event->{id};
	}


	my $round_sth = $dbh->prepare("
		select
			round.id, round.name, round.label,
			round.timeslot,
			panel.id, panel.bye,
			ballot.audit, ballot.judge_started, ballot.bye, ballot.forfeit,
			ballot.chair,
			event.id, event.abbr,
			dont_poke.value,
			online_hybrid.value,
			online_mode.value,
			status_by_entry.value

		from (round, panel, ballot, event)

			left join event_setting dont_poke
				on dont_poke.event = event.id
				and dont_poke.tag = 'dont_poke_entries'

			left join event_setting online_hybrid
				on online_hybrid.event = event.id
				and online_hybrid.tag = 'online_hybrid'

			left join event_setting online_mode
				on online_mode.event = event.id
				and online_mode.tag = 'online_mode'

			left join event_setting status_by_entry
				on status_by_entry.event = event.id
				and status_by_entry.tag = 'status_by_entry'

		$limit
			and round.id = panel.round
			and panel.id = ballot.panel
			and round.event = event.id
		group by panel.id, ballot.judge
		order by round.name
	");

	my $dont_poke;
	my $online_hybrid;

	if ($event || $timeslot_id) {

		$round_sth->execute();

		while (
			my (
				$rid, $round_name, $round_label, $timeslot,
				$panel_id, $panel_bye,
				$ballot_audit, $ballot_judge_started, $ballot_bye, $ballot_forfeit,
				$chair,
				$event_id, $event_abbr, $dont_poke_value,
				$online_hybrid_value,
				$online_mode,
				$status_by_entry
			) = $round_sth->fetchrow_array()
		) {

			$dont_poke += $dont_poke_value;
			$online_hybrid += $online_hybrid_value;

			unless ($rounds{$rid}{"number"}) {

				$rounds{$rid}{"online"}   = $online_mode;
				$rounds{$rid}{"by_entry"} = $status_by_entry;
				$rounds{$rid}{"hybrid"}   = $online_hybrid_value;
				$rounds{$rid}{"event"}    = $event_abbr;
				$rounds{$rid}{"number"}   = $round_name;

				if ($round_label) {
					$rounds{$rid}{"label"} = $round_label;
				} else {
					$rounds{$rid}{"label"} = "Round ".$round_name;
				}

				$rounds{$rid}{"done"}++;
			}

			$rounds{$rid}{"total"}++;

			if ($ballot_audit
				|| $ballot_bye
				|| $ballot_forfeit
				|| $panel_bye
			) {

				$rounds{$rid}{"audited"}++;
				$rounds{$rid}{"started"}++;

			} elsif ($ballot_judge_started) {

				$rounds{$rid}{"started"}++;
				undef $rounds{$rid}{"done"};

			} else {

				undef $rounds{$rid}{"started"};
				undef $rounds{$rid}{"done"};
			}
		}
	}

	my %panels;
	my %types;
	my $max_flight;

	if ($round_id || $timeslot_id) {

		my $limit;

		if ($round_id) {
			$round_id = int($round_id);
			$limit = "where round.id = ".$round_id;
		} elsif ($timeslot_id) {
			$timeslot_id = int($timeslot_id);
			$limit = "where round.timeslot = ".$timeslot_id;
		}

		my $entries_sth = $dbh->prepare("
			select
				panel.id, panel.letter, panel.bye, panel.flight, panel.round,
				ballot.id, ballot.side, ballot.speakerorder, ballot.bye, ballot.forfeit,
				entry.id, entry.code,
				school.code, school.name,
				online_hybrid.value,
				student.id, student.first, student.last, student.person,
				room.name,
				event.abbr, event.type,
				max_entry.value

			from (panel, ballot, entry, entry_student es, student, round, event)

				left join room on panel.room = room.id

				left join entry_setting online_hybrid
					on online_hybrid.entry = entry.id
					and online_hybrid.tag = 'online_hybrid'

				left join event_setting max_entry
					on max_entry.event = event.id
					and max_entry.tag = 'max_entry'

				left join school on entry.school = school.id

			$limit
				and round.id = panel.round
				and panel.id = ballot.panel
				and ballot.entry = entry.id
				and entry.id = es.entry
				and es.student = student.id
				and entry.event = event.id
		");

		$entries_sth->execute();
		my $luddite_alert;

		while (
			my (
				$panel_id, $panel_letter, $panel_bye, $flight, $round_id,
				$ballot_id, $ballot_side, $ballot_speakerorder, $ballot_bye, $ballot_forfeit,
				$entry_id, $entry_code,
				$school_code, $school_name,
				$online,
				$student_id, $student_first, $student_last, $student_person,
				$room_name,
				$event_abbr, $event_type,
				$max_entry
			) = $entries_sth->fetchrow_array()
		) {

			if ($flight > $max_flight) {
				$max_flight = $flight;
			}

			$types{$event_type} = $round_id;

			$panels{$panel_id}{"flight"}    = $flight;
			$panels{$panel_id}{"event"}     = $event_abbr;
			$panels{$panel_id}{"letter"}    = $panel_letter;
			$panels{$panel_id}{"room"}      = $room_name;
			$panels{$panel_id}{"type"}      = $event_type;
			$panels{$panel_id}{"max_entry"} = $max_entry || 1;

			if ($panel_bye) {
				$panels{$panel_id}{"bye"} = $panel_bye;
			} elsif ($ballot_bye) {
				$panels{$panel_id}{"entries"}{$entry_id}{"bye"}++
			} elsif ($ballot_forfeit) {
				$panels{$panel_id}{"entries"}{$entry_id}{"forfeit"}++
			}

			$panels{$panel_id}{"entries"}{$entry_id}{"code"} = $entry_code;

			if (length($entry_code) > $longest_code) {
				$longest_code = length($entry_code);
			}

			if ($school_code) {
				$panels{$panel_id}{"entries"}{$entry_id}{"school"} = $school_code;
			} else {
				$panels{$panel_id}{"entries"}{$entry_id}{"school"} = $m->comp("/funclib/short_name.mas", name => $school_name);
			}

			if ($online) {
				$panels{$panel_id}{"entries"}{$entry_id}{"online"} = $online;
				$panels{$panel_id}{"online"}++;
			}

			if ($student_person) {
				$panels{$panel_id}{"entries"}{$entry_id}{"members"}{$student_person}
					= ucfirst(substr($student_first, 0, 1)).ucfirst(substr($student_last, 0, 1));
				$panels{$panel_id}{"bodies"}{$student_person}++;
			} else {
				$panels{$panel_id}{"entries"}{$entry_id}{"members"}{"student_".$student_id}
					= ucfirst(substr($student_first, 0, 1)).ucfirst(substr($student_last, 0, 1))."*";
				$panels{$panel_id}{"bodies"}{"student_".$student_id}++;
				$luddite_alert++;
			}

			if ($ballot_side) {
				$rounds{$round_id}{"sides"}++;
				$panels{$panel_id}{"sides"}++;
				$panels{$panel_id}{"entries"}{$entry_id}{"order"} = $ballot_side;
			} elsif ($ballot_speakerorder) {
				$panels{$panel_id}{"orders"}++;
				$rounds{$round_id}{"orders"}++;
				$panels{$panel_id}{"entries"}{$entry_id}{"order"} = $ballot_speakerorder;
			}
		}

		$entries_sth->finish();

		my $judges_sth = $dbh->prepare("
			select
				panel.id, panel.letter, panel.bye,
				ballot.id, ballot.side, ballot.speakerorder, ballot.bye, ballot.forfeit,
				ballot.audit, ballot.chair,
				CONVERT_TZ(ballot.judge_started, '+00:00', tourn.tz), started_by.first, started_by.last,
				judge.id, judge.code, judge.first, judge.last, judge.person,
				online_hybrid.value

			from (panel, ballot, judge, round, category, tourn)

				left join person started_by on started_by.id = ballot.started_by
				left join judge_setting online_hybrid on online_hybrid.judge = judge.id and online_hybrid.tag = 'online_hybrid'

			$limit
				and round.id = panel.round
				and panel.id = ballot.panel
				and ballot.judge = judge.id
				and judge.category = category.id
				and category.tourn = tourn.id
		");

		$judges_sth->execute();

		while (
			my (
				$panel_id, $panel_letter, $panel_bye,
				$ballot_id, $ballot_side, $ballot_speakerorder, $ballot_bye, $ballot_forfeit,
				$ballot_audit, $chair,
				$started, $started_by_first, $started_by_last,
				$judge_id, $judge_code, $judge_first, $judge_last, $judge_person, $online
			) = $judges_sth->fetchrow_array()
		) {

			$judge_last =~ s/- ONLINE//g;
			$judge_last =~ s/- Online//g;

			$panels{$panel_id}{"judges"}{$judge_id}{"code"}  = $judge_code;
			$panels{$panel_id}{"judges"}{$judge_id}{"name"}  = $judge_first." ".$judge_last;
			$panels{$panel_id}{"judges"}{$judge_id}{"last"}  = $judge_last;
			$panels{$panel_id}{"judges"}{$judge_id}{"first"}  = $judge_first;
			$panels{$panel_id}{"judges"}{$judge_id}{"chair"} = $chair;

			if ($online) {
				$panels{$panel_id}{"judges"}{$judge_id}{"online"} = $online;
				$panels{$panel_id}{"online"}++;
			}

			if ($judge_person) {
				$panels{$panel_id}{"judges"}{$judge_id}{"person"} = $judge_person;
				$panels{$panel_id}{"bodies"}{$judge_person}++;
			} else {
				$panels{$panel_id}{"judges"}{$judge_id}{"person"} = "judge_".$judge_id;
				$panels{$panel_id}{"bodies"}{"judge_".$judge_id}++;
			}

			unless ($ballot_audit || $panel_bye || $ballot_bye || $ballot_forfeit) {
				$panels{$panel_id}{"judges"}{$judge_id}{"not_done"}++;
			}

			$panels{$panel_id}{"judges"}{$judge_id}{"initials"}
				= ucfirst(substr($judge_first, 0, 1)).ucfirst(substr($judge_last, 0, 1));

			unless ($judge_person) {
				$panels{$panel_id}{"judges"}{$judge_id}{"initials"} .= "*";
				$luddite_alert++;
			}

			if ($started) {
				$panels{$panel_id}{"judges"}{$judge_id}{"started"} =
					$m->comp('/funclib/showtime.mas',
						string => $started,
						length => "day",
						return => 1
					);

				$panels{$panel_id}{"judges"}{$judge_id}{"started_by"} = $started_by_first." ".$started_by_last;
			}

			$judges{$judge_id}++;
		}
		$judges_sth->finish();
	}

	if ($longest_code  > 20) {
		$longest_code = 20;
	} elsif ($longest_code  < 5) {
		$longest_code = 7;
	}

	my $get_url = $Tab::indexcards_url."/tab/".$tourn->id;

	if ($round_id) {
		$get_url .= "/round/$round_id/attendance";
	} elsif ($timeslot_id) {
		$get_url .= "/timeslot/$timeslot_id/attendance";
	}

	my $post_url = $Tab::indexcards_url."/tab/".$tourn->id."/all/attendance";

</%init>

	<script>

		function refreshLogs() {

			$.ajax({
				type        : 'GET',
				url         : '<% $get_url %>',
				crossDomain : true,
				xhrFields : {
					withCredentials : true
				},
			}).then( function(status) {

				$(".statusicon")
					.removeClass("fa-check")
					.removeClass("greentext")
					.addClass("fa-cicle")
					.addClass("brightredtext");

				$(".starticon")
					.removeClass("fa-star")
					.removeClass("greentext")
					.addClass("fa-stop")
					.addClass("yellowtext");

				$(".doneicon")
					.removeClass("fa-certificate");

				$(".container").attr("property_name", 0);
				$(".start").attr("property_name", 0);
				$(".done").attr("property_name", 0);

				$(".bye_start")
					.removeClass("yellowtext")
					.removeClass("fa-stop")
					.addClass("fa-star")
					.addClass("greentext");

				$(".start_bye")
					.attr("property_name", 1);

				$(".bye_done")
					.attr("property_name", 1);

				$(".done_bye")
					.addClass("fa-certificate");

				if (status.person) {
					Object.keys(status?.person).forEach( personId => {

						const person = status.person[personId];
						Object.keys(person).forEach(panelId => {

							var panel = person[panelId];

							if (panel.tag == 'panel' || panel.tag == 'present') {
								$("#container_"+panelId+"_"+personId).attr("property_name", 1);
								$("#"+panelId+"_"+personId)
									.removeClass("brightredtext")
									.removeClass("fa-circle")
									.addClass("fa-check")
									.addClass("greentext")
									.attr("title", panel.description+" at "+panel.started);
							}

							if (panel.started) {
								$("#"+panelId+"_"+personId+"_start")
									.removeClass("yellowtext")
									.removeClass("fa-stop")
									.addClass("fa-star")
									.addClass("greentext");

								$("#start_"+panelId+"_"+personId)
									.attr("title", "Marked started by "+panel.started_by+" at "+panel.started)
									.attr("property_name", 1);
							}

							if (panel.audited) {
								$("#"+panelId+"_"+personId+"_done")
									.addClass("fa-certificate");

								$("#done_"+panelId+"_"+personId)
									.attr("property_name", 1);
							}
						});
					});
				}

				if (status.student) {
					Object.keys(status?.student).forEach( studentId => {
						Object.keys(status.student[studentId]).forEach(panelId => {

							const panel = status.student[studentId]?.[panelId];

							if (panel.tag == 'panel' || panel.tag == 'present') {
								$("#container_"+panelId+"_student_"+studentId).attr("property_name", 1);
								$("#"+panelId+"_student_"+studentId)
									.removeClass("brightredtext")
									.removeClass("fa-circle")
									.addClass("fa-check")
									.addClass("greentext")
									.attr("title", panel.description+" at "+panel.started);
							}
						});
					});
				}

				if (status.entry) {
					Object.keys(status.entry).forEach( entryId => {
						Object.keys(status.entry[entryId]).forEach( panelId => {
							const panel = status.entry[entryId]?.[panelId];

							if (panel.tag == 'panel' || panel.tag == 'present') {
								$("#container_"+panelId+"_entry_"+entryId).attr("property_name", 1);
								$("#"+panelId+"_entry_"+entryId)
									.removeClass("brightredtext")
									.removeClass("fa-circle")
									.addClass("fa-check")
									.addClass("greentext")
									.attr("title", panel.description+" at "+panel.started);
							}
						});
					});
				}

				$(`.confirmations`).attr('data-text', '0');
				$(`.confirmation_yes`).addClass('hidden');
				$(`.confirmation_no`).removeClass('hidden');

				if (status.panel) {
					Object.keys(status.panel).forEach( panelId => {
						$(`#${panelId}_confirmed`).attr('data-text', '1');
						$(`#${panelId}_confirmed_yes`).removeClass('hidden');
						$(`#${panelId}_confirmed_no`).addClass('hidden');
						$(`#${panelId}_confirmed_yes`).attr("title", status.panel[panelId]);
					});
				}

			}).then( () => {
				countNoses();
				countStarts();
				countDone();
				updateView();
				fixVisual();
				$("table").trigger("applyWidgets");
			});

		};

		function countStarts() {

			var panelCounts = {};
			var startCounts = {};

			$(".start").each( (index, elem) => {
				var panelId = $(elem).attr('panel');

				if (panelCounts[panelId]) {
				} else {
					panelCounts[panelId] = 0;
				}

				if ($(elem).attr('property_name') == 1) {
					panelCounts[panelId]++;
				}
				if ($(elem).attr('bye') == 1) {
					panelCounts[panelId] += 10;
				}
			});

			var total = 0;

			Object.keys(panelCounts).forEach( panelId => {
				$("#"+panelId+"_startcount").attr('data-text', panelCounts[panelId]);
				total += panelCounts[panelId];
			});

			$(".start_total").text(total);
			$("table").trigger("update");

		}

		function countNoses() {

			var panelCounts = {};
			var panelRatio = {};
			var panelBye = {};

			$(".container").each( (index, elem) => {

				var panelId = $(elem).attr('panel');
				panelRatio[panelId] = $("#"+panelId+"_bodies").attr('total');

				if (panelCounts[panelId]) {
				} else {
					panelCounts[panelId] = 0;
				}

				if ($(elem).attr('property_name') == 1) {
					panelCounts[panelId]++;
				}

				if ($(elem).attr('bye') == 1) {
					panelCounts[panelId] = panelRatio[panelId];
					panelRatio[panelId] = .5;
					panelBye[panelId] = 1;
				}
			});

			Object.keys(panelCounts).forEach( panelId => {
				var ratio;

				if (panelRatio[panelId] > 0) {
					ratio = panelCounts[panelId] / panelRatio[panelId];
				}

				$("#"+panelId+"_count").text(panelCounts[panelId]);
				$("#"+panelId+"_ratio").text(ratio);

				if (panelBye[panelId]) {
					$("#"+panelId).addClass('panelstart');
				}

				if (ratio == 1 || ratio > 1) {
					$("#"+panelId).addClass('attendance');
				} else {
					$("#"+panelId).removeClass('attendance');
				}

			});

			var judgeStarts = {};
			var judgeRatio = {};

			$(".start").each( (index, elem) => {
				var panelId = $(elem).attr('panel');
				judgeRatio[panelId] = $("#"+panelId+"_bodies").attr('judges');

				if (judgeStarts[panelId]) {
				} else {
					judgeStarts[panelId] = 0;
				}

				if ($(elem).attr('property_name') == 1) {
					judgeStarts[panelId]++;
				}
			});

			Object.keys(judgeStarts).forEach(panelId => {
				var ratio;

				if (judgeRatio[panelId] > 0) {
					ratio = judgeStarts[panelId] / judgeRatio[panelId];
				}

				if (ratio == 1 || ratio > 1) {
					$("#"+panelId).addClass('panelstart');
				} else {
					$("#"+panelId).removeClass('panelstart');
				}
			});

			$("table").trigger("update");
		}

		function countDone() {
			var panelCounts = {};

			$(".done").each( (index, elem) => {

				var panelId = $(elem).attr('panel');

				if (panelCounts[panelId]) {
				} else {
					panelCounts[panelId] = 0;
				}

				if ($(elem).attr('property_name') == 1) {
					panelCounts[panelId]++;
				}

				if ($(elem).attr('bye') == 1) {
					panelCounts[panelId] += 10;
				}
			});

			var total = 0;

			Object.keys(panelCounts).forEach(panelId => {
				$("#"+panelId+"_donecount").html(panelCounts[panelId]);
				total += panelCounts[panelId];
			});

			$(".done_total").text(total);
			$("table").trigger("update");
		}

		function updateView() {

			var tags = ['attendance', 'panelstart'];

			// Someday I'll use react and have real browser state

			for (let tag of tags) {
				$("."+tag).removeClass('hidden');
			}

			for (let tag of tags) {
				if ($("#"+tag).attr("state") == 1) {
					$("#"+tag).addClass('invert');
				} else {
					$("#"+tag).removeClass('invert');
					$("."+tag).addClass('hidden');
				}
			}

			$(".flightbutton").each((index, elem) => {
				var flight = $(elem).attr("flight");
				if ($("#flight_"+flight).attr("state") == 0) {
					$(".flight_"+flight).addClass("hidden");
				}
			});

			$("table").trigger("update");
		}

		function updateState(target) {

			if ($("#"+target).attr("state") == 1) {
				$("#"+target).attr("state", 0);
			} else {
				$("#"+target).attr("state", 1);
			}

			updateView();
		}

		function toggleFlight(flight) {
			if ($("#flight_"+flight).attr("state") == 1) {
				$("#flight_"+flight).attr("state", 0);
				$("#flight_"+flight).removeClass("invert");
			} else {
				$("#flight_"+flight).attr("state", 1);
				$("#flight_"+flight).addClass("invert");
			}
			updateView();
		}

		$(document).ready( () => {
			refreshLogs();
			setInterval(refreshLogs, 15000);
		});


	</script>

	<div class="menu">
		<div class="sidenote">

			<h4>Whole Timeslot</h4>

			<form
				action = "status.mhtml"
				method = "post"
			>

				<span class="row full marbottom centeralign">
					<select
						name     = "timeslot_id"
						onchange = 'this.form.submit()'
						class    = "fixedmed notfirst"
					>
						<option value="">Choose timeslot:</option>
%						foreach my $timeslot_id (@timeslot_ids) {
							<option
								value="<% $timeslot_id %>"
								<% ($timeslot_id == $ARGS{"timeslot_id"})
									? "selected"
									: "" %>
							><% $timeslots{$timeslot_id}{name} %></option>
%						}
					</select>
				</span>

			</form>

			<h4>Or, By Event</h4>

			<form
				action = "status.mhtml"
				method = "post"
			>

				<span class="row full marbottom centeralign">
					<select
						name     = "event_id"
						onchange = 'this.form.submit()'
						class    = "fixedmed notfirst"
					>
						<option value="">Choose event:</option>
<%perl>
						foreach my $other_id (sort {
							$events{$a}{supp} cmp $events{$b}{supp}
							|| $events{$a}{type} cmp $events{$b}{type}
							|| $events{$a}{abbr} cmp $events{$b}{abbr}
						} keys %events) {
</%perl>
							<option
								value="<% $other_id %>"
								<% ($event && $other_id == $event->{id})
									? "selected"
									: "" %>
							><% $events{$other_id}{abbr} %></option>
%						}
					</select>
				</span>
			</form>

%			if ($event || $timeslot_id) {

				<span class="fivesixth martopless">
					<span class="half nospace">
						<h4 class="nospace marbottomless">Rounds</h4>
					</span>
					<span class="sixth centeralign nospace tiny">
						Start
					</span>
					<span class="sixth centeralign nospace tiny">
						Done
					</span>
					<span class="sixth leftalign nospace tiny">
						Total
					</span>
				</span>

%				unless ($checker) {
					<span class="sixth centeralign nospace tiny">
						<% $perms->{'details'}{$event} %>
						Schem
					</span>
%				}
<%perl>
				foreach my $rid (
					sort {
						$rounds{$a}{"number"} <=> $rounds{$b}{"number"}
					} keys %rounds
				) {

					next unless $rounds{$rid}{"number"};

					my $color;

					if ($rounds{$rid}{"done"}) {
						$color = "green";
					} elsif ($rounds{$rid}{"started"}) {
						$color = "yellow";
					} else {
						$color = "grey";
					}
</%perl>
					<a href="status.mhtml?round_id=<% $rid %>"
						class="<%
							$round_id == $rid ? "dk" : ""
						%><% $color %> fivesixths"
					>
						<span class="half nowrap smallwrap">
							<% $rounds{$rid}{"event"} %>
							<% $rounds{$rid}{"label"} %>
						</span>

						<span class="sixth centeralign smallish">
							<% $rounds{$rid}{"started"} %>
						</span>

						<span class="sixth centeralign smallish">
							<% $rounds{$rid}{"audited"} %>
						</span>

						<span class="sixth centeralign smallish">
							<% $rounds{$rid}{"total"} %>
						</span>
					</a>

					<span class="sixth nospace rightalign">
%						unless ($checker) {
							<a href="/panel/schemat/show.mhtml?round_id=<% $rid %>"
								class="bluetext buttonwhite fa fa-sm fa-external-link"
								target="_blank"
							></a>
%						}
					</span>
%				}
%			}
		</div>

		<div class="sidenote">

			<h5>Poke Button</h5>

			<p>
				The "poke" button will text any missing competitors or judges
				from that section with a boilerplate message asking them to
				report to the room.
			</p>

%			if ($event && (not defined $checker)) {
				<label for="dont_poke_entries">
					<div class="hover row">
						<span class="threequarters padleft">
							Poke only judges
						</span>
						<span class="quarter centeralign">
							<& "/funclib/bool_switch.mas",
								tag     => "dont_poke_entries",
								value   => $dont_poke,
								target  => $event->{id},
								url     => "/setup/events/setting_switch.mhtml",
								smaller => 1,

							&>
						</span>
					</div>
				</label>
%			}

			<h4>Util Rooms</h4>
<%perl>
			my @rooms = eval {
				return @{$tourn_settings->{"online_rooms"}};
			};

			foreach my $room (sort {
				defined($b->{"name"}) <=> defined($a->{"name"})
				|| $a->{"name"} cmp $b->{"name"}
				|| $a->{"access"} cmp $b->{"access"}
			} @rooms) {

				next if $event && $room->{"event_id"} && $room->{"event_id"} ne $event;

				my $key = $room->{"id"};
				$room->{'tourn_id'} = $tourn->id;
</%perl>
				<div class="row">
					<span class="threequarters padleft">
						<% $room->{"name"} %>
					</span>

					<span
						class     = "quarter centeralign nospace padvertless"
%						if ($room->{"uuid"} || $room->{"url"}) {
							data-text = '1'
%						} else {
							data-text = '0'
%						}
					>
%						if ($room->{"uuid"} || $room->{"url"}) {
							<& "/funclib/online_room.mas",
								util   => $room,
								person => $person,
								tourn  => $tourn,
								perms  => $perms,
								class  => "fa-sm"
							&>
%						} else {
%#							I hate this
							&nbsp;
%						}
					</span>
				</div>
%			}
		</div>
	</div>

	<div class="main">

		<div class="nospace">
			<span class="threequarters">
				<h5 class="nospace">
					<% $tourn->name %>
				</h5>
			</span>

			<span class="quarter rightalign nospace">
				<h4 class="nospace">
					Round Status
				</h4>
			</span>
		</div>

%		unless ($checker) {
			<& "tabbar.mas",
				whoami         => 'status',
				tourn          => $tourn,
				tourn_settings => $tourn_settings
			&>
%		}

%		if ($round_id || $timeslot_id) {

			<div class="full">

				<div class="full flexrow padtop">

					<span class="quarter">
						<h5 class="nospace nowrap">
							<% $round ? $round->realname : "" %>
							<% $timeslot ? $timeslot->name : "" %>
						</h5>
					</span>

					<span class="sixth centeralign bigger semibold redtext">
						<% scalar (keys %panels) %> sections
					</span>

					<span class="sixth centeralign bigger semibold redtext">
						<% scalar (keys %judges) %> judges
					</span>

					<span class="sixth centeralign bigger semibold bluetext started">
						<span class="inline start_total">0</span> started
					</span>

					<span class="sixth centeralign bigger semibold bluetext started">
						<span class="inline done_total">0</span> done
					</span>

					<span
						class = "sixth"
						id    = "campus_buttonarea"
					>
						<a
							id      = "attendance"
							state   = "1"
							class   = "fa fa-sm fa-check buttonwhite greentextnohover invert"
							title   = "Show/Hide Fully Present"
							onClick = "updateState('attendance');"
						></a>
						<a
							id      = "panelstart"
							state   = "1"
							class   = "fa fa-sm fa-star buttonwhite bluetextnohover invert marleft"
							title   = "Show/Hide All Started"
							onClick = "updateState('panelstart');"
						></a>
					</span>

%					if ($max_flight > 1) {
						<span class="fifth padvertless rightalign">
%							foreach my $flight (1 .. $max_flight) {
								<a
									id      = "flight_<% $flight %>"
									flight  = "<% $flight %>"
									state   = "1"
									class   = "buttonwhite bluetextnohover invert marleft fa-sm flightbutton"
									title   = "show/hide flight <% $flight %>"
									onclick = "toggleFlight('<% $flight %>');"
								>F<% $flight %></a>
%							}
						</span>
%					}
				</div>

				<div class="full flexrow centeralign">
					<span class="bluetext italic threefifths">
						Click on a competitor or judge to change their status
					</span>
				</div>
			</div>

%			my $number_of_types = scalar(keys %types);

%			foreach my $type (sort keys %types) {

%				my $sample_round = $types{$type};

				<& "/funclib/tablesorter.mas",
					table     => "campus_".$type,
					resize    => 1,
					nobuttons => 1
				&>

%				if ($number_of_types > 1) {
					<p class="semibold bluetext biggish">
						<% ucfirst($type) %> Events
					</p>

%				}

				<table id="campus_<% $type %>" class="padbottom unfixed">

					<thead>
						<tr class="yellowrow padvert smallish">
							<th>
								Ev
							</th>

							<th class="smallhide">
								Sct
							</th>

%							if ($max_flight > 1) {
								<th class="smallhide">
									Flight
								</th>
%							}

							<th class="smallhide">
								Rm
							</th>

%							if ($rounds{$sample_round}{"orders"}) {
								<th>
									Entries
								</th>
%							} else {

								<th>
									<% $tourn_settings->{"mock_trial_registration"} ? "Prosecutor" : "Aff" %>
								</th>

								<th>
									<% $tourn_settings->{"mock_trial_registration"} ? "Defense" : "Neg" %>
								</th>
%							}

							<th>
								Judges
							</th>

							<th title="Start Round button has been pressed" class="centeralign limiticon nospace">
								<span class="fa fa-sm fa-flag greentext"></span>
							</th>

							<th title="Checker has confirmed this round is OK" class="centeralign limiticon nospace">
								<span class="fa fa-sm fa-thumbs-o-up greentext"></span>
							</th>

							<th title="Ballot Entered & Confirmed" class="centeralign limiticon nospace">
								<span class="fa fa-sm fa-flag-checkered"></span>
							</th>

							<th title="Count of those entering the room" class="smallhide nospace limiticon">
								<span class="fa fa-sm fa-hashtag"></span>
							</th>

							<th class="smallhide">
								Poke
							</th>
						</tr>
					</thead>

					<tbody>
<%perl>
						foreach my $panel_id (
							sort {
								$panels{$a}{"event"} cmp $panels{$b}{"event"}
								|| $panels{$a}{"bye"} cmp $panels{$b}{"bye"}
								|| $panels{$a}{"flight"} cmp $panels{$b}{"flight"}
								|| length($panels{$a}{"room"}) <=> length($panels{$b}{"room"})
								|| $panels{$a}{"room"} cmp $panels{$b}{"room"}
								|| length($panels{$a}{"letter"}) <=> length($panels{$b}{"letter"})
								|| $panels{$a}{"letter"} cmp $panels{$b}{"letter"}
							} keys %panels
						) {

							next unless $panels{$panel_id}{'type'} eq $type;

							my $count = 0;
							my $bodies = eval {
								return scalar (keys %{$panels{$panel_id}{"bodies"}});
							};

							my $judgecount = eval {
								return scalar (keys %{$panels{$panel_id}{"judges"}});
							};

							$panels{$panel_id}{"brokenroom"} = $panels{$panel_id}{"room"};
							$panels{$panel_id}{"brokenroom"} =~ s/\ /<br>/g;
							$panels{$panel_id}{"brokenroom"} =~ s/-/<br>/g;
							$panels{$panel_id}{"brokenroom"} =~ s/\//<br>/g;

</%perl>
							<tr id="<% $panel_id %>" class="flight_<% $panels{$panel_id}{"flight"} %>">

								<td class="centeralign nospace semibold smallish">
									<% $panels{$panel_id}{"event"} %>
									<div class="full smallshow normalweight">
										<% $panels{$panel_id}{"brokenroom"} || $panels{$panel_id}{"letter"} %>
									</div>
								</td>

								<td class="centeralign nospace smallhide">
									<a
										href   = "/panel/schemat/panel_view.mhtml?panel_id=<% $panel_id %>"
										target = "_blank"
										class  = "smallish plain centeralign hover padvert full"
									><%
										$panels{$panel_id}{"bye"}
										? "BYE"
										: $panels{$panel_id}{"letter"}
									%></a>
								</td>

%								if ($max_flight > 1) {
									<td class="centeralign nospace limittiny smallhide">
										<% $panels{$panel_id}{"flight"} %>
									</td>
%								}

								<td class="centeralign limitsmall smallhide">
%									if ($rounds{$sample_round}{"online"} || $panels{$panel_id}{"online"}) {
										<& "/funclib/online_room.mas",
											panel    => $panel_id,
											person   => $person,
											no_name  => 1,
											class    => "fa-sm",
											sortable => 1
										&> <br />
										<% $panels{$panel_id}{"room"} %>
%									} else {
										<a
											href   = "/panel/schemat/panel_view.mhtml?panel_id=<% $panel_id %>"
											target = "_blank"
											class  = "smallish plain centeralign hover padvert full"
										><% $panels{$panel_id}{"room"} %></a>
%									}
								</td>

%								if ($rounds{$sample_round}{"orders"}) {
									<td class="leftalign nospace">
%								}
<%perl>
								my $last_side;
								my $entry_count;

								if ($panels{$panel_id}{"entries"}) {

									foreach my $entry_id (
										sort {
											$panels{$panel_id}{"entries"}{$a}{"order"} <=> $panels{$panel_id}{"entries"}{$b}{"order"}
										} keys %{$panels{$panel_id}{"entries"}}
									) {

										$entry_count++;
										my $size = 'full';

										if ($rounds{$sample_round}{"sides"}) {

											if ($panels{$panel_id}{"entries"}{$entry_id}{"members"}
												&! $rounds{$sample_round}{"by_entry"}
											) {
												if (
													scalar (keys %{$panels{$panel_id}{"entries"}{$entry_id}{"members"}}) > 1) {
													$size = "half nowrap smallwrap";
												}
											}

											unless ($last_side) {

												if ($panels{$panel_id}{"type"} eq "wsdc") {
													$m->print("<td class='nospace top'>");
												} else {
													$m->print("<td class='nospace nowrap smallwrap'>");
												}
												$last_side = $panels{$panel_id}{"entries"}{$entry_id}{"order"};

											} elsif ($last_side != $panels{$panel_id}{"entries"}{$entry_id}{"order"}) {

												$m->print("</td>");

												if ($panels{$panel_id}{"type"} eq "wsdc") {
													$m->print("<td class='nospace top'>");
												} else {
													$m->print("<td class='nospace nowrap smallwrap'>");
												}
												$last_side = $panels{$panel_id}{"entries"}{$entry_id}{"order"};
											}

										} else {
											$size = 'third';
										}

										if ($rounds{$sample_round}{"orders"}) {
											$size = "sixth nowrap smallwrap";
										}

										if ($rounds{$sample_round}{"online"} &! $rounds{$sample_round}{"by_entry"}) {

											if ($rounds{$sample_round}{"hybrid"} && $panels{$panel_id}{"entries"}{$entry_id}{"online"}) {
												$m->print('<span class="fa fa-sm fa-laptop fifth centeralign"></span>');
												$size = "twofifths";
											} else {

												if ($panels{$panel_id}{"type"} eq "debate"
													|| $panels{$panel_id}{"type"} eq "mock_trial"
													|| $panels{$panel_id}{"type"} eq "wsdc"
												) {
													if ($panels{$panel_id}{"max_entry"} > 1) {
														$size = "half";
													} else {
														$size = "full";
													}
												} else {
													$size = "quarter";
												}
											}

											foreach my $person_id (
												sort {
													$panels{$panel_id}{"entries"}{$entry_id}{"members"}{$a}
														cmp $panels{$panel_id}{"entries"}{$entry_id}{"members"}{$b}
												} keys %{$panels{$panel_id}{"entries"}{$entry_id}{"members"}}
											) {
</%perl>
												<span
													id            = "container_<% $panel_id %>_<% $person_id %>"
													class         = "<% $size %> yellowhover leftalign container"
													target_id      = "<% $person_id %>"
													target_type    = "person"
													panel         = "<% $panel_id %>"
													bye           = "<% $panels{$panel_id}{"bye"} ? "1" : "0" %>"
													property_name = "<% $panels{$panel_id}{"attendance"}{$person_id} ? 1 : 0 %>"
													onClick       = "postSwitch(this, '<% $post_url %>', countNoses)"
												>

%													if ($panels{$panel_id}{"entries"}{$entry_id}{"bye"}) {
%														$count++;
														<span class="quarter semibold graytext smaller"
														>BYE</span>

%													} elsif ($panels{$panel_id}{"entries"}{$entry_id}{"forfeit"}) {
%														$count++;
														<span class="quarter semibold centeralign graytext smaller"
														>FFT</span>
<%perl>
													} elsif (
														$panels{$panel_id}{"attendance"}{$person_id}
														|| $panels{$panel_id}{"bye"}
													) {

														$count++;
</%perl>
														<span
															id="<% $panel_id %>_<% $person_id %>"
															title="<&
																"/funclib/showtime.mas",
																	string => $panels{$panel_id}{"attendance"}{$person},
																	length => "day"
															&>"
															class="quarter centeralign fa fa-sm fa-check greentext statusicon"
														></span>
%													} else {
														<span
															id="<% $panel_id %>_<% $person_id %>"
															class="quarter centeralign fa fa-sm fa-circle brightredtext statusicon"
														></span>
%													}

													<span class="threequarters nospace centeralign smaller">
														<% $panels{$panel_id}{"entries"}{$entry_id}{"members"}{$person_id} %>
													</span>

%													if ($panels{$panel_id}{"type"} eq "speech" || $panels{$panel_id}{"type"} eq "congress" ) {
														<div
															class = "nospace supersmall centeralign italic full hover graytext"
															title = "<% $panels{$panel_id}{"entries"}{$entry_id}{"school"} %>"
														>
															<% $panels{$panel_id}{"entries"}{$entry_id}{"code"} %>
														</div>
%													}
												</span>
%											}

%											if ($panels{$panel_id}{"type"} eq "debate"
%												|| $panels{$panel_id}{"type"} eq "wsdc"
%												|| $panels{$panel_id}{"type"} eq "mock_trial"
%											) {
												<div
													class = "nospace supersmall centeralign italic full hover graytext"
													title = "<% $panels{$panel_id}{"entries"}{$entry_id}{"school"} %>"
												>
													<% $panels{$panel_id}{"entries"}{$entry_id}{"code"} %>
												</div>
%											}

%										} else {

											<span id = "container_<% $panel_id %>_entry_<% $entry_id %>"
<%perl>
												unless (
													$panels{$panel_id}{"type"} eq "debate"
													|| $panels{$panel_id}{"type"} eq "wsdc"
													|| $panels{$panel_id}{"type"} eq "mock_trial"
												) {
</%perl>
													class         = "yellowhover leftalign container third nospace"
%												} else {
													class         = "yellowhover leftalign container full"
%												}
												title         = "<% $panels{$panel_id}{"entries"}{$entry_id}{"code"} %>"
												target_id      = "<% $entry_id %>"
												target_type    = "entry"
												panel         = "<% $panel_id %>"
												bye           = "<% $panels{$panel_id}{"bye"} ? "1" : "0" %>"
												property_name = "<% $panels{$panel_id}{"attendance"}{$entry_id} ? 1 : 0 %>"
												onClick       = "postSwitch(this, '<% $post_url %>', countNoses)"
											>
												<div class="flexrow nospace full entries">
%													if ($panels{$panel_id}{"entries"}{$entry_id}{"bye"}) {
%														$count++;
														<span class="fifth semibold centeralign graytext smaller"
														>BYE</span>

%													} elsif ($panels{$panel_id}{"entries"}{$entry_id}{"forfeit"}) {
%														$count++;
														<span class="fifth semibold centeralign graytext smaller"
														>FFT</span>
<%perl>
													} elsif (
														$panels{$panel_id}{"attendance"}{$entry_id}
														|| $panels{$panel_id}{"bye"}
													) {
														$count++;
</%perl>
														<span
															id="<% $panel_id %>_entry_<% $entry_id %>"
															title="<& "/funclib/showtime.mas",
																string => $panels{$panel_id}{"attendance"}{$entry_id},
																length => "day"
															&>"
															class="fifth fa fa-sm fa-check greentext statusicon centeralign"
														></span>
%													} else {
														<span
															id="<% $panel_id %>_entry_<% $entry_id %>"
															class="fifth fa fa-sm fa-circle brightredtext statusicon centeralign"
														></span>
%													}

													<span class="padleft leftalign smaller threequarters wrap grow">
														<span style="max-width: 100px !important" class="nowrap smallwrap">
															<% $panels{$panel_id}{"entries"}{$entry_id}{"code"} %>
														</span>
													</span>
												</div>
											</span>
<%perl>
										}
									}
								}

								if ($rounds{$sample_round}{"orders"}) {
									$m->print('</td>');
								} elsif ($entry_count < 2) {
									$m->print("<td></td>");
								}

								$m->print('<td class="nospace">');

								if ($panels{$panel_id}{"judges"}) {

									foreach my $judge_id (
										sort {
											$panels{$panel_id}{"judges"}{$b}{"chair"} <=> $panels{$panel_id}{"judges"}{$a}{"chair"}
											|| $panels{$panel_id}{"judges"}{$a}{"last"} cmp $panels{$panel_id}{"judges"}{$b}{"last"}
										} keys %{$panels{$panel_id}{"judges"}}
									) {

										my $person_id = $panels{$panel_id}{"judges"}{$judge_id}{"person"};
</%perl>
										<span
											id            = "container_<% $panel_id %>_<% $person_id || "judge_".$judge_id  %>"
											class         = "full marno padless yellowhover container judgefixedheight flexrow"
											target_id      = "<% $person_id > 0 ? $person_id : $judge_id %>"
											target_type    = "<% $person_id > 0 ? "person" : "judge" %>"
											panel         = "<% $panel_id %>"
											bye           = "<% $panels{$panel_id}{"bye"} ? "1" : "0" %>"
											setting_name  = "judge"
											property_name = "<% $panels{$panel_id}{"attendance"}{$person_id} ? 1 : 0 %>"
											onClick       = "postSwitch(this, '<% $post_url %>', countNoses);"
										>
%											if ($panels{$panel_id}{"attendance"}{$person_id}) {
%												$count++;
												<span
													id="<% $panel_id %>_<% $person_id %>"
													title="<&
														"/funclib/showtime.mas",
															string => $panels{$panel_id}{"attendance"}{$person},
															length => "day"
													&>"
													class="eighth centeralign fa fa-sm fa-check greentext statusicon grow"
												></span>
%											} else {
												<span
													id="<% $panel_id %>_<% $person_id %>"
													class="eighth centeralign fa fa-sm fa-circle brightredtext statusicon grow"
												></span>
%											}

%											if ($rounds{$sample_round}{"hybrid"} && $panels{$panel_id}{"judges"}{$judge_id}{"online"}) {
												<span class="centeralign eighth fa fa-sm fa-laptop"></span>
%											}

											<span class="threequarters smaller flexrow smallwrap">
												<span class="hidden">
													<% $panels{$panel_id}{"judges"}{$judge_id}{"chair"}
														? "CHAIR"
														: "NOPE"
													%>
													<% $panels{$panel_id}{"judges"}{$judge_id}{"last"} %>
												</span>
												<span class="eighth">
													<% $panels{$panel_id}{"judges"}{$judge_id}{"chair"}
														? "<span class='fa fa-sm fa-gavel'></span>"
														: ""
													%>
												</span>

												<span class="smallshow seveneighths grow nowrap">
													<% $panels{$panel_id}{"judges"}{$judge_id}{"last"} %>,
													<% substr($panels{$panel_id}{"judges"}{$judge_id}{"first"}, 0, 1) %>
												</span>
												<span class="smallhide seveneighths grow">
													<% $panels{$panel_id}{"judges"}{$judge_id}{"name"} %>
												</span>
											</span>
										</span>
%									}
%								}
								</td>

								<td
									class = "nospace"
									id    = "<% $panel_id %>_startcount"
								>
<%perl>
									if ($panels{$panel_id}{"judges"}) {

										foreach my $judge_id (
											sort {
												$panels{$panel_id}{"judges"}{$b}{"chair"} <=> $panels{$panel_id}{"judges"}{$a}{"chair"}
												|| $panels{$panel_id}{"judges"}{$a}{"last"} cmp $panels{$panel_id}{"judges"}{$b}{"last"}
											} keys %{$panels{$panel_id}{"judges"}}
										) {

											my $person_id = $panels{$panel_id}{"judges"}{$judge_id}{"person"};
											my $started = $panels{$panel_id}{"judges"}{$judge_id}{"started"};
											my $started_by = $panels{$panel_id}{"judges"}{$judge_id}{"started_by"};
</%perl>
											<span
												id            = "start_<% $panel_id %>_<% $person_id ? $person_id : "judge_".$judge_id %>"
												class         = "full marno padless yellowhover start centeralign judgefixedheight"
												target_id     = "<% $person_id ? $person_id : $judge_id %>"
												target_type   = "<% $person_id ? "person" : "judge" %>"
												judge         = "<% $judge_id %>"
												panel         = "<% $panel_id %>"
												setting_name  = "judge_started"
												property_name = "<% $panels{$panel_id}{"started"}{$person_id} ? 1 : 0 %>"
												onClick       = "postSwitch(this, '<% $post_url %>', countStarts);"
%												if ($started) {
													title = "Marked started <% $started %> by <% $started_by %>"
%												} else {
													title = "Not started"
%												}
											>
%												if ($started) {
%													$count++;
													<span
														id="<% $panel_id %>_<% $person_id %>_start"
														class="centeralign fa fa-sm fa-star greentext starticon"
													></span>
%												} else {
													<span
														id="<% $panel_id %>_<% $person_id %>_start"
														class="centeralign fa fa-sm fa-stop yellowtext starticon"
													></span>
%												}
											</span>
%										}

%									} elsif ($panels{$panel_id}{"bye"}) {

										<span
											class         = "full marno padless start_bye centeralign judgefixedheight"
											property_name = "1"
											panel         = "<% $panel_id %>"
											title         = "Bye"
										>
											<span
												class="centeralign fa fa-sm fa-star greentext bye_start"
											></span>
										</span>
%									}
								</td>

								<td
									class     = "nospace centeralign confirmations"
									id        = "<% $panel_id %>_confirmed"
									data-text = "0"
								>
									<span
										id       = "<% $panel_id %>_confirmed_yes"
										class    = "hidden fa fa-thumbs-o-up greentext full padvertless yellowhover confirmation_yes"
										panel_id = "<% $panel_id %>"
										status   = "1"
										onClick  = "postSwitch(this, 'panel_confirm.mhtml')"
									></span>

									<span
										id       = "<% $panel_id %>_confirmed_no"
										class    = "fa fa-thumbs-down orangetext full padvertless yellowhover confirmation_no"
										panel_id = "<% $panel_id %>"
										status   = "0"
										onClick  = "postSwitch(this, 'panel_confirm.mhtml')"
									></span>
								</td>

								<td class="nospace">
									<span
										id    = "<% $panel_id %>_donecount"
										class = "hidden"
									></span>
<%perl>
									if ($panels{$panel_id}{"judges"}) {

										foreach my $judge_id (
											sort {
												$panels{$panel_id}{"judges"}{$b}{"chair"} <=> $panels{$panel_id}{"judges"}{$a}{"chair"}
												|| $panels{$panel_id}{"judges"}{$a}{"last"} cmp $panels{$panel_id}{"judges"}{$b}{"last"}
											} keys %{$panels{$panel_id}{"judges"}}
										) {

											my $person_id = $panels{$panel_id}{"judges"}{$judge_id}{"person"};
											my $not_done = $panels{$panel_id}{"judges"}{$judge_id}{"not_done"};
</%perl>
											<span
												id            = "done_<% $panel_id %>_<% $person_id %>"
												class         = "centeralign full done padless marno judgefixedheight"
												panel         = "<% $panel_id %>"
												bye           = "<% $panels{$panel_id}{"bye"} ? 1 : 0 %>"
												property_name = "<% $not_done ? "0" : "1" %>"
											>
												<span
													id="<% $panel_id %>_<% $person_id %>_done"
													class="full centeralign fa fa-sm <% $not_done ? "" : "fa-certificate" %> greentext doneicon"
													title="<% $not_done ? "" : "Done" %>"
												>&nbsp;</span>
											</span>
%										}
%									} elsif ($panels{$panel_id}{'bye'}) {
										<span
											class         = "bye_done centeralign full"
											panel         = "<% $panel_id %>"
											property_name = "1"
										>
											<span
												class="done_bye fa fa-sm fa-certificate greentext"
											></span>
										</span>
%									}
								</td>

								<td
									id     = "<% $panel_id %>_bodies"
									total  = "<% $bodies %>"
									judges = "<% $judgecount %>"
									class  = "centeralign limitsmall smallhide"
								>
									<span
										class="hidden"
										id="<% $panel_id %>_ratio"
									><% $bodies ? $count/$bodies : 1 %></span>
									<span id = "<% $panel_id %>_count">
										<% $count %>
									</span>
								</td>

								<td
									title = "Blast the missing people from this section"
									class = "centeralign limitsmall nospace smallhide"
								>
									<a
										class     = "buttonwhite redtext fa fa-bell invert centeralign"
										target_id = "<% $panel_id %>"
										id        = "blast_<% $panel_id %>"
										onClick   = "postSwitch(this, 'blast_missing.mhtml');"
									></a>
								</td>
							</tr>
%						}
					</tbody>
				</table>
%			}
%		}

	</div>

