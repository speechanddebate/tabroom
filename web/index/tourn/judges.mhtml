<%args>
	$tourn_id
	$judge_group_id => undef
	$account => undef
</%args>
<%init>

	my $tourn =  Tab::Tourn->retrieve($tourn_id);
	my $judge_group =  Tab::JudgeGroup->retrieve($judge_group_id);

	Tab::JudgeGroup->set_sql( field_reports => "
		select judge_group.* from judge_group, judge_group_setting
		where judge_group.tourn = ?
		and judge_group.id = judge_group_setting.judge_group
		and judge_group_setting.tag = \"field_report\"
		and judge_group_setting.value = 1
		order by judge_group.name
	");

	my @judge_groups = Tab::JudgeGroup->search_field_reports($tourn->id);

	$judge_group = $judge_groups[0] unless $judge_group;

    my $webpage = Tab::Webpage->search( tourn => $tourn_id, special => "fields")->first;

	my $switch;

</%init>

	<div class="left huge">

        <h2>
            <% $tourn->name %>: <% $tourn->location %>  
        </h2>

        <& tourn_header.mas, tourn => $tourn, account => $account &>

%		if ($judge_group) { 

%			my @judges = sort {$a->school->name cmp $b->school->name} $judge_group->judges(active => 1);

			<h4>Judges in <% $judge_group->name %> (<% scalar @judges %> judges) </h4>

			<table cellpadding="6" cellspacing="1" width="100%">

%				foreach my $judge (@judges) { 

					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
			
						<td class="medspan smallish nowrap">
							<% $judge->school ? $judge->school->short_name : "Hired" %>
						</td>

						<td>
							<% $judge->school ? $judge->school->chapter->state : "" %>
						</td>

						<td>
%							if ($judge->account && $judge->account->paradigm) { 
								<a class="white block" href="/index/paradigm.mhtml?judge_id=<% $judge->account->id %>">
%							} 
							<% $judge->first." ".$judge->last %>
							</a>
						</td>

%						if ( ($judge->obligation + $judge->hired) > 0) { 
							<td>
								<% $judge->obligation + $judge->hired %>
							</td>
%						}

					</tr>

%				}

			</table>

%		} elsif ($webpage) { 

	        <p>
				<% $webpage->content %>
			</p>

%		} else { 

			<p>Choose an judge_group at right to see the reported field.  You may not see all judge_groups
			or divisions in the field report; the system only reports fields which the tournament
			officials have released.</p>

%		}

		</table>

	</div>

	<div class="right small">
	
		<div class="sidenote">

			<h4>Judges</h4>

%			foreach my $ojudge_group (sort {$a->name cmp $b->name} @judge_groups) { 

				<a class="<% ($ojudge_group->id == $judge_group_id ) ? "dk" : "" %>blue block" 
					href="/index/tourn/judges.mhtml?tourn_id=<% $tourn_id %>&judge_group_id=<% $ojudge_group->id %>">
					<% $ojudge_group->name %>
				</a>

%		}
	
		</div>

	</div>

