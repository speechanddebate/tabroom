<%args>
	$event_id => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id) if $event_id;  
	my $tourn = $event->tourn;

	$m->abort() unless $event->setting("live_updates");

	my $switch;

	use POSIX;

	my @entries = sort {$a->school->name cmp $b->school->name} $event->entries ( dropped => 0, waitlist => 0);
	my @ballot_values = $m->comp("/funclib/event_values.mas", event => $event, public => 1, prelim => 1);
	my %wins_by_entry = ();

	foreach my $value (@ballot_values) {
		$wins_by_entry{$value->entryid}++ if $value->value == 1 and $value->tag eq "ballot";
	}

	@entries = sort { $wins_by_entry{$b->id} <=> $wins_by_entry{$a->id} } @entries;

</%init>

	<& sidebar.mas, tourn_id => $tourn->id, event_id => $event_id, &>

	<& /funclib/tablesorter.mas, table => "sortme" &>

	<div class="left huge">

		<h2>Records in order</h2>

			<table cellpadding="4" cellspacing="1" id="sortme">

				<thead>

				<tr class="yellowrow">
					
					<th class="smaller">
						Wins
					</th>

					<th class="smaller">
						Name
					</th>

					<th class="smaller">
						Code
					</th>

					<th class="smaller">
						School
					</th>
				</tr>

				</thead>


				<tbody>

%				foreach my $entry (@entries) {

					<tr>

						<td class="smaller centeralign">
							<% $wins_by_entry{$entry->id} ? $wins_by_entry{$entry->id} : "" %>
						</td>

						<td class="smaller">
							<a class="plain block" href="entry_record.mhtml?tourn_id=<% $tourn->id %>&entry_id=<% $entry->id %>">
								<% $entry->name %>
							</a>
						</td>

						<td class="smaller">
							<a class="plain block" href="entry_record.mhtml?tourn_id=<% $tourn->id %>&entry_id=<% $entry->id %>">
								<% $entry->code %>
							</a>
						</td>

						<td class="smaller">
							<% $entry->school->short_name %>
						</td>

					</tr>

%				}

			</tbody>

		</table>

	</div>


