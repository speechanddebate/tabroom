<%args>
	$judge_id => undef
	$search_first => undef
	$search_last => undef
</%args>
<%init>

	my $account = Tab::Account->retrieve($judge_id) if $judge_id;

	my @searches;

	if ($search_first || $search_last) { 
	
		if ($search_first && $search_last) { 

			Tab::Account->set_sql( both => "
				select distinct *
				from account
				where first like ? 
				and last like ? 
				and paradigm is not null
			");

			@searches = Tab::Account->search_both($search_first, $search_last);

		} elsif ($search_first) {

			Tab::Account->set_sql( first => "
				select distinct *
				from account
				where first like ? 
				and paradigm is not null
			");

			@searches = Tab::Account->search_first($search_first);

		} elsif ($search_last) {

			Tab::Account->set_sql( last => "
				select distinct *
				from account
				where last like ? 
				and paradigm is not null
			");

			@searches = Tab::Account->search_last($search_last);

		}

		$account = shift @searches if scalar @searches == 1;

	}

</%init>


	<div class="left huge">

		<br />

%		if (@searches) { 

			<h2>Pick one</h2>

			<p>Your search for <% $search_first %> <% $search_last %> returned multiple judges:</p>

%			foreach my $search (@searches) { 
				
				<a class="blue quarterspan nowrap smallish" href="paradigm.mhtml?judge_id=<% $search->id %>">
					<% $search->first." ".$search->last %>
				</a>

%			}

%		} elsif ($account) { 

			<h2><% $account->first." ".$account->last %> Paradigm</h2>

			<div class="paradigm">
				<% $account->paradigm %>
			</div>

%		} else { 

			<h2>Judge Paradigms</h2>

			<p>Search for a judge at right to read paradigms</p>

%			unless (@searches) { 
%				if ($search_first || $search_last) {
					<p class="explain centeralign">
						Your search for <% $search_first %> <% $search_last %> returned no judges with paradigms.  Please
						try again.   
					</p>
%				}
%			}

%		}

	</div>

	<div class="right small">

%		if ($account) { 

			<div class="sidenote">

				<h4><% $account->last %> History</h4>

				<a href="/jbruschke/JudgeRecord.php?judgeid=<% $account->id %>" class="blue block">
					View Past Results
				</a>

			</div>

%		}
	
		<div class="sidenote">

			<h4>Search Judges:</h4>

			<form action="paradigm.mhtml">

			<div class="oddrow block smallish">
				<input type="text" name="search_first" placeholder="First name" size="25">
			</div>

			<div class="oddrow block smallish">
				<input type="text" name="search_last" placeholder="Last name" size="25">
			</div>

			<div class="liblrow rightalign">
				<input type="submit" value=" Go ">
				</form>
			</div>

		</div>

	</div>



