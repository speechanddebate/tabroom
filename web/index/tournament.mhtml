<%args> 
	$tourn_id => undef
</%args>
<%init> 
	my $tourn = Tab::Tournament->retrieve($tourn_id) if $tourn_id;

	my $league = $tourn->league;

	my @events = sort {$a->name cmp $b->name} $tourn->events;

	my $now = DateTime->now;

	$now->set_time_zone($league->timezone);

	my $start = $tourn->start;
	$start->set_time_zone($league->timezone);
	my $end = $tourn->end;
	$end->set_time_zone($league->timezone);
	my $reg_start = $tourn->reg_start;
	$reg_start->set_time_zone($league->timezone);
	my $reg_end = $tourn->reg_end;
	$reg_end->set_time_zone($league->timezone);
	
</%init> 

	<h2><% $tourn->name %></h2>

%	if ($now < $reg_end && $now > $reg_start and not $tourn->method ) { 
	<p class="err">This tournament's registration period has started, but nothing has
	been set up yet.  Please contact the tournament directors listed below for more
	information.</p>
% 	}

%	if ($now < $reg_end && $now > $reg_start and not $tourn->events ) { 
	<p class="err">This tournament's registration has started, but events have not
	been set up yet.  Please contact the tournament directors listed below for more
	information.</p>
% 	}

% my $switch;

<table cellpadding="5" cellspacing="1" width="100%" style="font-size: 100%">

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Contacts:</th>
	<td><a href="mailto:<% $tourn->director->email %>"><%$tourn->director->first." ".$tourn->director->last %></td>
</tr>

% foreach my $ca ($tourn->accounts) { 
%	next unless $ca->contact;
%	my $c = $ca->account;

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	<td></td>
	<td>
	<a href="mailto:<% $c->email %>">
	<% $c->first." ".$c->last %>
	</a></td>
</tr>
%}

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Tournament Dates:</th>
<td>
	<% $start->mdy('/') %>
	<% ($start->mdy ne $end->mdy) ? " - ".$end->mdy('/') : "" %> 
</td>
</tr>

% unless ($tourn->reg_start->mdy('/') eq $tourn->reg_end->mdy('/')) {

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td style="padding-left: 30px;">Online Registration Begins:</th>
<td>
	<% $tourn->reg_start->mdy('/') %>
</td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td style="padding-left: 30px;">Student Adds Due:</th>
<td>
	<% $tourn->reg_end->mdy('/') %> 
	at
	<% $tourn->reg_end->set_time_zone($league->timezone)->hour_12.":".$tourn->reg_end->strftime('%M')." ".$tourn->reg_end->strftime('%p')%> 
</td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td style="padding-left: 30px;">Judging Information Due:</th>
<td>
	<% $tourn->judge_deadline->mdy('/') %> 
	at
	<% $tourn->judge_deadline->set_time_zone($league->timezone)->hour_12.":".$tourn->judge_deadline->strftime('%M')." ".$tourn->judge_deadline->strftime('%p')%> 
</td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td style="padding-left: 30px;">Drops/Changes online until:</th>
<td>
	<% $tourn->drop_deadline->mdy('/') %> 
	at
	<% $tourn->drop_deadline->set_time_zone($league->timezone)->hour_12.":".$tourn->drop_deadline->strftime('%M')." ".$tourn->drop_deadline->strftime('%p')%> 
</td>
</tr>

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<td style="padding-left: 30px;">Fines on changes apply after</th>
<td>
	<% $tourn->fine_deadline->mdy('/') %> 
	at
	<% $tourn->fine_deadline->set_time_zone($league->timezone)->hour_12.":".$tourn->fine_deadline->strftime('%M')." ".$tourn->fine_deadline->strftime('%p')%> 
</td>

% }

% if ($tourn->method && $tourn->method->publish_schools) { 

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Registered School List</th>
<td><a href="<% $Tab::url_prefix %>/index/schools.mhtml?tourn_id=<% $tourn->id %>">School List</td>
</td>
</tr>

%	}




% if ($tourn->invitename) {
<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Invitation:</th>
<td>(<a href="<% $Tab::url_prefix%>/files/<% $tourn->league->id %>/tournaments/<% $tourn->id."/".$tourn->invitename %>"><% $tourn->invitename %></a>)</td>
</tr>
%  }

% if ($tourn->bill_packet) {
<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Bills:</th>
<td>(<a href="<% $Tab::url_prefix%>/files/<% $tourn->league->id %>/tournaments/<% $tourn->id."/bills/".$tourn->bill_packet %>">Download</a>)</td>
</tr>
%  }

% if ($tourn->method && $tourn->method->publish_paradigms) { 

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	<th>Judge Paradigms</th>
	<td><a href="<% $Tab::url_prefix %>/index/paradigms.mhtml?tourn_id=<% $tourn->id %>">View Judge Paradigms</a></td>
	</td>
	</tr>

%	}

% if ($tourn->published_rounds) { 

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
	<th>Postings/Schematics:</th>
	<td>(<a href="<% $Tab::url_prefix %>/index/postings.mhtml?tourn_id=<% $tourn->id %>">View Postings</a>)</td>
	</tr>

%	}

% if ($tourn->results) { 

<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Results:</th>
<td>(<a href="<% $Tab::url_prefix %>/public_site/results/<% $league->id %>/<% $tourn->id %>/index.mhtml">Results</a>)</td>
</tr>

% }

</td>

% if ($tourn->inviteurl) {
<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
<th>Tournament Website:</th>
<td>(<a href="<% $tourn->inviteurl %>">Link</a>)</td>
</tr>
%}

</table>

% if ($tourn->sites) { 

<h3 style="letter-spacing: 1px;">Location<% (scalar $tourn->sites > 2) ? "s" : ""%></h3>

<table cellpadding="5" cellspacing="1" width="100%">

% foreach my $site (sort {$a->name cmp $b->name} $tourn->sites) { 

<tr>
<td colspan="2"><h4><% $site->name %>:</h4></td>
</tr>

% if ($site->host) { 

<tr>
<td class="italic">Site Host:</td>
<td> <% $site->host->first." ".$site->host->last %></td>
</tr>

% }

<tr>
<td colspan="2">
<% $site->directions %> 
</td>
</tr>

% }

</table>
% } #end of if sites

%	$switch = 1;

<table cellpadding="7" cellspacing="1" width="100%">

	<tr>
		<td colspan="2">
			<h4>Events Offered</h4>
		</td>
	</tr>

% foreach my $event (@events) { 

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
		<td>
			<a href="event.mhtml?event_id=<% $event->id %>"><% $event->name %></a>
		</td>
	</tr>

% }

</table>
