<%args>
	$account
	$school_id => undef
	$chapter_id => undef
	$tourn_id => undef
	$entry_id => undef
</%args>
<%init>

	$m->call_next if $r->uri eq "/user/enter/create.mhtml";

	my $school = Tab::School->retrieve($school_id) if $school_id;
	my $chapter = Tab::Chapter->retrieve($chapter_id) if $chapter_id;
	my $tourn = Tab::Tourn->retrieve($tourn_id) if $tourn_id;

	$school = Tab::School->search( chapter => $chapter, tourn => $tourn_id )->first unless $school;

	my $coach = Tab::ChapterAdmin->search( chapter => $school->chapter->id, account => $account->id )->first if $school && $school->chapter;

	my $entry = Tab::Entry->retrieve($entry_id) if $entry_id;

	$m->redirect("/user/home.mhtml?err=That school does not exist yet.  Please register") unless $school;

	if ($account->site_admin || $coach) { 

		$m->call_next( school => $school );

	}  else { 

		$m->redirect("/user/home.mhtml?err=You are not authorized to view that school");

	}



</%init>

