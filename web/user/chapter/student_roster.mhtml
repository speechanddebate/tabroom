<%args>
	$account
	$chapter_id => undef
	$show_grads => undef
	$err => undef
	$sort_by => "last"
	$from => undef
	$tourn
</%args>
<%init>

	unless ($chapter_id) {
		my $err = "You haven't chosen a chapter.  Please choose at right";
		$m->redirect("/user/home.mhtml?err=$err");
	}

	my $chapter = Tab::Chapter->retrieve($chapter_id);


	my @students;
 
	if ($show_grads) { 

		@students = $chapter->students;

	} else {

		@students = $chapter->nongrads;

	}

	unless (@students) { 
		$m->redirect("student_edit.mhtml?newbie=yes&chapter_id=".$chapter_id);
	}

	@students = sort {$a->last cmp $b->last} @students;

	@students = sort {$a->grad_year <=> $b->grad_year} @students if $sort_by eq "grad_year";

	@students = sort {$b->novice <=> $a->novice } @students if $sort_by eq "novice";

	@students = sort {$b->retired <=> $a->retired } @students if $sort_by eq "retired";

	my $message;

</%init>

	<div class="left huge">

		<& /user/tabbar.mas, chapter => $chapter, whoami => "students" &>

        <table>

            <tr>
                <td width="100%">
                    <h2><% $chapter->name %> Student Roster</h2>
                </td>

                <td>
                    <form action="student_edit.mhtml" method="post">
                    <input  type="submit" value="Add New">
                    <input type="hidden" name="chapter_id" value="<% $chapter->id %>">
                    </form>
                </td>
            </tr>

        </table>


		<table width="100%" cellpadding="3" cellspacing="1">

			<tr class="liblrow">
				<th>
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_grads=<% $show_grads %>&sort_by=last"> 
						Name
					</a>
				</th>

				<th class="smaller" style="text-align: center;">
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_grads=<% $show_grads %>&sort_by=grad_year">
						Grad Year
					</a>
				</th>

				<th class="smaller" style="text-align: center;">
					<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_grads=<% $show_grads %>&sort_by=novice">
						Novice
					</a>
				</th>

%				if ($show_grads) { 
					<th class="smaller" style="text-align: center;">
						<a href="student_roster.mhtml?chapter_id=<% $chapter_id %>&show_grads=<% $show_grads %>&sort_by=retired">
							Retired
						</a>
					</th>
%				}

				<th class="smallctr" colspan="2">

					<a class="whiteblock" href="student_roster.mhtml?show_grads=<% ($show_grads) ? "" : "a" %>&chapter_id=<% $chapter->id %>">
						<% ($show_grads) ? "Hide Graduates" : "Show Graduates" %>
					</a>

				</th>

			</tr>

% 			my $switch; 

% 			foreach my $student (@students) { 

%				next if $student->retired &! $show_grads;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a id="<% $student->id %>"></a>
						<% $student->last.", ".$student->first %>
					</td>

					<td class="center">
						<% $student->grad_year %>
					</td>

					<td class="center">
						<% ($student->novice) ? "*" : "" %>
					</td>

%					if ($show_grads) { 
						<td class="center">
							<% ($student->retired) ? "Y" : "" %>
						</td>
%					}
							
					<td class="center">
						<a class="whiteblock" href="/user/chapter/student_edit.mhtml?student_id=<% $student->id %>">
						Edit
						</a>
					</td>

					<td class="center">
						<a class="whiteblock" href="/user/chapter/student_retire.mhtml?student_id=<% $student->id %>">
							<% ($student->retired) ? "Unretire" : "  Retire  " %>
						</a>
					</td>

				</tr>

% 			}

		</table>

	</div>

	<div class="right small">

		<& /user/menu.mas, chapter => $chapter, account => $account, tourn => $tourn &>

	</div>
	
