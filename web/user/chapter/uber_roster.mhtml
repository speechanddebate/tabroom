<%args>
	$account
	$chapter_id
	$show_retired => undef
	$err => undef
	$sort_by => "last"
	$from => undef
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my @ubers;
 
	if ($show_retired) { 
		@ubers = $chapter->ubers;
	} else {
		@ubers = $chapter->ubers( retired => 0 );
	}

	unless (@ubers) {
		$m->redirect("uber_edit.mhtml?newbie=yes&chapter_id=".$chapter_id);
	}

	@ubers = sort {$a->last cmp $b->last} @ubers;
	@ubers = sort {$b->started <=> $a->started } @ubers if $sort_by eq "started";
	@ubers = sort {$b->retired <=> $a->retired } @ubers if $sort_by eq "retired";

	my $message;

</%init>

	<div class="left huge">

		<& /user/tabbar.mas, chapter => $chapter, whoami => "judges" &>

		<table>

			<tr>
				<td width="100%">
					<h2><% $chapter->name %> Judge Roster</h2>
				</td>

				<td>
					<form action="uber_edit.mhtml" method="post">
					<input class="blue" type="submit" value="Add New">
					<input type="hidden" name="chapter_id" value="<% $chapter->id %>">
					</form>
				</td>
			</tr>

		</table>

		<table width="100%" cellpadding="4" cellspacing="1">

			<tr class="liblrow">

				<th>
					<a href="uber_roster.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=last"> Name </a>
				</th>

				<th style="text-align: center;"> 
					<a href="uber_roster.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=cell">Cell #</a>
				</th>

				<th style="text-align: center;"> 
					<a href="uber_roster.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=started">Started</a>
				</th>

%				if ($show_retired) { 

					<th class="smaller" style="text-align: center;"> 
						<a href="uber_roster.mhtml?chapter_id=<% $chapter_id %>&show_retired=<% $show_retired %>&sort_by=retired">Inactive</a>
					</th>

%				}

				<th class="smallctr" colspan="2">
					<a class="whiteblock" href="uber_roster.mhtml?show_retired=<% ($show_retired) ? "" : "a" %>&chapter_id=<% $chapter->id %>">
						<% ($show_retired) ? "Hide Inactives" : "Show Inactives" %>
					</a>

				</th>

			</tr>

% 			my $switch; 

% 			foreach my $uber (@ubers) { 

%				next if $uber->retired &! $show_retired;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<td>
						<a id="<% $uber->id %>"></a>
						<% $uber->last.", ".$uber->first %>
					</td>

					<td align="center">
						<% $uber->cell %>
					</td>

					<td align="center">
						<% $uber->started %>
					</td>

%					if ($show_retired) { 
						<td class="center">
							<% ($uber->retired) ? "Y" : "" %>
						</td>
%					}
							
					<td class="smallctr">
						<a class="whiteblock" href="/user/chapter/uber_edit.mhtml?uber_id=<% $uber->id %>">
							Edit
						</a>
					</td>

					<td class="smallctr">
						<a class="whiteblock" href="/user/chapter/uber_retire.mhtml?uber_id=<% $uber->id %>">
							<% ($uber->retired) ? "Activate" : "Deactivate" %>
						</a>
					</td>

				</tr>

% 			}

		</table>

	</div>

	<div class="right small">

        <& /user/menu.mas, chapter => $chapter, account => $account &>

	</div>

