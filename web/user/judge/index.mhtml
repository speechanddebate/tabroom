<%args>
	$account
	$judge_id => undef
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id);

	if ($judge > 0 && $judge->account && $judge->account->id != $account->id) { 
		my $name = $account->last;
		$m->print("That judge is not you.  Stop messing around, $name");
		$m->abort;
	}

	my @judges = $account->judges unless $judge;
	push (@judges, $judge) if $judge;

	my $switch;
	my $now = DateTime->now;

</%init>

	<& /user/menu.mas, account => $account &>

	<div class="huge left">

		<h2>Upcoming judging</h2>

%		foreach my $judge (@judges) { 

%			next if $judge->judge_group->tourn->end < $now;

			<h4><% $judge->judge_group->name %> at <% $judge->judge_group->tourn->name %> </h4>

			<div class="half left">

				<span class="odd block padmore smallish">
					<span class="medspan">
						School
					</span>
					<% $judge->school ? $judge->school->short_name : "Hired" %>
				</span>

				<span class="odd block padmore smallish">
					<span class="medspan">
						Judge Group
					</span>
					<% $judge->judge_group->name %>
				</span>
	
%				unless  ($judge->judge_group->setting("no_codes")) { 

					<span class="odd block padmore smallish">
						<span class="medspan">
							Judge Code
						</span>
						<% $judge->code %>
					</span>

%				}

			</div>

			<div class="right half">

%				if ($judge->judge_group->setting("rounds_per")) { 

					<span class="odd block padmore smallish">
						<span class="medbigspan">
							Obligation for School
						</span>
						<span class="evensmallerspan">
							<% $judge->obligation %>
						</span>
					</span>

					<span class="odd block padmore smallish">
						<span class="medbigspan">
							Hired Rounds
						</span>
						<span class="evensmallerspan">
							<% $judge->hired %>
						</span>
					</span>
%				}

%				if ($m->comp("/funclib/account_panels.mas", account => $account, judge => $judge)) {

					<br style="clear: both;" />

					<span class="odd block padmore smallish">

						<span class="medbigspan" style="margin-top: 6px;">
							Enter Ballots Online:
						</span>

						<span class="smallerspan">
							<a class="dkgreen inline" href="panels.mhtml">
								ENTER
							</a>
						</span>
					</div>

%				} elsif ($m->comp("/funclib/account_published.mas", account => $account, judge => $judge)) {

					<br style="clear: both;" />

					<span class="odd block padmore smallish">

						<span class="medbigspan">
							See Online Pairings:
						</span>

						<span class="smallspan">
							<a class="dkgreen block" href="panels.mhtml">
								VIEW
							</a>
						</span>
					</div>
%				}

			</div>

			<br style="clear: both;" />

%		}

	</div>

