<%args>
	$account
</%args>
<%init>

	my @cjs = Tab::ChapterJudge->search_like( first => $account->first."%", last => $account->last."%" );
	my @judges = Tab::Judge->search_like( first => $account->first."%", last => $account->last."%" );

	my %cjs_by_id = ();

	foreach my $cjs (@cjs) { 
		$cjs_by_id{$cjs->id}++;
	}

	my $switch;
	my $found;

</%init>

	<div class="left huge">

		<h2>Judges</h2>

		<p>
			Link these judges to your accounts for updates & ballot
			assignments.  Note: the adminstrators of your team/school will have
			to approve requests to claim a judge record before you can access
			them.  Team admins will be notified of requests by email.
		</p>

		<table cellpadding="5" cellspacing="1">

			<tr class="yellowrow">
				
				<th>
					School/Team
				</th>

				<th>
					Created
				</th>

				<th>
					Tournaments Judged
				</th>

				<th>
				</th>

			</tr>

%			foreach my $cjs (@cjs) { 

%				next if $cjs->account->id;
%				next if $cjs->acct_request && $cjs->acct_request->id == $account->id;
%				$found++;
			
				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						<% ($cjs->chapter) ? $cjs->chapter->name : "" %>
					</td>

					<td class="centeralign">
						<% Tab::niceshortdt($cjs->created) %>
					</td>

					<td class="centeralign">
						<% (scalar $cjs->judges) %> tournaments
					</td>

					<td class="centeralign">
						<a class="dkgreen block" href="claim.mhtml?chapter_judge_id=<% $cjs->id %>">
							Claim this judge
						</a>
					</td>

				</tr>

%			}

%			foreach my $judge (@judges) { 

%				next if $judge->account;
%				next if $judge->chapter_judge && $cjs_by_id{$judge->chapter_judge->id};
%				$found++;

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

					<td>
						<% ($judge->school) ? $judge->school->name : "Hired" %>
					</td>

					<td class="centeralign">
						<% $judge->judge_group->tourn->name %>
					</td>

					<td class="centeralign">

%						if ($judge->acct_request && $judge->acct_request->id == $account->id) { 

							<a class="dkred block">
								Request Pending
							</a>

%						} else {

							<a class="dkgreen block" href="claim.mhtml?chapter_judge=<% $judge->id %>">
								Claim this judge
							</a>

%						}

					</td>

				</tr>

%			}

		</table>

%		unless ($found) { 

			<br />

			<p>
				There are no judges with your name to claim.   If this is in
				error, as your team administrator or the tournament director to
				link your email to that judge record.
			</p>
%		}

	</div>

	<div class="right small">

		<div class="sidenote">

			<h4>Your teams</h4>

%			foreach my $cj ($account->chapter_judges) { 
				<a class="yellow block" href="chapter.mhtml?chapter_judge_id=<% $cj->id %>">
					<% $cj->chapter->name %>
				</a>
%			}

		</div>

		<div class="sidenote">

			<h4>Recent judging</h4>

%			my $count;
%			foreach my $judge (sort {$b->id <=> $a->id} $account->judges) { 
%				last if $count++ > 10;
				<a class="blue block" href="judge.mhtml?judge_id=<% $judge->id %>">
					<% $judge->judge_group->abbr %> at <% $judge->judge_group->tourn->name %>
				</a>
%			}

			<a class="yellow block" href="history.mhtml?account_id=<% $account->id %>" style="margin-top: 10px;">
				Full Judging History
			</a>
	
		</div>

	</div>

