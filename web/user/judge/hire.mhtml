<%args>
	$person
</%args>
<%init>

	my @already = $m->comp("/funclib/person_judges.mas", person => $person);

	my %judge_by_tourn = ();

	foreach my $judge (@already) {
		$judge_by_tourn{$judge->tourn} = $judge;
	}

</%init>

	<& /funclib/tablesorter.mas, table => "hired" &>

	<& /user/menu.mas, person => $person, whoami => "exchange" &>

	<div class="main">

		<span class="threequarters">
			<h2>
				Offer Hired Rounds
			</h2>
		</span>
		<span
			class="quarter rightalign"
			id="hired_buttonarea"
		>
		</span>

		<table id="hired">

			<thead>
			<tr class="yellowrow smallish">

				<th class="">
					Tournament
				</th>

				<th class="">
					Location
				</th>

				<th class=" tightline centeralign">
					Obligation
				</th>

				<th class=" tightline centeralign">
					Hire Offer
				</th>

				<th class=" tightline centeralign">
					Tourn OK
				</th>

				<th class=" tightline centeralign">
					Claimed
				</th>

				<th class="">
					Total
				</td>

				<th class="nosort">
				</th>

			</thead>

			<tbody>

%			my %used = ();

%			foreach my $tourn ($m->comp("/funclib/tourn_exchange.mas")) {

%				next if $used{$tourn->id};
%				$used{$tourn->id}++;

%				my $judge =  $judge_by_tourn{$tourn->id};

				<tr>

					<td class="nospace padless">
%						if ($tourn->webname) {
							<a class="plain" href="http://<% $tourn->webname %>.tabroom.com">
%						} else {
							<a class="plain" href="/index/tourn/index.mhtml?tourn_id=<% $tourn->id %>">
%						}
							<div class="padless marno">
								<% $tourn->name %>
								(<% $tourn->location %>)
							</div>
							<div class="padless marno">
								<% Tab::niceshortdate($tourn->start) %>
								<% $tourn->start->day != $tourn->end->day ? " - ".Tab::niceshortdate($tourn->end) : "" %>
								<% $tourn->start->year %>
							</div>
						</a>
					</td>

					<td class="nospace padless centeralign">
						<% $tourn->city ? $tourn->city."," : "" %> <% $tourn->state %>
					</td>

					<td class="centeralign">
						<% $judge ? $judge->obligation : "" %>
					</td>

					<td class="centeralign">
						<% $judge ? $judge->setting('hire_offer') : "" %>
					</td>

					<td class="centeralign">
						<% $judge && $judge->setting('hire_offer') ?  $judge->setting("hire_approved") ? "Yes" : "No" : "" %>
					</td>

					<td class="centeralign">
						<% $judge ? $judge->hired : "" %>
					</td>

					<td class="centeralign">
						<% $judge ? $judge->hired + $judge->obligation : "" %>
					</td>

					<td class="centeralign ">
						<a
							class="buttonwhite bluetext thin invert"
							href="hire_edit.mhtml?tourn_id=<% $tourn->id %>"
						>
							OFFER
						</a>
					</td>

				</tr>

%			}

			</tbody>

		</table>

	</div>



