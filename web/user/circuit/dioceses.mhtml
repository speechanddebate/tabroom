<%args>
	$circuit_id
</%args>
<%init>

	my $circuit = Tab::Circuit->retrieve($circuit_id);
	
	my $switch = 1;



</%init>

	<& menu.mas, circuit => $circuit, whoami => "dioceses" &>


	<div class="left huge">

		<h2><% $circuit->abbr %> Dioceses</h2>

		<div class="liblrow block smallish">

			<form action="dioceses_save.mhtml" method="post">
			<input type="hidden" name="circuit_id" value="<% $circuit->id %>">
			<input type="hidden" name="new" value="1">

			<span class="eighty bigger">
				<h5>Add New:</h5>
			</span>

			<span class="medbigspan">
				<input type="text" name="name_new" size="25" placeholder="Diocese name">
			</span>

			<span class="smallerspan rightalign">
				Arch:
			</span>
			<span class="smallerspan">
				<input type="checkbox" name="arch_new" size="5" value="1">
			</span>

			<span class="smallishspan">
				<input type="text" name="code_new" size="4" placeholder="Code">
			</span>

			<span class="eighty">
				<input type="text" name="quota_new" size="4" placeholder="Quota">
			</span>

			<span class="smallspan">
				<input type="submit" value=" Add " class="thin">
			</span>

			</form>

		</div>

		<& /funclib/tablesorter.mas, table => "sortme" &>

		<table cellpadding="4" cellspacing="1" id="sortme">

			<thead>

				<tr class="yellowrow">

					<th class="smallish">
						Diocese
					</th>

					<th class="smallish">
						Arch
					</th>

					<th class="smallish">
						Code
					</th>

					<th class="smallish">
						Quota
					</th>

					<th class="smallish">
						Access
					</th>

				</tr>

			</thead>

			<tbody>

%				foreach my $diocese (sort {$a->name cmp $b->name} $circuit->regions) {

					<tr class="smallish">

						<td>
							<input type="text" name="name_<% $diocese->id %>" size="20" value="<% $diocese->name %>">
						</td>

						<td class="centeralign">
							<span class="hidden"><% $diocese->arch %></span>
							<input type="checkbox" name="arch_<% $diocese->id %>" size="25" value="1" <% $diocese->arch ? 'checked="checked"' : "" %> >
						</td>

						<td class="centeralign">
							<span class="hidden"><% length($diocese->code) %><% $diocese->code %></span>
							<input type="text" name="code_<% $diocese->id %>" size="4" value="<% $diocese->code %>">
						</td>

						<td class="centeralign">
							<span class="hidden"><% $diocese->quota %></span>
							<input type="text" name="quota_<% $diocese->id %>" size="4" value="<% $diocese->quota %>">
						</td>

						<td>
%							foreach my $admin ($diocese->admins) { 
								<a href="diocese_admin.mhtml?diocese_id=<% $diocese->id %>&circuit_id=<% $circuit->id %>" class="plain block padless">
									<% $admin->first." ".$admin->last." (".$admin->email.")" %>
								</a>
%							}

%							unless ($diocese->admins) { 
								<a href="diocese_admin.mhtml?diocese_id=<% $diocese->id %>&circuit_id=<% $circuit->id %>" class="dkred block padless">
									Add Administrator
								</a>
%							}

						</td>

					</tr>
%				}

			</tbody>

			<tr class="liblrow">

				<td colspan="5" class="rightalign">
					<input type="submit" value="Save Diocese">
					</form>
				</td>

			</tr>

		</table>

	</div>








