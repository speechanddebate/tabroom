<%args>
	$account
</%args>
<%init>

	my $now = DateTime->now();

	Tab::Circuit->set_sql(by_admin => "
		select distinct circuit.* 
		from circuit, circuit_admin
		where circuit.id = circuit_admin.circuit
		and circuit_admin.account = ? 
		order by circuit.name");


	Tab::Tourn->set_sql(approvals => "
		select distinct tourn.* 
		from tourn, tourn_circuit
		where tourn.id = tourn_circuit.tourn
		and tourn_circuit.tourn = ?
		and tourn.approved = 0
		order by tourn.name");

	my @circuits = Tab::Circuit->search_by_admin($account->id);

	return unless @circuits;

</%init>

	<h3 style="padding-top: 15px;" >Circuits:</h3>

%		foreach my $circuit (@circuits) { 

			<a class="blue block" href="/user/circuit/circuit_select.mhtml?circuit_id=<% $circuit->id %>">
				<% $circuit->name %> (<% $circuit->state %>)
			</a>

%			my @approvals = Tab::Tourn->search_approvals($circuit->id);

%			if (@approvals) { 
			
				<a class="red block" href="/circuit/approvals.mhtml?circuit_id=<% $circuit->id %>">
					--> <% scalar @approvals %> tournaments pending approval
				</a>

%			}

%		}
