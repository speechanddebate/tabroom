<%args>
	$circuit
	$person
	$person_settings
	$perms
	$key => undef
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	my $qualifiers = $circuit->setting("qualifiers");
	my $message;

	if ($key) {

		foreach my $qual (keys %{$qualifiers}) {
			if ($key == $qual) {
				$message = "Deleted qualification ruleset ".$qualifiers->{$key}{label},
				Tab::ChangeLog->create({
					person      => $person,
					circuit     => $circuit,
					description => $message,
				});

				delete $qualifiers->{$key};
			}
		};

		if (scalar (keys %{$qualifiers}) > 0) {
			$circuit->setting("qualifiers", "json", $qualifiers);
		} else {
			$circuit->setting("qualifiers", 0);
		}
	}

	my $response = {
		error   => \0,
		message => $message
	};

	$m->print(JSON::encode_json($response));

</%init>
