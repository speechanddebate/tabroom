<%args>
	$judge
</%args>
<%init>

	my %judge_settings;
	%judge_settings = $judge->all_settings() if $judge;

	my $category = $judge->category;
	my %category_settings = $category->all_settings();

	my %nomination;

	if ($judge && $category_settings{"nats_category"}) {

		%nomination = eval {
			return %{JSON::decode_json($judge->setting("nomination")) };
		};

	}

	my $tourn = $category->tourn;

	my $judge_deadline = $tourn->setting("judge_deadline");
	$judge_deadline = $tourn->setting("drop_deadline") unless $judge_deadline;

	my $now = DateTime->now();

	my $person = $judge->person;

	my $closed;
	$closed++ if $now > $judge_deadline;

</%init>

		<h5 class="martopmore">Late Elimination Nominations</h5>

		<div class="nospace centeralign">

			<span class="nineteen leftalign nospace">

				<div class="nospace full">

					<p class="bluetext">
						Judging a national semifinal or final round is an honor
						for the judge, and we strive to have the strongest pool
						of judges possible, with representation from multiple
						viewpoints and approaches.
					</p>

					<p class="bluetext">
						You may nominate your judges below to judge late
						elimination rounds.  Judges of late elim rounds must be
						at least two years out of high school competition.
					</p>

					<p class="bluetext">
						Please understand this will not guarantee the judge is
						pooled for a round. Judges must be available at the
						tournament on Wednesday, Thursday &amp; Friday. Failure
						to appear for a self-nominated late elim round will
						forfeit the school's bond.
					</p>

					<p class="redtext">
						All judges nominated for late elim/finals judging should
						also fill out the Diversity Questionnaire whether or
						not you consider yourself diversity-enhancing.  All
						nominated judges must also have an email and cell phone
						number listed.
					</p>

%					if ($nomination{"chair_nominated"}) {
						<div id="chair_nom" class="full centeralign semibold redtext">
							You were nominated to judge semis or finals by your
							District Chair.  Please contact your chair if this
							is an error or you will not be available to judge
							in late elimination or final rounds.
						</div>
%					}

					<label for="self_nominated">

						<div class="full row marno martopmore hover">

							<span class="fourfifths semibold bluetext bigger">
%								if ($ARGS{"me"}) {
									I would like to be considered to judge a semi or final round
%								} else {
									This judge would like to be considered to judge a semi or final round
%								}
							</span>

							<span class="fifth">
								<input
									type    = "checkbox"
									name    = "self_nominated"
									id      = "self_nominated"
									value   = "1"
									onClick = "showNomination();"
									<% $closed ? "disabled" : "" %>
									<% $nomination{"self_nominated"}
										? 'checked="checked"'
										: ""
									%>
								>
							</span>
						</div>
					</label>

					<div id="nom" class="full nospace">

%						unless ( ($judge_settings{"email"} || $person->email) && ( $judge_settings{"phone"} || $person->phone) ) {

							<p class="full bigger redtext semibold marvertmore borderbottomred">
								This judge cannot be nominated for late elimination
								rounds without a listed phone number and email.

								Please list contact information above before
								you proceed with their nomination.
							</p>

%						} else {


							<label for="two_years_out">
								<div class="full row marno hover">
									<span class="fourfifths semibold bluetext">
										Judge is 2 or more years out of high school competition (required):
									</span>

									<span class="fifth">
										<input
											type    = "checkbox"
											name    = "two_years_out"
											id      = "two_years_out"
											value   = "1"
											<% $closed ? "disabled" : "" %>
											<% $nomination{"two_years_out"} ? 'checked="checked"' : "" %>
										> Yes
									</span>
								</div>
							</label>

							<div class="full row marno">
								<span class="twofifths semibold">
									Role at Nationals
								</span>

								<span class="threefifths">
									<select name="role" class="fixedbig">
										<option value=""></option>
%										foreach my $value ("Head Coach", "Assistant Coach", "Tournament Judge", "Other") {
											<option
												value="<% $value %>"
												<% $value eq $nomination{"role"} ? "selected" : "" %>
											><% $value %></option>
%										}
									</select>
								</span>
							</div>

							<div class="full row marno">
								<span class="twofifths semibold">
									Phonetic name pronuncation guide
								</span>

								<span class="threefifths">
									<input
										type  = "text"
										name  = "phonetic"
										size  = "48"
										<% $closed ? "disabled" : "" %>
										value = "<% $nomination{"phonetic"} %>"
									>
								</span>
							</div>

							<div class="full row marno">
								<span class="twofifths semibold">
									Brief bio for introductions
								</span>

								<span class="threefifths">
									<input
										type  = "text"
										name  = "bio"
										size  = "64"
										<% $closed ? "disabled" : "" %>
										value = "<% $nomination{"bio"} %>"
									>
								</span>
							</div>
<%perl>

#							I should make this dynamic but right now I give zero fucks - CLP 3/14/2018
#				i			NEW FOR 2019:  Still give zero fucks.

							my @types = (
								"Policy",
								"LD",
								"PF",
								"Congress",
								"Public Address",
								"Interp",
								"Big Questions",
								"Worlds Debate",
								"Supp/Conn IEs",
								"Supp Debate",
								"Middle School IE",
								"Middle School Debate"
							);
</%perl>
							<span class="full semibold">
								<span class="twothirds nospace">
									Which events would you be best suited &amp; most willing to judge?
								</span>
								<span class="third nospace rightalign redtext">
									You must choose at least 1
								</span>
							</span>

							<div class="full row marno">
%								foreach my $type (@types) {
									<label for="<% $type %>">
										<span class="quarter hover nospace padleft ltborderleft">
											<span class="fourfifths">
												<% $type %>
											</span>

											<span class="fifth">
												<input
													type  = "checkbox"
													name  = "<% $type %>"
													id    = "<% $type %>"
													value = 1
													<% $closed ? "disabled" : "" %>
													<% $nomination{"type"}{$type} ? 'checked="checked"' : "" %>
												>
											</span>
										</span>
									</label>
%								}
							</div>

							<div class="full row marno centeralign bluetext padvertmore semibold">
								Please note: if you prefer Congress do not select any other pools; <br />
								the timing of Congress final sessions does not allow judges time for other events.
							</div>

							<div class="full row marno">

								<& "/funclib/editor.mas" &>

								<div class="semibold full nospace martopmore marbottom">
									Please list supporting information/details for us to
									consider in pooling you for semis and finals.
								</div>

								<div class="semibold full nospace centeralign">

%									if ($closed) {
										<% $nomination{"text"} %>
%									} else {
										<textarea
											name    = "text"
											rows    = 5
											columns = 70
										><% $nomination{"text"} %></textarea>
%									}

								</div>
							</div>
						</div>

%						unless ($closed) {
							<div class="liblrow rightalign marno">
								<span class="true centeralign quarter">
									<input
										type="submit"
										value="Save Nomination"
									>
								</span>
							</div>
%						}
%					}
				</div>
			</div>

		<script>

			function showNomination() {
				if ($("#self_nominated").prop("checked")) {
					$("#nom").removeClass('hidden');
				} else if ($("#chair_nominated").text()) {
					$("#nom").removeClass('hidden');
				} else {
					$("#nom").addClass('hidden');
				}
			}

			$(document).ready(function() {
				showNomination();
			});

		</script>
