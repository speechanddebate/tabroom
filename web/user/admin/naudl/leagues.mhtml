<%args>
	$person
	$person_settings
	$dbh
</%args>
<%init>

	my $sth = $dbh->prepare("
		select
			circuit.id, circuit.name, circuit.abbr,
			code.value code

		from (circuit, circuit_setting cs)

			left join circuit_setting code
				on code.tag = 'naudl_league_code'
				and code.circuit = circuit.id

		where cs.tag = 'naudl_member'
		and cs.circuit = circuit.id

		order by circuit.name

	");

	$sth->execute();
	my $circuits = $sth->fetchall_hash();

</%init>

	<& "../menu.mas",
		person          => $person,
		person_settings => $person_settings,
		whoami          => "naudl_leagues"
	&>

	<div class="main">

		<div class='full flexrow'>
			<span class="threequarters">
				<h2>NAUDL Circuit Codes</h2>
			</span>

			<span
				class = "quarter rightalign"
				id    = "naudl_circuits_buttonarea"
			>
			</span>
		</div>

	<& "/funclib/tablesorter.mas",
		table => "naudl_circuits"
	&>

	<table id="naudl_circuits">
		<thead>
			<tr class="yellowrow">
				<th>
					Circuit ID
				</th>

				<th>
					Circuit Name
				</th>

				<th>
					Circuit Abbr
				</th>

				<th>
					NAUDL League Code
				</th>

				<th>
					Banish
				</th>
			</tr>
		</thead>

		<tbody>

%			foreach my $circuit (@{$circuits}) {
				<tr id="<% $circuit->{id} %>">
					<td>
						<% $circuit->{id} %>
					</td>

					<td>
						<% $circuit->{name} %>
					</td>

					<td>
						<% $circuit->{abbr} %>
					</td>

					<td>
						<input
							type       = "text"
							name       = "code"
							circuit_id = "<% $circuit->{id} %>"
							value      = "<% $circuit->{code} %>"
							class      = 'full'
							onChange   = "postSwitch(this, 'league_code.mhtml');"
						>
					</td>

%					my $warn = "This will remove data posting from ".$circuit->{name}." to the NAUDL Salesforce.  Are you sure?";

					<td class="centeralign">
						<a
							class      = "fa fa-trash buttonwhite redtext"
							circuit_id = "<% $circuit->{id} %>"
							onClick    = "postConfirm('<% $warn %>', this, 'league_rm.mhtml');"
						>
					</td>
				</tr>
%			}
		</tbody>

	</table>
