<%args>
	$person
	$session
</%args>
<%init>

	$m->abort unless $person->site_admin;

	my @dates = (
		"nsda_district_open",
		"nsda_district_deadline"
	);

	foreach my $tag (@dates) { 

		my $tz = "America/Chicago";

		my $object = Tab::TournSetting->search( 
			tourn => 0,
			tag   => $tag
		)->first;

		my $dt = eval { 
			return Tab::dtme($ARGS{$tag}, $ARGS{$tag."time"}, $tz);
		}

		if ($dt) { 

			if ($object) { 

				$object->value_date($dt);
				$object->update();

			} else { 

				Tab::TournSetting->create({
					tourn      => 0,
					tag        => $tag,
					value      => "date",
					value_date => $dt
				});
			}

		} elsif ($object) { 

			$object->delete();
		}
	}

	my @tags = (
		"school_consent",
		"nsda_district_email",
		"nsda_district_jot_email"
	);

	foreach my $tag (@tags) { 

		my $object = Tab::TournSetting->search( 
			tourn => 0,
			tag   => $tag
		)->first;

		if ($object) { 

			if ($ARGS{$tag}) { 
				$object->value_text($ARGS{$tag});
				$object->update();
			} else {
				$object->delete();
			}

		} elsif ($ARGS{$tag}) { 

			Tab::TournSetting->create({
				tourn      => 0,
				tag        => $tag,
				value      => "text",
				value_text => $ARGS{$tag}
			});

		}

	}

	my $msg = "Settings for Districts saved";

	$m->redirect("district_forms.mhtml?msg=$msg");

</%init>

