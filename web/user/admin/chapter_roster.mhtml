<%args>
	$account
	$chapter_id
</%args>
<%init>

	my $chapter = Tab::Chapter->retrieve($chapter_id);

	my @circuits = $chapter->circuits;

	my @candidate_chapters;

	my %used; 

	foreach my $circuit (@circuits) { 
		push @candidate_chapters, $circuit->chapters;
	}

	my %seen = (); 
	@candidate_chapters = grep { ! $seen{$_->id} ++ } @candidate_chapters;

</%init>

	<& /funclib/tablesorter.mas, table => "sortme" &>

	<div class="blankfull">

		<div class="full nospace">

			<span class="half nospace">
				<h4><% $chapter->name %></h4> 
			</span>

			<span class="quarter centeralign nospace">

				<span class="twofifth smallish padless marno">
					Switch To:
				</span>
				<span class="threefifth padless marno">
				<form action="chapter_roster.mhtml" method="post">
				<select name="chapter_id" onchange='this.form.submit()' class="fixedsmall">
%				foreach my $candidate (@candidate_chapters) {
					<option value="<% $candidate->id %>" <% $candidate->id == $chapter->id ? 'selected="selected"' : "" %>> <% $candidate->name." ".$candidate->location %>  </option>
%				}
				</select>
				</form>
				</span>
			</span>

			<span class="quarter rightalign nospace">
				<a href="chapters.mhtml" class="dkblue padmuchmore "> Return to Chapter Search</a>
			</span>


		</div>

		<table id="sortme">

			<thead>

				<tr class="yellowrow smallish">
					
					<th>
						First
					</th>

					<th>
						Last
					</th>

					<th>
						Grad
					</th>

					<th>
						Merit #
					</th>

					<th class="smaller">
						Ret
					</th>

					<th>
						School
					</th>

				</tr>

			</thead>

			<tbody>

			<form action="chapter_roster_save.mhtml">
			<input type="hidden" name="chapter_id" value="<% $chapter->id %>">

%		foreach my $student ($chapter->students) { 

			<tr>

				<td>
					<input type="text" name="<% $student->id %>_first" size="16" value="<% $student->first %>">
				</td>

				<td>
					<input type="text" name="<% $student->id %>_last" size="16" value="<% $student->last %>">
				</td>

				<td>
					<input type="number" name="<% $student->id %>_grad_year" size="4" min="2010" max="3000" value="<% $student->grad_year %>">
				</td>

				<td>
					<input type="number" name="<% $student->id %>_ualt_id" size="6" value="<% $student->ualt_id %>">
				</td>

				<td>
					<input type="checkbox" name="<% $student->id %>_retired" value="1" <% $student->retired ? 'checked="checked"' : "" %>>
				</td>

				<td>
					<select name="<% $student->id %>_chapter" class="fixed">
%						foreach my $candidate (@candidate_chapters) { 
							<option value="<% $candidate->id %>" <% $candidate->id == $chapter->id ? 'selected="selected"' : "" %>> <% $candidate->name." ".$candidate->location %>  </option>
%						}
					</select>
				</td>

			</tr>

%		}

		</tbody>

		<tr class="libl">

			<td colspan="10" class="rightalign">
				<input type="submit" value="  Save Student Changes ">
				</form>
			</td>

		</tr>

		</table>

	</div>

	<div class="menu">
	
%		foreach my $circuit (@circuits) { 

			<div class="sidenote">

				<h4><% $circuit->name %> </h4>

			</div>

%		}

	</div>
