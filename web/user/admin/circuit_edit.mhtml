<%args> 
	$person
	$person_settings
	$circuit_id => undef
</%args>
<%init> 

	my $circuit = Tab::Circuit->retrieve($circuit_id) if $circuit_id;

	my %circuit_settings = $circuit->all_settings() if $circuit;

</%init>

	<& 
		menu.mas, 
		whoami          => "circuits",
		person          => $person,
		person_settings => $person_settings
	&>

	<div class="main">
					
		<h2><% ($circuit) ? $circuit->name : "Create Circuit" %></h2> 

		<span class="pagehalf">
		
			<h4>Settings & Name</h4>
		
				<table>

				<tr class="row">

					<td>
						Full Name:
					</td>
				
					<td class="centeralign" colspan="2">
						<form action="circuit_save.mhtml" method="post"> 
						<input
							type  = "hidden"
							name  = "circuit_id"
							value = "<% $circuit_id %>">
						<input
							type  = "text"
							size  = "32"
							name  = "name"
							value = "<% ($circuit) ? $circuit->name : "" %>">
					</td>

				</tr>

				<tr class="row">

					<td>
						Abbreviation
					</td>

					<td class="centeralign" colspan="2">
						<input 
							type  = "text"
							size  = "32"
							name  = "abbr"
							value = "<% ($circuit) ? $circuit->abbr : "" %>"
						>
					</td>
				</tr>
				
				<tr class="row">

					<td>
						State/Prov
					</td>

					<td class="centeralign" colspan="2">
						<select
							name="state" 
							class="fixedmed"
						>
							<option value="" >None</option>
							<& /funclib/state_select.mas, state => $circuit ? $circuit->state : "" &>
						</select>
					</td>
				</tr>

				<tr class="row">

					<td>
						Country
					</td>

					<td class="centeralign" colspan="2">
						<select
							name="country" class="fixedmed">
							<& "/funclib/country_select.mas", 
								country => $circuit ? $circuit->country 
								: "" &>
						</select>
					</td>
				</tr>
				
				<tr class="row">

					<td>Website</td>

					<td class="centeralign" colspan="2">
						<input 
							type  = "text"
							size  = "32"
							name  = "url"
							value = "<% $circuit_settings{'url'} %>"
						>
					</td>
				</tr>
				
				<tr class="row">

					<td>Timezone:</td>

					<td class="centeralign" colspan="2">
						<select
							name="timezone" class="fixedmed">
%							if ($circuit) { 
								<& /funclib/timezones.mas, tz => $circuit->tz &>
%							} else { 
								<& /funclib/timezones.mas &>
%							} 
						</select>
					</td>
				</tr>

				<tr class="row">

					<td>NAUDL League Code</td>

					<td class="centeralign" colspan="2">
						<input 
							type  = "text"
							size  = "32"
							name  = "naudl_league_code"
							value = "<% $circuit_settings{'naudl_league_code'} %>"
						>
					</td>
				</tr>

			</table>


			<table>
				
				<tr class="row">
				
					<td colspan="2">Active Circuit:</td>
				
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "active"
							value = "1" 
							<% ($circuit && $circuit->active) ? "checked" : "" %> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "active"
							value = ""
							<% ($circuit && $circuit->active) ? "" : "checked"  %> 
						> 
						No
					</td>
				</tr>
				
				<tr class="row">
				
					<td colspan="2">Full Memberships</td>
					
					<td class="centeralign"> 
						<input
							type  = "radio"
							name  = "full_members"
							value = "1"
							<% ($circuit_settings{"full_members"}) ? "checked" : "" %> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "full_members"
							value = "" 
							<% ($circuit_settings{'full_members'}) ? "" : "checked" %>
						>
						No
					</td>
				</tr>
				
				<tr class="row">
				
					<td colspan="2">Open to non-members</td>
					
					<td class="centeralign"> 
						<input
							type  = "radio"
							name  = "tourn_only"
							value = "1" 
							<% ($circuit_settings{"tourn_only"}) ? "checked" : "" %> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "tourn_only"
							value = ""
							<% ($circuit_settings{"tourn_only"}) ? "" : "checked" %> 
						>
						No
					</td>
				</tr>

				<tr class="row">
				
					<td colspan="2">
						Directors may add tournaments to circuit
					</td>
					
					<td class="centeralign"> 
						<input
							type  = "radio"
							name  = "tourns_no_add"
							value = "" 
							<% $circuit_settings{"tourns_no_add"} 
								? "" 
								: "checked"
							%> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "tourns_no_add"
							value = "1"
							<% $circuit_settings{"tourns_no_add"}
								? "checked"
								: ""
							%> 
						>
						No
					</td>
				</tr>

				
				<tr class="row">
				
					<td colspan="2">Track Bids</td>
					
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "track_bids"
							value = "1"
							<% ($circuit_settings{"track_bids"}) ? "checked" : "" %> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "track_bids"
							value = ""
							<% ($circuit_settings{"track_bids"}) ? "" : "checked" %>
						>
						No
					</td>
				</tr>
				
				<tr class="row">
				
					<td colspan="2">NAUDL Demographics</td>
					
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "demographics"
							value = "1"
							<% ($circuit_settings{"demographics"}) ? "checked" : "" %> >
						Yes
				
						<input
							type  = "radio"
							name  = "demographics"
							value = ""
							<% ($circuit_settings{"demographics"}) ? "" : "checked" %> >
						No
					</td>
				</tr>
				
				<tr class="row">
				
					<td colspan="2">Use Regions</td>
					
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "regions"
							value = "1"
							<% ($circuit_settings{"regions"}) ? "checked" : "" %>
						>
						Yes
				
						<input
							type  = "radio"
							name  = "regions"
							value = ""
							<% ($circuit_settings{"regions"}) ? "" : "checked" %>
						>
						No
					</td>
				</tr>
				
				<tr class="row">
				
					<td colspan="2">NCFL National specific stuff</td>
					
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "ncfl"
							value = "1"
							<% ($circuit_settings{"ncfl"}) ? "checked" : "" %> 
						>
						Yes
				
						<input
							type  = "radio"
							name  = "ncfl"
							value = ""
							<% ($circuit_settings{"ncfl"}) ? "" : "checked" %> 
						>
						No
					</td>
				</tr>

				<tr class="row">
				
					<td colspan="2">NAUDL Specific Stuff</td> 
					
					<td class="centeralign">
						<input
							type  = "radio"
							name  = "naudl"
							value = "1"
							<% ($circuit_settings{"naudl"}) ? "checked" : "" %>
						>
							Yes
				
						<input
							type  = "radio"
							name  = "naudl"
							value = ""
							<% ($circuit_settings{"naudl"}) ? "" : "checked" %>
						>
							No
					</td>
				</tr>
				
				
				<tr class="liblrow">
					<td class="rightalign" colspan="3">
						<input 
							type  = "submit"
							value = "Save Circuit Info">
						</form>
					</td>
				</tr>
				
			</table>

		</span>

		<span class="pagehalf">

%			if ($circuit) { 

			<h4>Circuit Administrators:</h4>

			<table>

%	 			foreach my $admin (sort {$a->last cmp $b->last} $circuit->admins) { 

					<tr class="row">

						<td class="smallish nospace padleft">
							<a 
								class="white padtopmore padbottommore padleft marform"
								href="mailto:<% $admin->email %>"
							>
								<% $admin->first." ".$admin->last %> (<% $admin->email %>)
							</a>
						</td>

						<td class="smallish nospace centeralign">
							<a 
								class="buttonwhite redtext fa fa-lg fa-trash"
								href="admin_rm.mhtml?admin_id=<% $admin->id %>&circuit_id=<% $circuit_id %>">
							</a>
						</td>

					</tr>

%	 			} # end of foreach my admin

				<tr class="liblrow">
					<td>
						<form action="admin_add.mhtml" method="post">
						<input 
							type  = "hidden"
							name  = "circuit_id"
							value = "<% $circuit_id %>"
						>
						<input 
							type        = "text"
							size        = "32"
							name        = "email"
							placeholder = "Enter email address"
						>
					</td>

					<td class="centeralign">
						<input 
							type  = "submit"
							value = "Add"
							class = "thin"
						>
						</form>
					</td>

				</tr>

			</table>

		</span>
%		}

	</div>




