<%args>
	$person
	$person_settings
	$edit_id => undef
</%args>
<%init>

	my $edit = Tab::Person->retrieve($edit_id);
	my $switch;

	unless ($edit) {
		$m->print("No user was found with that ID");
		$m->abort();
	}

	my %edit_settings = $edit->all_settings;

</%init>

	<&
		"menu.mas",
		whoami          => "persons",
		person          => $person,
		edit_id         => $edit_id,
		person_settings => $person_settings
	&>

	<div class="main">

		<h2>Edit <% $edit->first." ".$edit->last %>'s details</h2>

			<h4>Personal Record</h4>

			<span class="pagehalf">

			<div class="row">

				<span class="third smallish">
					Email login
				</span>

				<span class="rightalign twothirds">

					<form
						action = "person_save.mhtml"
						method = "post"
					>

					<input
						type  = "hidden"
						name  = "edit_id"
						value = "<% $edit->id %>"
					>

					<input
						type  = "text"
						name  = "email"
						value = "<% $edit->email %>"
						size  = "24"
					>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					First
				</span>

				<span class="rightalign twothirds">
					<input
						type  = "text"
						name  = "first"
						value = "<% $edit->first %>"
						size  = "24"
					>
				</span>

			</div>
			<div class="row">

				<span class="third smallish">
					Middle
				</span>

				<span class="rightalign twothirds">
					<input
						type  = "text"
						name  = "middle"
						value = "<% $edit->middle %>"
						size  = "24"
					>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					Last
				</span>

				<span class="rightalign twothirds" >
					<input
						type  = "text"
						name  = "last"
						value = "<% $edit->last %>"
						size  = "24"
					>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					Street Address
				</span>

				<span class="rightalign twothirds" >
					<input
						type  = "text"
						name  = "street"
						value = "<% $edit->street %>"
						size  = "24"
					>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					City
				</span>

				<span class="rightalign twothirds" >
					<input
						type  = "text"
						name  = "city"
						value = "<% $edit->city %>"
						size  = "24"
					>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					State/Province
				</span>

				<span class="rightalign twothirds" >
					<select
						name  = "state"
						class = "fixedmed chosen"
					>
						<&
							"/funclib/state_select.mas",
							state => $edit->state
						&>
					</select>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					Country
				</span>

				<span class="rightalign twothirds" >
					<select name="country" class="fixedmed">

						<& "/funclib/country_select.mas",
							country => $edit->country
						&>

					</select>
				</span>

			</div>

			<div class="row">

				<span class="third smallish">
					ZIP code
				</span>

				<span class="rightalign twothirds" >
					<input
						type  = "text"
						name  = "zip"
						value = "<% sprintf("%05d", $edit->zip) %>"
						size  = "24"
					>
				</span>

			</div>

		</span>

		<span class="pagehalf">

			<div class="row">

				<span class="third smallish">
					Phone Number
				</span>

				<span class="rightalign twothirds">
					<input
						type  = "tel"
						name  = "phone"
						value = "<% Tab::phone($edit->phone) %>"
						size  = "16"
					>
				</span>

			</div>

			<div class="row">

	            <span class="third smallish">
	                Cell provider
	            </span>

	            <span class="rightalign twothirds">
	                <select name="provider" class="fixedmed chosen">
						<& /funclib/cell_domains.mas, provider => $edit->provider &>
	                </select>
	            </span>

    	    </div>

			<div class="row">

				<span class="third smallish">
					NSDA Merit Number
				</span>

				<span class="rightalign twothirds">
					<input
						type  = "text"
						name  = "ualt_id"
						value = "<% $edit->ualt_id %>"
						size  = "16"
					>
				</span>

			</div>


			<div class="row">

				<span class="third smallish">
					NSDA ID Number
				</span>

				<span class="rightalign twothirds">
					<input
						type  = "text"
						name  = "nsda"
						value = "<% $edit->nsda %>"
						size  = "16"
					>
				</span>

			</div>

			<label for="no_email">
				<div class="row hover">

					<span class="fourfifths smallish">
						No Emails or Texts
					</span>

					<span class="fifth">
						<input
							type  = "checkbox"
							id    = "no_email"
							value = "1"
							name  = "no_email"
							<% ($edit->no_email) ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

			<label for="site_admin">
				<div class="row hover">
					<span class="fourfifths smallish">
						Tabroom Site Admin (God-like powers)
					</span>

					<span class="fifth">
						<input
							type  = "checkbox"
							value = "1"
							id    = "site_admin"
							name  = "site_admin"
							<% ($edit->site_admin) ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

			<label for="nsda_admin">

				<div class="row hover">

					<span class="fourfifths smallish">
						NSDA Office Staff
					</span>

					<span class="fifth">
						<input
							type  = "checkbox"
							value = "1"
							id    = "nsda_admin"
							name  = "nsda_admin"
							<% ($edit_settings{"nsda_admin"}) ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

			<label for="naudl_admin">

				<div class="row hover">

					<span class="fourfifths smallish">
						NAUDL Data Admin
					</span>

					<span class="fifth">
						<input
							type  = "checkbox"
							value = "1"
							id    = "naudl_admin"
							name  = "naudl_admin"
							<% ($edit_settings{"naudl_admin"}) ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

			<label for="scream_in_pain">

				<div
					title="Causes Tabroom to scream in pain on every page reload"
					class="row hover">

					<span class="fourfifths smallish">
						Scream in Pain
					</span>

					<span class="fifth">
						<input
							type  = "checkbox"
							value = "1"
							id    = "scream_in_pain"
							name  = "scream_in_pain"
							<% ($edit_settings{"scream_in_pain"}) ? "checked" : "" %>
						>
					</span>

				</div>
			</label>

		</span>

		<div class="libl pagefull rightalign">
			<input
				type  = "submit"
				value = "Save Changes"
			>
		</div>

			<h5>Logins</h5>

%			my $counter = 1;
%			my @logins = $edit->logins;

%			foreach my $login (@logins) {

				<div class="row pagefull">

				<span class="twenty semibold bluetext centeralign">
					<% $counter++ %>
				</span>

				<span class="fourtenths">
					<input
						type  = "text"
						name  = "<% $login->id %>_username"
						size  = "42"
						value = "<% $login->username %>"
					>
				</span>

				<span class="eighth">
					<span class="semibold bluetext twothirds">
						Used
					</span>
					<span class="third">
						<% $login->accesses %>
					</span>
				</span>

				<span class="threetenths">
					<span class="twofifths semibold bluetext nospace">
						Last Login
					</span>
					<span class="threefifths nospace">
						<& "/funclib/showdt.mas", dt => $login->last_access, length => 'shorter' &>
						<% $login->last_access->year %>
					</span>
				</span>

				<span class="twenty nospace">
					<a
						target = "_blank"
						class  = "buttonwhite bluetext fa fa-sm fa-retweet"
						href   = "/user/login/forgot_send.mhtml?username=<% $login->username %>"
						title  = "Trigger Password Reset"
					></a>
				</span>

%				if (scalar @logins > 1) {

					<span class="twenty nospace">
						<a
							class  = "buttonwhite redtext fa fa-sm fa-trash"
							href   = "login_rm.mhtml?login_id=<% $login->id %>"
						>
						</a>
					</span>
%				}

			</div>
%		}

		<div class="libl pagefull rightalign">
			<input  type="submit" value="Save Logins">
			</form>
		</div>

	</div>

