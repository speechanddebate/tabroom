<%args>
	$person
	$tourn
	$region
</%args>
<%init>

	my $tz = $person->tz;
	$tz = "UTC" unless $tz;

	my %used_schools = ();

	my %hotels = map {$_->id => $_} $tourn->hotels;

</%init>

	<div class="main">

		<h2><% $region->arch ? "Archdiocese" : "Diocese" %> of <% $region->name %></h2>

		<& menubar.mas,
			tourn  => $tourn,
			region => $region,
			whoami => "schools"
		&>

		<span class="threequarters">
			<h4>Schools attending the tournament</h4>
		</span>
		<span
			id    = "hola_buttonarea"
			class = "quarter rightalign"
		></span>

		<& "/funclib/tablesorter.mas", table => "hola" &>

		<table id="hola">

			<thead>
			<tr class="yellowrow">

				<th class="smallish">
					School
				</th>

				<th class="smallish">
					Contact
				</th>

				<th class="smallish">
				</th>

			</tr>

			<tbody>

%			foreach my $school (sort {$a->name cmp $b->name} $tourn->schools( region => $region->id)) {

%				$used_schools{$school->chapter->id}++;

				<tr>

					<td>
						<% $school->name %>
					</td>

					<td class='smallish nospace'>

						<span class="fourtenths padleft">
							<% $school->setting("contact_name") %>
						</span>

						<span class="half nospace">
							<span class="full padless">
								<% Tab::phoneme($school->setting("contact_number")) %>
							</span>
							<span class="full padless">
								<a class="white padless" href="mailto:<% $school->setting("contact_email") %>">
									<% $school->setting("contact_email") %>
								</a>
							</span>
						</span>

						<span class="full padless">
							<% $hotels{$school->setting("hotel")}
							? $hotels{$school->setting("hotel")}->name
							: "PLEASE LIST HOTEL!" %>
						</span>
					</td>

					<td class='smallish nospace centeralign'>
						<a
							class="buttonwhite bluetext fa fa-lg fa-edit"
							href="tourn_school_edit.mhtml?school_id=<% $school->id %>&region_id=<% $region->id %>&tourn_id=<% $tourn->id %>">
						</a>
					</td>

				</tr>

%			}

			</tbody>

		</table>

	</div>

	<div class="menu">

		<div class="sidenote">

			<form action="tourn_school_create.mhtml" method="post">

			<input
				type  = "hidden"
				name  = "region_id"
				value = "<% $region->id %>"
			>

			<input
				type  = "hidden"
				name  = "tourn_id"
				value = "<% $tourn->id %>"
			>

			<h4>Add new school</h4>

			<div class="full lightrow">

				<span class="threequarters centeralign">
					<input
						type        = "text"
						class       = "thin"
						name        = "name"
						size        = "20"
						placeholder = "Name of school"
					>
				</span>

				<span class="quarter centeralign marno">
					<input type="submit" class="thin" value="Add">
				</span>
			</div>

			</form>

		</div>

		<div class="sidenote">

			<h4>Add existing school</h4>

			<form action="tourn_school_edit.mhtml" method="post">

			<input
				type  = "hidden"
				name  = "region_id"
				value = "<% $region->id %>"
			>
			<input
				type  = "hidden"
				name  = "tourn_id"
				value = "<% $tourn->id %>"
			>

			<div class="full lightrow centeralign">

				<select
					class    = "fixedmed"
					name     = "chapter_id"
					onchange = "this.form.submit();"
				>

					<option value=""></option>

%					foreach my $chapter (sort {$a->name cmp $b->name} $region->chapters) {

%						next if $used_schools{$chapter->id};

						<option
							value="<% $chapter->id %>"
						><% $chapter->short_name %></option>

%					}

				</select>

			</div>

			</form>

		</div>

	</div>
