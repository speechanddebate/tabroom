<%args>
	$account
	$chapter => undef
	$nodiv => undef
	$circuit_id => undef
	$whoami => undef
</%args>
<%init>

	my @all_tourns = $m->comp("/funclib/account_tourns.mas", account => $account, all => 1);
	my @tourns = $m->comp("/funclib/account_tourns.mas", account => $account);
	my @entries = $m->comp("/funclib/account_entries.mas", account => $account);

	my @chapters = $m->comp("/funclib/account_chapters.mas", account => $account, prefs => "yes");

	my @circuits = $m->comp("/funclib/account_circuits.mas", account => $account);
	my @followed = $m->comp("/funclib/account_followed.mas", account => $account);
	my @alljudges = $m->comp("/funclib/account_judges.mas", account => $account, all => 1);
	my @all_chapter_judges = $account->chapter_judges;
	my @allentries = $m->comp("/funclib/account_entries.mas", account => $account, all => 1);


</%init>

%	unless ( $nodiv) { 
		<div class="right small">
%	}

%	if (@chapters) { 

			<div class="sidenote">
				<h4>
					Schools
				</h4>

%				foreach my $ochapter (@chapters) { 
					<a class="<% ($chapter && $ochapter->id == $chapter->id )? "yellow" : "blue" %> padless block" style="margin-top: 2px;" href="/user/chapter/tournaments.mhtml?chapter_id=<% $ochapter->id %>">
						<span class="medspan">
							<% $ochapter->name %>
						</span>
						<span class="smaller">
							<% $ochapter->prefs ? "Prefs Only" : "&nbsp;" %>
						</span>
					</a>
%				}

			</div>
%		}


			<div class="sidenote">

				<h4>
					Judging
				</h4>

%				if (@alljudges || @all_chapter_judges) { 
					<a class="blue block nowrap" href="/user/judge/panels.mhtml">
						Current Assignments
					</a>
					<a class="blue block nowrap" href="/user/judge/index.mhtml">
						Upcoming Judging
					</a>
					<a class="blue block" href="/user/judge/history.mhtml?account_id=<% $account->id %>">
						Judging History
					</a>
%				}

%				if ($m->comp("/funclib/tourn_exchange.mas")) { 
	                <a class="blue block" href="/user/judge/hire.mhtml?account_id=<% $account->id %>">
						Sign up as a hired judge
					</a>
%				}

				<a class="blue block" href="/user/judge/paradigm.mhtml">
					Edit Paradigm
				</a>


			</div>

%		if (@all_tourns) { 

			<div class="sidenote">
				<h4>
					Tournaments
				</h4>

%				foreach my $tourn (@tourns) { 
					<a class="padno nowrap blue block" href="/user/tourn/select.mhtml?tourn_id=<% $tourn->id %>">

						<span class="medspan padmed left">
							<% $tourn->name %>
						</span>

						<span class="location">
							<% $tourn->location %>
						</span>
					</a>
%				}

				<a class="yellow block" href="/user/tourn/all.mhtml" style="margin-top: 5px;">
					See Past Tournaments
				</a>

			</div>
%		}

%		if (@entries) { 

			<div class="sidenote">

				<h4>
					Entries
				</h4>

%				foreach my $entry (@entries) { 
					<a class="nowrap blue block" href="/user/entry/index.mhtml?entry_id=<% $entry->id %>">
						<% $entry->event->abbr %> at <% $entry->event->tourn->name %>
					</a>
%				}

%				foreach my $student ($account->students) { 
					<a class="nowrap blue block" href="/user/entry/students.mhtml?student_id=<% $student->id %>">
						<% $student->chapter->name %> signups
					</a>
%				}

%				if (@allentries) { 

					<a class="yellow block" href="/user/entry/history.mhtml?account_id=<% $account->id %>">
						Your Entry History
					</a>
%				}

			</div>
%		}

%		if (@followed) { 

			<div class="sidenote">
				<h4>
					Following
				</h4>

%				foreach my $account (@followed) { 
					<a class="blue block" href="/user/follow/index.mhtml?follow_id=<% $account->id %>">
						<% $account->first." ".$account->last %>
					</a>
%				}

			</div>

%		}

%		if (@circuits) { 

			<div class="sidenote">

				<h4>
					Circuits
				</h4>

%				foreach my $circuit (@circuits) { 

					<a class="<% $circuit->id == $circuit_id ? "dk" : "" %>blue nowrap block padno" href="/user/circuit/index.mhtml?circuit_id=<% $circuit->id %>">

						<span class="medspan padmed left">
							<% $circuit->name %>
						</span>

						<span class="location">
							<% ($circuit->state) ? $circuit->state."/" : "" %><% $circuit->country %>
						</span>
					</a>

%					if ($m->comp("/funclib/circuit_tourns.mas", circuit => $circuit, approval => 1)) { 

						<a class="yellow nowrap block" style="margin-bottom: 10px; margin-left: 10px;" href="/user/circuit/approvals.mhtml?circuit_id=<% $circuit->id %>">
							Approve Tourn Requests
						</a>

%					}

%				}

			</div>
%		}

%		if ($account->site_admin) { 
			<& admin/menu.mas, account => $account, nodiv => 1, whoami => $whoami &>
%		}

		<div class="sidenote">

			<h4>Your Account</h4>

			<a class="blue block" href="/user/chapter/create.mhtml">
				Create a new school/team
			</a>

			<a class="blue block" href="/user/tourn/request.mhtml">
				Request a new tournament
			</a>
<!--
			<a class="blue block" href="/user/circuit/request.mhtml">
				Request a new circuit
			</a>
-->

			<a class="blue block" href="/user/judge/search.mhtml">
				Link your account to a judge
			</a>

			<a class="blue block" href="/user/student/search.mhtml">
				Link your account to a student
			</a>

			<a class="blue block" href="/user/student/follow.mhtml">
				Get updates for a student
			</a>


		</div>

%	unless ( $nodiv) { 
	</div>
%	}

