<%args>
	$circuit
	$round_id
	$session
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);

	#Set up the filename and the needed trace files

     my $filename = "judge-subsheets-".$session->id."-".$round->id;
     my $filepath = $Tab::file_root."/tmp/";
     my $garbage = `rm -f $filepath"."$filename.*`;

     open (TEXOUT, ">$filepath"."$filename.tex");

	print TEXOUT <<'EOF';
\documentclass[10pt]{letter}
\usepackage{fullpage}
\usepackage{multirow}
\usepackage{colortbl}
\usepackage[hmargin=1in,vmargin=1.25in]{geometry}
\usepackage{helvet}
\renewcommand{\familydefault}{\sfdefault}
\renewcommand{\arraystretch}{1.4}
\begin{document}
\addtolength{\textwidth}{1in}
\addtolength{\voffset}{-.5in}
EOF

	close TEXOUT;

	$m->comp("print_subsheet.mas", 
			round_id => $round->id, 
			filename => $filename, 
			filepath => $filepath, 
			circuit => $circuit);

    open (TEXOUT, ">>$filepath"."$filename.tex");
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

    $garbage = `cd $filepath; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
    $garbage = `cd $filepath; rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
    $m->redirect("$Tab::url_prefix/tmp/$filename.pdf");

</%init>
