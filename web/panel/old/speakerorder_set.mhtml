<%args>
	$account
	$tourn
	$timeslot_id => undef
	$err => undef
</%args>
<%init>

	if ($timeslot_id) { 
		my @timeslots;

		if ($timeslot_id == "all") {
			@timeslots = $tourn->timeslots;
		} else { 
			push (@timeslots, Tab::Timeslot->retrieve($timeslot_id));
		}	

		foreach my $ts (@timeslots) { 
			$m->comp("speaker_order.mas", timeslot_id => $ts->id, tourn => $tourn);
		}

		my $err = "Speaker order set";
	 	$m->redirect("$Tab::url_prefix/panel/speakerorder_set.mhtml?err=$err");

	}

	my @timeslots =  sort {$a->start <=> $b->start} $tourn->timeslots;

</%init>

	<div class="left huge">

		<h2>Set speaker order</h2>

		<form action="speaker_order.mas" method="post">

		<table cellpadding="5" cellspacing="1" width="100%">
		
			<tr class="oddrow">

				<td>
					Timeslot:
				</td>

				<td>
					<select name="timeslot_id">

						<option value="">All Paneled Prelims </option>

% 						foreach my $ts (@timeslots) {
							<option value="<%$ts->id %>"><% $ts->name %></option>
% 						}

				</td> 
				
			</tr>

			<tr class="evenrow">

				<td>
					Event:
				</td>

				<td>
					<select name="event_id">
						<option value="">All Events</option>

%						foreach my $event ($m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 
%							next unless $event->type eq "speech";
							<option value="<% $event->id %>"><% $event->name %></option>
%						}	

			</tr>

			<tr class="liblrow">

				<td colspan="2" align="right">
					<input type="submit" value="  Set Order  ">
					</form>
				</td>

			</tr>
			
		</table> 

	</div>

	<div class="right small">
		
		<h3>Order reports</h3>

%		my $switch;

%			foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)(type => "speech")) { 
				<a class="blue block" href="speakerorder_report.mhtml?event_id=<% $event->id %>"> <% $event->name %></a>
%			}

		</table>

	</div>
