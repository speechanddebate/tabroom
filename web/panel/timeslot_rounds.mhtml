<%args>
	$account
	$timeslot_id
	$tourn
	$league
	$err => undef
</%args>
<%perl>

	my $timeslot = Tab::Timeslot->retrieve($timeslot_id);
	my @sites = $tourn->sites;

</%perl>

<p class="err"><% $err %></p>

<table cellpadding="0" cellspacing="0">

<tr>
<td width="100%">
<h3>Rounds scheduled in <% $timeslot->name %></h3>
</td>

<td style="padding-right: 5px;">
	<form action="all_schedules.mhtml" method="post">
	<input class="blue" type="submit" value="Return to Schedules">
	</form>
</td>

</tr>

</table>

<table cellpadding="6" cellspacing="1" border="0" width="100%">

%	my $switch;

%	if ($timeslot->rounds) { 

<tr class="dkblrow">
<th>#</th>
<th>Label</th>
<th>Type</th>
<th>Event</th>

%	if (scalar (@sites) > 1) { 
		<th>Location</th>
%	}

%	if ($tourn->pools) { 
		<th>Judge Pool</th>
%	}

	<th>PUB</th>
	<th>NFY</th>
	<th>PRE</th>
	<th>SO*</th>
	<th></th>
</tr>

%	}

	<form action="timeslot_round_save.mhtml" method="post">
	<input type="hidden" name="timeslot_id" value="<% $timeslot->id %>">

%	foreach my $round (sort {$a->event->abbr cmp $b->event->abbr} $timeslot->rounds) {
%	# sort {$a->timeslot->start->epoch <=> $b->timeslot->start->epoch} $event->rounds) {

	<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<th style="text-align:center;"><% ($account->site_admin) ? $round->event->abbr." ".$round->name."<h4></h4>".$round->id: $round->event->abbr." ".$round->name %></th>

	<td>
		<input type="text" name="<% $round->id %>_label" value="<% $round->label %>" size="7">
	</td>

	<td>
	<select name="<% $round->id %>_type">
		<option value="prelim" <% ($round->type eq "prelim") ? "selected" : "" %> >Prelim</option>
		<option value="elim" <% ($round->type eq "elim") ? "selected" : "" %> >Elim</option>
		<option value="final" <% ($round->type eq "final") ? "selected" : "" %> >Final</option>
	</select>
	</td>

	<td>
	<select name="<% $round->id %>_event_id">

%	foreach my $event ( sort {$a->abbr cmp $b->abbr} $tourn->events) { 
		<option value="<% $event->id %>" 
			<% ($round->event) ? ($event->id == $round->event->id) ? "selected" : "" : "" %> >
			<% $event->abbr %>
		</option>
%	}

	</select></td>

%	if (scalar (@sites) > 1) { 
		<td>
		<select name="<% $round->id %>_site_id">
			<option value="">None</option>
%			foreach my $site ($tourn->sites) { 
			<option value="<% $site->id %>" 
			<% ($round->site) ? ($site->id == $round->site->id) ? "selected" : "" : "" %> >
			<% substr($site->name,0,15) %></option>

%			}

			</select></td>
%	} else { 
		<input type="hidden" name="<% $round->id %>_site_id" value="<% $round->site->id %>">
%	}

%	if ($tourn->pools) { 
		<td>
			<select name="<% $round->id %>_pool_id">
			<option value="">None</option>
%			foreach my $pool ($tourn->pools) { 
				<option value="<% $pool->id %>" 
				<% ($round->pool) ? ($pool->id == $round->pool->id) ? "selected" : "" : "" %> >
				<% substr($pool->name, 0, 15) %></option>
%			}
		</select></td>
%	}

	<td><input type="checkbox" value="1" name="<% $round->id %>_published" <% $round->published ? "checked" : "" %>></td>
	<td><input type="checkbox" value="1" name="<% $round->id %>_no_first_year" <% $round->no_first_year ? "checked" : "" %>></td>
	<td><input type="checkbox" value="1" name="<% $round->id %>_preset" <% $round->preset ? "checked" : "" %>></td>

	<td align="center">
		(<a href="<% $Tab::url_prefix %>/panel/round_edit.mhtml?from=ts&round_id=<% $round->id %>">Panels</a>)
		<h4></h4>
		(<a href="<% $Tab::url_prefix %>/panel/round_rm.mhtml?from=ts&round_id=<% $round->id %>">Delete</a>)
	
	</tr>


%	}


%	if ($timeslot->rounds) { 
		<tr>
		<td colspan="10" align="right">
			<input class="blue" type="submit" value="Save All Changes">
			</form>
		</td>
		</tr>
%	}

<tr class="dkblrow">
<th>#</th>
<th>Label</th>
<th>Type</th>
<th>Event</th>

%	if (scalar (@sites) > 1) { 
		<th>Location</th>
%	}

%	if ($tourn->pools) { 
		<th>Judge Pool</th>
%	}

	<th>PUB</th>
	<th>NFY</th>
	<th>PRE</th>
	<th>SO*</th>
	<th></th>
</tr>

<tr class="bluerow">

	<th>
		<form action="timeslot_round_save.mhtml" method="post">
		<input type="hidden" name="timeslot_id" value="<% $timeslot->id %>">
		<input type="hidden" value="1" name="add_new">
		Add:
	</th>

	<td>
	<input type="text" name="new_label" size="7">
	</td>

	<td>
	<select name="new_type">
		<option value="prelim">Prelim</option>
		<option value="elim">Elim</option>
		<option value="final">Final</option>
	</select>
	</td>

	<td>
	<select name="new_event_id">

%	foreach my $event (sort {$a->abbr <=> $b->abbr} $tourn->events) { 
		<option value="<% $event->id %>"><% $event->abbr %></option>
%	}

	</select>
	</td>

%	if (scalar (@sites) > 1) { 
	<td>
		<select name="new_site_id">
%		foreach my $site (sort {$a->name <=> $b->name} $tourn->sites) { 
			<option value="<% $site->id %>"><% substr($site->name,0,15) %></option>
%		}
		</select></td>
%	} else { 
		<input type="hidden" name="new_site_id" value="<% $sites[0]->id %>">
%	}

%	if ($tourn->pools) { 
	<td>
	<select name="new_pool_id">
		<option value="">No pool</option>
%		foreach my $pool (sort {$a->name <=> $b->name} $tourn->pools) { 
			<option value="<% $pool->id %>"><% substr($pool->name,0,15) %></option>
%		}
		</select></td>
%	}

	<td><input type="checkbox" value="1" name="new_published"></td>
	<td><input type="checkbox" value="1" name="new_no_first_year"></td>
	<td><input type="checkbox" value="1" name="new_preset"></td>
	<td align="center">
		<input type="submit" class="blue" value="Add">
</td>


</tr>
	</table>	

<table cellpadding="5" cellspacing="1" width="100%">
<tr>
<td width="65%">

<h4>* Key:</h4>

<table width="100%" cellpadding="4" cellspacing="1">

<tr>
	<td>PUB: Published on the web</td>
	<td>NFY: No first year judges</td>
</tr>

<tr>
	<td>PRE: Round is a preset elim</td>
	<td>SO: Round's speaker order is set</td>
</tr>

</table>

</td>


</td>
</tr>
</table>

</div>

