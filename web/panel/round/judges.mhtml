<%args>
	$round_id
</%args>
<%init>

	my $round = Tab::Round->retrieve($round_id);
	my @panels = sort {$a->letter cmp $b->letter} $round->panels;

	my $num_judges = $round->judges;
	$num_judges = 1 unless $round->judges;

	$m->comp("/funclib/round_clear_judges.mas", round => $round);

	foreach my $panel (@panels) { 

		my @judges = $m->comp("/funclib/clean_judges.mas", panel => $panel);
		Tab::debuglog("Panel ".$panel->letter." in the works");

		foreach (1 .. $num_judges) { 
			my $judge = shift @judges if @judges;
			Tab::debuglog("Assigning in judge ".$judge->last);
			$m->comp("/funclib/panel_judgeadd.mas", panel => $panel, judge => $judge) if $judge;
		}

	}

	my $msg = "Judges have been assigned";

	$m->redirect("/panel/schemat/show.mhtml?round_id=$round_id&msg=$msg");

</%init>
