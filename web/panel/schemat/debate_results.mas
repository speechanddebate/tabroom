<%args>
	$round
</%args>

%		my @done_panels = $m->comp("/funclib/round_results.mas", round => $round);
%		my $switch;

		<h4>
		  	Results
		</h4>

		<table cellpadding="4" cellspacing="1">

%		my %seen = (); 
%		@done_panels = grep { ! $seen{$_->id} ++ } @done_panels;
%		Tab::debuglog("I have ".scalar @done_panels." panels");

%		my %judge_already = ();

%		foreach my $done (@done_panels) { 

%			my @judges = $m->comp("/funclib/panel_judges.mas", panel => $done);
%			Tab::debuglog("I have ".scalar @judges." judges");
%			my @entries = $m->comp('/funclib/panel_entries.mas', panel => $done);

%			my %seen = (); 
%			@entries = grep { ! $seen{$_->id} ++ } @entries;
%			Tab::debuglog("I have ".scalar @entries." entries");

%			foreach my $judge (@judges) { 

%				my @scores = $m->comp('/funclib/panel_scores.mas', panel => $done, judge => $judge);

%				next unless @scores;
%				my %scores_by_recipient =();

%				foreach my $score (@scores) {  
%					push @{$scores_by_recipient{$score->student->id}}, $score if $score->student && $score->student->id; 
%				}

%				foreach my $entry (@entries) { 

%					if ($done->audit) { 
						<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
%					} else {
						<tr class="<% ($switch++ % 2) ? "yellowrow" : "yellow" %>">
%					} 

					<td class="smallish">
						<% $judge_already{$judge->id}++ ? "" : $judge->last  %>
					</td>

					<td class=" nowrap smallish">
						<% $entry->code %>  
					</td>

					<td class=" nowrap smallish">
						<% $entry->side ? $entry->side == 1 ? "Aff" : "Neg" : "" %>
					</td>

					<td class=" nowrap smallish">

%						foreach my $score (@scores) { 
%							next if $score->student > 0;
%							next unless $score->ballot->entry->id == $entry->id;
							<% $score->tag eq "ballot" ? $score->value ? "W" : "L" : "" %>
							<% $score->tag eq "rank" ? $score->value : "" %>
							<% $score->tag eq "points" ? $score->value : "" %>
%						}

					</td>

%					foreach my $student ($entry->students) { 
%						my @scores = @{$scores_by_recipient{$student->id}} if $student->id && $scores_by_recipient{$student->id};
%						next unless @scores;
						
						<td class=" nowrap smallish">

							<% $student->last %>:

%							my $notfirst;
%							foreach my $score (@scores) { 
								<% $notfirst++ ? "-" : "" %>
								<% $score->tag eq "ballot" ? $score->value ? "W" : "L" : "" %>
								<% $score->tag eq "rank" ? $score->value : "" %>
								<% $score->tag eq "points" ? $score->value : "" %>
%							}
							
						</td>

%					}

					</tr>
%				}

%			}

			<tr>
			<td></td>
			</tr>

%		}
		

		</table>

