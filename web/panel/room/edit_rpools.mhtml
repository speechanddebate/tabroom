<%args>
	$account
	$tourn
	$rg_name => undef
</%args>
<%init>

	my $msg;
	my $switch;

	if ($rg_name) { 
		my $rpool = Tab::RPool->create({
			tourn => $tourn->id,
			name  => $rg_name,
		});
		$msg = "Pool $rg_name created";
	}

	my @rpools = sort {$a->name cmp $b->name} $tourn->rpools;

</%init>

	<& menu.mas, tourn => $tourn, whoami => "edit_rpools" &>

	<div class="main">

		<% $msg ? '<p class="explain">'.$msg.'</p>' : "" %>

		<h2>Room Pools</h2>
	
		<& tabbar.mas, tourn => $tourn, whoami => "edit_rpools" &>

		<span class="quarter nospace top" style="width: 23%;">

			<table cellpadding="3" cellspacing="1">

				<tr class="yellowrow smallish">
					<th>
						<form action="edit_rpools_save.mhtml" method="post">
						Pool Name
					</th>
				</tr>

%				foreach my $rpool (@rpools) { 

					<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">

						<td>
							<a id="<% $rpool->id %>"></a>
							<span class="hidden"><% $rpool->name %></span>
							<span class="optionblock">
								<input type="text" name="<% $rpool->id %>" value="<% $rpool->name %>" size="16">
							</span>
						</td>

					</tr>

%				}

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<td>
						<div class="optionblock">
						<input type="text" name="new" placeholder="New Pool name" size="12">
						</div>
					</td>
				</tr>

				<tr class="liblrow">
					<td>
						<div class="optionblock">
						<input type="submit" value="Save Pools">
						</form>
						</div>
					</td>
				</tr>

			</table>

		</span>

%		undef $switch;

		<span class="threequarter top nospace" style="width: 76%; border-left: 0px solid white;">
		
			<table cellpadding="3" cellspacing="1">

				<tr class="yellowrow smaller">

					<th>
						Rounds (Click to remove)
					</th>

					<th class="smaller">
						Rms
					</th>

					<th class="nosort">
						Add Rounds
					</th>
					
					<th class="nosort">
						Add All From
					</th>

					<th class="nosort">
					</th>

				</tr>

%				foreach my $rpool (@rpools) { 

					<tr class="<% ($switch++ % 2) ? "odd" : "even" %>">

						<td class="nospace">
							<div class="optionblocknosp">
%							my %used_round;
%							foreach my $round ($rpool->rounds) {
%								$used_round{$round->id}++;
%								next unless $round->event;
								<span class="nospace quarter smaller centeralign">
									<a class="white nowrap hover" href="rpool_round_rm.mhtml?rpool_id=<% $rpool->id %>&round_id=<% $round->id %>">
									<% $round->event ? $round->event->abbr : "" %>
									<% $round->name %>
									</a>
								</span>
%							}
							</div>
						</td>

						<td class="centeralign smallish">
							<% scalar $rpool->rooms %>
						</td>

						<td>
							<form action="rpool_round_add.mhtml" method="post">
							<input type="hidden" name="rpool_id" value="<% $rpool->id %>">

							<select name="round_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
								<option value=""></option>
%								my @rounds = $m->comp("/funclib/tourn_rounds.mas", tourn => $tourn);
%		                       	foreach my $round (@rounds) {
%									next if $used_round{$round->id};
									<option value="<% $round->id %>"><% $round->event->name %> <% $round->realname %></option>
%		                       	}
							</select>

							</form>
						</td>

						<td>
							<form action="rpool_event_add.mhtml" method="post">
							<input type="hidden" name="rpool_id" value="<% $rpool->id %>">

							<select name="event_id" class="chosen fixedsmaller" onchange='this.form.submit()'>
								<option value=""></option>
%		                       	foreach my $event ($tourn->events) {
									<option value="<% $event->id %>"><% $event->name %></option>
%		                       	}
							</select>

							</form>
						</td>


						<td class="centeralign padno">
%							my $warn = "You are about to delete this room rpool and cast any rounds in it to pull from the main list.  Are you sure?";
							<a class="dkred padmuchmore marno block" <& "/funclib/confirm.mas", warn => $warn &>  href="rpool_delete.mhtml?rpool_id=<% $rpool->id %>"> X </a>
						</td>
					
					</tr>

%				}

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<td colspan="5">
						<Div class="optionblock"> &nbsp;</div>
					</td>
				</tr>

				<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow" %>">
					<td colspan="5">
						<Div class="optionblock">&nbsp;</div>
					</td>
				</tr>

			</tbody>

		</table>

		</span>

	</div>
