<%args>
	$league
	$tourn
	$account
	$session
	$debug => undef
</%args>
<%init>
	
	my $filename = $Tab::file_root."/tmp/tournament-fines-".$tourn->id."-".$session->id;
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{letter}
\\usepackage{fullpage}
\\usepackage{helvet}
\\usepackage{colortbl}
\\usepackage{fancyhdr,lastpage}
\\usepackage[hmargin=.8in,vmargin=1in]{geometry}
\\pagestyle{fancy}

\\fancyhf{} % clear all header and footer fields

\\fancyfoot[R]{\\footnotesize Page \\thepage\\ of \\pageref{LastPage}}
\\fancyfoot[L]{\\footnotesize Printed by the Tabroom.com free online tournament management system}

EOF
    print TEXOUT "\\fancyhead[RO]{\\Large ".&Tab::texify($tourn->name)." fines }\n";
    print TEXOUT <<"EOF";

\\renewcommand{\\headrulewidth}{0pt}
\\renewcommand{\\footrulewidth}{0pt}

\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.3}

\\setlength{\\textheight}{8.25in}       
\\setlength{\\topmargin}{-.25in}      
\\setlength{\\headsep}{0.25in}      

\\setlength{\\parskip}{1.4ex}
\\setlength{\\parindent}{0mm}

\\addtolength{\\textwidth}{1in}
\\addtolength{\\hoffset}{-.2in}

\\begin{document}

EOF

	print TEXOUT "\\normalsize\n";
	print TEXOUT "\\begin{tabular}{p{1.3in}p{3.5in}p{1.25in}p{.5in}}\n";
	print TEXOUT "\\multicolumn{4}{l}{\\large}\\\\\n";
	print TEXOUT "\\rowcolor[rgb]{1.0,.95,.94}\[5.5pt\]\[5.5pt\]\n";
	print TEXOUT "School & Fine Reason & Levied At & Amount \\\\ \n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";
	print TEXOUT "\\small\n";
	
	my @fines = $tourn->fines;

#	@fines = sort {$a->levied->epoch <=> $b->levied->epoch} @fines;

	my $switch; 

	foreach my $fine (@fines) { 
		print TEXOUT "\\begin{tabular}{p{1.3in}p{3.5in}p{1.25in}p{.5in}}\n";
		print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);
		print TEXOUT "(".&Tab::texify($fine->region->code).") " if $league->diocese_based && $fine->region;
		print TEXOUT "(".&Tab::texify($fine->school->region->code).") " if $league->diocese_based &! $fine->region;
		print TEXOUT &Tab::texify($fine->school->name) if $fine->school;
		print TEXOUT " & ".&Tab::texify($fine->reason)." & ";
		print TEXOUT $fine->levied->mon."/".$fine->levied->day." at ".$fine->levied->hour_12.":".$fine->levied->strftime("%M")." ".$fine->levied->strftime("%P") if $fine->levied;
		print TEXOUT " & \\\$".$fine->amount;
		print TEXOUT "\\\\ \n";
		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";
	}

	print TEXOUT "\\end{document}\n";
	close TEXOUT;


$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

`rm -f $filename.tex $filename.log $filename.dvi $filename.aux` unless $debug;

my $tourn_id = $tourn->id;

$m->redirect("$Tab::url_prefix/tmp/tournament-fines-$tourn_id-".$session->id.".pdf");

</%init>

<div id="content">

<p><% $filename %></p>
