<%args>
	$tourn
	$group_id
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id);

	my @judges_by_code = Tab::Judge->search( tournament => $tourn->id, {order_by => "code"});

        my $last_code;

        if (@judges_by_code) {

            my $last_code_judge = pop @judges_by_code;
            $last_code = $last_code_judge->code;
            $last_code++;

        } else {
            $last_code = 100;
        }



	foreach my $tick (1 .. 10) { 

		my $first_key = "first_".$tick;
		my $last_key = "last_".$tick;
		my $special_key = "special_".$tick;

		$last_code++;


		if ($ARGS{$first_key}) { 

			my $judge = Tab::Judge->create({
				
				first 	=> $ARGS{$first_key},
				last 	=> $ARGS{$last_key},
				special 	=> $ARGS{$special_key},
				active 	=> 1,
				spare_pool 	=> 1,
				judge_group => $group->id,
				tournament	=> $tourn->id,
				code 		=> $last_code

			});

			my $didit;
			
        	foreach my $subset ($group->qual_subsets) {
			
            	my $qual_id = $ARGS{$subset->id."_".$tick};

            	my $rating = Tab::Rating->create({
                	tournament => $tourn->id,
                	judge => $judge->id,
					subset => $subset->id,
                	qual => $qual_id,
					type => "coach"
            	});

				$didit++;

			}

			unless ($didit) { 

            	my $qual_id = $ARGS{"qual_".$tick};

            	my $rating = Tab::Rating->create({
                	tournament => $tourn->id,
                	judge => $judge->id,
                	qual => $qual_id,
					type => "coach"
            	});

			}

		}

	}

	$m->redirect("$Tab::url_prefix/register/judge/hires.mhtml?group_id=$group_id");


</%init>
