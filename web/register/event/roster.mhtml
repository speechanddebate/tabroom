<%args>
	$event_id
	$tourn
	$sort => undef
	$drops => undef
	$waitlist => undef
</%args>
<%init>

	my $event = Tab::Event->retrieve($event_id);

	my @entries = Tab::Entry->search( event => $event->id );

	@entries = Tab::Entry->search( event => $event->id, dropped => 1) if $drops;
	@entries = Tab::Entry->search( event => $event->id, waitlist => 1 ) if $waitlist;

	my $namestring = "Entries";
	$namestring = "Drops" if $drops;
	$namestring = "Waitlist" if $waitlist;


	my %entry_names = ();

	foreach my $entry (@entries) { 
		$entry_names{$entry->id} = $m->comp("/funclib/entry_students.mas", entry => $entry, name => 1);
	}

	@entries = sort {$a->reg_time cmp $b->reg_time} @entries;

	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

</%init>

	<& event_menu.mas, tourn => $tourn, event => $event, drops => $drops, waitlist => $waitlist &>

	<h3><% scalar @entries." ".$namestring %> in <% $event->name %></h3>

	<& /funclib/tablesorter.mas, table => "sortme" &>

	<div class="left huge">

		<table cellpadding="1" cellspacing="1" width="100%" id="sortme">

			<thead>

			<tr class="yellowrow">

				<th class="smaller">
					<a class="white block" href="roster.mhtml?event_id=<% $event->id %>&waitlist=<% $waitlist %>&drops=<% $drops %>&sort=code">
						Code
					<a>
				</th>

				<th class="smaller">
					<a class="white block" href="roster.mhtml?event_id=<% $event->id %>&waitlist=<% $waitlist %>&drops=<% $drops %>&sort=name">
						Students Name
					<a>
				</th>

				<th class="smaller">
					<a class="white block" href="roster.mhtml?event_id=<% $event->id %>&waitlist=<% $waitlist %>&drops=<% $drops %>&sort=school">
						School
					<a>
				</th>

				<th class="smaller">
					<a class="white block" href="roster.mhtml?event_id=<% $event->id %>&waitlist=<% $waitlist %>&drops=<% $drops %>&sort=reg_time">
						Registered
					</a>
				</th>

%				if ($drops) {

					<th class="smaller">
						<a class="white block" href="roster.mhtml?event_id=<% $event->id %>&waitlist=<% $waitlist %>&drops=<% $drops %>&sort=drop_time">
							Dropped
						</a>
					</th>

%				} else { 

					<td>
					</td>
%				}

			</tr>
			</thead>
			<tbody>

%			foreach my $entry (@entries) { 

%				next if $entry->dropped && $waitlist;

				<tr class="<% ($entry->dropped && not defined $drops) ? "strike" : "" %>" >

					<td class="smaller">
						<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
							<% $m->comp("/funclib/entry_code.mas", entry => $entry) %>
						</a>
					</td>

					<td class="smaller">
						<a class="white block" href="/register/entry/edit.mhtml?entry_id=<% $entry->id %>">
							<% $entry_names{$entry->id} %>
						</a>
					</td>

					<td class="smaller">
						<a class="white block" href="/register/school/entries.mhtml?event_id=<% $entry->event->id %>&school_id=<% $entry->school->id %>">
							<% $entry->school->short_name %>
						</a>
					</td>

					<td class="smaller">
						<% ($entry->reg_time) ? &Tab::niceshortdt($entry->reg_time->set_time_zone($tz)) : "" %>
					</td>

					<td class="smaller centeralign">

%						if ($waitlist) { 

%							my $warn = "This will remove the entry from the waitlist.  The coaches will be notified by email.";
							<a class="dkgreen block" href="waitlist_admit.mhtml?entry_id=<% $entry->id %>"  <& "/funclib/confirm.mas", warn => $warn &> >
								Admit
							</a>

%						} elsif ($drops) { 
							
							<% ($entry->drop_time) ? &Tab::niceshortdt($entry->drop_time->set_time_zone($tz)) : "" %>
							<% ($entry->drop_by) ? $entry->drop_by->first." ".$entry->drop_by->last : "" %>

%						} else { 

							<% ($entry->dropped) ? "DROP" : "" %>
							<% ($entry->waitlist) ? "WL" : "" %>
							<% ($entry->dq) ? "DQ" : "" %>

%						}

					</td>

				</tr>
%			}

			</tbody>

		</table>

	</div>

