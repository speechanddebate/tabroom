<%args>
	$person
	$entry_id
	$tourn
</%args>
<%init>

	my $entry = Tab::Entry->retrieve($entry_id);

	my $msg = "Entry not found";
	$m->redirect("/register/index.mhtml?msg=$msg") unless $entry;

	my $event = $entry->event;
	my $school = $entry->school;

	my @ballots = $entry->ballots;

	foreach (@ballots) {
		$_->delete;
	}

	my $entry_code = $entry->code;

	my @students = $entry->students;

	my $description = "Entry ".$entry->code." TOTALLY DELETED in ".$entry->event->abbr;;

	my $change = $m->comp("/funclib/log.mas",
		tourn       => $tourn->id,
		school      => int($school),
		type        => "registration",
		description => $description,
		person      => $person->id
	);

	system "$Tab::eventlogger $description";

	$entry->delete;

	if ($school && $school->setting("individuals")) {
		$school->setting("individuals", $school->setting("individuals") - scalar @students)
	}

	$msg = "Entry ". $entry_code ." deleted";
	$m->redirect("/register/school/entries.mhtml?school_id=".int($school)."&event_id=".$event->id."&msg=$msg");

</%init>
