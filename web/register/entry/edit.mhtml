<%args>
	$tourn
	$perms
	$tourn_settings
	$person
	$person_settings
	$entry_id	  => undef
	$only_category => undef
</%args>
<%init>

	use Tab::NSDA::Person;

	my $entry = Tab::Entry->retrieve($entry_id) if $entry_id;

	$m->abort unless $entry;
	$m->abort unless $entry->event->tourn->id == $tourn->id;

	$m->abort if $only_category
		&& $entry->event->category->id
		!= $only_category->id;

	my $event    = $entry->event;
	my @students = $entry->students;
	my $category = $event->category;

	my %event_settings = $event->all_settings;
	my %category_settings = $category->all_settings() if $category;

	my $aff_string = $event_settings{"aff_label"};
	my $neg_string = $event_settings{"neg_label"};

	$aff_string = "Aff" unless $aff_string;
	$neg_string = "Neg" unless $neg_string;

	my $event_type = $event->type;

	$event_type = "debate"
		if ($event_type eq "wsdc"
			|| $event_type eq "policy"
			|| $event_type eq "ld"
			|| $event_type eq "pf"
			|| $event_type eq "parli");

	my $show_region++ if $event_settings{"region_avoid"};
	$show_region++ if $event_settings{"region_constrain"};
	$show_region++ if $tourn_settings->{"ncfl"};

	my $no_codes++ if $event_settings{"code_style"} eq "names";
	my $tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	Tab::Round->set_sql( flightedness => "
		select max(round.flighted) from round where event = ?
	");

	my $max_flights = Tab::Round->sql_flightedness->select_val($event->id);

	my %wins = $m->comp(
		"/funclib/entry_wins.mas",
		event => $event
	);

	my %losses = $m->comp(
		"/funclib/entry_losses.mas",
		event => $event
	);

	my $school = $entry->school;
	my $region = $school->region if $school;

	my %entry_settings = $entry->all_settings;

    my %reasons;

    %reasons = $m->comp(
        "/funclib/judgemath/nats_check_judging.mas",
        school => $school
    ) if $tourn_settings->{"nsda_nats"};



</%init>

%	if ($only_category || $perms->{"details"}) {

		<div class="main">

			<h2><% $school->name %></h2>

%	} else {

		<& "/register/menubar.mas",
			school         => $school,
			whoami         => "students",
			tourn          => $tourn,
   			reasons        => \%reasons,
			tourn_settings => $tourn_settings
		&>
%	}

	<script>

		function statusSwitch(targetStatus) {
			$("."+targetStatus).toggleClass('hidden');
		}

	</script>

	<form action="save.mhtml" method="post">

	<input
		type  = "hidden"
		name  = "entry_id"
		value = "<% $entry->id %>"
	>

	<script>

		function togglePieces() {
			$(".pieceinfo").toggleClass('hidden');
			$("#piecebutton").toggleClass('invert');
		}

	</script>

		<div class="full nospace">

			<span class="half padleft nowrap">
				<h5 class="semibold">Entry in <% $event->abbr %></h5>
			</span>

			<span class="<% $event_type eq 'debate'
				? "threeeighths"
				: "half"
			%> marno rightalign">

%				if ($event_settings{"ask_for_titles"}
%					|| $event_settings{"ask_for_bibliography"}
%				) {
					<a
						id      = "piecebutton"
						class   = "bluetext buttonwhite"
						onClick = "togglePieces()"
					>Title/Info</a>
%				}

				<span
					class="redtext buttonwhite banner dropped
					<% $entry->dropped ? "" : "hidden" %>">
					DROPPED
				</span>

				<span
					class="orangetext buttonwhite banner dq
					<% $entry->dq ? "" : "hidden" %>">
					DISQUALIFIED
				</span>

				<span
					class="purpletext buttonwhite banner waitlist
					<% $entry->waitlist &! $entry->dropped ? "" : "hidden" %>">
					WAITLISTED
				</span>

				<span
					class="purpletext buttonwhite banner vacate
					<% $entry_settings{"nsda_vacate"} ? "" : "hidden" %>">
					VACATED
				</span>

				<span
					class="greentext buttonwhite banner exclude_from_sweeps
					<% $entry_settings{"exclude_from_sweeps"} ? "" : "hidden" %>">
					NO SWEEPS
				</span>

				<span
					class="greentext buttonwhite banner presiding_officer
					<% $entry_settings{"presiding_officer"} ? "" : "hidden" %>">
					Presiding Officer
				</span>

				<span
					class="orangetext buttonwhite banner no_elims
					<% $entry_settings{"no_elims"} ? "" : "hidden" %>">
					NO ELIMS
				</span>
				<span
					class="bluetext buttonwhite banner autoqual
					<% $entry_settings{"autoqual"} ? "" : "hidden" %>">
					AUTOQUAL
				</span>
			</span>

%			if ($event_type eq "debate") {
				<span class="eighth rightalign <% $entry->active ? "" : "hidden" %>">
					<h4 class="bluetext record">
						<%
							$wins{$entry->id} ? $wins{$entry->id} : "0"
								%>-<%
							$losses{$entry->id} ? $losses{$entry->id} : "0"
						%>
					</h4>
				</span>
%			}

		</div>

%		my $code_setting = $event_settings{"code_style"};

		<span class="pagehalf">
			<div class="row">
				<span class="fifth padleft padleft">
					Name
				</span>

				<span class="threequarter padleft rightalign">
					<input
						type  = "text"
						size  = "24"
						name  = "name"
						value = "<% $entry->name %>"
					>
				</span>
			</div>

%			unless ($event_settings{"no_codes"} || $no_codes) {

				<div class="row">
					<span class="fifth padleft">
						Code
					</span>

					<span class="threequarter padleft rightalign">
						<input
							type  = "text"
							size  = "24"
							name  = "code"
							value = "<% $entry->code %>"
						>
					</span>
				</div>

<%perl>
			}

			unless ($entry->code) {

				my $entry_code = $m->comp("/funclib/entry_code.mas",
					entry => $entry,
					event => $event
				);

</%perl>

				<div class="row">

					<span class="third marno centeralign semibold bluetext padsetting">
						Next Free Code:
					</span>

					<span class="twothirds padsetting rightalign">
						<% $entry_code %>
					</span>

				</div>

%			}

%			if ($tourn_settings->{"nsda_nats"}) {

				<div class="row nospace">

%				if ($event_settings{"supp"} || $event_settings{"conn"}) {

					<span class="semibold purpletext centeralign quarter padno padsetting">
						SUPP/CONN
					</span>

<%perl>
					if ($entry_settings{'reregistered'}) {

						my $reregistered = Tab::EntrySetting->search(
							entry => $entry, tag => "reregistered"
						)->first;

						my $reregistered_by = Tab::Person->retrieve($reregistered->value);
						my $reregistered_at = $reregistered->timestamp->set_time_zone($tz);
</%perl>
						<span
							class='threeeighths centeralign marno padless yellowhover'
							title="<% $reregistered_by->email %>"
						>
							<% $reregistered_by->first." ".$reregistered_by->last %>
						</span>

						<span class='threeeighths centeralign marno padless'>
							<%
								$m->comp("/funclib/showdate.mas",
									length => "short",
									dt     => $reregistered_at
								)
							%> <%
								$m->comp("/funclib/showtime.mas",
									length => "short",
									dt     => $reregistered_at
								)
							%>
						</span>

%					} else {

						<span class="twothirds rightalign">
							Re-reg Pending
						</span>
%					}

					</span>

%				} elsif ($entry->active) {

<%perl>
					my $accepted_by = Tab::Person->retrieve($entry_settings{"accepted_by"});
					my $accepted_at = $entry_settings{'accepted_at'};
					$accepted_at->set_time_zone($tz) if $accepted_at;
</%perl>

					<span class="semibold greentext centeralign quarter padno padsetting">
						ACCEPTED
					</span>

					<% $accepted_by
						? "<span class='bluetext semibold threeeighths marno padless'>by ".$accepted_by->first." ".$accepted_by->last."</span>"
						: ""
					%> <%
						$entry_settings{"accepted_at"}
						? "<span class='threeeighths marno bluetext semibold padless'> on ".
							Tab::niceshortdate($accepted_at)." at ".
							Tab::nicetime($accepted_at)."</span>"
						: ""
					%>
					</span>

%				} elsif ($entry_settings{"rejected_by"}) {

<%perl>
					my $rejected_by = Tab::Person->retrieve($entry_settings{"rejected_by"});
					my $rejected_at = $entry_settings{'rejected_at'};
					$rejected_at->set_time_zone($tz) if $rejected_at;
</%perl>

					<span class="semibold redtext centeralign quarter padno padsetting">
						REJECTED
					</span>

					<% $rejected_by
						? "<span class='threeeighths centeralign marno padless'>".$rejected_by->first." ".$rejected_by->last."</span>"
						: ""
					%>

					<% $entry_settings{"rejected_at"}
						? "<span class='threeeighths centeralign marno padless'>".
							Tab::niceshortdate($rejected_at)." ".
							Tab::nicetime($rejected_at)."</span>"
						: ""
					%>

%				} else {

%					my $created_at = $entry->created_at->set_time_zone($tz);

					<span class="semibold orangetext centeralign quarter padno padsetting">
						PENDING
					</span>

					<span class='quarter centeralign marno padless'>
						Created:
					</span>
					<span class='quarter centeralign marno padless'>
						<% Tab::eurodate($created_at) %>
					</span>
					<span class='quarter centeralign marno padless'>
						<% Tab::nicetime($created_at) %>
					</span>

%				}

				</div>

				<div class="row">
					<span class="centeralign quarter padtopmore padbottommore">
						Complete?
					</span>

%					if ($entry_settings{"status"} eq "complete") {
						<span class="centeralign threequarters padtopmore padbottommore greentext">
							COMPLETE
						</span>
%					} else {
						<span class="leftalign threequarters nospace smallish redtext">
							<% $entry_settings{"incomplete_reasons"} %>
						</span>
%					}
					</span>
				</div>


%			} else {

				<div class="row">

					<span class="centeralign third padtopmore padbottommore">
						Registered
					</span>

					<span class="third">
						<% Tab::eurodate($entry->created_at) %>
					</span>

					<span class="third">
						<% Tab::nicetime($entry->created_at) %>
					</span>

				</div>
%			}

		</span>

%		my %entry_students = ();
%		my $tick = 1;

		<span class="pagehalf">

%			if ($tourn_settings->{"nsda_district"} && $event->abbr eq "HOU") {

				<div class="row">

					<span class="threequarters">
						House Chamber Bloc
					</span>

					<span class="quarter">
						<input
							type  = "number"
							name  = "nsda_house_bloc"
							min   = 1
							size  = 8
							max   = <% $event_settings{"house_chambers"} %>
							value = "<% $entry_settings{"nsda_house_bloc"} %>"
						>
					</span>

				</div>

<%perl>

			}

			if ($event_settings{"breakouts"}) {

				foreach my $breakout (1 .. $event_settings{"breakouts"}) {

					next if $event_settings{"breakout_".$breakout."_delete"};
</%perl>

					<label for="breakout_<% $breakout %>">

						<div class="row hover">

							<span class="threequarter padleft nowrap">
								<% $event_settings{"breakout_".$breakout."_label"} %>
							</span>

							<span class="quarter">
								<input
									type  = "checkbox"
									name  = "breakout_<% $breakout %>"
									id	= "breakout_<% $breakout %>"
									value = "1"
									<% $entry_settings{"breakout_".$breakout}
										? 'checked="checked"'
										: ""
									%>
								>
							</span>

						</div>

					</label>
<%perl>

				}

			}

			if (
				($tourn_settings->{"nsda_nats"}
					|| $tourn_settings->{"nsda_district"}
					|| $tourn_settings->{"nsda_ms_nats"}
				)
				&& (not defined $event_settings{"not_nats"} )
				&& ($event->type eq "speech" || $event->type eq "debate")
			) {

</%perl>
				<div class="row">
					<span class="threequarters padleft">
						Down and out after Round
					</span>

					<span class="quarter">
						<input
							type  = "number"
							name  = "down"
							value = "<% $entry_settings{"down"} %>"
						>
					</span>
				</div>
<%perl>
			}

			if (
				$tourn_settings->{"nsda_nats"}
				&! $event_settings{'usa_wsdc'}
			) {

				my $nsda_person = Tab::NSDA::Person->search(
					user_id => $entry_settings{"coach_points"}
				)->first;

				my @coaches = $m->comp(
					"/funclib/nsda_school_coaches.mas",
					school => $school
				);

				unshift @coaches, $nsda_person if $nsda_person > 0;

</%perl>

				<div class="row">

					<span class="third">
						Coach Points
					</span>

					<span class="twothirds rightalign">
						<select name="coach_points" class="fixedmed">
							<option value=""></option>

<%perl>
							my %used;
							foreach my $coach (@coaches) {
								next if $used{$coach->user_id}++;
</%perl>
								<option
									value="<% $coach->user_id %>"
									<% $nsda_person && $coach->user_id == $nsda_person->user_id
										? 'selected="selected"'
										: ""
									%>
								><% $coach->ufname." ".$coach->ulname." (#".$coach->user_id.")" %></option>
%							}

						</select>
					</span>

				</div>

				<div class="row">

					<span class="half">
						Points to (Manual):
					</span>

					<span class="half rightalign">
						Merit #:
						<input
							type  = "text"
							name  = "coach_points_merit"
							size  = "12"
						>
					</span>
				</div>

%				if ($tourn_settings->{"nsda_nats"}) {

					<div class="row">

						<span class="semibold redtext centeralign third">
							Change Status:
						</span>

%						if ($event_settings{"supp"} || $event_settings{"conn"}) {

							<span class="twothirds">
								<select name="reregistered" class='fixedsmall'>
									<option
										<% $entry_settings{"reregistered"}
											? ""
											: 'selected="selected"'
										%>
										value="0"
									>Pending Re-reg</option>
									<option
										<% $entry_settings{"reregistered"}
											? 'selected="selected"'
											: ""
										%>
										value="1"
									>Re-registered</option>
								</select>
							</span>

%						} else {

<%perl>
							my $status;
							$status = "accepted" if $entry->active;
							$status = "dropped" if $entry->dropped;
							$status = "pending" if $entry->unconfirmed;
							$status = "rejected" if $entry_settings{"rejected_by"};

</%perl>

							<span class="twothirds rightalign">

								<select name="entry_status" class='fixedmed'>

									<option value="">No Change</option>

									<option
										value="accepted"
									>Accepted</option>

									<option
										value="rejected"
									>Rejected (Promote Next)</option>

									<option
										value="rejected_no_promotion"
									>Rejected (No Promotion)</option>

									<option
										value="pending"
									>Pending</option>

								</select>

							</span>

%						}

					</div>
<%perl>
				}
			}

			if (
				$person->site_admin
				&! $tourn_settings->{"nsda_nats"}
			) {
</%perl>

				<div class="row">

					<span class="threequarters">
						JOT Import ID
					</span>

					<span class="quarter">
						<input
							type  = "number"
							name  = "jot_id"
							size  = 8
							value = "<% $entry_settings{"jot_id"} %>"
						>
					</span>

				</div>

%			}



%	 		if ($event_settings{"apda"}) {

%				my $seed = $entry_settings{"registered_seed"};

				<div class="row">

					<span class="quarter padleft">
						APDA Seed
					</span>

					<span class="threequarter padleft">
						<select name="seed" class="fixedsmall">
							<option value="">None</option>
							<option value="full"
								<% $seed eq "full" ? "selected" : "" %>>Full</option>
							<option value="half"
								<% $seed eq "half" ? "selected" : "" %>>Half</option>
							<option value="free"
								<% $seed eq "free" ? "selected" : "" %>>Free</option>
						</select>
					</span>
				</div>

%	 		}

%			if ($event_settings{"seed_presets"}) {

				<div class="row">

					<span class="threequarters">
						Preset Seed
					</span>

					<span class="quarter">
						<input
							type  = "number"
							name  = "pairing_seed"
							size  = "5"
							class = "thin"
							value = "<% $entry_settings{"pairing_seed"} %>"
						>
					</span>

				</div>
%	 		}

%			if ($event_settings{"round_robin"}) {

				<div class="row">

					<span class="half padleft more">
						Round Robin Pod
					</span>

					<span class="half">
						<input
							type="number"
							name="pod"
							size="5"
							class="thin"
							value="<% $entry_settings{"pod"} %>"
						>
					</span>

				</div>
%	 		}

		</span>
<%perl>
		if	($tourn_settings->{"nsda_nats"}
				|| $tourn_settings->{"nsda_district"}
				|| $tourn_settings->{"nsda_ms_nats"}
		) {

</%perl>
			<div class="row pagefull marno">

				<span class="quarter padleftmore marno semibold bluetext">
					Awards coaches:
				</span>

				<span class="threequarters centeralign">
					<input
						type="text"
						name = "coach_script"
						size = "72"
						value= "<% $entry_settings{"coach_script"} %>"
					>
				</span>

			</div>

%		}

		<div class="libl rightalign marno pagefull">
			<input type="submit" value="Save Entry">
			</form>
		</div>


<%perl>
		if (
			(	$tourn_settings->{"nsda_district"}
				|| $tourn_settings->{"nsda_nats"}
				|| $tourn_settings->{"nsda_ms_nats"}
			) && (
				$event_settings{"ask_for_titles"}
				|| $event_settings{"ask_for_topic"}
				|| $event_settings{"ask_for_bibliography"}
			)
		) {
</%perl>

			<div class="full hidden pieceinfo martopmore marno pagefull">

				<span class="threequarters">
					<h5>Piece/speech title information:</h5>
				</span>

				<span class="quarter rightalign">
					<a class="buttonwhite bluetext smallish invert"
						href="https://staging.tabroom.com/natsfiles/<% $tourn->id."/".$school->id."/scripts/".$entry->id."/" %>"
					>Piece Upload Archive</a>
				</span>

				<div class="row">

					<span class="third padleft">
						Piece Title
					</span>

					<span class="twothirds padleft">
						<input
							type  = "text"
							size  = "64"
							name  = "title"
							value = "<% $entry_settings{"title"} %>"
						>
					</span>

				</div>

				<div class="row">

					<span class="third padleft">
						Speech Topic
					</span>

					<span class="twothirds padleft">
						<input
							type  = "text"
							size  = "64"
							name  = "topic"
							value = "<% $entry_settings{"topic"} %>"
						>
					</span>

				</div>

				<& "/funclib/editor.mas", half => 1 &>

				<div class="row">

					<span class="third padleft">
						Bibliography
					</span>

					<span class="twothirds padleft centearlign">
						<textarea
							rows  = "5"
							cols  = "65"
							class = "half"
							name  = "bibliography"
						><% $entry_settings{"bibliography"} %></textarea>
					</span>

				</div>

				<div class="row">

					<span class="third padleft">
						Piece Author
					</span>

					<span class="twothirds padleft">
						<input
							type  = "text"
							size  = "64"
							name  = "author"
							value = "<% $entry_settings{"author"} %>">
					</span>

				</div>

				<div class="row">

					<span class="third">
						Publisher
					</span>

					<span class="twothirds">
						<input
							type  = "text"
							name  = "publisher"
							value = "<% $entry_settings{"publisher"} %>"
							size  = "64"
						>
					</span>
				</div>

				<div class="row">

					<span class="third">
						Publication Year
					</span>

					<span class="twothirds">
						<input
							type  = "text"
							name  = "publish_date"
							value = "<% $entry_settings{"publish_date"} %>"
							size  = "64"
						>
					</span>

				</div>

				<div class="row">

					<span class="third">
						ISBN Number
					</span>

					<span class="twothirds">
						<input
							type  = "text"
							name  = "publish_isbn"
							value = "<% $entry_settings{"publish_isbn"} %>"
							size  = "64"
						>
					</span>

				</div>

				<div class="row">

					<span class="third">
						Date the web page was printed:
					</span>

					<& /funclib/datepicker.mas, id => "publish_print_date" &>

%					my $publish_print_date = $entry_settings{"publish_print_date"};

					<span class="twothirds">
						 <input
							type  = "text"
							name  = "publish_print_date"
							id    = "publish_print_date"
							size  = "16"
							value = "<% Tab::pickerdate($publish_print_date) %>"
						>
					</span>

				</div>

				<div class="row">

					<span class="third">
						URL (web address)
					</span>

					<span class="twothirds">
						<input
							type  = "url"
							name  = "publish_url"
							value = "<% $entry_settings{"publish_url"} %>"
							size  = "64"
						>
					</span>

				</div>

				<div class="libl rightalign marno pagefull">
					<input type="submit" value="Save Titles">
					</form>
				</div>

			</div>

%		} elsif ($event_settings{"ask_for_titles"}) {

			<div class="full pieceinfo hidden martopmore">

				<div class="row">

					<span class="quarter padleft">
						Piece Title/ISBN
					</span>

					<span class="threequarter padleft">
						<input
							type  = "text"
							size  = "64"
							name  = "title"
							value = "<% $entry_settings{"title"} %>">
					</span>

				</div>

				<div class="row">

					<span class="quarter padleft">
						Piece Author
					</span>

					<span class="threequarter padleft">
						<input
							type  = "text"
							size  = "64"
							name  = "author"
							value = "<% $entry_settings{"author"} %>">
					</span>

				</div>

				<div class="libl rightalign marno pagefull">
					<input type="submit" value="Save Titles">
					</form>
				</div>

			</div>

%		}



		<h6 class="semibold padleftmore martopmore">
			Individual Competitors
		</h6>

%		unless (@students) {

			<div class="lirdrow redtext centeralign padmore marno padbottommore">

				<h2 class="redtext">SOMETHING IS VERY WRONG</h2>

					You have no individual competitors linked to this entry.
					That will cause all kinds of issues!

					<br />
					Speaker points and speaker ranks cannot be entered
					until you add students.  Use the menu at right.
			</div>
<%perl>

		}

		foreach my $student (@students) {

			my $hybrid_school;

			if (   $student->chapter
				&& $school->chapter
				&& $student->chapter->id != $school->chapter->id
			) {

				$hybrid_school = Tab::School->search(
					tourn   => $tourn->id,
					chapter => $student->chapter->id
				)->first;
			}

			$entry_students{$student->id}++;

</%perl>

			<span class="bordervert pagehalf marno odd padless">

				<span class="threefifths hover nospace">
					<a
						class = "white padvert full"
						title = "<% $student->fullname %>"
						href  = "student_edit.mhtml?student_id=<%$student->id%>&entry_id=<% $entry->id %>"
					>
						<span class="tenth centeralign marno">
							<% $tick++ %>
						</span>

						<span class="seveneighths nospace">
							<% $student->fullname %>
						</span>
					</a>
				</span>

				<span class="fourtenths smaller nospace rightalign">

%					if ($student->novice) {
						<div class="full nospace">
							<% $student->novice ? 'Novice' : "" %>
						</div>
%					}

%					if ($student->nsda) {
						<div class="full nospace">
							NSDA #<% $student->nsda %>
						</div>
%					}

%					if ($hybrid_school) {
						<div class="full nospace">
							<a
								class="white marno padless"
								href="/register/school/entries.mhtml?school_id=<%$hybrid_school->id%>"
							>
								<% $hybrid_school->short_name %>
							</a>
						</div>
%					}
				</span>

			</span>
%		}


% 	if ($entry && $event_settings{"ask_quals"}) {

		<h4 class="martop">Qualifying Information:</h4>

		<table class="nar">

			<tr class="yellow">

				<th class="smaller">

					<form
						action = "qual_save.mhtml"
						method = "post"
					>

					<input
						type  = "hidden"
						name  = "entry_id"
						value = "<% $entry->id %>"
					>
				</th>

				<th class="smaller">
					Tournament
				</th>

				<th class="smaller">
					Placement/Points
				</th>

			</div>

%			my $tick = 1;

%			foreach my $qual ($entry->qualifiers) {

				<tr class="row">

					<th>
						Qual <% $tick++ %>.
					</th>

					<td>
						<input
							type  = "text"
							size  = "20"
							name  = "qual_<% $qual->id %>_name"
							value = "<% $qual->name %>">
					</td>

					<td>
						<input
							type  = "text"
							size  = "20"
							name  = "qual_<% $qual->id %>_result"
							value = "<% $qual->result %>"
						>
					</td>

				</tr>

% 			}

			<tr class="row">

				<th>
					Add Qual:
				</th>

				<td>
					<input
						type = "text"
						size = "20"
						name = "qual_new_name"
					>
				</td>

				<td>
					<input
						type = "text"
						size = "20"
						name = "qual_new_result"
					>
				</td>

			</tr>

% 			if ($entry && $event_settings{"ask_quals"}) {

				<tr class="row">

					<th>
						<label for="atlarge">
							At-Large
						</label>
					</th>

					<td colspan="2" class="leftalign">
						<input
							id    = "atlarge"
							type  = "checkbox"
							name  = "atlarge"
							value = "1"
							<% $entry_settings{"atlarge"} ? 'checked="checked"' : "" %>
						>
					</td>

				</tr>
% 			}


			<tr class="libl">

				<td colspan="3" class="rightalign">
					<input
						type="submit"
						value="Save Qualifiers"
					>
					</form>
				</td>

			</tr>

		</table>

<%perl>

 	}

	if ($tourn->setting("housing")) {

		my $start = $tourn->start;
		my $end = $tourn->end;

		$start->set_time_zone($tz);
		$end->set_time_zone($tz);

		$end->truncate(to => 'day');
		$start->truncate(to => 'day');

		my @days = $m->comp(
			"/funclib/tourn_days.mas",
			tourn => $tourn
		);

		my $day_before = $days[0]->clone;

		$day_before->subtract( days => 1);
		push (@days, $day_before);

</%perl>

		<h4>Housing</h4>

		<form action="housing_save.mhtml" method="post">

		<input
			type  = "hidden"
			name  = "entry_id"
			value = "<% $entry->id %>"
		>

%		foreach my $student (@students) {

			<span class="pagehalf">

				<div class="row smaller">

					<span class="half">
						<% $student->first." ".$student->last %>
					</span>

					<span class="half nospace">
						Gender

						<label for="m_<% $student->id %>">
							<span class="quarter hover centeralign">
								M <input
										type  = "radio"
										class = "padno"
										name  = "gender_<%$student->id%>"
										id    = "m_<% $student->id %>"
										value = "M" <% ($student->gender eq "M") ? "checked" : "" %>
									>
							</span>
						</label>

						<label for="f_<% $student->id %>">
							<span class="quarter hover centeralign">
								F <input
									type  = "radio"
									class = "padno"
									name  = "gender_<%$student->id%>"
									id	= "f_<% $student->id %>"
									value = "F" <% ($student->gender eq "F") ? "checked" : "" %>
								>
							</span>
						</label>

						<label for="o_<% $student->id %>">
							<span
								title="Other"
								class="quarter hover centeralign"
							>
								O <input
									type  = "radio"
									class = "padno"
									name  = "gender_<%$student->id%>"
									id    = "o_<% $student->id %>"
									value = "O" <% ($student->gender eq "O") ? "checked" : "" %>
								>
							</span>
						</label>

					</span>

				</div>


<%perl>

				foreach my $day (@days) {

					next unless Tab::HousingSlots->search( night => $day );

					my $housing = $m->comp(
						"/funclib/student_housing.mas",
							student => $student,
							tourn   => $tourn,
							day     => $day
						);

</%perl>

					<div class="row smaller">

						<span class="quarter padleft padleft">
							<% Tab::niceshortdayte($day) %>
						</span>

						<label for="request_<% $student->id."_".$day->ymd %>">

							<span class="third hover nospace">

								<span class="threefifth padless">
									Requested:
								</span>

								<span class="fifth ">
									<input
										type  = "checkbox"
										name  = "request_<% $student->id."_".$day->ymd %>"
										value = "1" <% ($housing) ? "checked" : "" %>
										id    = "request_<% $student->id."_".$day->ymd %>"
									>
								</span>
							</span>
						</label>

						<label for="waitlist_<% $student->id."_".$day->ymd %>">

							<span class="third hover nospace">

								<span class="threefifth padless">
									Waitlist:
								</span>

								<span class="third">
									<input
										type  = "checkbox"
										name  = "waitlist_<% $student->id."_".$day->ymd %>"
										id    = "waitlist_<% $student->id."_".$day->ymd %>"
										value = "1"
										<% ($housing && $housing->waitlist) ? "checked" : "" %> >
								</span>
							</span>
						</label>

					</div>
%   			}

			</span>

%		}

		<div class="libl rightalign fullpage">
		   	<input type="submit" value="Save Housing Details">
   			</form>
		</div>

<%perl>

	} # end of if housing.

	my @rounds = sort { $a->name <=> $b->name } $event->rounds;

	if (@rounds) {

</%perl>

		<div class="full nospace martopmore">

			<span class="quarter">
				<h4>Rounds:</h4>
			</span>

			<span
				class="threequarters rightalign"
				id="rounds_buttonarea"
			>
				<a
					class = "buttonwhite bluetext smallish padless"
					href  = "/tabbing/entry/card.mhtml?entry_id=<% $entry->id %>"
				>Change Results</a>
			</span>

		</div>

		<& "/funclib/tablesorter.mas", table => 'rounds' &>

		<table id="rounds" class="nar">

			<thead>

			<tr class="yellowrow">

				<th class="smaller">
					Round
				</td>

				<th class="smaller">
					Start
				</th>

%				if ($event_type eq "wudc" || $event_type eq "speech") {
					<th class="smaller">
						Speaks
					</th>
%				}

%				if ($event_type eq "debate") {

					<th class="smaller limit3">
						Vs.
					</th>

					<th class="smaller">
						Side
					</th>

%				}

				<th class="smaller">
					Room
				</th>

				<th class="smaller limit2 nosort">

%					if ($event_type eq "debate") {

						<span class="third marno">
							Judge
						</span>

						<span class="third marno">
							Result
						</span>

%					} else {

						<span class="half marno">
							Judge
						</span>

						<span class="half marno">
							Result
						</span>
%					}
				</th>

				<th class="smaller nosort">
					Actions
				</th>

			</tr>

			</thead>
			<tbody>
<%perl>

			foreach my $round (@rounds) {

				my @panels = $m->comp(
					"/funclib/entry_panels.mas",
						round => $round,
						entry => $entry
				);

				foreach my $panel (@panels) {

					my @all_ballots = Tab::Ballot->search( panel => $panel->id );
					my @ballots;

					my $opp;
					my $side;

					foreach my $ballot (@all_ballots) {
						if ($ballot->entry && $entry && $ballot->entry->id == $entry->id) {
							push @ballots, $ballot;
							$side = $ballot->side
						} else {
							$opp = $ballot->entry;
						}
					}

</%perl>
					<tr class="row">

						<td class="smaller centeralign">
							<span class="hidden"><% $round->name %></span>
							<% $round->realname %>
						</td>

						<td class="smaller nowrap">
							<span class="hidden"><% $round->timeslot->start->epoch %></span>
							<% &Tab::nicetime($round->timeslot->start->set_time_zone($tz)) %>
						</td>

%						if ($event_type eq "wudc" || $event_type eq "speech") {
							<td class="smaller centeralign">
								<%
									Lingua::EN::Numbers::Ordinate::ordinate(
										$m->comp(
											"/funclib/entry_speakerorder.mas",
											entry => $entry,
											panel => $panel
										)
									) %>
							</td>
%						}

%						if ($event_type eq "debate") {

%							if ($panel->bye) {
								<td class="smaller" colspan="4">
									<div class="full">
										BYE
									</div>
								</td>
%							} else {

								<td class="smaller">
									<a
										class="white"
										href="edit.mhtml?entry_id=<% $opp ? $opp->id : ""%>"
									> <% $show_region
											&& $opp
											&& $opp->school
											&& $opp->school->region
												? $opp->school->region->code
												: ""
										%> <%
											$opp ? $opp->code
												: ""
									%> </a>
								</td>

								<td class="smaller centeralign">
%									if ($panel->bye) {
										B
%									} else {
										<% $side == 1 ? $aff_string : $neg_string %>
%									}

								</td>

								<td class="smaller nospace centeralign">
									<% $event->type eq "congress" ? "Ch ".$panel->letter : "" %>
									<% ($panel->room > 0) ? $panel->room->name : "No Room" %>
								</td>

								<td class="smaller nospace">

%				 					if ($panel->bye) {

										<span class="semibold redtext">
											BYE
										</span>

%									} else {

<%perl>
					 					foreach my $judge (
											sort {$a->ballotid <=> $b->ballotid}
												$m->comp(
													"/funclib/panel_judges.mas",
													panel => $panel
												)
										) {
</%perl>

											<div class="full nospace nowrap padleft">

												<span class="third nospace nowrap">

													<% $category_settings{'no_codes'}
														? $judge->last
														: $judge->code." ".$judge->last.", ".$judge->first
													%><%
														$judge->chair ? "*" : ""
													%>
												</span>

												<span class="twothirds nospace nowrap">
<%perl>
						 							foreach my $ballot (@ballots) {

														next if $ballot->judge->id ne $judge->id;

														my %values = ();

														foreach my $score ($ballot->values) {

															if ($score->student && $score->student->id) {

																$values{$score->student->id}{$score->tag} = $score->value;
																$values{"total_".$score->tag} += $score->value;
															} elsif ($score->tag eq "ballot") {

																$values{$score->tag} = "L"
																	unless $score->value;

																$values{$score->tag} = "W"
																	if $score->value;
															} else {
																$values{$score->tag} = $score->value;
															}
														}
</%perl>
%														if ($event_type eq "wudc") {

															<span class="sixth padless marno">
																<% $values{"rank"}
																	? Lingua::EN::Numbers::Ordinate::ordinate($values{"rank"})
																	: ""
																%>
															</span>

%														} else {

%															if ($ballot->bye) {

																<span class="sixth padless marno">
																	BYE
																</span>

%															} elsif ($ballot->forfeit) {

																<span class="sixth padless marno">
																	FFT
																</span>

%															} else {

																<span class="sixth padless marno">

																	<div class="padless marless centeralign semibold bluetext">
																		<% $values{"ballot"}  %>
																	</div>

%																	if ($event->type eq "wsdc") {

																		<div class="padless marless centeralign semibold">
																			<% $values{"total_rebuttal_points"}
																				+ $values{"total_points"} %>
																		</div>
%																	}

																</span>
%															}
%														}

														<span class="fivesixths smaller padless marno">

<%perl>
														foreach my $student (@students) {

															next unless $values{$student->id}{"points"}
																|| $values{$student->id}{"rank"};

</%perl>
															<div class="nospace padless">

																<span class="quarter padleft nospace nowrap">
																	<% $values{$student->id}{"points"} %>
																</span>

																<span class="sixth">
																	<% $values{$student->id}{"rank"} %>
																</span>

																<span class="threefifths nospace">
																	<% $student->last.", ".$student->first %>
																</span>

															</div>
%					 									}

%														if ($event->type eq "wsdc") {

%															foreach my $student (@students) {

%																next unless $values{$student->id}{"rebuttal_points"};

																<div class="nospace padless">

																	<span class="quarter padleft nospace nowrap">
																		<% $values{$student->id}{"rebuttal_points"} %>
																	</span>

																	<span class="sixth">
																	</span>

																	<span class="threefifths nospace">
																		Reply: <% $student->first." ".$student->last %>
																	</span>
																</div>
%					 										}

%														}

%													}

												</span>

											</div>
%										}
%		 							}

								</td>
%							}

%						} else {

							<td class="smaller nospace">
								<% $panel->room ? $panel->room->name : "No Room" %>
							</td>

							<td class="smaller nospace">
<%perl>
								foreach my $judge (
									sort {$a->ballotid <=> $b->ballotid}
									$m->comp("/funclib/panel_judges.mas", panel => $panel)
								) {

</%perl>
									<div class="full nospace nowrap">

										<span class="half nospace smaller">
											<% $category_settings{'no_codes'}
												? $judge->last
												: $judge->code." ".$judge->last.", ".$judge->first
											%><% $judge->chair ? "*" : "" %>
										</span>

										<span class="half nospace smaller">

%				 							foreach my $ballot (@ballots) {

%												next unless $ballot->judge->id == $judge->id;

												<span class="third padleft">

													<% $ballot->forfeit ? "NoShow" : "" %>
													<% $ballot->bye ? "Bye" : "" %>

%													my @values = $ballot->values;

%													foreach my $value (@values) {
%														if ($value->tag eq "rank") {
														<% $value->value %>
%														}
%													}

												</span>

												<span class="twothirds marno">

%													my $notfirst;

%													foreach my $value (sort {$a->speech <=> $b->speech} @values) {

%														if ($value->tag eq "points") {
															<% $value->value %>
%						 								}

%														if ($value->tag eq "congress_speech") {
															<% $notfirst++ ? ", " : "" %>
															<% $value->value %>
%						 								}

%					 								}

												</span>

%											}

										</span>

									</div>

%		 						}

							</td>
%						}

						<td class="centeralign nospace nowrap">

							<a
								class="bluetext buttonwhite fa fa-sm fa-eye"
								href="/panel/schemat/panel_view.mhtml?panel_id=<% $panel->id %>"
								title="view Section"
							></a>

							<a
								class = "redtext buttonwhite fa fa-sm fa-retweet"
								title = "Move manually into a different section"
								href  = "/panel/manipulate/entry_edit.mhtml?entry_id=<% $entry->id %>&round_id=<% $round->id %>"
							></a>

%							if ($event->type eq "speech") {
								<a
									class = "greentext buttonwhite fa fa-sm fa-plus"
									title = "Move manually into a second section"
									href  = "/panel/manipulate/entry_edit.mhtml?entry_id=<% $entry->id %>&round_id=<% $round->id %>&add=1"
								></a>
%							}
						</td>

					</tr>

% 				}

%				unless (@panels) {

					<tr class="row">

						<td class="smaller centeralign">
							<span class="hidden"><% $round->name %></span>
							<% $round->realname %>
						</td>

						<td class="smaller">
							<span class="hidden"><% $round && $round->timeslot ? $round->timeslot->start->epoch : "" %></span>
							<% $round && $round->timeslot ? &Tab::nicetime($round->timeslot->start->set_time_zone($tz)) : "" %>
						</td>

						<td colspan="8" class="nospace">

							<span class="half nospace semibold redtext padleft">
								Not scheduled in
								<% ($round->label)
									? $round->label
									: "Round ".$round->name
								%>
							</span>

							<span class="quarter semibold bluetext">
								Add to round:
							</span>

							<span class="quarter padvertless marno">
								<a
									class = "greentext buttonwhite fa fa-plus fa-sm"
									href  = "/panel/manipulate/entry_edit.mhtml?entry_id=<% $entry->id %>&round_id=<% $round->id %>"
									title = "Add Manually to <% $round->realname %>"
								></a>
							</span>

						</td>
					</tr>
% 				}

% 			}

			</tbody>


		</table>
%	}

	</div>

	<div class="menu">

		<div class="sidenote">

%			unless ($only_category || $perms->{"details"}) {

% 				if ($tourn_settings->{"ncfl"}) {
					<a
						class="blue half marno"
						href="/register/region/tourn_entries.mhtml?region_id=<% $region->id %>"
					>
						<% $region->name %>
					</a>
%				}

				<a
					class="blue half"
					href="/register/school/entries.mhtml?school_id=<% $school->id %>"
				>
					<% $school->short_name %>
				</a>

				<a
					class = "blue half"
					href  = "/register/event/roster.mhtml?event_id=<% $event->id %>&sort=school"
				>
					All <% $event->abbr %> entries
				</a>

%			} else {
				<a
					class = "blue full"
					href  = "/register/event/roster.mhtml?event_id=<% $event->id %>&sort=school"
				>
					All <% $event->abbr %> entries
				</a>
%			}

		<h4>Printouts</h4>

% 		if ( $event_settings{"usa_wsdc"} ) {

			<a
				class = "blue full nowrap"
				href  = "/register/reports/usa_debate.mhtml?district_id=<% $entry->school->district->id %>"
			>
				<span class="quarter">
					Info Sheet
				</span>
				<span class='threequarters rightalign'>
					<% $entry->code %>
				</span>
			</a>

%		} else {

			<a
				class = "blue full nowrap"
				href  = "print.mhtml?entry_id=<% $entry->id %>"
			>
				<span class="quarter">
					Info Sheet
				</span>
				<span class='threequarters rightalign'>
					<% $entry->code %>
				</span>
			</a>
%		}

% 		if ($tourn_settings->{"ncfl"}) {
			<a
				class = "blue full"
				href  = "/funclib/ncfl/print_entry_card.mhtml?entry_id=<% $entry->id %>"
			>
				Print <% $entry->code %> NCFL Card
			</a>
%		}

% 		unless ( $event_settings{"usa_wsdc"} ) {
%			foreach my $student (@students) {

				<a
					class = "blue full nowrap"
					href  = "student_print.mhtml?student_id=<% $student->id %>"
				>
					<span class="third">
						Dance Card:
					</span>
					<span class="twothirds rightalign">
						<% $student->first." ".$student->last %>
					</span>
				</a>

%			}
%		}

		<h4 class="marbottomless martop">Entry Details</h4>

%			if ($tourn_settings->{"legion"}) {

				<a
					class = "martop marbottom blue full"
					href  = "/tabbing/report/legion_report.mhtml?school_id=<% $school->id %>"
				>
					Legion Results Sheet
				</a>

%			}

%			if ($category_settings{"prefs"}) {

				<a
					class = "yellow half marbottom"
					href  = "/register/entry/prefs.mhtml?entry_id=<% $entry->id %>&sort=school"
				>
					Pref Sheet
				</a>

				<a
					class = "yellow half marbottom"
					href  = "/register/entry/strikes.mhtml?entry_id=<% $entry->id %>"
				>
					Strikes &amp; Conflicts
				</a>

%			} else {

				<a
					class = "yellow full martop marbottom"
					href  = "/register/entry/strikes.mhtml?entry_id=<% $entry->id %>"
				>
					Strikes &amp; Conflicts
				</a>

%			}

			<label for="<% $entry->id %>_dropped">
				<div class="full nospace row hover">

					<span class="threequarters padleft nospace semibold biggish redtext">
						Drop/Stop Scheduling
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry->dropped %></span>

						<label class="switch smaller">
							<input
								type          = "checkbox"
								value         = "1"
								id            = "<% $entry->id %>_dropped"
								property_name = "dropped"
								target_type   = "entry"
								target_id     = "<% $entry->id %>"
								onChange      = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('dropped');"

								<% $entry->dropped ? 'checked="checked"' : "" %>
							>
							<div class="onred slider"></div>
						</label>

					</span>

				</div>
			</label>

% 			if ( $event_settings{"waitlist"} || $event_settings{"waitlist_all"} ) {

				<label for="<% $entry->id %>_waitlist">
				<div class="full nospace row hover">

					<span class="threequarters padleft nospace">
						Waitlisted <br />(notifies coaches by email)
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry->waitlist %></span>

						<label class="switch smaller">
							<input
								type          = "checkbox"
								value         = "1"
								id            = "<% $entry->id %>_waitlist"
								property_name = "waitlist"
								target_type   = "entry"
								target_id     = "<% $entry->id %>"
								onChange      = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('waitlist');"

								<% $entry->waitlist ? 'checked="checked"' : "" %>
							>
							<div class="onred slider"></div>
						</label>

					</span>

				</div>
				</label>

%			}

			<label for="<% $entry->id %>_ada">

			<div class="full nospace row hover">

				<span class="threequarters padleft nospace">
					ADA rooms
				</span>

				<span class="quarter nospace rightalign">

					<span class="hidden"><% $entry->ada %></span>

					<label class="switch smaller">
						<input
							type          = "checkbox"
							value         = "1"
							id            = "<% $entry->id %>_ada"
							property_name = "ada"
							target_type   = "entry"
							target_id     = "<% $entry->id %>"
							onChange      = "postSwitch(
								this,
								'entry_switch.mhtml'); statusSwitch('ada');"
							<% $entry->ada ? 'checked="checked"' : "" %>
						>
						<div class="slider"></div>
					</label>

				</span>

			</div>
			</label>

<%perl>

			my $warn = "You are about to disqualify this entry.  In IEs, other entries in the same section as this one will be promoted one rank if they scored below this entry in all rounds.  In debate no results changes will be made.  You can undo this if you change your mind.";

</%perl>

			<label for="<% $entry->id %>_dq">
			<div
				title = "<% $warn %>"
				class="full nospace row hover"
			>
				<span class="threequarters padleft nospace">
					Disqualify <% $tourn_settings->{"nsda_district"} ? "" : "(by NCFL Rule)" %>
				</span>

				<span class="quarter nospace rightalign">

					<span class="hidden"><% $entry->dq %></span>

					<label class="switch smaller">
						<input
							type          = "checkbox"
							value         = "1"
							id            = "<% $entry->id %>_dq"
							property_name = "dq"
							target_type   = "entry"
							target_id     = "<% $entry->id %>"
							onChange      = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('dq');"

							<% $entry->dq ? 'checked="checked"' : "" %>
						>
						<div class="onred slider"></div>
					</label>

				</span>

			</div>
			</label>

%			$warn = "Settings this to Y will cause this entry not to clear to the first elim break no matter their seed.";

			<label = "<% $entry->id %>_no_elims">

			<div
				title = "<% $warn %>"
				class="full nospace row hover"
			>

				<span class="threequarters padleft nospace">
					Ineligible for Elims
				</span>

				<span class="quarter nospace rightalign">

					<span class="hidden"><% $entry_settings{"no_elims"} %></span>

					<label class="switch smaller">
						<input
							type         = "checkbox"
							value        = "1"
							id           = "<% $entry->id %>_no_elims"
							setting_name = "no_elims"
							target_type  = "entry"
							target_id    = "<% $entry->id %>"
							onChange     = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('no_elims');"

							<% $entry_settings{"no_elims"} ? 'checked="checked"' : "" %>
						>
						<div class="onred slider"></div>
					</label>

				</span>

			</div>
			</label>

%			if ($tourn_settings->{"nsda_district"}) {

%				$warn = "Setting this will mean this entry will not qualify to nationals; set this if they've qualified in a higher priority event.";


				<label for="<% $entry->id %>_nsda_vacate">
				<div
					title = "<% $warn %>"
					class = "full marno padless row hover"
				>

					<span class="threequarters padleft nospace">
						Vacate spot to Nationals
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry_settings{"nsda_vacate"} %></span>

						<label class="switch smaller">
							<input
								type         = "checkbox"
								value        = "1"
								id           = "<% $entry->id %>_nsda_vacate"
								setting_name = "nsda_vacate"
								target_type  = "entry"
								target_id    = "<% $entry->id %>"
								onChange     = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('vacate');"

								<% $entry_settings{"nsda_vacate"} ? 'checked="checked"' : "" %>
							>
							<div class="onred slider"></div>
						</label>

					</span>

				</div>
				</label>

%			}

%			if ($tourn_settings->{"nsda_nats"}) {

				<label = "<% $entry->id %>_autoqual">

					<div
						title = "<% $warn %>"
						class="full nospace row hover"
					>

						<span class="threequarters padleft nospace">
							Auto-qualifier
						</span>

						<span class="quarter nospace rightalign">

							<span class="hidden"><% $entry_settings{"autoqual"} %></span>

							<label class="switch smaller">
								<input
									type         = "checkbox"
									value        = "1"
									id           = "<% $entry->id %>_autoqual"
									setting_name = "autoqual"
									target_type  = "entry"
									target_id    = "<% $entry->id %>"
									onChange     = "postSwitch( this, 'entry_switch.mhtml'); statusSwitch('autoqual');"

									<% $entry_settings{"autoqual"} ? 'checked="checked"' : "" %>
								>
								<div class="onred slider"></div>
							</label>

						</span>

					</div>
				</label>
%			}

%			if ($category_settings{"prefs"}) {

				<label for="<% $entry->id %>_open_prefs">

				<div class="full nospace row hover" >

					<span class="threequarters">
						Open prefs despite deadline:
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry_settings{"open_prefs"} %></span>

						<label class="switch smaller">
							<input
								type         = "checkbox"
								value        = "1"
								id           = "<% $entry->id %>_open_prefs"
								setting_name = "open_prefs"
								target_type  = "entry"
								target_id    = "<% $entry->id %>"
								onChange     = "
									postSwitch(
										this,
										'entry_switch.mhtml'
									);
									statusSwitch('open_prefs');"
								<% $entry_settings{"open_prefs"} ? 'checked="checked"' : "" %>
							>
							<div class="onred slider"></div>

						</label>

					</span>

				</div>

%			}

%			$warn = "Setting this will mean this entry will not qualify for team award points";

			<label for="<% $entry->id %>_exclude_from_sweeps">

				<div
					title = "<% $warn %>"
					class="full nospace row hover"
				>

					<span class="threequarters padleft nospace">
						Exclude from Sweepstakes
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry_settings{"exclude_from_sweeps"} %></span>

						<label class="switch smaller">
							<input
								type         = "checkbox"
								value        = "1"
								id           = "<% $entry->id %>_exclude_from_sweeps"
								setting_name = "exclude_from_sweeps"
								target_type  = "entry"
								target_id    = "<% $entry->id %>"
								onChange     = "postSwitch( this, 'entry_switch.mhtml');
												statusSwitch('exclude_from_sweeps');"

								<% $entry_settings{"exclude_from_sweeps"} ? 'checked="checked"' : "" %>
							>
							<div class="onred slider"></div>

						</label>

					</span>

				</div>

			</label>

%			if ($event->type eq "congress") {
			<label for="<% $entry->id %>_presiding_officer">

				<div
					title = "<% $warn %>"
					class = "full marno padless row hover"
				>

					<span class="threequarters nospace">
						Presiding Officer Nominee
					</span>

					<span class="quarter nospace rightalign">

						<span class="hidden"><% $entry_settings{"presiding_officer"} %></span>

						<label class="switch smaller">
							<input
								type         = "checkbox"
								value        = "1"
								id           = "<% $entry->id %>_presiding_officer"
								setting_name = "presiding_officer"
								target_type  = "entry"
								target_id    = "<% $entry->id %>"
								onChange     = "postSwitch( this, 'entry_switch.mhtml');
												statusSwitch('presiding_officer');"

								<% $entry_settings{"presiding_officer"} ? 'checked="checked"' : "" %>
							>
							<div class="slider"></div>

						</label>

					</span>

				</div>

			</label>
%			}

%			if ($max_flights > 1 && $entry_id) {

				<h4>Lock to Flight</h4>

				<form action="flight_save.mhtml" method="post">

				<div class="row centeralign ">

					<input
						type  = "hidden"
						name  = "entry_id"
						value = "<% $entry_id %>"
					>

					<select
						name	 = "flight"
						class	= "fixedsmall"
						onchange = 'this.form.submit();'
					>

						<option value="">None</option>

%					  	foreach my $flight ( 1 .. $max_flights) {
							<option
								value="<% $flight %>"
								<% $flight == $entry_settings{"preferred_flight"} ? "selected" : "" %>
							> <% $flight %> </option>
%				   		}
					</select>
				</div>
				</form>
%			}

		</div>

		<div class="sidenote">

			<h4>Swap Competitors</h4>

			<form action="change.mhtml" method="post">

			<input
				type  = "hidden"
				name  = "entry_id"
				value = "<% $entry_id %>"
			>

			<input
				type  = "hidden"
				name  = "school_id"
				value = "<% $school->id %>"
			>

<%perl>

			my $skip;

			$skip++ if $person->site_admin;
			$skip++ if $person_settings->{"nsda_admin"};

			my @clean_students = $m->comp(
				"/funclib/students_evententer.mas",
				tourn         => $tourn,
				event         => $event,
				school        => $school,
				skip_district => $skip
			);

			my $count = 1;

			my $max_entry = $event_settings{"max_entry"};
			$max_entry = 1 unless $max_entry;

</%perl>

%			foreach my $student (@students) {

				<div class="row marvertno">

					<span class="sixth nospace padleft">
						<% $count++ %>
					</span>

					<span class="fivesixth nospace">

						<select
							name	 = "<% $student->id %>"
							onchange = 'this.form.submit();'
							class	= "fixedmedsmall"
						>

							<option
								value="<% $student->id %>"
							><% $student->last.", ".$student->first %></option>

							<option value="0">No Partner/Maverick</option>

<%perl>

							my $last_chapter;

							foreach my $other_student (@clean_students) {

 				  				next if $entry_students{$other_student->id};

								if ($event_settings{"usa_wsdc"}) {

									if ($last_chapter != $other_student->chapter->id) {
										$m->print('</optgroup>');
										$m->print('<optgroup label="'.$other_student->chapter->name.'">');
										$last_chapter = $other_student->chapter->id;
									}

								}

</%perl>
								<option
									value="<% $other_student->id %>"
								> <% $other_student->last.", ".$other_student->first %> </option>
%							}

%							$m->print('</optgroup>') if $event_settings{"usa_wsdc"};

						</select>
					</span>

				</div>

%			}

%			if (scalar @students < $max_entry) {

				<div class="row">

					<span class="sixth nospace padleft">
						<% $count++ %>:
					</span>

					<span class="fivesixth nospace">

						<select
							name	 = "new"
							onchange = 'this.form.submit()'
							class	= "fixedmedsmall"
						>

							<option value="">
								Add student
							</option>

							<option value="0">No Partner/Maverick</option>

<%perl>
							my $last_chapter;

							foreach my $other_student (@clean_students) {

		  						next if $entry_students{$other_student->id};

								if ($event_settings{"usa_wsdc"}) {

									if ($last_chapter != $other_student->chapter->id) {
										$m->print('</optgroup>');
										$m->print('<optgroup label="'.$other_student->chapter->name.'">');
										$last_chapter = $other_student->chapter->id;
									}

								}

</%perl>
								<option
									value="<% $other_student->id %>"
									> <% substr($other_student->last.", ".$other_student->first,0,15) %> </option>
%							}

						</select>

					</span>

				</div>
%			}

			<noscript>

				<div class="libl rightalign">
					<input
						type  = "submit"
						class = "thin"
						value = "Save Changes">
				</div>

			</noscript>

			</form>

			<a
				href  = "/register/school/student_add.mhtml?all=yep&school_id=<% $school->id %>&from_entry=<% $entry->id %>"
				class = "yellow full martop marbottom"
			>
				Add competitor not on roster
			</a>

%			unless ($only_category || $perms->{"details"}) {
			<h4 class="martop">Swap Event/Division</h4>

			<form
				action = "change_event.mhtml"
				method = "post"
			>

			<input
				type  = "hidden"
				name  = "entry_id"
				value = "<% $entry_id %>"
			>

			<div class="full marno padless row centeralign">

				<span class="threequarter padleft">

					<select
						name  = "event_id"
						class = "fixedsmall"
					>

%						foreach my $event (sort {$a->name cmp $b->name} $tourn->events) {

							<option
								value="<% $event->id %>"
								<% $event->id == $entry->event->id ? "selected" : "" %>
							> <% substr($event->name,0,32) %> </option>
%						}

					</select>

				</span>

				<span class="quarter centeralign">
					<input
						type  = "submit"
						class = "thin"
						value = "Go"
					>
				</span>

			</div>

			</form>

%			}
			<h4>Swap School</h4>

			<form
				action = "school.mhtml"
				method = "post"
			>

			<input
				type  = "hidden"
				name  = "entry_id"
				value = "<% $entry->id %>"
			>

			<div class="full marno padless row centeralign">

<%perl>

				my @schools = $tourn->schools;

				@schools = Tab::School->search(
					region => $region,
					tourn  => $tourn->id
				) if $tourn_settings->{"ncfl"};

</%perl>
				<span class="threequarter padleft">

					<select
						name  = "school_id"
						class = "fixedsmall"
					>

%						foreach my $other_school (sort {$a->name cmp $b->name} @schools) {

							<option
								value="<% $other_school->id %>"
								<% $other_school->id == $school->id ? "selected" : "" %>
							> <% substr($other_school->name,0,32) %> </option>

%						}

					</select>
				</span>

				<span class="quarter centeralign">
					<input
						type  = "submit"
						class = "thin"
						value = "Go"
					>
				</span>

			</div>

			</form>

<%perl>
			my $now = DateTime->now(time_zone => $tz);
			my $start = $tourn->start;
			$start->set_time_zone($tz);

			unless ($start->epoch < $now->epoch) {
</%perl>

				<div class="full marno padtopmore">

				<h5>Delete Completely</h5>

%				my $warn = "This function will delete ANY RECORD of this entry, including results, history, opponent's records, and so on.  Please be sure you mean to do all these things before continuing.  <br /><br />It is much safer and more harmless to just hit Drop/Stop Scheduling above.";

				<a class = "full buttonwhite redtext centeralign invert"
					href = "delete.mhtml?entry_id=<% $entry->id %>"
					<& "/funclib/confirm.mas", warn => $warn &>
				>
					DELETE ENTRY COMPLETELY?!
				</a>

				</div>

%			}

		</div>


	</div>

	<br style="clear: both;" />
