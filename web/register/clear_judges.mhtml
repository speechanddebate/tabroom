<%args> 
	$circuit
	$event_id
	$tourn
	$err => undef
</%args> 
<%init> 

	my $event = Tab::Event->retrieve($event_id);
	my @judges = $event->class->judge_group->judges;

	my %schools_in_event = ();
	my @schools = $tourn->schools;

	foreach my $school (@schools) { 

		my @entries = Tab::Entry->search( event => $event_id, school => $school->id);
		$schools_in_event{$school->id}++ if @entries;

	}

	Tab::Judge->columns(TEMP => qw/region_name qual_name/);

	foreach my $judge (@judges) { 

		$judge->region_name($judge->school->chapter->region($circuit)->name) 
				if $judge->school && $judge->school->chapter 
					&& $judge->school->chapter->region($circuit);

 		my @qual = Tab::JudgeClass->search( 
					judge => $judge->id, 
					class => $event->class->id );

		$judge->qual_name($qual[0]->qual->name) if @qual && $qual[0]->qual;
	}

	@judges = sort {$a->last cmp $b->last} @judges;
	@judges = sort {$a->school->name cmp $b->school->name} @judges;
	@judges = sort {$a->region_name cmp $b->region_name} @judges;
	@judges = sort {$a->qual_name cmp $b->qual_name} @judges;

</%init> 

<p><font color="red"><% $err %></font></p>

<form action="judges.mhtml" method="post">

<table cellpadding="0" cellspacing="0" width="100%">
<tr>
<td width="100%">
<h3>Judges without competitors in <% $event->name %> </h3>
</td>

<td>
<input  type="submit" value="Return to Judges">
</td>
</form>

</table>

<form action="block_elim_judges.mas" method="post">
<input type="hidden" name="event_id" value="<% $event->id %>">

<center>

<table cellpadding="4" cellspacing="0" width="95%">

%	my $switch;

% JUDGE:
% foreach my $judge (@judges) { 
% next if $judge->school && $schools_in_event{$judge->school->id};
% next if $judge->active == 0;
% next if Tab::Strike->search( judge => $judge->id, event => $event_id, type => "event");
% $switch++;

<tr <% ($switch % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

	<td>
	<a href="<% $Tab::url_prefix %>/register/judge_edit.mhtml?judge_id=<% $judge->id %>">
	<% $judge->code %>
	</a>
	</td>

	<td>
	<% $judge->first." ".$judge->last %>
	</td>

	<td>
	<% ($judge->school && $judge->school->id > 0) ? $judge->school->name : "Hired" %>
	</td>

% if ($circuit->region_based) {

	<td>
	<% $judge->region_name %>
	</td>

% }

	<td>
	<% $judge->qual_name %>
	</td>

<td>Block: <input type="checkbox" value="1" name="block_<%$judge->id%>"   
			<% (Tab::Strike->search( judge => $judge->id, event => $event_id, type => "elim")) ?
					"checked" : "" %> > </td>

</tr>

% }

<tr><td colspan="5" align="center"><input  type="submit" value="Save Blocks"></td></tr>

</table>
</center>
</form>


