<%args>
	$judge_id
	$tourn
	$perms
	$tourn_settings
	$only_category => undef
</%args>
<%init>

	my $judge = Tab::Judge->retrieve($judge_id) if $judge_id;

	$m->comp("/funclib/abort.mas",
		warning => "No judge found with id $judge_id"
	) unless $judge;

	my $category = $judge->category;
	my $start    = $tourn->start;
	my $end      = $tourn->end;

	our $tz;
	$tz = $tourn->tz;
	$tz = "UTC" unless $tz;

	$start->set_time_zone($tz);
	$end->set_time_zone($tz);

	my $morning = DateTime->new(
		hour      => 8,
		minute    => 00,
		second    => 00,
		year      => $start->year,
		month     => $start->month,
		day       => $start->day,
		time_zone => $tz
	);

	my $night = DateTime->new(
		hour      => 20,
		minute    => 00,
		second    => 00,
		year      => $end->year,
		month     => $end->month,
		day       => $end->day,
		time_zone => $tz
	);

	my %entries = $m->comp(
		"/funclib/tourn_entries_hash.mas",
		tourn => $tourn
	);

	my %judges = $m->comp(
		"/funclib/tourn_judges_hash.mas",
		tourn => $tourn
	);

	my %students = $m->comp(
		"/funclib/tourn_students_hash.mas",
		tourn => $tourn
	);

	my %schools = $m->comp(
		"/funclib/tourn_schools.mas",
		tourn   => $tourn,
		actives => 1
	);

	my @timeslots = $m->comp(
		"/funclib/category_timeslots.mas",
		category => $category
	);

	my @days = $m->comp(
		"/funclib/tourn_days.mas",
		tourn => $tourn
	);

	my @pools = $m->comp(
		"/funclib/tourn_jpools.mas",
		tourn => $tourn
	);

	my %links;

	$links{"edit"} = "edit.mhtml?judge_id=".$judge->id;

	$links{"pools"} = $links{"edit"}."&default=pools" if @pools;

	$links{"noms"} = $links{"edit"}."&default=noms" if $judge->setting("nomination");

	$links{"rounds"} = $links{"edit"}."&default=rounds"
		if $m->comp("/funclib/judge_panels.mas", judge => $judge);

	$links{"paradigm"} = $links{"edit"}."&default=paradigm"
		if ($category->setting("ask_paradigm") && $judge->person);

	$links{"strikes"} = "judge_strikes.mhtml?judge_id=".$judge->id;

	my $default = "strikes";

</%init>

%  	unless ($judge->hired || $only_category || $perms->{"details"}) {

		<&
			"/register/menubar.mas",
			school		 => $judge->school,
			whoami		 => "judges",
			tourn		  => $tourn,
			tourn_settings => $tourn_settings
		&>
%	} else {
		<div class="main">

		<% $judge->school ? '<h2>'.$judge->school->name.'</h2>' : "" %>

%	}

		<span class="half marno padless padvert judgeactive <% $judge->active ? "" : "redtext" %>">
			<h5 class="inline">
				<% $category->setting("no_codes") ? "" : $judge->code %>
				<% $judge ? $judge->first." ".$judge->last : "Add Judge" %>
				<h6 class="active semibold redtext inline <% $judge->active ? "hidden" : "" %>">
					&ndash; INACTIVE
				</h6>
			</h5>
		</span>

		<span class="half rightalign">
			<&
				"/funclib/tabs.mas",
					links   => \%links,
					default => $default,
					right   => "true",
					buttons => "true",
					large   => "true"
			&>
		</span>

		<span class="pagehalf">

%		if ($category->shifts) {

			<h5>Shifts unavailable</h5>

<%perl>

	   		foreach my $shift (
				sort {$a->start->epoch <=> $b->start->epoch}
				$category->shifts
			) {

				my $start = $shift->start->set_time_zone($tz);
				my $end = $shift->end->set_time_zone($tz);

				my $day_string = $start->day_abbr;

				my $start_string = $start->hour_12.":".$start->strftime('%M')." ".$end->strftime('%p');
				my $end_string = $end->hour_12.":".$end->strftime('%M')." ".$end->strftime('%p');;
</%perl>

				<label for="shift_<% $shift->id %>">

					<div class="row hover">

%						if ($shift->fine) {
							<span class="threetenths marno padleft smallish">
%						} else {
							<span class="fourtenths marno padleft smallish">
%						}
							<% $shift->name %>
						</span>

						<span class="eighth marno padless">
							<% $day_string %>
						</span>
						<span class="sixth marno padless rightalign">
							<% $start_string %>
						</span>-<span class="sixth marno padless">
							<% $end_string %>
						</span>

%						if ($shift->fine) {
							<span class="eighth fullheight marvert marbottomless">
								<% $tourn_settings->{"currency"}.$shift->fine %>
							</span>
%						}

						<span class="eighth marno hover rightalign">
							<label class="switch smaller">
								<input
									type          = "checkbox"
									value         = "1"
									id            = "shift_<% $shift->id %>"
									target_id     = "<% $judge->id %>"
									setting_name  = "<% $shift->id %>"
									property_name = "shift"
									onChange      = "postSwitch(this, 'strike_switch.mhtml');"
									<% $shift->strike($judge) ? 'checked="checked"' : "" %>
								>
								<div class="slider onred smallish"></div>
							</label>
						</span>
					</div>
				</label>
				</form>
%			}
%   	}

		<h5>Time based</h5>

%		if (scalar @days > 1) {

			<form
				action = "strike_save.mhtml"
				method = "post"
			>

			<input
				type  = "hidden"
				value = "day"
				name  = "type"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter semibold bluetext padsetting">
					Whole day
				</span>

				<span class="threequarters nospace padless rightalign">

<%perl>
					my $first;
					foreach my $day (@days)  {

						my $start_time = "00:00:00";
						my $end_time = "23:59:00";

						$day->set_time_zone($tz);

						my $start_dt = $day->clone;
						my $end_dt = $day->clone;

						$start_dt->set(
							hour	  => "00",
							minute	=> "00",
							second	=> "00"
						);

						$end_dt->set(
							hour	  => "23",
							minute	=> "59",
							second	=> "00"
						);

						next unless ($start_dt && $end_dt);

						my $existing = Tab::Strike->search(
							judge => $judge->id,
							tourn => $tourn->id,
							type  => "time",
							start => $start_dt,
							end   => $end_dt
						)->first;
</%perl>

						<label for="day_<% $day->mdy %>">

							<span class="quarter hover nospace">

								<span class="half marno centeralign">
									<% $day->day_abbr %>
								</span>

								<span class="half marno">

									<label class="switch smaller right">
										<input
											type          = "checkbox"
											value         = "1"
											id            = "day_<% $day->mdy %>"
											target_id     = "<% $judge->id %>"
											setting_name  = "<% $day->mdy %>"
											property_name = "day"
											onChange      = "postSwitch(this, 'strike_switch.mhtml');"
											<% $existing ? 'checked="checked"' : "" %>
										>
										<div class="slider onred smallish"></div>
									</label>
								</span>
							</span>
						</label>

%	   				}
				</span>
			</div>
			</form>
%		}

		<form
			action = "strike_save.mhtml"
			method = "post"
		>

		<input
			type  = "hidden"
			value = "timeslot"
			name  = "type"
		>

		<input
			type  = "hidden"
			value = "<% $judge->id %>"
			name  = "judge_id"
		>

		<div class="row">

			<span class="quarter padsetting marvert semibold bluetext">
				Timeslot
			</span>

			<span class="threequarters rightalign">

				<select
					onChange = "this.form.submit();"
					name     = "timeslot_id"
					class    = "fixedmed"
				>
				<option value=""></option>

<%perl>
					foreach my $timeslot (@timeslots) {

						my $start = $timeslot->start->set_time_zone($tz);
						my $end = $timeslot->end->set_time_zone($tz);

						my $start_string = $start->day_abbr." ".$start->hour_12.":".$start->strftime('%M');
						my $end_string = $end->hour_12.":".$end->strftime('%M')." ".$end->strftime('%p');;
</%perl>
						<option
							value="<% $timeslot->id %>"
						><% $timeslot->name %> (<% $start_string."-".$end_string %>)</option>
%					}
				</select>
			</span>
			</form>

		</div>


		<form
			action = "strike_save.mhtml"
			method = "post"
		>

		<input
			type  = "hidden"
			value = "departure"
			name  = "type"
		>

		<input
			type  = "hidden"
			value = "<% $judge->id %>"
			name  = "judge_id"
		>

%		my $d_strike = $judge->strikes(type => "departure")->first;
%		my $departure = eval{ return $d_strike->start->set_time_zone($tourn->tz); };

		<div class="row">

			<span class="eighth padsetting semibold bluetext">
				Departs
			</span>

			<span class="half nospace">
%				if (scalar @days > 3) {
%					foreach my $day (@days) {
						<label for="departure_<% $day->ymd %>">
							<span class="quarter hover marno padless smallish">
								<input
									type  = "radio"
									name  = "departure_date"
									value = "<% $day->mdy('/') %>"
									id	= "departure_<% $day->ymd %>"
									<% ($departure && $departure->ymd eq $day->ymd) ? "checked" : "" %>
								>
								<% substr($day->day_abbr, 0, 2) %>
							</span>
						</label>
%					}
%				} elsif (scalar @days > 1) {
%					foreach my $day (@days) {
						<label for="departure_<% $day->ymd %>">
							<span class="third hover nospace smallish">
								<input
									type  = "radio"
									name  = "departure_date"
									value = "<% $day->mdy('/') %>"
									id	= "departure_<% $day->ymd %>"
									<% ($departure && $departure->ymd eq $day->ymd) ? "checked" : "" %>
								>
								<% $day->day_abbr %>
							</span>
						</label>
%					}
%			  	} else {
					<input
						type  = "hidden"
						name  = "departure_date"
						value = "<% $days[0]->mdy('/') %>"
					>
%				}
			</span>

			<span class="twotenths marno">
				@
				<& "/funclib/timepicker.mas",
					name => "departure_time",
					size => 6,
					time => $departure
				&>
			</span>

			<span class="nospace rightalign eighth">
				<input
					type  = "submit"
					value = "Save"
					class = "thin"
				>
			</span>

			</form>

		</div>

		<h5>Event/division</h5>

		<form
			action="strike_save.mhtml"
			method="post"
		>

		<input
			type  = "hidden"
			value = "event"
			name  = "type"
		>

		<input
			type  = "hidden"
			value = "<% $judge->id %>"
			name  = "judge_id"
		>

		<div class="row">

			<span class="threeeighths padsetting semibold bluetext">
				No rounds in
			</span>

			<span class="half">
				<select
					onChange = "this.form.submit();"
					name	 = "event"
					class	= "fixedmed"
				>
					<option value=""></option>
%					foreach my $event ($category->events) {
						<option
							value="<% $event->id %>"
						><% $event->name %></option>
%					}
				</select>
			</span>
		</div>

		</form>

		<form
			action="strike_save.mhtml"
			method="post"
		>

		<input
			type  = "hidden"
			value = "elim"
			name  = "type"
		>
		<input
			type  = "hidden"
			value = "<% $judge->id %>"
			name  = "judge_id"
		>

		<div class="row">

			<span class="threeeighths padsetting semibold bluetext">
				Elim rounds only in
			</span>

			<span class="half">

				<select
					onchange = "this.form.submit();"
					name	 = "event"
					class	= "fixedmed"
				>

					<option value=""></option>
%					foreach my $event ($category->events) {
						<option
							value="<% $event->id %>"
						> <% $event->name %> </option>
%					}
				</select>
			</span>

		</div>
		</form>

	</span>

	<span class="pagehalf">

		<h5>Competitors</h5>

			<form
				action="strike_save.mhtml"
				method="post"
			>

			<input
				type  = "hidden"
				value = "entry"
				name  = "type"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter padsetting semibold bluetext">
					Strike Entry
				</span>

				<label for="registrant_byentry">
					<span class="quarter hover">
						<input
							type  = "checkbox"
							name  = "registrant"
							value = "1"
							id    = "registrant_byentry"
						>Visible*
					</span>
				</label>

				<span class="half centeralign">
					<select
						onchange = "this.form.submit();"
						name	 = "entry_id"
						class	= "fixedmed"
					>

					<option value=""></option>
<%perl>
					foreach my $entry_id (
						sort {$entries{$a}{"code"} <=> $entries{$b}{"code"}}
						keys %entries
					) {
</%perl>
						<option
							value="<% $entry_id %>"
						><%
							$entries{$entry_id}{"region_code"}
						%> <%
							$entries{$entry_id}{"school_code"}
						%> <%
							$entries{$entry_id}{"code"}
						%> <%
							$entries{$entry_id}{"name"}
						%></option>
%					}
					</select>
				</span>

			</div>
			</form>

			<form
				action="strike_save.mhtml"
				method="post"
			>

			<input
				type  = "hidden"
				value = "student"
				name  = "type"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter padsetting semibold bluetext">
					Strike Person
				</span>

				<label for="registrant_bycomp">
					<span class="quarter hover">
						<input
							type  = "checkbox"
							name  = "registrant"
							value = "1"
							id    = "registrant_bycomp"
						>Visible*
					</span>
				</label>

				<span class="half centeralign">
					<select
						onchange = "this.form.submit();"
						name	 = "student_id"
						class	= "fixedmed"
					>

					<option value=""></option>
<%perl>
					foreach my $student_id (
						sort {$students{$a}{"code"} <=> $students{$b}{"code"}}
						keys %students
					) {
</%perl>
						<option
							value="<% $student_id %>"
						><%
							$students{$student_id}{"region_code"}
						%> <%
							$students{$student_id}{"school_code"}
						%> <%
							$students{$student_id}{"code"}
						%> <%
							$students{$student_id}{"name"}
						%></option>
%					}
					</select>
				</span>

			</div>
		</form>


			<form
				action="strike_save.mhtml"
				method="post"
			>

			<input
				type  = "hidden"
				value = "student"
				name  = "type"
			>

			<input
				type  = "hidden"
				value = "1"
				name  = "conflict"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter padsetting semibold bluetext">
					Conflict
				</span>

				<label for="registrant_compconflict">
					<span class="quarter hover">
						<input
							type  = "checkbox"
							name  = "registrant"
							value = "1"
							id    = "registrant_compconflict"
						>Visible*
					</span>
				</label>

				<span class="half centeralign">
					<select
						onchange = "this.form.submit();"
						name	 = "student_id"
						class	= "fixedmed"
					>

					<option value=""></option>
<%perl>
					foreach my $student_id (
						sort {$students{$a}{"code"} <=> $students{$b}{"code"}}
						keys %students
					) {
</%perl>
						<option
							value="<% $student_id %>"
						><%
							$students{$student_id}{"region_code"}
						%> <%
							$students{$student_id}{"school_code"}
						%> <%
							$students{$student_id}{"code"}
						%> <%
							$students{$student_id}{"name"}
						%></option>
%					}
					</select>
				</span>

			</div>
		</form>


		<h5>Schools</h5>

			<form
				action = "strike_save.mhtml"
				method = "post"
			>

			<input
				type	= "hidden"
				value   = "school"
				name	= "type"
			>

			<input
				type	= "hidden"
				value   = "1"
				name	= "conflict"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter padsetting semibold bluetext">
					Conflict
				</span>

				<label for="registrant_confschool">
					<span class="quarter hover">
						<input
							type  = "checkbox"
							name  = "registrant"
							id    = "registrant_confschool"
							value = "1"
						>Visible*
					</span>
				</label>

				<span class="half">

					<select
						onchange = "this.form.submit();"
						name	 = "school"
						class	= "fixedmed"
					>
					<option value=""></option>

<%perl>

						foreach my $school_id (
							sort {$schools{$a}{"name"} cmp $schools{$b}{"name"}}
							keys %schools
						) {
</%perl>

%							next unless $schools{$school_id}{"chapter_id"};

							<option
								value="<% $school_id %>"
							> <%
								$schools{$school_id}{"code"}
							%> <%
								$schools{$school_id}{"name"}
							%> <%
								$schools{$school_id}{"region_name"}
							%> <%
								$schools{$school_id}{"region_code"}
							%> </option>
%						}
					</select>
				</span>

			</div>
			</form>

			<form
				action = "strike_save.mhtml"
				method = "post"
			>

			<input
				type	= "hidden"
				value   = "school"
				name	= "type"
			>

			<input
				type  = "hidden"
				value = "<% $judge->id %>"
				name  = "judge_id"
			>

			<div class="row">

				<span class="quarter padsetting semibold bluetext">
					Strike
				</span>

				<label for="registrant_byschool">
					<span class="quarter hover">
						<input
							type  = "checkbox"
							name  = "registrant"
							id    = "registrant_byschool"
							value = "1"
						>Visible*
					</span>
				</label>

				<span class="half">

					<select
						onchange = "this.form.submit();"
						name	 = "school"
						class	= "fixedmed"
					>
					<option value=""></option>

<%perl>

						foreach my $school_id (
							sort {$schools{$a}{"name"} cmp $schools{$b}{"name"}}
							keys %schools
						) {
</%perl>

%							next unless $schools{$school_id}{"chapter_id"};

							<option
								value="<% $school_id %>"
							> <%
								$schools{$school_id}{"code"}
							%> <%
								$schools{$school_id}{"name"}
							%> <%
								$schools{$school_id}{"region_name"}
							%> <%
								$schools{$school_id}{"region_code"}
							%> </option>
%						}
					</select>
				</span>

			</div>
			</form>

% 			if ($tourn_settings->{"regions"}) {

				<h5>Region</h5>

				<form
					action="strike_save.mhtml"
					method="post"
				>
				<input
					type  = "hidden"
					value = "region"
					name  = "type"
				>
				<input
					type  = "hidden"
					value = "<% $judge->id %>"
					name  = "judge_id"
				>

				<div class="row">

					<span class="quarter padsetting semibold bluetext">
						Conflict
					</span>
					<label for="registrant_strike_region">
						<span class="quarter hover">
							<input
								type  = "checkbox"
								name  = "registrant"
								value = "1"
								id    = "registrant_strike_region"
							>Visible*
						</span>
					</label>

					<span class="half">
						<select
							onchange = "this.form.submit();"
							name	 = "region"
							class	= "fixedmed"
						>
							<option value=""></option>
%							foreach my $region (sort {$a->name cmp $b->name} $tourn->regions) {
								<option value="<% $region->id %>"> <% $region->name %> </option>
%							}
						</select>
					</span>

				</div>
				</form>
%			}

% 			if ($tourn_settings->{"nsda_nats"}) {

				<h5>Districts</h5>

				<form action="strike_save.mhtml" method="post">

				<input
					type  = "hidden"
					value = "district"
					name  = "type"
				>

				<input
					type  = "hidden"
					value = "<% $judge->id %>"
					name  = "judge_id"
				>

				<div class="row">

					<span class="quarter padsetting semibold bluetext">
						Conflict
					</span>

					<label for="registrant_strike_district">
						<span class="quarter hover">
							<input
								type  = "checkbox"
								name  = "registrant"
								value = "1"
								id    = "registrant_strike_district"
							>Visible*
						</span>
					</label>

					<span class="half">
						<select
							onchange = "this.form.submit();"
							name	 = "district"
							class	= "fixedmed"
						>
							<option value=""></option>
<%perl>
						foreach my $district (
							sort {$a->name cmp $b->name}
							$m->comp("/funclib/tourn_districts.mas", tourn => $tourn)
						) {
</%perl>
								<option
									value="<% $district->id %>"
								><% $district->code %> <% $district->name %> </option>
%						}
						</select>
					</span>

				</div>

				</form>

%			}

%			if ($tourn_settings->{"ncfl"}) {

				<form
					action = "strike_save.mhtml"
					method = "post"
				>

				<input
					type  = "hidden"
					value = "region"
					name  = "type"
				>

				<input
					type  = "hidden"
					value = "<% $judge->id %>"
					name  = "judge_id"
				>

				<h5 class="martopmore">
					Diocese
				</h5>

				<div class="row">

					<span class="quarter padsetting semibold bluetext">
						Conflict
					</span>

					<label for="registrant_strike_diocese">
						<span class="quarter hover">
							<input
								type  = "checkbox"
								name  = "registrant"
								value = "1"
								id    = "registrant_strike_diocese"
							>Visible*
						</span>
					</label>

					<span class="half">

						<select onchange="this.form.submit();"
							name  = "region"
							class = "fixedmed"
						>
							<option value=""></option>
<%perl>
						foreach my $region (
							sort {$a->name cmp $b->name}
							$m->comp("/funclib/tourn_regions.mas", tourn => $tourn)
						) {
</%perl>
							<option
								value="<% $region->id %>"
							> <% $region->name %> <% sprintf("%2s", $region->code) %> </option>
%						}
						</select>
					</span>

				</div>
				</form>

%			}

	</span>

		<h5 class="martopmore">
			Custom Time based
		</h5>

		<form
			action = "strike_save.mhtml"
			method = "post"
		>

		<input
			type  = "hidden"
			value = "time"
			name  = "type"
		>

		<input
			type  = "hidden"
			value = "<% $judge->id %>"
			name  = "judge_id"
		>

		<div class="row">

			<span class="fifth semibold bluetext">
				No rounds between
			</span>

			<span class="threefifths marno">

%	  			if (scalar @days > 1) {
%					my $first;
%					foreach my $day (@days)  {

						<label for="start_<% $day->ymd %>">

							<span class="sixth hover marno">

								<input
									type  = "radio"
									name  = "start_date"
									value = "<% $day->mdy('/') %>"
									id	= "start_<% $day->ymd %>"
									<% ($first++ < 1) ? "checked" : "" %>
								>
								<% $day->day_abbr %>
							</span>

						</label>
%	   				}

%			   	} else {

					<input
						type  = "hidden"
						name  = "start_date"
						value = "<% $start->mdy('/') %>"
					>

					<input
						type  = "hidden"
						name  = "end_date"
						value = "<% $start->mdy('/') %>"
					>
%	   			}

			</span>

			<span class="eighth">
				<& "/funclib/timepicker.mas",
					name => "start_time",
					size => 8,
					time => $morning
				&>
			</span>

		</div>

		<div class="row">

			<span class="fifth semibold bluetext">
				And
			</span>

			<span class="threefifths marno">

%   			if (scalar @days > 1) {

%					my $first;

%					foreach my $day (@days) {
						<label for="end_<% $day->ymd %>">
							<span class="sixth marno hover">
								<input
									type  = "radio"
									name  = "end_date"
									value = "<% $day->mdy('/') %>"
									id	= "end_<% $day->ymd %>"
									<% ($first++ < 1) ? "checked" : "" %>
								>
									<% $day->day_abbr %>
							</span>
						</label>
%	  				}
%	 			}
			</span>

			<span class="eighth">
				<& "/funclib/timepicker.mas",
					name => "end_time",
					size => 8,
					time => $night
				&>
			</span>

			<span class="twentieth padno marno rightalign">
				<input
					type  = "submit"
					class = "thin"
					value = "Save"
				>
				</form>
			</span>

		</div>

		<h5 class="martopmore">
			Clone Strikes &amp; Conflict
		</h5>

		<form
			action = "conflict_copy.mhtml"
			method = "post"
		>

		<input
			type  = "hidden"
			name  = "to_id"
			value = "<% $judge->id %>"
		>

		<div class="row">

			<span class="third semibold bluetext">
				Clone strikes/conflicts from:
			</span>

			<span class="twothirds">

				<select
					onchange = "this.form.submit();"
					name	 = "from_id"
					class	= "fixedbig"
				>

					<option value=""></option>
<%perl>
					foreach my $judge_id (
						sort {$judges{$a}{"last"} <=> $judges{$b}{"last"}}
						keys %judges
					) {
</%perl>
						<option
							value="<% $judge_id %>"
						><%
							$judges{$judge_id}{"region_code"}
						%> <%
							$judges{$judge_id}{"school_code"}
						%> <%
							$judges{$judge_id}{"code"}
						%> <%
							$judges{$judge_id}{"name"}
						%></option>
%					}
				</select>
			</span>

			<span class="quarter">
			</span>

		</div>

		<div class = "centeralign">

			<p class="semibold redtext bigger centeralign fivesixths">
				* Conflicts marked Visible will be seen by entries on pref sheets
					and by judges.   Strikes marked as Visible will be seen by entries
					on strike sheets and count against their quota.
			</p>

			<p class="semibold redtext bigger centeralign fivesixths">
				Any entrants without the visible flag will not be seen by judges or competitors
					and will not count against strike quotas.
			</p>

		</div>

	</div>

	<div class="menu">

		<div class="sidenote">

<%perl>
			my @strikes = $judge->strikes;
			my @conflicts;
			my @invisibles;
			my @visibles;

			foreach my $strike (@strikes) {
				if ($strike->registrant) {
					if ($strike->conflict) {
						push @conflicts, $strike;
					} else {
						push @visibles, $strike;
					}
				} else {
					push @invisibles, $strike;
				}
			}

			if (@visibles || @conflicts) {
				$m->print('<h4>Visible</h4>');
			}

			if (@visibles) {
   				$m->print("<h5>Strikes</h5>");
 				foreach my $strike (sort {$a->type cmp $b->type} @visibles) {
					&print_strike($strike);
				}
			}

			if (@conflicts) {
   				$m->print("<h5>Conflicts</h5>");
 				foreach my $strike (sort {$a->type cmp $b->type} @conflicts) {
					&print_strike($strike);
				}
			}

			if (@invisibles) {
				$m->print('<h4 class="martopmuchmore">Tab Room Only</h4>');
			}

			if (@invisibles) {
 				foreach my $strike (
					sort {
						$a->type cmp $b->type
						|| $a->start  <=> $b->start
						|| $a->entry  <=> $b->entry
						|| $a->school <=> $b->school
					} @invisibles
				) {
					&print_strike($strike);
				}
			}

		$m->print("</div>");
	$m->print("</div>");

	undef $tz;

	sub print_strike {

		my $strike = shift;

		my $entry_text;

		if ($strike->conflictee) {
			$entry_text .= "Judge Entered";
		}

		if ($strike->entered_by > 0) {
			$entry_text .= "By ".$strike->entered_by->first." ".$strike->entered_by->last." (".$strike->entered_by->email.")";
		}

		if ($strike->created_at) {
			$strike->created_at->set_time_zone($tz);
			$entry_text .= " At ".Tab::xmldt($strike->created_at);
		}

</%perl>

		<div
			id    = "<% $strike->id %>"
			class = "full odd marno padless"
			title = "<% $entry_text %>"
		>

			<span class="fivesixths nospace nowrap">
				<% $m->comp("/funclib/strike_name.mas", strike => $strike) %>
			</span>

			<span class="seventh centeralign nospace">
				<a
					class       = "buttonwhite redtext fa fa-sm fa-trash biggish marno padmuchless redborder"
					value       = "1"
					id          = "delete_<% $strike->id %>"
					target_type = "strike"
					target_id   = "<% $strike->id %>"
					on_success  = "destroy"
					onClick     = "postSwitch(this, 'strike_rm.mhtml');"
				></a>
			</span>

		</div>
%	}

