<%args>
	$tourn
	$group_id
	$sort_by => "code"
	$hires => undef
	$drops => undef
</%args>
<%init>

	my $group = Tab::JudgeGroup->retrieve($group_id); 

	my @judges = Tab::Judge->search( judge_group => $group_id, school => 0 ) if $hires;
	@judges = Tab::Judge->search( judge_group => $group_id, dropped => 1 ) if $drops;
	@judges = Tab::Judge->search( judge_group => $group_id) unless $hires || $drops;

	my @events = $group->events;

	@judges = sort {$a->last cmp $b->last} @judges;
	@judges = sort {$a->code cmp $b->code} @judges unless $sort_by eq "last" || $group->setting("no_codes");
	@judges = sort {$a->first cmp $b->first} @judges if $sort_by eq "first";
	@judges = sort {$a->school->name cmp $b->school->name} @judges if $sort_by eq "schname"; 
	@judges = sort {$a->region->name cmp $b->region->name} @judges if $sort_by eq "regname"; 
	@judges = sort {$a->region->code cmp $b->region->code} @judges if $sort_by eq "regcode"; 
	@judges = sort {$a->prelim_pool->name cmp $b->prelim_pool->name} @judges if $sort_by eq "prelim_pool"; 

	my $regions++ if $tourn->setting("ncfl");
	$regions++ if $tourn->setting("regions");

	Tab::Judge->set_sql( check_rounds => " select sum(obligation) from judge where judge.judge_group = ? ");
	my $rounds = Tab::Judge->sql_check_rounds->select_val($group->id);

</%init>

	<& menu.mas, tourn => $tourn, whoami => "roster", group => $group, hires => $hires, drops => $drops &>

	<div class="left huge">

	<span style="width: 400px; float: left;">
		<h2> <% ($hires) ? "Hired" : "" %> <% ($drops) ? "Dropped" : "" %> <% $group->name %> Judges </h2>
	</span>

	<span style="width: 250px; float: right;">
		<h4 class="rightalign" ><% ($rounds) ? $rounds." rounds/" : "" %><% scalar @judges." judges" %></h4>
	</span>

	<table cellpadding="3" cellspacing="1"  border="0" width="100%">

		<thead>

		<tr class="yellowrow">

%			unless ($group->setting("no_codes")) { 
				<th>
					<a class="white block" href="roster.mhtml?group_id=<% $group->id %>&sort_by=code">
					Code
					</a>
				</th>
%			}

			<th>
				<a class="white block" href="roster.mhtml?group_id=<% $group->id %>&sort_by=last">
				Name
				</a>
			</th>

			<th>
				<a class="white block" href="roster.mhtml?group_id=<% $group->id %>&sort_by=schname">
				School
				</a>
			</th>


%			if ($group->setting("rounds_per") || $rounds) { 
				<th class="centeralign smaller">
					Rounds<br/>/Hired
				</th>
%			}

%			if ($group->setting("coach_ratings")) { 
				
				<th class="centeralign">
					Rtng	
				</th>
%			}

%			$m->print("<th>Regcode</th>") if $tourn->setting("regions");

%			$m->print("<th>Diocode</th>") if $tourn->setting("ncfl");

			<th class="centeralign">
				Coach Notes
			</th>

%			if (  $group->setting("conflicts") || $group->setting("prefs") || $group->setting("entry_strikes") || $group->setting("school_strikes") ) { 
				<th class="smaller">
					Ratings
				</th>
%			}

		</tr>
		</thead>
		<tbody>

% 		my $switch;

%		foreach my $judge (@judges) { 

%			my $region = $m->comp('/funclib/school_region.mas', school => $judge->school->region) if $regions; 

			<tr class="<% ($switch++ % 2) ? "oddrow" : "evenrow"  %> <% ($judge->dropped && not defined $drops) ? "strike" : "" %>"> 

%			unless ($group->setting("no_codes")) { 
				<td align="center">
					<a class="white block" href="/register/judge/edit.mhtml?from=list&judge_id=<% $judge->id %>">
						<% ($judge->code) ? $judge->code : "Edit"%>
					</a>
				</td>
%			}

			<td>
				<a class="white block" href="/register/judge/edit.mhtml?from=list&judge_id=<% $judge->id %>">
					<% $judge->first %> <% $judge->last %>
				</a>
			</td>

			<td>
				<a class="white block" href="/register/school/judges.mhtml?from=list&school_id=<% ($judge->school) ? $judge->school->id : "" %>">
				<% ($judge->setting("neutral")) ? "Neutral (" : "" %><% ($judge->school && $judge->school->short_name) ? substr($judge->school->short_name,0,25) : "Hired" %><% ($judge->setting("neutral")) ? ")" : "" %>
				</a>
			</td>

%			if ($group->setting("rounds_per") || $rounds) { 

				<td class="centeralign">
%					if ($judge->dropped) { 
						DROP
%					} else { 
						<% $judge->obligation."/".$judge->hired %>
%					}
				</td>
%			}


%			if ($group->setting("coach_ratings")) { 

				<td class="smaller centeralign">
					<% $m->comp("/funclib/judge_rating.mas", judge => $judge, print => 1) %>
				</td>
%			}	

%			if ($tourn->setting("ncfl")) { 

				<td class="smaller centeralign">
					<% $region->code %>
				</td>

				<td class="smaller centeralign">
					<% ($group->setting("tab_room")) ? ($judge->setting("prelim_pool")) ? $judge->prelim_pool->name : $judge->judge_group->abbr : "" %>
				</td>

%			}	

			<td width="25%" class="smaller">
				<% $judge->notes %>
			</td>

%			if (  $group->setting("conflicts") || $group->setting("prefs") || $group->setting("entry_strikes") || $group->setting("school_strikes") ) { 
				<td>
					<a class="white block" href="prefs.mhtml?judge_id=<% $judge->id %>&roster=hello">
						View
					</a>
				</td>
%			}

		</tr>

% 		} 

		<tbody>

	</table>

</div>

