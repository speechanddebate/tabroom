<%args>
	$person
	$perms
	$jpool_id      => undef
	$property_name  => undef
	$tourn
	$tourn_settings
</%args>
<%init>

	$m->clear_buffer();
	$r->content_type('application/json');

	unless ($jpool_id) {
		$m->print('{ "error": true, "message": "No Judge Pool ID sent"}');
		$m->abort();
	}

	unless ($property_name && $property_name eq int($property_name)) {
		$m->print('{ "error": true, "message": "No judge ID to remove sent"}');
		$m->abort();
	}

	my $jpool = Tab::JPool->retrieve($jpool_id);
	my $message = "Judge removed from pool ".$jpool->name;

	Tab::JPoolJudge->set_sql( rm_judge => "
		delete from jpool_judge where jpool = ? and judge = ?
	");

	Tab::JPoolJudge->sql_rm_judge->execute($jpool_id, $property_name);

	if ($tourn_settings->{"nsda_nats"}) {

		my $response = $m->comp(
			"/funclib/nsda/judge_check.mas",
			tourn     => $tourn,
			judge_obj => $judge
		);

		if ($judge->school) {
			$m->comp("/funclib/judgemath/nats_check_judging.mas", school => $judge->school);
		}
	}

	$m->print('{
		"error"   : false,
		"message" : "'.$message.'"
	}');

	$m->flush_buffer();
	$m->abort();

</%init>
