<%args>
	$tourn
	$session
</%args>
<%init>

	my $name = $tourn->name;
	$name =~ s/[\W_]//g;

    my $filename = "SchoolContacts-".$name."-".$session->id;
    my $filepath = $Tab::file_root."tmp/".$filename;

    $m->comp("/funclib/printout.mas",
		tourn    => $tourn,
		filename => $filename,
		head     => 1
	);

    my $now = DateTime->now;
    $now->set_time_zone($tourn->tz);

    open (TEXOUT, ">>$filepath.tex");

	print TEXOUT "\\noindent\n";
	print TEXOUT "{\\bf \\Large School Contacts \\hfill ". Tab::texify($tourn->name) ." }\\\\ \n";
	print TEXOUT "\\medskip\n";
	print TEXOUT "\\newline\n";

	my $switch = 1;
	my $tabular = "\\begin{tabular}{p{1.5in}p{1.5in}p{2.0in}p{.95in}p{.55in}}\n";

	my $total_judge;
	my $total_student;

	print TEXOUT $tabular;
	print TEXOUT "\\rowcolor[rgb]{1,.95,.66}\[5.5pt\]\[5.5pt\]\n" if ($switch++ % 2);
	print TEXOUT  &Tab::texify("School")." & ";
	print TEXOUT  &Tab::texify("Contact Name")." & ";
	print TEXOUT  &Tab::texify("Contact Email")." & ";
	print TEXOUT  &Tab::texify("Contact Phone")." & ";
	print TEXOUT  &Tab::texify("Status");
	print TEXOUT "\\\\ \n";
	print TEXOUT "\\end{tabular}\n";
	print TEXOUT "\\newline\n";

	my %school_settings =
		$m->comp("/funclib/school_settings.mas",
			tourn => $tourn,
			value => 1
		);

	foreach my $school (sort { $a->short_name cmp $b->short_name } $tourn->schools) {

		print TEXOUT $tabular;
		print TEXOUT "\\rowcolor[rgb]{.94,.94,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch % 2);
		print TEXOUT "\\footnotesize ";
		print TEXOUT "\\truncate{1.45in}{";
		print TEXOUT  &Tab::texify($school->short_name)."} & ";

		my $number = $school_settings{$school->id}{"contact_number"};
		$number =~ s/[\D_]//g;

		print TEXOUT  &Tab::texify($school_settings{$school->id}{"contact_name"})." & ";
		print TEXOUT  &Tab::texify($school_settings{$school->id}{"contact_email"})." & ";
		print TEXOUT  &Tab::texify(Tab::phoneme($number))." & ";

		print TEXOUT  "Checked In" if $school->onsite;
		print TEXOUT "\\\\ \n";
		print TEXOUT "\\rowcolor[rgb]{.94,.94,.94}\[5.5pt\]\[5.5pt\]\n" if ($switch % 2);
		print TEXOUT " & \\footnotesize ";

		print TEXOUT  &Tab::texify($school_settings{$school->id}{"contact_hotel_rooms"})." rooms "
			if $school_settings{$school->id}{"contact_hotel_rooms"};

		print TEXOUT " & \\footnotesize ";
		print TEXOUT  &Tab::texify($school_settings{$school->id}{"contact_hotel"})." ";
		print TEXOUT " & \\footnotesize ";

		print TEXOUT " until " if $school_settings{$school->id}{"contact_hotel_checkout"};
		print TEXOUT &Tab::texify(
			Tab::niceshortdayte($school_settings{$school->id}{"contact_hotel_checkout"})
		)." & ";

		print TEXOUT "\\end{tabular}\n";
		print TEXOUT "\\newline\n";

		$switch++;

	}

    $m->comp("/funclib/printout.mas",
		tourn    => $tourn,
		filename => $filename,
		tail     => 1
	);

</%init>

