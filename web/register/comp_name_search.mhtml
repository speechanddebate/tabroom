<%args>
	$circuit
	$last_name
	$tourn
</%args>
<%init>

	$last_name = "%".$last_name."%";

	my @comps = Tab::Comp->search_mult_last_name($last_name, $tourn->id);
	push (@comps, Tab::Comp->search_stud_last_name($last_name, $tourn->id));
	push (@comps, Tab::Comp->search_part_last_name($last_name, $tourn->id));
	push (@comps, Tab::Comp->search_team_last_name($last_name, $tourn->id));

	#uniq
	my %seen = ();
	@comps = grep { ! $seen{$_->id} ++ } @comps;

	if (scalar @comps == 1) { 

		$m->redirect("$Tab::url_prefix/register/comp_edit.mhtml?comp_id=".$comps[0]->id);

	}

</%init>


	<div class="left huge">

	<h3>Compeitors with last name <% $last_name %></h3>

	<table cellpadding="7" cellspacing="1" width="100%">

%	my $switch;

%	foreach my $comp (@comps) { 

		<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>> 
		
			<th style="text-align: center;"> 
				<a href="<% $Tab::url_prefix %>/register/comp_edit.mhtml?comp_id=<% $comp->id %>"> 
					<% $comp->code." in ".$comp->event->abbr %>
				</a> 
			</td> 
			
			<td>
%				if ($comp->event->team == 1) { 
					<% $comp->student->first." ".$comp->student->last %>
%				}

%				if ($comp->event->team == 2) { 
					<% $comp->student->last." ".$comp->partner->last %>
%				}

%				if ($comp->event->team == 3) { 
					<% $comp->name %> (
%						foreach my $stud ($comp->members) { 
							<% $stud->first." ".$stud->last %>, 
%						}
					)
%				}
			</td> 
			
			<td>
				<% $comp->school->name %>
			</td>

%			if ($circuit->diocese_based || $circuit->region_based) { 

				<td>
					<% $comp->school->region->name %>
				</td>
%			}

		</tr>

% 	}

	</table>



