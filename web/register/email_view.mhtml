<%args>
	$circuit
	$tourn
	$account
	$email_id => undef
</%args>
<%init>

	my $email = Tab::Email->retrieve($email_id) if $email_id;

	use Text::Wrap
    $Text::Wrap::columns = 72;

	my $switch;

</%init>

	<div class="left huge">

%		if ($email_id) { 
	
			<h2>Email to entrants</h2>
				
			<table cellpadding="4" width="100%" cellspacing="1"> 
			
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
					<th>Subject:</th>
					<td><% $email->subject %></td>
				</tr>
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
					<th>Sender:</th>
					<td><% $email->sender->first." ".$email->sender->last %></td>
				</tr>
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
					<th>Sent to:</th>
					<td><% $email->sent_to %></td>
				</tr>
				
				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>
					<th>Sent on:</th>
					<td><% Tab::nicedt($email->senton->set_time_zone($circuit->timezone)) %></td>
				</tr>
				
				<tr>
					<th colspan="2">
						<h4>Text of message:</h4>
					</th>
				</tr>


				<tr>
					<td colspan="2">
						<pre><%	print wrap('', '', $email->text) %></pre>
					</td>
				</tr>

%				if ($account->site_admin) { 

					<tr class="lirdrow">

						<td>
							Email ID
						</td>

						<td>
							<% $email->id %>
						</td>

					</tr>
%				}
				
			</table>
				
%		}
	
	</div>

	<div class="right small">

		<a href="/register/email_entryose.mhtml" class="red block">Entryose New Email</a>

		<h4>Tournament email archive:</h4>

%			foreach my $archive (Tab::Email->search( tournament => $tourn->id )) {

				<a href="/register/email_view.mhtml?email_id=<% $archive->id %>" 
					class="<% ($archive->id == $email_id) ? "dkblue block" : "blue block" %>">
					<% $archive->subject %>
				</a>

%			}


	</div>


	<div style="clear: both;">
