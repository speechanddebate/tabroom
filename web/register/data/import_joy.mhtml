<%args>
	$tourn
	$tourn_settings
	$person
	$session
</%args>
<%init>

	my $ok;
	$ok++ if $person->site_admin;

</%init>

	<& "menu.mas", 
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		person         => $person,
		whoami         => 'import_joy',
		ok             => $ok
	&>

	<div class="main">

		<h4>Import Data from Joy of Tournaments</h4>

		<p>
			You must have created divisions/events and judge categories for the
			import to proceed properly.  The division/events are matched based
			on name; thus the division/event names in Tabroom must exactly
			match the names in the Joy and the Joy export file.
		</p>

		<p>
			Additionally, constraints on times and against schools will be
			listed in judges' notes section, but cannot be automatically added;
			you will have to manually enter them in as judge strikes.
		</p>


		<form 
			enctype  = "multipart/form-data"
			name     = "jotformat"
			action   = "import_joy_format.mhtml"
			method   = "post"
		>

		<p class="semibold martopmuchmore bluetext">
			You should prefer this importer to get data from JOT.  Download the
			JOT native import file.  You should have then fewer issues with
			mismatched school names (I hope!).
		</p>

		<div class="row full marno">

			<span class="twofifths">
				JOT Web Entries file (tourn.txt from website)
			</span>

			<span class="twofifths">

				<div class="uploader wider">

					<input 
						type     = "file"
						name     = "jotformat"
						style    = "opacity: 0;"
						onchange = "uploaderName('jotformat', 'jotformat_file')"
						id       = "jotformat"
					>

					<span 
						id    = "jotformat_file"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span 
						class = "action"
						style = "-webkit-user-select: none;"
					>Choose File</span>

				</div>
			</span>

			<span class="fifth rightalign">
				<input 
					type  = "submit"
					value = "Upload"
					class = "thin"
				>
			</span>

		</div>
		
		</form>

		<p class="semibold redtext martopmore">
			Use this only if the JOT native file uploader did not work.
		</p>

		<form 
			enctype  = "multipart/form-data"
			name     = "save"
			action   = "import_joy_save.mhtml"
			method   = "post"
		>

		<div class="row full marno">

			<span class="twofifths">
				JOT_Entries.txt (TRPC download) file:
			</span>

			<span class="twofifths">

				<div class="uploader wider">

					<input 
						type     = "file"
						name     = "entries"
						style    = "opacity: 0;"
						onchange = "uploaderName('entries', 'entries_file')"
						id       = "entries"
					>

					<span 
						id    = "entries_file"
						class = "filename"
						style = "-webkit-user-select: none;"
					>No file selected</span>

					<span 
						class="action" 
						style="-webkit-user-select: none;"
					>Choose File</span>
				</div>
			</span>

			<span class="fifth rightalign">
				<input 
					type  = "submit"
					value = "Upload"
					class = "thin"
				>
			</span>
		
			</form>

		</div>

		<form 
			enctype  = "multipart/form-data"
			name     = "save"
			action   = "import_joy_prefs.mhtml"
			method   = "post"
		>

		<div class="row full marno">

			<span class="sixth">
				Prefs.txt file:
			</span>

			<span class="third rightalign">

				<div class="uploader thinner leftalign">

					<input 
						type     = "file"
						name     = "prefs"
						style    = "opacity: 0;"
						onchange = "uploaderName('prefs', 'prefsfile')"
						id       = "prefs"
					>

						<span 
							id    = "prefsfile"
							class = "filename"
							style = "-webkit-user-select: none;"
						>No file selected</span>

						<span 
							class="action" 
							style="-webkit-user-select: none;"
						>Choose File</span>
				</div>

			</span>

			<span class="third centeralign">

				<select name="category_id" class="fixedsmall">

%					foreach my $category ($tourn->categories) { 
						<option value="<% $category->id %>">
							<% $category->abbr %>
						</option>
%					}

				</select>

			</span>

			<span class="eighth rightalign">

				<input 
					type="submit" 
					value="Upload" 
					class="thin"
				>
			</span>

		</div>
		
		</form>

		<h5 class="martopmore">
			Upload Tournament Results
		</h5>

		<form 
			enctype = "multipart/form-data"
			name    = "jotresults"
			action  = "import_joy_results.mhtml"
			method  = "post"
		>

			<p class="semibold martopmuchmore bluetext">
				This import will capture results from JOT, using the .jot files.
			</p>

			<div class="row full marno">

				<span class="twofifths">
					Tournament .jot results data:
				</span>

				<span class="twofifths">

					<div class="uploader wider leftalign">

						<input 
							type     = "file"
							name     = "resultsjot"
							style    = "opacity: 0;"
							onchange = "uploaderName('jotresults', 'jotresults_file');"
							id       = "jotresults"
						>

							<span 
								id    = "jotresults_file"
								class = "filename"
								style = "-webkit-user-select: none;"
							>No file selected</span>

							<span 
								class="action" 
								style="-webkit-user-select: none;"
							>Choose File</span>
					</div>

				</span>

				<span class="fifth rightalign">
					<input 
						type  = "submit"
						value = "Upload"
						class = "thin"
					>
				</span>

			</div>

		</form>

	</div>


