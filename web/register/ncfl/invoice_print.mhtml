<%args>
	$circuit
	$diocese_id
	$session
	$tourn
	$account
</%args>
<%init>

	my $diocese = Tab::Region->retrieve($diocese_id);
	my $filename = $Tab::file_root."/tmp/invoice-".$diocese->code."-".$session->id;
	
	my $garbage = `rm -f $filename.*`;

	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{colortbl}
\\usepackage{helvet}
\\usepackage{nopageno}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.5}
\\begin{document}
\\begin{center}


EOF

	close TEXOUT;

	$m->comp("/funclib/fees_print.mas", 
		id => $diocese_id, 
		tourn_id => $tourn->id, 
		filename => $filename, 
		circuit => $circuit
	);

	open (TEXOUT, ">>$filename.tex");
	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";
	close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

$m->redirect("$Tab::url_prefix/tmp/invoice-".$diocese->code."-".$session->id.".pdf");

</%init>

<div id="content">

<p><% $filename %></p>
