<%args>
	$league
	$tourn
	$account
	$sort_by => "name"
</%args>

<%init>
	
	my $filename = $Tab::file_root."/tmp/schoolcodes-$sort_by-".$tourn->id;
	
	my $garbage = `rm -f $filename.*`;
	
	open (TEXOUT, ">$filename.tex");

	print TEXOUT <<"EOF";
\\documentclass[10pt]{report}
\\usepackage{fullpage}
\\usepackage{nopageno}
\\usepackage{colortbl}
\\usepackage{times}
\\renewcommand{\\arraystretch}{1.2}

\\addtolength{\\textwidth}{1in}
\\addtolength{\\textheight}{.5in}
\\addtolength{\\hoffset}{-.1in}

\\begin{document}
\\normalsize
\\begin{center}

EOF

	print TEXOUT "{\\Large Schools attending ". Tab::texify($tourn->name) ." }\\\\ \n";
	print TEXOUT "\\bigskip\n";

my @schools = $tourn->schools;

if ($sort_by eq "name") { 

	@schools = sort { $a->name cmp $b->name } @schools;

}	

if ($sort_by eq "code") { 

	@schools = sort { $a->code cmp $b->code } @schools;

}

if ($sort_by eq "region") { 

	@schools = sort { $a->region->code cmp $b->region->code } @schools;

}

my $switch;

foreach my $school (@schools) { 

	print TEXOUT "\\begin{tabular}{p{.5in}p{4.0in}p{.5in}p{.5in}}\n";

	next if ($school->name eq "Unaffiliated");

	print TEXOUT "\\rowcolor[rgb]{.84,.89,.94}\n" if ($switch++ % 2);

	print TEXOUT  &Tab::texify($school->code)." & ".&Tab::texify($school->name);
	print TEXOUT " & ";
	print TEXOUT " ".&Tab::texify($school->chapter->state)."" 
				if $school->chapter->state;

	print TEXOUT " & ";

	print TEXOUT " ".&Tab::texify($school->region->code)."" 
				if $school->region;


	print TEXOUT "\\\\ \n";
	print TEXOUT "\\end{tabular}\n";

	print TEXOUT "\\newline\n";

}

	print TEXOUT "\\end{center}\n";
	print TEXOUT "\\end{document}\n";
	close TEXOUT;


$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;

`rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;

my $tourn_id = $tourn->id;
$m->redirect("$Tab::url_prefix/tmp/schoolcodes-$sort_by-$tourn_id.pdf");

</%init>

