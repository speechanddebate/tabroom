<%args> 
	$tourn
	$circuit
	$chapter_id => undef
	$school_id => undef
	$account
	$err => undef
</%args>

<%init>
	use POSIX;

	my $chapter;
	my $school;

	unless ($school_id || $chapter_id) { 
		$err = "You have accessed the registration page incorrectly.  Please try again.";
		$m->redirect("$Tab::url_prefix/register/entries.mhtml?err=$err");
	}

	if ($chapter_id) { 
		$chapter = Tab::Chapter->retrieve($chapter_id);
	}

	if ($school_id) {
		$school = Tab::School->retrieve($school_id);
		$chapter = $school->chapter;
	}

	my $region = $chapter->region($circuit) if $circuit->region_based;
	my @events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn);
	@events = sort { $a->name cmp $b->name } @events;
	my @groups = sort {$a->name cmp $b->name} $tourn->groups;

 	my $switch;

</%init>

	<& menubar.mas, school => $school, whoami => "students", tourn => $tourn &>

	<div class="left huge">

		<table cellpadding="4" border="0" width="100%" cellspacing="1">

% 			foreach my $event (@events) { 

% 				my @entries = Tab::Entry->search( 
%					event => $event->id, 
%					school => $school->id );

%				next unless @entries;

				<tr>
					<th colspan="5">
						<h4><% $event->name %></h4>
					</td>
				</tr>

% 				foreach my $comp (@entries) { 
				
					<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

						<td>
							<% ($event->no_codes) ? "" : $comp->code %>
						</td>
		
						<td>
							<a class="whiteblock" href="entry/edit.mhtml?comp_id=<% $comp->id %>">
							<% $comp->team_name %>
							</a>
						</td>

%						if ($tourn->method->ask_qualifying_tournament) { 
							<td>
								<% $comp->qualifier %> 
							</td>
%						}

						<td align="center">
							<% ($comp->waitlist) ? "<a class=\"whiteblock\" href=\"waitlist.mhtml?event_id=".$comp->event->id."\">Waitlisted</a>" : "" %>
							<% ($comp->dq) ? "Disqualified" : "" %>
							<% ($comp->dropped) ? "Dropped" : "" %> 
						</td>


						<td>
							<a class="whiteblock" href="<% ($comp->dropped) ? "comp_undrop.mas" : "comp_drop.mas" %>?comp_id=<% $comp->id %>&from=list">	
								<% ($comp->dropped) ? "Un-Drop" : "Drop" %>
							</a>
						</td>

					</tr>
%   			}

% 			}

		</table>

	</div>

	<div class="right small">

%		foreach my $event (sort {$a->name cmp $b->name} $m->comp("/funclib/tourn_events.mas", tourn => $tourn)) { 

			<a href="comp_enter.mhtml?school_id=<% $school->id %>&event_id=<% $event->id %>" class="blue block">
				Add <% $event->name %> entry
			</a>

%		}

	</div>
