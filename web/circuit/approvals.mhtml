<%args>
	$session
	$account	
	$circuit_id => undef
	$tz
</%args>
<%init>

	my $circuit = Tab::Circuit->retrieve($circuit_id);

	my @approvals = $m->comp("/funclib/circuit_tourns.mas", approval => 1, circuit => $circuit);

	my $switch ;
	my $school_year = Tab->school_year;

</%init>

	<div class="left huge">
	
		<h2>Tournaments Pending Approval</h2>
	
		<table cellpadding="6" cellspacing="1" width="100%">

			<tr class="liblrow">
				<th> 
					Tournament
				</th>
				<th>
					Dates
				</th>
				<th>
					Requestor
				</th>

				<th colspan="2">
					Actions
				</th>

			</tr>

%			foreach my $tourn (sort {$a->start->epoch <=> $b->start->epoch} @approvals) { 

%				next unless $tourn->start->epoch > $school_year->epoch;

				<tr <% ($switch++ % 2) ? "class=\"oddrow\"" : "class=\"evenrow\"" %>>

					<th class="smaller">
						<a class="white block" href="tourn_edit.mhtml?tourn_id=<% $tourn->id %>" class="whiteblock">
							<% $tourn->name %>
						</a>
					</th>

%					if ($account->site_admin && not defined $circuit_id) { 
						<td class="smaller">
							<a href="/admin/circuit_edit.mhtml?circuit_id=<% $tourn->circuit->id %>" class="whiteblock">
								<% $tourn->circuit->short_name %>
							</a>
						</td>

%					}

					<td class="smaller">
						<% Tab::niceshortdate($tourn->start->set_time_zone($tourn->tz)) %>
						<% ($tourn->start->mdy('') == $tourn->end->mdy('')) ? "" : "-".Tab::niceshortdate($tourn->end->set_time_zone($tourn->tz)) %>
					</td>

					<td class="smaller">
%						foreach my $director ($m->comp("/funclib/tourn_admins.mas", tourn => $tourn)) { 
							<% $director->first." ".$director->last %>
%						}
					</td>

					<td class="smaller">
						<a class="centeralign dkgreen block" href="approve.mhtml?tourn_id=<% $tourn->id %>&circuit_id=<% $circuit_id %>" class="whiteblock">
							Approve
						</a>
					</td>

					<td class="smaller">
						<a class="centeralign dkred block" href="delete_tournament.mhtml?circuit_id=<% $circuit_id %>&tourn_id=<% $tourn->id %>" class="whiteblock"
							onClick="if(confirm('This will remove the tournament from your circuit. Are you sure you want to so banish <% $tourn->name %>?'))
								return true;	
								else return false;"
						>
							Delete
						</a>
					</td>

				</tr>

%			}

		</table>

	</div>
