<%args>
	$circuit
	$tourn
	$session
	$event_id => undef
</%args>
<%init>

	my @events = $m->comp("/funclib/tourn_events.mas", tourn => $tourn) unless $event_id;
	push (@events, Tab::Event->retrieve($event_id)) if $event_id;

	@events = sort { $a->name cmp $b->name } @events;

	my $tourn_id = $tourn->id;
	my $filename = $Tab::file_root."/tmp/awards-".$tourn_id."-".$session->id;
	my $garbage = `rm -f $filename.*`;


open (TEXOUT, ">$filename.tex");

print TEXOUT <<"EOF";
\\documentclass[11pt]{report}
\\usepackage{fullpage}
\\usepackage{colortbl}
\\usepackage{helvet}
\\usepackage{nopageno}
\\renewcommand{\\familydefault}{\\sfdefault}
\\renewcommand{\\arraystretch}{1.7}
\\begin{document}

\\setlength{\\oddsidemargin}{-.5in}     
\\setlength{\\textwidth}{6.5in}        

\\setlength{\\textheight}{9in}       
\\setlength{\\topmargin}{-.25in}      
\\setlength{\\headsep}{0in}         

\\setlength{\\parskip}{1.4ex}
\\setlength{\\parindent}{0mm}

\\begin{center}
\\normalsize

EOF

foreach my $event (@events) { 

	next if $event->type eq "congress";
	next if $event->type eq "debate";
	next unless $event->comps;

	$m->comp("print_event_awards.mas", 
			filename => $filename, 
			event => $event, 
			circuit => $circuit);

}

close TEXOUT;


$m->comp("print_sweeps.mas", 
				filename => $filename, 
				tourn => $tourn, 
				view => "print") unless $event_id;

open (TEXOUT, ">>$filename.tex");

print TEXOUT "\\end{center}\n";
print TEXOUT "\\end{document}\n";
close TEXOUT;

$garbage = `cd $Tab::file_root/tmp; $Tab::latex_path $filename.tex; $Tab::dvipdfm_path $filename.dvi`;
#$garbage = `rm -f $filename.tex $filename.log $filename.dvi $filename.aux`;
$m->redirect("$Tab::url_prefix/tmp/awards-$tourn_id-".$session->id.".pdf");

</%init>
