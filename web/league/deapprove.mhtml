<%args>
	$tourn_id
	$account
	$circuit_id => undef
</%args>
<%init>

	my $tourn = Tab::Tournament->retrieve($tourn_id);

	my $circuit = $tourn->circuit if $circuit_id;

	unless ($account->site_admin || (grep $_->id == $circuit_id, $account->circuits)) {
		$m->print("<h2>Shenanigans!</h2> <p>I call shenanigans.  You do not have permissions to approve that tournament.  Stop trying.</p>");
		$m->abort;
	}

	$tourn->approved(0);
	$tourn->update;

	my $msg = "Tournament ".$tourn->name." has been de-approved.";

	$m->redirect("/circuit/approvals.mhtml?circuit_id=".$circuit_id."&msg=".$msg) if $circuit_id;

	$m->redirect("/circuit/approvals.mhtml?msg=".$msg) if $account->site_admin;

</%init>
